!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()}(this,function(){"use strict";function i(e){var t=n(e);return l.encodeByteArray(t,!0)}const t={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},f=function(e,t){if(!e)throw u(t)},u=function(e){return new Error("Firebase Database ("+t.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},n=function(t){const n=[];let r=0;for(let i=0;i<t.length;i++){let e=t.charCodeAt(i);e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(55296==(64512&e)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(e=65536+((1023&e)<<10)+(1023&t.charCodeAt(++i)),n[r++]=e>>18|240,n[r++]=e>>12&63|128):n[r++]=e>>12|224,n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n},l={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();var r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let u=0;u<n.length;u+=3){var s=n[u],a=u+1<n.length,o=a?n[u+1]:0,c=u+2<n.length,l=c?n[u+2]:0;let e=(15&o)<<2|l>>6,t=63&l;c||(t=64,a||(e=64)),i.push(r[s>>2],r[(3&s)<<4|o>>4],r[e],r[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var i,s,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(i=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&i)):239<a&&a<365?(s=((7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))):(i=e[n++],s=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&i)<<6|63&s))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let c=0;c<e.length;){var i=n[e.charAt(c++)],s=c<e.length?n[e.charAt(c)]:0;++c;var a=c<e.length?n[e.charAt(c)]:64;++c;var o=c<e.length?n[e.charAt(c)]:64;if(++c,null==i||null==s||null==a||null==o)throw Error();r.push(i<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==o&&r.push(a<<6&192|o))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},s=function(e){return i(e).replace(/\./g,"")},a=function(e){try{return l.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function c(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:const n=t;return new Date(n.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const r in t)t.hasOwnProperty(r)&&"__proto__"!==r&&(e[r]=c(e[r],t[r]));return e}class h{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(n){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof n&&(this.promise.catch(()=>{}),1===n.length?n(e):n(e,t))}}}function o(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(i)),""].join(".")}function d(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function r(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(d())}function p(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function g(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function m(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function v(){const e=d();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function y(){return!0===t.NODE_ADMIN}function _(){return"object"==typeof indexedDB}function w(){return new Promise((t,n)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var e;n((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){n(e)}})}function b(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class I extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,I.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,T.prototype.create)}}class T{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],s=s?(r=n,s.replace(E,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",s=`${this.serviceName}: ${s} (${i}).`;return new I(i,s,n)}}const E=/\{\$([^}]+)}/g;function k(e){return JSON.parse(e)}function C(e){return JSON.stringify(e)}function S(e){let t={},n={},r={},i="";try{var s=e.split(".");t=k(a(s[0])||""),n=k(a(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function N(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function R(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function x(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function D(e,t){if(e===t)return 1;const n=Object.keys(e),r=Object.keys(t);for(const a of n){if(!r.includes(a))return;var i=e[a],s=t[a];if(P(i)&&P(s)){if(!D(i,s))return}else if(i!==s)return}for(const o of r)if(!n.includes(o))return;return 1}function P(e){return null!==e&&"object"==typeof e}function O(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function M(e){const r={},t=e.replace(/^\?/,"").split("&");return t.forEach(e=>{var t,n;e&&([t,n]=e.split("="),r[decodeURIComponent(t)]=decodeURIComponent(n))}),r}function L(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,0<n?n:void 0)}class F{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(n,r){r=r||0;const i=this.W_;if("string"==typeof n)for(let e=0;e<16;e++)i[e]=n.charCodeAt(r)<<24|n.charCodeAt(r+1)<<16|n.charCodeAt(r+2)<<8|n.charCodeAt(r+3),r+=4;else for(let t=0;t<16;t++)i[t]=n[r]<<24|n[r+1]<<16|n[r+2]<<8|n[r+3],r+=4;for(let d=16;d<80;d++){var e=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=4294967295&(e<<1|e>>>31)}let t=this.chain_[0],s=this.chain_[1],a=this.chain_[2],o=this.chain_[3],c=this.chain_[4],l,u;for(let p=0;p<80;p++){u=p<40?p<20?(l=o^s&(a^o),1518500249):(l=s^a^o,1859775393):p<60?(l=s&a|o&(s|a),2400959708):(l=s^a^o,3395469782);var h=(t<<5|t>>>27)+l+c+u+i[p]&4294967295;c=o,o=a,a=4294967295&(s<<30|s>>>2),s=t,t=h}this.chain_[0]=this.chain_[0]+t&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+o&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(n,r){if(null!=n){var i=(r=void 0===r?n.length:r)-this.blockSize;let e=0;const s=this.buf_;let t=this.inbuf_;for(;e<r;){if(0===t)for(;e<=i;)this.compress_(n,e),e+=this.blockSize;if("string"==typeof n){for(;e<r;)if(s[t]=n.charCodeAt(e),++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}else for(;e<r;)if(s[t]=n[e],++t,++e,t===this.blockSize){this.compress_(s),t=0;break}}this.inbuf_=t,this.total_+=r}}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;56<=r;r--)this.buf_[r]=255&e,e/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let e=24;0<=e;e-=8)t[n]=this.chain_[i]>>e&255,++n;return t}}function U(e,t){const n=new q(e,t);return n.subscribe.bind(n)}class q{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=V),void 0===r.error&&(r.error=V),void 0===r.complete&&(r.complete=V);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function V(){}function B(e,t,n,r){let i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i){var s=e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".";throw new Error(s)}}function j(e,t){return`${e} failed: ${t} argument `}function K(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(j(e,t)+"must be a valid function.")}function $(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(j(e,t)+"must be a valid context object.")}function W(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}const z=function(e){let t=0;for(let r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t++:n<2048?t+=2:55296<=n&&n<=56319?(t+=4,r++):t+=3}return t},G=1e3,H=2,Q=144e5,Y=.5;function J(e,t=G,n=H){var r=t*Math.pow(n,e),i=Math.round(Y*r*(Math.random()-.5)*2);return Math.min(Q,r+i)}function X(e){return e&&e._delegate?e._delegate:e}class Z{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ee="[DEFAULT]";class te{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new h;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&r.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!==(n=null==e?void 0:e.optional)&&void 0!==n&&n;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ee})}catch(e){}for(var[t,n]of this.instancesDeferred.entries()){t=this.normalizeInstanceIdentifier(t);try{var r=this.getOrInitializeService({instanceIdentifier:t});n.resolve(r)}catch(e){}}}}clearInstance(e=ee){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ee){return this.instances.has(e)}getOptions(e=ee){return this.instancesOptions.get(e)||{}}initialize(e={}){var{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);var r,i,s=this.getOrInitializeService({instanceIdentifier:n,options:t});for([r,i]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(r)&&i.resolve(s);return s}onInit(e,t){var n=this.normalizeInstanceIdentifier(t);const r=null!==(i=this.onInitCallbacks.get(n))&&void 0!==i?i:new Set;r.add(e),this.onInitCallbacks.set(n,r);var i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){var n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===ee?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=ee){return!this.component||this.component.multipleInstances?e:ee}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ne{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){const t=this.getProvider(e.name);t.isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);var t=new te(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const re=[];var ie,e,se;(e=ie=ie||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";const ae={debug:ie.DEBUG,verbose:ie.VERBOSE,info:ie.INFO,warn:ie.WARN,error:ie.ERROR,silent:ie.SILENT},oe=ie.INFO,ce={[ie.DEBUG]:"log",[ie.VERBOSE]:"log",[ie.INFO]:"info",[ie.WARN]:"warn",[ie.ERROR]:"error"},le=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=ce[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};class ue{constructor(e){this.name=e,this._logLevel=oe,this._logHandler=le,this._userLogHandler=null,re.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ie))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ae[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ie.DEBUG,...e),this._logHandler(this,ie.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ie.VERBOSE,...e),this._logHandler(this,ie.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ie.INFO,...e),this._logHandler(this,ie.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ie.WARN,...e),this._logHandler(this,ie.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ie.ERROR,...e),this._logHandler(this,ie.ERROR,...e)}}const he=(t,e)=>e.some(e=>t instanceof e);let de,pe;const fe=new WeakMap,ge=new WeakMap,me=new WeakMap,ve=new WeakMap,ye=new WeakMap;let _e={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return ge.get(e);if("objectStoreNames"===t)return e.objectStoreNames||me.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ie(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function we(r){return r!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(pe=pe||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(r)?function(...e){return r.apply(Te(this),e),Ie(fe.get(this))}:function(...e){return Ie(r.apply(Te(this),e))}:function(e,...t){var n=r.call(Te(this),e,...t);return me.set(n,e.sort?e.sort():[e]),Ie(n)}}function be(e){return"function"==typeof e?we(e):(e instanceof IDBTransaction&&(s=e,ge.has(s)||(t=new Promise((e,t)=>{const n=()=>{s.removeEventListener("complete",r),s.removeEventListener("error",i),s.removeEventListener("abort",i)},r=()=>{e(),n()},i=()=>{t(s.error||new DOMException("AbortError","AbortError")),n()};s.addEventListener("complete",r),s.addEventListener("error",i),s.addEventListener("abort",i)}),ge.set(s,t))),he(e,de=de||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(e,_e):e);var s,t}function Ie(e){if(e instanceof IDBRequest)return function(s){const e=new Promise((e,t)=>{const n=()=>{s.removeEventListener("success",r),s.removeEventListener("error",i)},r=()=>{e(Ie(s.result)),n()},i=()=>{t(s.error),n()};s.addEventListener("success",r),s.addEventListener("error",i)});return e.then(e=>{e instanceof IDBCursor&&fe.set(e,s)}).catch(()=>{}),ye.set(e,s),e}(e);if(ve.has(e))return ve.get(e);var t=be(e);return t!==e&&(ve.set(e,t),ye.set(t,e)),t}const Te=e=>ye.get(e);function Ee(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(e,t),o=Ie(a);return r&&a.addEventListener("upgradeneeded",e=>{r(Ie(a.result),e.oldVersion,e.newVersion,Ie(a.transaction))}),n&&a.addEventListener("blocked",()=>n()),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),o}function ke(e,{blocked:t}={}){const n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",()=>t()),Ie(n).then(()=>{})}const Ce=["get","getKey","getAll","getAllKeys","count"],Se=["put","add","delete","clear"],Ae=new Map;function Ne(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(Ae.get(t))return Ae.get(t);const i=t.replace(/FromIndex$/,""),s=t!==i,a=Se.includes(i);if(i in(s?IDBIndex:IDBObjectStore).prototype&&(a||Ce.includes(i))){var n=async function(e,...t){var n=this.transaction(e,a?"readwrite":"readonly");let r=n.store;return s&&(r=r.index(t.shift())),(await Promise.all([r[i](...t),a&&n.done]))[0]};return Ae.set(t,n),n}}}_e={...se=_e,get:(e,t,n)=>Ne(e,t)||se.get(e,t,n),has:(e,t)=>!!Ne(e,t)||se.has(e,t)};class Re{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{if("VERSION"!==(null==(t=e.getComponent())?void 0:t.type))return null;var t,t=e.getImmediate();return`${t.library}/${t.version}`}).filter(e=>e).join(" ")}}const xe="@firebase/app",De=new ue("@firebase/app");var Pe;const Oe="[DEFAULT]",Me={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Le=new Map,Fe=new Map;function Ue(t,n){try{t.container.addComponent(n)}catch(e){De.debug(`Component ${n.name} failed to register with FirebaseApp ${t.name}`,e)}}function qe(e,t){e.container.addOrOverwriteComponent(t)}function Ve(e){var t=e.name;if(Fe.has(t))return De.debug(`There were multiple attempts to register component ${t}.`),!1;Fe.set(t,e);for(const n of Le.values())Ue(n,e);return!0}function Be(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const je=new T("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Ke{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Z("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw je.create("app-deleted",{appName:this._name})}}const $e="9.10.0";function We(e,t={}){if("object"!=typeof t){const r=t;t={name:r}}var n=Object.assign({name:Oe,automaticDataCollectionEnabled:!1},t);const r=n.name;if("string"!=typeof r||!r)throw je.create("bad-app-name",{appName:String(r)});var i=Le.get(r);if(i){if(D(e,i.options)&&D(n,i.config))return i;throw je.create("duplicate-app",{appName:r})}const s=new ne(r);for(const a of Fe.values())s.addComponent(a);n=new Ke(e,n,s);return Le.set(r,n),n}function ze(e=Oe){var t=Le.get(e);if(!t)throw je.create("no-app",{appName:e});return t}async function Ge(e){var t=e.name;Le.has(t)&&(Le.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function He(e,t,n){let r=null!==(s=Me[e])&&void 0!==s?s:e;n&&(r+=`-${n}`);var i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){const a=[`Unable to register library "${r}" with version "${t}":`];return i&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&a.push("and"),s&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void De.warn(a.join(" "))}Ve(new Z(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function Qe(e,t){if(null!==e&&"function"!=typeof e)throw je.create("invalid-log-argument");!function(s,e){for(const t of re){let i=null;e&&e.level&&(i=ae[e.level]),t.userLogHandler=null===s?null:(e,t,...n)=>{var r=n.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");t>=(null!==i&&void 0!==i?i:e.logLevel)&&s({level:ie[t].toLowerCase(),message:r,args:n,type:e.name})}}}(e,t)}function Ye(e){var t;t=e,re.forEach(e=>{e.setLogLevel(t)})}const Je="firebase-heartbeat-database",Xe=1,Ze="firebase-heartbeat-store";let et=null;function tt(){return et=et||Ee(Je,Xe,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Ze)}}).catch(e=>{throw je.create("idb-open",{originalErrorMessage:e.message})}),et}async function nt(e,t){var n;try{const r=await tt(),i=r.transaction(Ze,"readwrite"),s=i.objectStore(Ze);return await s.put(t,rt(e)),i.done}catch(e){e instanceof I?De.warn(e.message):(n=je.create("idb-set",{originalErrorMessage:null===e||void 0===e?void 0:e.message}),De.warn(n.message))}}function rt(e){return`${e.name}!${e.options.appId}`}class it{constructor(e){this.container=e,this._heartbeatsCache=null;var t=this.container.getProvider("app").getImmediate();this._storage=new at(t),this._heartbeatsCachePromise=this._storage.read().then(e=>this._heartbeatsCache=e)}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate();var t=e.getPlatformInfoString();const n=st();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==n&&!this._heartbeatsCache.heartbeats.some(e=>e.date===n))return this._heartbeatsCache.heartbeats.push({date:n,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{var t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";var e=st(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const s=n.find(e=>e.agent===i.agent);if(s){if(s.dates.push(i.date),ot(n)>t){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),ot(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),t=s(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,0<n.length?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),t}}function st(){const e=new Date;return e.toISOString().substring(0,10)}class at{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!_()&&w().then(()=>!0).catch(()=>!1)}async read(){return await this._canUseIndexedDBPromise&&await async function(e){var t;try{const n=await tt();return n.transaction(Ze).objectStore(Ze).get(rt(e))}catch(e){e instanceof I?De.warn(e.message):(t=je.create("idb-get",{originalErrorMessage:null===e||void 0===e?void 0:e.message}),De.warn(t.message))}}(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){var n=await this.read();return nt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){var n=await this.read();return nt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function ot(e){return s(JSON.stringify({version:2,heartbeats:e})).length}Pe="",Ve(new Z("platform-logger",e=>new Re(e),"PRIVATE")),Ve(new Z("heartbeat",e=>new it(e),"PRIVATE")),He(xe,"0.7.33",Pe),He(xe,"0.7.33","esm2017"),He("fire-js","");var ct=Object.freeze({__proto__:null,SDK_VERSION:$e,_DEFAULT_ENTRY_NAME:Oe,_addComponent:Ue,_addOrOverwriteComponent:qe,_apps:Le,_clearComponents:function(){Fe.clear()},_components:Fe,_getProvider:Be,_registerComponent:Ve,_removeServiceInstance:function(e,t,n=Oe){Be(e,t).clearInstance(n)},deleteApp:Ge,getApp:ze,getApps:function(){return Array.from(Le.values())},initializeApp:We,onLog:Qe,registerVersion:He,setLogLevel:Ye,FirebaseError:I});class lt{constructor(e,t){this._delegate=e,this.firebase=t,Ue(e,new Z("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),Ge(this._delegate)))}_getService(e,t=Oe){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=Oe){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Ue(this._delegate,e)}_addOrOverwriteComponent(e){qe(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const ut=new T("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});function ht(i){const s={},a={__esModule:!0,initializeApp:function(e,t={}){var n=We(e,t);if(A(s,n.name))return s[n.name];var r=new i(n,a);return s[n.name]=r},app:o,registerVersion:He,setLogLevel:Ye,onLog:Qe,apps:null,SDK_VERSION:$e,INTERNAL:{registerComponent:function(n){const r=n.name,t=r.replace("-compat","");{var e;Ve(n)&&"PUBLIC"===n.type&&(e=(e=o())=>{if("function"!=typeof e[t])throw ut.create("invalid-app-argument",{appName:r});return e[t]()},void 0!==n.serviceProps&&c(e,n.serviceProps),a[t]=e,i.prototype[t]=function(...e){const t=this._getService.bind(this,r);return t.apply(this,n.multipleInstances?e:[])})}return"PUBLIC"===n.type?a[t]:null},removeApp:function(e){delete s[e]},useAsService:function(e,t){if("serverAuth"===t)return null;var n=t;return n},modularAPIs:ct}};function o(e){if(e=e||Oe,!A(s,e))throw ut.create("no-app",{appName:e});return s[e]}return a.default=a,Object.defineProperty(a,"apps",{get:function(){return Object.keys(s).map(e=>s[e])}}),o.App=i,a}var dt=function e(){const t=ht(lt);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){c(t,e)},createSubscribe:U,ErrorFactory:T,deepExtend:c}),t}();const pt=new ue("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){pt.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const DP=self.firebase.SDK_VERSION;DP&&0<=DP.indexOf("LITE")&&pt.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const ft=dt;He("@firebase/app-compat","0.1.34",void 0);ft.registerVersion("firebase","9.10.0","app-compat");var gt="@firebase/installations",mt="0.5.12";const vt=1e4,yt=`w:${mt}`,_t="FIS_v2",wt="https://firebaseinstallations.googleapis.com/v1",bt=36e5;const It=new T("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Tt(e){return e instanceof I&&e.code.includes("request-failed")}function Et({projectId:e}){return`${wt}/projects/${e}/installations`}function kt(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function Ct(e,t){var n=(await t.json()).error;return It.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function St({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function At(e,{refreshToken:t}){const n=St(e);return n.append("Authorization",(t=t,`${_t} ${t}`)),n}async function Nt(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function Rt(t){return new Promise(e=>{setTimeout(e,t)})}const xt=/^[cdef][\w-]{21}$/,Dt="";function Pt(){try{const t=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(t),t[0]=112+t[0]%16;var e=function(e){const t=function(e){const t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}(e);return t.substr(0,22)}(t);return xt.test(e)?e:Dt}catch(e){return Dt}}function Ot(e){return`${e.appName}!${e.appId}`}const Mt=new Map;function Lt(e,t){var n=Ot(e);Ft(n,t),function(e,t){const n=function(){!Ut&&"BroadcastChannel"in self&&(Ut=new BroadcastChannel("[Firebase] FID Change"),Ut.onmessage=e=>{Ft(e.data.key,e.data.fid)});return Ut}();n&&n.postMessage({key:e,fid:t});0===Mt.size&&Ut&&(Ut.close(),Ut=null)}(n,t)}function Ft(e,t){var n=Mt.get(e);if(n)for(const r of n)r(t)}let Ut=null;const qt="firebase-installations-store";let Vt=null;function Bt(){return Vt=Vt||Ee("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(qt)}}),Vt}async function jt(e,t){var n=Ot(e);const r=await Bt(),i=r.transaction(qt,"readwrite"),s=i.objectStore(qt);var a=await s.get(n);return await s.put(t,n),await i.done,a&&a.fid===t.fid||Lt(e,t.fid),t}async function Kt(e){var t=Ot(e);const n=await Bt(),r=n.transaction(qt,"readwrite");await r.objectStore(qt).delete(t),await r.done}async function $t(e,t){var n=Ot(e);const r=await Bt(),i=r.transaction(qt,"readwrite"),s=i.objectStore(qt);var a=await s.get(n),o=t(a);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||a&&a.fid===o.fid||Lt(e,o.fid),o}async function Wt(n){let r;var e=await $t(n.appConfig,e=>{var t=Gt(e||{fid:Pt(),registrationStatus:0}),t=function(e,t){{if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:async function(e){let t=await zt(e.appConfig);for(;1===t.registrationStatus;)await Rt(100),t=await zt(e.appConfig);if(0!==t.registrationStatus)return t;{var{installationEntry:n,registrationPromise:r}=await Wt(e);return r||n}}(e)}:{installationEntry:t};if(!navigator.onLine){var n=Promise.reject(It.create("app-offline"));return{installationEntry:t,registrationPromise:n}}var r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},n=async function(t,n){try{var e=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=Et(e),i=St(e),s=t.getImmediate({optional:!0});!s||(a=await s.getHeartbeatsHeader())&&i.append("x-firebase-client",a);var a={fid:n,authVersion:_t,appId:e.appId,sdkVersion:yt};const o={method:"POST",headers:i,body:JSON.stringify(a)},c=await Nt(()=>fetch(r,o));if(c.ok){a=await c.json();return{fid:a.fid||n,registrationStatus:2,refreshToken:a.refreshToken,authToken:kt(a.authToken)}}throw await Ct("Create Installation",c)}(t,n);return jt(t.appConfig,e)}catch(e){throw Tt(e)&&409===e.customData.serverCode?await Kt(t.appConfig):await jt(t.appConfig,{fid:n.fid,registrationStatus:0}),e}}(e,r);return{installationEntry:r,registrationPromise:n}}}(n,t);return r=t.registrationPromise,t.installationEntry});return e.fid===Dt?{installationEntry:await r}:{installationEntry:e,registrationPromise:r}}function zt(e){return $t(e,e=>{if(!e)throw It.create("installation-not-found");return Gt(e)})}function Gt(e){return 1===(t=e).registrationStatus&&t.registrationTime+vt<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function Ht({appConfig:e,heartbeatServiceProvider:t},n){const r=([i,s]=[e,n["fid"]],`${Et(i)}/${s}/authTokens:generate`);var i,s;const a=At(e,n),o=t.getImmediate({optional:!0});!o||(c=await o.getHeartbeatsHeader())&&a.append("x-firebase-client",c);var c={installation:{sdkVersion:yt,appId:e.appId}};const l={method:"POST",headers:a,body:JSON.stringify(c)},u=await Nt(()=>fetch(r,l));if(u.ok)return kt(await u.json());throw await Ct("Generate Auth Token",u)}async function Qt(r,i=!1){let s;var e=await $t(r.appConfig,e=>{if(!Jt(e))throw It.create("not-registered");var t,n=e.authToken;if(i||2!==(t=n).requestStatus||function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+bt}(t)){if(1===n.requestStatus)return s=async function(e,t){let n=await Yt(e.appConfig);for(;1===n.authToken.requestStatus;)await Rt(100),n=await Yt(e.appConfig);var r=n.authToken;return 0===r.requestStatus?Qt(e,t):r}(r,i),e;if(!navigator.onLine)throw It.create("app-offline");n=(t=e,n={requestStatus:1,requestTime:Date.now()},Object.assign(Object.assign({},t),{authToken:n}));return s=async function(t,n){try{var r=await Ht(t,n),e=Object.assign(Object.assign({},n),{authToken:r});return await jt(t.appConfig,e),r}catch(e){throw!Tt(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(r=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),await jt(t.appConfig,r)):await Kt(t.appConfig),e}}(r,n),n}return e});return s?await s:e.authToken}function Yt(e){return $t(e,e=>{if(!Jt(e))throw It.create("not-registered");var t,n=e.authToken;return 1===(t=n).requestStatus&&t.requestTime+vt<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function Jt(e){return void 0!==e&&2===e.registrationStatus}async function Xt(e,t=!1){var n,r=e;return await((n=(await Wt(r)).registrationPromise)&&await n),(await Qt(r,t)).token}function Zt(e){return It.create("missing-app-config-values",{valueName:e})}const en="installations",tn=e=>{var t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw Zt("App Configuration");if(!e.name)throw Zt("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw Zt(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),heartbeatServiceProvider:Be(t,"heartbeat"),_delete:()=>Promise.resolve()}},nn=e=>{const t=Be(e.getProvider("app").getImmediate(),en).getImmediate();return{getId:()=>async function(e){var t=e;const{installationEntry:n,registrationPromise:r}=await Wt(t);return(r||Qt(t)).catch(console.error),n.fid}(t),getToken:e=>Xt(t,e)}};Ve(new Z(en,tn,"PUBLIC")),Ve(new Z("installations-internal",nn,"PRIVATE")),He(gt,mt),He(gt,mt,"esm2017");const rn="analytics",sn="firebase_id",an="origin",on="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",cn="https://www.googletagmanager.com/gtag/js",ln=new ue("@firebase/analytics");function un(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function hn(r,i,s,a){return async function(e,t,n){try{"event"===e?await async function(e,n,r,i,s){try{let t=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const c=await un(r);for(const l of e){var a=c.find(e=>e.measurementId===l),o=a&&n[a.appId];if(!o){t=[];break}t.push(o)}}0===t.length&&(t=Object.values(n)),await Promise.all(t),e("event",i,s||{})}catch(e){ln.error(e)}}(r,i,s,t,n):"config"===e?await async function(e,t,n,r,i,s){var a=r[i];try{if(a)await t[a];else{const c=await un(n);var o=c.find(e=>e.measurementId===i);o&&await t[o.appId]}}catch(e){ln.error(e)}e("config",i,s)}(r,i,s,a,t,n):"consent"===e?r("consent","update",n):r("set",t)}catch(e){ln.error(e)}}}const dn=new T("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),pn=30;const fn=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function gn(e){var t,{appId:n,apiKey:r}=e,r={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":r})},n=on.replace("{app-id}",n);const i=await fetch(n,r);if(200===i.status||304===i.status)return i.json();{let e="";try{var s=await i.json();null!==(t=s.error)&&void 0!==t&&t.message&&(e=s.error.message)}catch(e){}throw dn.create("config-fetch-failed",{httpStatus:i.status,responseMessage:e})}}async function mn(e,t=fn,n){var{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw dn.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw dn.create("no-api-key")}var a=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()};const o=new _n;return setTimeout(async()=>{o.abort()},void 0!==n?n:6e4),async function t(n,{throttleEndTimeMillis:e,backoffCount:r},i,s=fn){var a;const{appId:o,measurementId:c}=n;try{await vn(i,e)}catch(e){if(c)return ln.warn("Timed out fetching this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${c}`+` provided in the "measurementId" field in the local Firebase config. [${null===(a=e)||void 0===a?void 0:a.message}]`),{appId:o,measurementId:c};throw e}try{const l=await gn(n);return s.deleteThrottleMetadata(o),l}catch(e){const u=e;if(!yn(u)){if(s.deleteThrottleMetadata(o),c)return ln.warn("Failed to fetch this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${c}`+` provided in the "measurementId" field in the local Firebase config. [${null===u||void 0===u?void 0:u.message}]`),{appId:o,measurementId:c};throw e}const h=503===Number(null===(a=null===u||void 0===u?void 0:u.customData)||void 0===a?void 0:a.httpStatus)?J(r,s.intervalMillis,pn):J(r,s.intervalMillis),d={throttleEndTimeMillis:Date.now()+h,backoffCount:r+1};return s.setThrottleMetadata(o,d),ln.debug(`Calling attemptFetch again in ${h} millis`),t(n,d,i,s)}}({appId:r,apiKey:i,measurementId:s},a,o,t)}function vn(i,s){return new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(dn.create("fetch-throttle",{throttleEndTimeMillis:s}))})})}function yn(e){if(!(e instanceof I&&e.customData))return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}class _n{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function wn(t,e,n,r,i,s,a){const o=mn(t);o.then(e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&ln.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>ln.error(e)),e.push(o);var c=async function(){if(!_())return ln.warn(dn.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await w()}catch(e){return ln.warn(dn.create("indexeddb-unavailable",{errorInfo:null===e||void 0===e?void 0:e.toString()}).message),!1}return!0}().then(e=>{if(e)return r.getId()}),[l,u]=await Promise.all([o,c]);!function(){var e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(cn))return t}()&&function(e,t){const n=document.createElement("script");n.src=`${cn}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(s,l.measurementId),i("js",new Date);const h=null!==(c=null==a?void 0:a.config)&&void 0!==c?c:{};return h[an]="firebase",h.update=!0,null!=u&&(h[sn]=u),i("config",l.measurementId,h),l.measurementId}class bn{constructor(e){this.app=e}_delete(){return delete In[this.app.options.appId],Promise.resolve()}}let In={},Tn=[];const En={};let kn="dataLayer",Cn="gtag",Sn,An,Nn=!1;function Rn(e){if(Nn)throw dn.create("already-initialized");e.dataLayerName&&(kn=e.dataLayerName),e.gtagName&&(Cn=e.gtagName)}function xn(e,t,n){!function(){const e=[];var t;g()&&e.push("This is a browser extension environment."),b()||e.push("Cookies are not available."),0<e.length&&(t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=dn.create("invalid-analytics-context",{errorInfo:t}),ln.warn(t.message))}();var r,i,s=e.options.appId;if(!s)throw dn.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw dn.create("no-api-key");ln.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest'+` measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId}`+' provided in the "measurementId" field in the local Firebase config.')}if(null!=In[s])throw dn.create("already-exists",{id:s});return Nn||(function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t,t}(kn),{wrappedGtag:r,gtagCore:i}=function(e,t,n,r,i){let s=function(){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=hn(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(In,Tn,En,kn,Cn),An=r,Sn=i,Nn=!0),In[s]=wn(e,Tn,En,t,Sn,kn,n),new bn(e)}async function Dn(){if(g())return!1;if(!b())return!1;if(!_())return!1;try{return await w()}catch(e){return!1}}function Pn(e,t,n){e=X(e),async function(e,t,n,r){if(r&&r.global)return e("set",{screen_name:n}),Promise.resolve();e("config",await t,{update:!0,screen_name:n})}(An,In[e.app.options.appId],t,n).catch(e=>ln.error(e))}function On(e,t,n){e=X(e),async function(e,t,n,r){if(r&&r.global)return e("set",{user_id:n}),Promise.resolve();e("config",await t,{update:!0,user_id:n})}(An,In[e.app.options.appId],t,n).catch(e=>ln.error(e))}function Mn(e,t,n){e=X(e),async function(e,t,n,r){if(r&&r.global){const i={};for(const s of Object.keys(n))i[`user_properties.${s}`]=n[s];return e("set",i),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(An,In[e.app.options.appId],t,n).catch(e=>ln.error(e))}function Ln(e,t){e=X(e),async function(e,t){var n=await e;window[`ga-disable-${n}`]=!t}(In[e.app.options.appId],t).catch(e=>ln.error(e))}function Fn(e,t,n,r){e=X(e),async function(e,t,n,r,i){var s;i&&i.global?e("event",n,r):(s=await t,e("event",n,Object.assign(Object.assign({},r),{send_to:s})))}(An,In[e.app.options.appId],t,n,r).catch(e=>ln.error(e))}const Un="@firebase/analytics";Ve(new Z(rn,(e,{options:t})=>{return xn(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)},"PUBLIC")),Ve(new Z("analytics-internal",function(e){try{const r=e.getProvider(rn).getImmediate();return{logEvent:(e,t,n)=>Fn(r,e,t,n)}}catch(e){throw dn.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),He(Un,"0.8.0"),He(Un,"0.8.0","esm2017");var qn,Vn;class Bn{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){Fn(this._delegate,e,t,n)}setCurrentScreen(e,t){Pn(this._delegate,e,t)}setUserId(e,t){On(this._delegate,e,t)}setUserProperties(e,t){Mn(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){Ln(this._delegate,e)}}(OC=qn=qn||{}).ADD_SHIPPING_INFO="add_shipping_info",OC.ADD_PAYMENT_INFO="add_payment_info",OC.ADD_TO_CART="add_to_cart",OC.ADD_TO_WISHLIST="add_to_wishlist",OC.BEGIN_CHECKOUT="begin_checkout",OC.CHECKOUT_PROGRESS="checkout_progress",OC.EXCEPTION="exception",OC.GENERATE_LEAD="generate_lead",OC.LOGIN="login",OC.PAGE_VIEW="page_view",OC.PURCHASE="purchase",OC.REFUND="refund",OC.REMOVE_FROM_CART="remove_from_cart",OC.SCREEN_VIEW="screen_view",OC.SEARCH="search",OC.SELECT_CONTENT="select_content",OC.SELECT_ITEM="select_item",OC.SELECT_PROMOTION="select_promotion",OC.SET_CHECKOUT_OPTION="set_checkout_option",OC.SHARE="share",OC.SIGN_UP="sign_up",OC.TIMING_COMPLETE="timing_complete",OC.VIEW_CART="view_cart",OC.VIEW_ITEM="view_item",OC.VIEW_ITEM_LIST="view_item_list",OC.VIEW_PROMOTION="view_promotion",OC.VIEW_SEARCH_RESULTS="view_search_results";const jn=e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("analytics").getImmediate();return new Bn(t,n)};Vn={Analytics:Bn,settings:Rn,isSupported:Dn,EventName:qn},ft.INTERNAL.registerComponent(new Z("analytics-compat",jn,"PUBLIC").setServiceProps(Vn).setMultipleInstances(!0)),ft.registerVersion("@firebase/analytics-compat","0.1.13");const Kn=new Map,$n={activated:!1,tokenObservers:[]},Wn={initialized:!1,enabled:!1};function zn(e){return Kn.get(e)||$n}function Gn(e,t){Kn.set(e,t)}const Hn="https://content-firebaseappcheck.googleapis.com/v1",Qn="exchangeDebugToken",Yn={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class Jn{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=r))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new h,t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new h,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();var t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}const Xn=new T("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function Zn(e=!1){var t;return e?null===(t=self.grecaptcha)||void 0===t?void 0:t.enterprise:self.grecaptcha}function er(e){if(!zn(e).activated)throw Xn.create("use-before-activation",{appName:e.name})}function tr(e){var t=Math.round(e/1e3),n=Math.floor(t/86400),r=Math.floor((t-3600*n*24)/3600),i=Math.floor((t-3600*n*24-3600*r)/60),t=t-3600*n*24-3600*r-60*i;let s="";return n&&(s+=nr(n)+"d:"),r&&(s+=nr(r)+"h:"),s+=nr(i)+"m:"+nr(t)+"s",s}function nr(e){return 0===e?"00":10<=e?e.toString():"0"+e}async function rr({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});!i||(c=await i.getHeartbeatsHeader())&&(r["X-Firebase-Client"]=c);var s={method:"POST",body:JSON.stringify(t),headers:r};let a;try{a=await fetch(e,s)}catch(e){throw Xn.create("fetch-network-error",{originalErrorMessage:null===e||void 0===e?void 0:e.message})}if(200!==a.status)throw Xn.create("fetch-status-error",{httpStatus:a.status});let o;try{o=await a.json()}catch(e){throw Xn.create("fetch-parse-error",{originalErrorMessage:null===e||void 0===e?void 0:e.message})}var c=o.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw Xn.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration "+`format: ${o.ttl}`});s=1e3*Number(c[1]),c=Date.now();return{token:o.token,expireTimeMillis:c+s,issuedAtTimeMillis:c}}const ir="firebase-app-check-database",sr=1,ar="firebase-app-check-store",or="debug-token";let cr=null;function lr(){return cr||(cr=new Promise((t,n)=>{try{const e=indexedDB.open(ir,sr);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{var t;n(Xn.create("storage-open",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(ar,{keyPath:"compositeKey"})}}catch(e){n(Xn.create("storage-open",{originalErrorMessage:null===e||void 0===e?void 0:e.message}))}}),cr)}async function ur(e,t){const n=await lr(),r=n.transaction(ar,"readwrite"),i=r.objectStore(ar),s=i.put({compositeKey:e,value:t});return new Promise((t,n)=>{s.onsuccess=e=>{t()},r.onerror=e=>{var t;n(Xn.create("storage-set",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})}async function hr(e){const t=await lr(),i=t.transaction(ar,"readonly"),n=i.objectStore(ar),s=n.get(e);return new Promise((n,r)=>{s.onsuccess=e=>{var t=e.target.result;n(t?t.value:void 0)},i.onerror=e=>{var t;r(Xn.create("storage-get",{originalErrorMessage:null===(t=e.target.error)||void 0===t?void 0:t.message}))}})}function dr(e){return`${e.options.appId}-${e.name}`}const pr=new ue("@firebase/app-check");async function fr(t){if(_()){let e=void 0;try{e=await hr(dr(t))}catch(e){pr.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return e}}function gr(e,t){return _()?ur(dr(e),t).catch(e=>{pr.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}async function mr(){let e=void 0;try{e=await hr(or)}catch(e){}if(e)return e;var t,n=W();return t=n,ur(or,t).catch(e=>pr.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`)),n}function vr(){return Wn.enabled}async function yr(){var e=Wn;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function _r(){var e=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}();const t=Wn;if(t.initialized=!0,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===e.FIREBASE_APPCHECK_DEBUG_TOKEN){t.enabled=!0;const n=new h;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(mr())}}const wr={error:"UNKNOWN_ERROR"};async function br(e,t=!1){var n=e.app;er(n);const r=zn(n);let i=r.token,s=void 0;if(i||(o=await r.cachedTokenPromise)&&Cr(o)&&(i=o),!t&&i&&Cr(i))return{token:i.token};let a=!1;if(vr()){r.exchangeTokenPromise||(r.exchangeTokenPromise=rr(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${Hn}/projects/${n}/apps/${r}:${Qn}?key=${i}`,body:{debug_token:t}}}(n,await yr()),e.heartbeatServiceProvider).then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0);var o=await r.exchangeTokenPromise;return await gr(n,o),Gn(n,Object.assign(Object.assign({},r),{token:o})),{token:o.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().then(e=>(r.exchangeTokenPromise=void 0,e)),a=!0),i=await r.exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code?pr.warn(e.message):pr.error(e),s=e}let c;return i?(c={token:i.token},Gn(n,Object.assign(Object.assign({},r),{token:i})),await gr(n,i)):c=(e=s,{token:function(e){return l.encodeString(JSON.stringify(e),!1)}(wr),error:e}),a&&kr(n,c),c}function Ir(e,t,n,r){var i=e["app"];const s=zn(i);var a={next:n,error:r,type:t};if(Gn(i,Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,a]})),s.token&&Cr(s.token)){const o=s.token;Promise.resolve().then(()=>{n({token:o.token}),Er(e)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Er(e))}function Tr(e,t){const n=zn(e);var r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),Gn(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function Er(e){var t=e["app"],n=zn(t);let r=n.tokenRefresher;r||(r=function(n){const r=n["app"];return new Jn(async()=>{var e=zn(r);let t;if(t=e.token?await br(n,!0):await br(n),t.error)throw t.error},()=>!0,()=>{var e=zn(r);if(e.token){var t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5,e=e.token.expireTimeMillis-3e5,t=Math.min(t,e);return Math.max(0,t-Date.now())}return 0},Yn.RETRIAL_MIN_WAIT,Yn.RETRIAL_MAX_WAIT)}(e),Gn(t,Object.assign(Object.assign({},n),{tokenRefresher:r}))),!r.isRunning()&&n.isTokenAutoRefreshEnabled&&r.start()}function kr(e,t){for(const n of zn(e).tokenObservers)try{"EXTERNAL"===n.type&&null!=t.error?n.error(t.error):n.next(t)}catch(e){}}function Cr(e){return 0<e.expireTimeMillis-Date.now()}class Sr{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){var e=zn(this.app)["tokenObservers"];for(const t of e)Tr(this.app,t.next);return Promise.resolve()}}const Ar="https://www.google.com/recaptcha/api.js",Nr="https://www.google.com/recaptcha/enterprise.js";function Rr(t,n){var e=zn(t);const r=new h;Gn(t,Object.assign(Object.assign({},e),{reCAPTCHAState:{initialized:r}}));const i=Pr(t);e=Zn(!1);return e?Dr(t,n,e,i,r):function(e){const t=document.createElement("script");t.src=Ar,t.onload=e,document.head.appendChild(t)}(()=>{var e=Zn(!1);if(!e)throw new Error("no recaptcha");Dr(t,n,e,i,r)}),r.promise}function xr(t,n){var e=zn(t);const r=new h;Gn(t,Object.assign(Object.assign({},e),{reCAPTCHAState:{initialized:r}}));const i=Pr(t);e=Zn(!0);return e?Dr(t,n,e,i,r):function(e){const t=document.createElement("script");t.src=Nr,t.onload=e,document.head.appendChild(t)}(()=>{var e=Zn(!0);if(!e)throw new Error("no recaptcha");Dr(t,n,e,i,r)}),r.promise}function Dr(r,i,s,a,o){s.ready(()=>{var e,t,n;e=r,t=s.render(a,{sitekey:i,size:"invisible"}),n=zn(e),Gn(e,Object.assign(Object.assign({},n),{reCAPTCHAState:Object.assign(Object.assign({},n.reCAPTCHAState),{widgetId:t})})),o.resolve(s)})}function Pr(e){var t=`fire_app_check_${e.name}`;const n=document.createElement("div");return n.id=t,n.style.display="none",document.body.appendChild(n),t}async function Or(r){er(r);const i=await zn(r).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{const n=zn(r).reCAPTCHAState;i.ready(()=>{e(i.execute(n.widgetId,{action:"fire_app_check"}))})})}class Mr{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){qr(this._throttleData);var t=await Or(this._app).catch(e=>{throw Xn.create("recaptcha-error")});let e;try{e=await rr(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${Hn}/projects/${n}/apps/${r}:exchangeRecaptchaV3Token?key=${i}`,body:{recaptcha_v3_token:t}}}(this._app,t),this._heartbeatServiceProvider)}catch(e){throw null!==(t=e.code)&&void 0!==t&&t.includes("fetch-status-error")?(this._throttleData=Ur(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),Xn.create("throttled",{time:tr(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._heartbeatServiceProvider=Be(e,"heartbeat"),Rr(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Mr&&this._siteKey===e._siteKey}}class Lr{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){qr(this._throttleData);var t=await Or(this._app).catch(e=>{throw Xn.create("recaptcha-error")});let e;try{e=await rr(function(e,t){var{projectId:n,appId:r,apiKey:i}=e.options;return{url:`${Hn}/projects/${n}/apps/${r}:exchangeRecaptchaEnterpriseToken?key=${i}`,body:{recaptcha_enterprise_token:t}}}(this._app,t),this._heartbeatServiceProvider)}catch(e){throw null!==(t=e.code)&&void 0!==t&&t.includes("fetch-status-error")?(this._throttleData=Ur(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),Xn.create("throttled",{time:tr(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._heartbeatServiceProvider=Be(e,"heartbeat"),xr(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Lr&&this._siteKey===e._siteKey}}class Fr{constructor(e){this._customProviderOptions=e}async getToken(){var e=await this._customProviderOptions.getToken(),t=function(e){const t=S(e).claims;return"object"==typeof t&&t.hasOwnProperty("iat")?t.iat:null}(e.token),t=null!==t&&t<Date.now()&&0<t?1e3*t:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:t})}initialize(e){this._app=e}isEqual(e){return e instanceof Fr&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function Ur(e,t){if(404===e||403===e)return{backoffCount:1,allowRequestsAfter:Date.now()+864e5,httpStatus:e};var n=t?t.backoffCount:0,r=J(n,1e3,2);return{backoffCount:n+1,allowRequestsAfter:Date.now()+r,httpStatus:e}}function qr(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw Xn.create("throttled",{time:tr(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}function Vr(e=ze(),t){const n=Be(e=X(e),"app-check");if(Wn.initialized||_r(),vr()&&yr().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),n.isInitialized()){var r=n.getImmediate();const i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw Xn.create("already-initialized",{appName:e.name})}r=n.initialize({options:t});return function(t,e,n){const r=zn(t),i=Object.assign(Object.assign({},r),{activated:!0});i.provider=e,i.cachedTokenPromise=fr(t).then(e=>(e&&Cr(e)&&(Gn(t,Object.assign(Object.assign({},zn(t)),{token:e})),kr(t,{token:e.token})),e)),i.isTokenAutoRefreshEnabled=void 0===n?t.automaticDataCollectionEnabled:n,Gn(t,i),i.provider.initialize(t)}(e,t.provider,t.isTokenAutoRefreshEnabled),zn(e).isTokenAutoRefreshEnabled&&Ir(r,"INTERNAL",()=>{}),r}const Br="app-check-internal";Ve(new Z("app-check",e=>{var t,n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat");return t=n,e=r,new Sr(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(Br).initialize()})),Ve(new Z(Br,e=>{var t,n=e.getProvider("app-check").getImmediate();return t=n,{getToken:e=>br(t,e),addTokenListener:e=>Ir(t,"INTERNAL",e),removeTokenListener:e=>Tr(t.app,e)}},"PUBLIC").setInstantiationMode("EXPLICIT")),He("@firebase/app-check","0.5.12");const jr=new T("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."});class Kr{constructor(e){this.app=e}activate(e,t){let n;n="string"==typeof e?new Mr(e):e instanceof Lr||e instanceof Mr||e instanceof Fr?e:new Fr({getToken:e.getToken}),this._delegate=Vr(this.app,{provider:n,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw jr.create("use-before-activation",{appName:this.app.name});!function(e,t){var n=e.app;const r=zn(n);r.tokenRefresher&&(!0===t?r.tokenRefresher.start():r.tokenRefresher.stop()),Gn(n,Object.assign(Object.assign({},r),{isTokenAutoRefreshEnabled:t}))}(this._delegate,e)}getToken(e){if(!this._delegate)throw jr.create("use-before-activation",{appName:this.app.name});return async function(e,t){var n=await br(e,t);if(n.error)throw n.error;return{token:n.token}}(this._delegate,e)}onTokenChanged(e,t,n){if(!this._delegate)throw jr.create("use-before-activation",{appName:this.app.name});return function(e,t,n){let r=()=>{},i=()=>{};return r=null!=t.next?t.next.bind(t):t,null!=t.error?i=t.error.bind(t):n&&(i=n),Ir(e,"EXTERNAL",r,i),()=>Tr(e.app,r)}(this._delegate,e,t)}}const $r=e=>{var t=e.getProvider("app-compat").getImmediate();return new Kr(t)};function Wr(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}ft.INTERNAL.registerComponent(new Z("appCheck-compat",$r,"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:Lr,ReCaptchaV3Provider:Mr,CustomProvider:Fr})),ft.registerVersion("@firebase/app-check-compat","0.2.12");const zr={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Gr={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function Hr(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}function Qr(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}const Yr=Hr,Jr=new T("auth","Firebase",Hr()),Xr=new ue("@firebase/auth");function Zr(e,...t){Xr.logLevel<=ie.ERROR&&Xr.error(`Auth (${$e}): ${e}`,...t)}function ei(e,...t){throw ii(e,...t)}function ti(e,...t){return ii(e,...t)}function ni(e,t,n){var r=Object.assign(Object.assign({},Yr()),{[t]:n});const i=new T("auth","Firebase",r);return i.create(t,{appName:e.name})}function ri(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&ei(e,"argument-error"),ni(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function ii(e,...t){if("string"==typeof e)return Jr.create(e,...t);{var n=t[0];const r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}}function si(e,t,...n){if(!e)throw ii(t,...n)}function ai(e){var t="INTERNAL ASSERTION FAILED: "+e;throw Zr(t),new Error(t)}function oi(e,t){e||ai(t)}const ci=new Map;function li(e){oi(e instanceof Function,"Expected a class definition");let t=ci.get(e);return t?oi(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,ci.set(e,t)),t}function ui(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function hi(){return"http:"===di()||"https:"===di()}function di(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class pi{constructor(e,t){oi((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=r()||m()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(hi()||g()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function fi(e,t){oi(e.emulator,"Emulator should always be set here");var n=e.emulator["url"];return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class gi{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:void ai("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:void ai("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:void ai("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}const mi={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},vi=new pi(3e4,6e4);function yi(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function _i(i,s,a,o,e={}){return wi(i,e,async()=>{let e={},t={};o&&("GET"===s?t=o:e={body:JSON.stringify(o)});var n=O(Object.assign({key:i.config.apiKey},t)).slice(1);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/json",i.languageCode&&(r["X-Firebase-Locale"]=i.languageCode),gi.fetch()(Ii(i,i.config.apiHost,a,n),Object.assign({method:s,headers:r,referrerPolicy:"no-referrer"},e))})}async function wi(t,e,n){t._canInitEmulator=!1;var r=Object.assign(Object.assign({},mi),e);try{const a=new Ti(t),o=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();var i=await o.json();if("needConfirmation"in i)throw Ei(t,"account-exists-with-different-credential",i);if(o.ok&&!("errorMessage"in i))return i;{const c=o.ok?i.errorMessage:i.error.message,[l,u]=c.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===l)throw Ei(t,"credential-already-in-use",i);if("EMAIL_EXISTS"===l)throw Ei(t,"email-already-in-use",i);if("USER_DISABLED"===l)throw Ei(t,"user-disabled",i);var s=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw ni(t,s,u);ei(t,s)}}catch(e){if(e instanceof I)throw e;ei(t,"network-request-failed")}}async function bi(e,t,n,r,i={}){var s=await _i(e,t,n,r,i);return"mfaPendingCredential"in s&&ei(e,"multi-factor-auth-required",{_serverResponse:s}),s}function Ii(e,t,n,r){var i=`${t}${n}?${r}`;return e.config.emulator?fi(e.config,i):`${e.config.apiScheme}://${i}`}class Ti{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(ti(this.auth,"network-request-failed")),vi.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ei(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=ti(e,t,r);return i.customData._tokenResponse=n,i}function ki(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Ci(e){return 1e3*Number(e)}function Si(e){var[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Zr("JWT malformed, contained fewer than 3 sections"),null;try{var i=a(n);return i?JSON.parse(i):(Zr("Failed to decode base64 JWT payload"),null)}catch(e){return Zr("Caught error parsing JWT payload as JSON",null===e||void 0===e?void 0:e.toString()),null}}async function Ai(t,n,e=!1){if(e)return n;try{return n}catch(e){throw e instanceof I&&(n=[e["code"]][0],"auth/user-disabled"===n||"auth/user-token-expired"===n)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class Ni{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){var t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}this.errorBackoff=3e4;t=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,t)}schedule(e=!1){var t;this.isRunning&&(t=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},t))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null===e||void 0===e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Ri{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ki(this.lastLoginAt),this.creationTime=ki(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function xi(e){var t=e.auth,n=await e.getIdToken(),r=await Ai(e,async function(e,t){return _i(e,"POST","/v1/accounts:lookup",t)}(t,{idToken:n}));si(null==r?void 0:r.users.length,t,"internal-error");var i=r.users[0];e._notifyReloadListener(i);var s,a,t=null!==(n=i.providerUserInfo)&&void 0!==n&&n.length?i.providerUserInfo.map(e=>{var t=e["providerId"],n=Wr(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[],r=(s=e.providerData,a=t,[...s.filter(t=>!a.some(e=>e.providerId===t.providerId)),...a]),n=e.isAnonymous,t=!(e.email&&i.passwordHash||null!==r&&r.length),t=!!n&&t,t={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new Ri(i.createdAt,i.lastLoginAt),isAnonymous:t};Object.assign(e,t)}class Di{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){si(e.idToken,"internal-error"),si(void 0!==e.idToken,"internal-error"),si(void 0!==e.refreshToken,"internal-error");var t,n,n="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(t=e.idToken,si(n=Si(t),"internal-error"),si(void 0!==n.exp,"internal-error"),si(void 0!==n.iat,"internal-error"),Number(n.exp)-Number(n.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}async getToken(e,t=!1){return si(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){var i,s,{accessToken:n,refreshToken:r,expiresIn:a}=(s=t,await{accessToken:(a=await wi(i=e,{},async()=>{var e=O({grant_type:"refresh_token",refresh_token:s}).slice(1),{tokenApiHost:t,apiKey:n}=i.config,n=Ii(i,t,"/v1/token",`key=${n}`);const r=await i._getAdditionalHeaders();return r["Content-Type"]="application/x-www-form-urlencoded",gi.fetch()(n,{method:"POST",headers:r,body:e})})).access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token});this.updateTokensAndExpiration(n,r,Number(a))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){var{refreshToken:n,accessToken:r,expirationTime:i}=t;const s=new Di;return n&&(si("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(si("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(si("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Di,this.toJSON())}_performRefresh(){return ai("not implemented")}}function Pi(e,t){si("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Oi{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Wr(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ni(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Ri(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){var t=await Ai(this,this.stsTokenManager.getToken(this.auth,e));return si(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=X(e);var r=await n.getIdToken(t),i=Si(r);si(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");var s="object"==typeof i.firebase?i.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:ki(Ci(i.auth_time)),issuedAtTime:ki(Ci(i.iat)),expirationTime:ki(Ci(i.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=X(e);await xi(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(si(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Oi(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){si(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await xi(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){var e=await this.getIdToken();return await Ai(this,async function(e,t){return _i(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n=null!==(a=t.displayName)&&void 0!==a?a:void 0,r=null!==(g=t.email)&&void 0!==g?g:void 0,i=null!==(o=t.phoneNumber)&&void 0!==o?o:void 0,s=null!==(l=t.photoURL)&&void 0!==l?l:void 0,a=null!==(c=t.tenantId)&&void 0!==c?c:void 0,o=null!==(g=t._redirectEventId)&&void 0!==g?g:void 0,c=null!==(l=t.createdAt)&&void 0!==l?l:void 0,l=null!==(g=t.lastLoginAt)&&void 0!==g?g:void 0;const{uid:u,emailVerified:h,isAnonymous:d,providerData:p,stsTokenManager:f}=t;si(u&&f,e,"internal-error");var g=Di.fromJSON(this.name,f);si("string"==typeof u,e,"internal-error"),Pi(n,e.name),Pi(r,e.name),si("boolean"==typeof h,e,"internal-error"),si("boolean"==typeof d,e,"internal-error"),Pi(i,e.name),Pi(s,e.name),Pi(a,e.name),Pi(o,e.name),Pi(c,e.name),Pi(l,e.name);const m=new Oi({uid:u,auth:e,email:r,emailVerified:h,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:g,createdAt:c,lastLoginAt:l});return p&&Array.isArray(p)&&(m.providerData=p.map(e=>Object.assign({},e))),o&&(m._redirectEventId=o),m}static async _fromIdTokenResponse(e,t,n=!1){const r=new Di;r.updateFromServerResponse(t);var i=new Oi({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await xi(i),i}}class Mi{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){var t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Mi.type="NONE";const Li=Mi;function Fi(e,t,n){return`firebase:${e}:${t}:${n}`}class Ui{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;var{config:r,name:i}=this.auth;this.fullUserKey=Fi(this.userKey,r.apiKey,i),this.fullPersistenceKey=Fi("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?Oi._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence!==e){var t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Ui(li(Li),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||li(Li);const s=Fi(n,e.config.apiKey,e.name);let a=null;for(const u of t)try{var o=await u._get(s);if(o){var c=Oi._fromJSON(e,o);u!==i&&(a=c),i=u;break}}catch(e){}var l=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&l.length&&(i=l[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new Ui(i,e,n)}}function qi(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Ki(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Vi(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Wi(t))return"Blackberry";if(zi(t))return"Webos";if(Bi(t))return"Safari";if((t.includes("chrome/")||ji(t))&&!t.includes("edge/"))return"Chrome";if($i(t))return"Android";var n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null==n?void 0:n.length)?n[1]:"Other"}function Vi(e=d()){return/firefox\//i.test(e)}function Bi(e=d()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ji(e=d()){return/crios\//i.test(e)}function Ki(e=d()){return/iemobile/i.test(e)}function $i(e=d()){return/android/i.test(e)}function Wi(e=d()){return/blackberry/i.test(e)}function zi(e=d()){return/webos/i.test(e)}function Gi(e=d()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Hi(e=d()){return Gi(e)||$i(e)||zi(e)||Wi(e)||/windows phone/i.test(e)||Ki(e)}function Qi(e,t=[]){let n;switch(e){case"Browser":n=qi(d());break;case"Worker":n=`${qi(d())}-${e}`;break;default:n=e}var r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${$e}/${r}`}class Yi{constructor(e){this.auth=e,this.queue=[]}pushCallback(r,e){var t=n=>new Promise((e,t)=>{try{e(r(n))}catch(e){t(e)}});t.onAbort=e,this.queue.push(t);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser!==e){const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const r of t)try{r()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===e||void 0===e?void 0:e.message})}}}}class Ji{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Zi(this),this.idTokenSubscription=new Zi(this),this.beforeStateQueue=new Yi(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Jr,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=li(n)),this._initializationPromise=this.queue(async()=>{var e;if(!this._deleted&&(this.persistenceManager=await Ui.create(this,t),!this._deleted)){if(null!==(e=this._popupRedirectResolver)&&void 0!==e&&e._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(n),this.lastNotifiedUid=(null===(e=this.currentUser)||void 0===e?void 0:e.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(!this._deleted){var e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e)return this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t,n,r,i=await this.assertedPersistence.getCurrentUser();let s=i,a=!1;if(e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null===(r=this.redirectUser)||void 0===r?void 0:r._redirectEventId,n=null===s||void 0===s?void 0:s._redirectEventId,r=await this.tryRedirectSignIn(e),t&&t!==n||null==r||!r.user||(s=r.user,a=!0)),!s)return this.directlySetCurrentUser(null);if(s._redirectEventId)return si(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s);if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(e){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await xi(e)}catch(e){if("auth/network-request-failed"!==(null===e||void 0===e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?X(e):null;return t&&si(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&si(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(li(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new T("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){var t;return this.redirectPersistenceManager||(si(t=e&&li(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await Ui.create(this,[li(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!==(e=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==e?e:null,this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser)))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return si(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return si(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Qi(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);var t=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());return t&&(e["X-Firebase-Client"]=t),e}}function Xi(e){return X(e)}class Zi{constructor(e){this.auth=e,this.observer=null,this.addObserver=U(e=>this.observer=e)}get next(){return si(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function es(e,t,n){const r=Xi(e);si(r._canInitEmulator,r,"emulator-config-failed"),si(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");var i=!(null==n||!n.disableWarnings);const s=ts(t);var{host:a,port:o}=function(e){const t=ts(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);{if(i){var s=i[1];return{host:s,port:ns(r.substr(s.length+1))}}var[a,s]=r.split(":");return{host:a,port:ns(s)}}}(t);r.config.emulator={url:`${s}//${a}${null===o?"":`:${o}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function ts(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ns(e){if(!e)return null;var t=Number(e);return isNaN(t)?null:t}class rs{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ai("not implemented")}_getIdTokenResponse(e){return ai("not implemented")}_linkToIdToken(e,t){return ai("not implemented")}_getReauthenticationResolver(e){return ai("not implemented")}}async function is(e,t){return _i(e,"POST","/v1/accounts:resetPassword",yi(e,t))}async function ss(e,t){return _i(e,"POST","/v1/accounts:update",t)}async function as(e,t){return _i(e,"POST","/v1/accounts:sendOobCode",yi(e,t))}class os extends rs{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new os(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new os(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e;if(null!=t&&t.email&&null!=t&&t.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return bi(e,"POST","/v1/accounts:signInWithPassword",yi(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return bi(e,"POST","/v1/accounts:signInWithEmailLink",yi(e,t))}(e,{email:this._email,oobCode:this._password});default:ei(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return ss(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return bi(e,"POST","/v1/accounts:signInWithEmailLink",yi(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:ei(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function cs(e,t){return bi(e,"POST","/v1/accounts:signInWithIdp",yi(e,t))}class ls extends rs{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ls(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ei("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,t=Wr(t,["providerId","signInMethod"]);if(!n||!r)return null;const i=new ls(n,r);return i.idToken=t.idToken||void 0,i.accessToken=t.accessToken||void 0,i.secret=t.secret,i.nonce=t.nonce,i.pendingToken=t.pendingToken||null,i}_getIdTokenResponse(e){return cs(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,cs(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,cs(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=O(t)}return e}}const us={USER_NOT_FOUND:"user-not-found"};class hs extends rs{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new hs({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new hs({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return bi(e,"POST","/v1/accounts:signInWithPhoneNumber",yi(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){var n=await bi(e,"POST","/v1/accounts:signInWithPhoneNumber",yi(e,t));if(n.temporaryProof)throw Ei(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return bi(e,"POST","/v1/accounts:signInWithPhoneNumber",yi(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),us)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e="string"==typeof e?JSON.parse(e):e;return n||t||r||i?new hs({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class ds{constructor(e){var t=M(L(e)),n=null!==(r=t.apiKey)&&void 0!==r?r:null,r=null!==(i=t.oobCode)&&void 0!==i?i:null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=t.mode)&&void 0!==i?i:null);si(n&&r&&i,"argument-error"),this.apiKey=n,this.operation=i,this.code=r,this.continueUrl=null!==(r=t.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(r=t.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(t=t.tenantId)&&void 0!==t?t:null}static parseLink(e){var t,n,r,t=(t=M(L(e=e)).link,n=t?M(L(t)).deep_link_id:null,((r=M(L(e)).deep_link_id)?M(L(r)).link:null)||r||n||t||e);try{return new ds(t)}catch(e){return null}}}class ps{constructor(){this.providerId=ps.PROVIDER_ID}static credential(e,t){return os._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){var n=ds.parseLink(t);return si(n,"argument-error"),os._fromEmailAndCode(e,n.code,n.tenantId)}}ps.PROVIDER_ID="password",ps.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ps.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class fs{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class gs extends fs{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ms extends gs{static credentialFromJSON(e){var t="string"==typeof e?JSON.parse(e):e;return si("providerId"in t&&"signInMethod"in t,"argument-error"),ls._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return si(e.idToken||e.accessToken,"argument-error"),ls._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return ms.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return ms.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:a}=e;if(!(n||r||t||i))return null;if(!a)return null;try{return new ms(a)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class vs extends gs{constructor(){super("facebook.com")}static credential(e){return ls._fromParams({providerId:vs.PROVIDER_ID,signInMethod:vs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return vs.credentialFromTaggedObject(e)}static credentialFromError(e){return vs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return vs.credential(e.oauthAccessToken)}catch(e){return null}}}vs.FACEBOOK_SIGN_IN_METHOD="facebook.com",vs.PROVIDER_ID="facebook.com";class ys extends gs{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ls._fromParams({providerId:ys.PROVIDER_ID,signInMethod:ys.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ys.credentialFromTaggedObject(e)}static credentialFromError(e){return ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return ys.credential(t,n)}catch(e){return null}}}ys.GOOGLE_SIGN_IN_METHOD="google.com",ys.PROVIDER_ID="google.com";class _s extends gs{constructor(){super("github.com")}static credential(e){return ls._fromParams({providerId:_s.PROVIDER_ID,signInMethod:_s.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _s.credentialFromTaggedObject(e)}static credentialFromError(e){return _s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return _s.credential(e.oauthAccessToken)}catch(e){return null}}}_s.GITHUB_SIGN_IN_METHOD="github.com",_s.PROVIDER_ID="github.com";class ws extends rs{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return cs(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,cs(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,cs(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:t,signInMethod:n,pendingToken:r}="string"==typeof e?JSON.parse(e):e;return t&&n&&r&&t===n?new ws(t,r):null}static _create(e,t){return new ws(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class bs extends fs{constructor(e){si(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return bs.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return bs.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){var t=ws.fromJSON(e);return si(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return ws._create(n,t)}catch(e){return null}}}class Is extends gs{constructor(){super("twitter.com")}static credential(e,t){return ls._fromParams({providerId:Is.PROVIDER_ID,signInMethod:Is.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Is.credentialFromTaggedObject(e)}static credentialFromError(e){return Is.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Is.credential(t,n)}catch(e){return null}}}async function Ts(e,t){return bi(e,"POST","/v1/accounts:signUp",yi(e,t))}Is.TWITTER_SIGN_IN_METHOD="twitter.com",Is.PROVIDER_ID="twitter.com";class Es{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){var i=await Oi._fromIdTokenResponse(e,n,r),s=ks(n);return new Es({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);var r=ks(n);return new Es({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function ks(e){return e.providerId||("phoneNumber"in e?"phone":null)}class Cs extends I{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Cs.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Cs(e,t,n,r)}}function Ss(t,n,e,r){const i="reauthenticate"===n?e._getReauthenticationResolver(t):e._getIdTokenResponse(t);return i.catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw Cs._fromErrorAndOperation(t,e,n,r);throw e})}function As(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function Ns(e,t){const n=X(e);await xs(!0,n,t);var r=(e=n.auth,t={idToken:await n.getIdToken(),deleteProvider:[t]},await _i(e,"POST","/v1/accounts:update",t))["providerUserInfo"];const i=As(r||[]);return n.providerData=n.providerData.filter(e=>i.has(e.providerId)),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function Rs(e,t,n=!1){var r=await Ai(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Es._forOperation(e,"link",r)}async function xs(e,t,n){await xi(t);const r=As(t.providerData);var i=!1===e?"provider-already-linked":"no-such-provider";si(r.has(n)===e,t.auth,i)}async function Ds(e,t,n=!1){var r=e["auth"],i="reauthenticate";try{var s=await Ai(e,Ss(r,i,t,e),n);si(s.idToken,r,"internal-error");var a=Si(s.idToken);si(a,r,"internal-error");var o=a["sub"];return si(e.uid===o,r,"user-mismatch"),Es._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null===e||void 0===e?void 0:e.code)&&ei(r,"user-mismatch"),e}}async function Ps(e,t,n=!1){var r=await Ss(e,"signIn",t),r=await Es._fromIdTokenResponse(e,"signIn",r);return n||await e._updateCurrentUser(r.user),r}async function Os(e,t){return Ps(Xi(e),t)}async function Ms(e,t){var n=X(e);return await xs(!1,n,t.providerId),Rs(n,t)}async function Ls(e,t){return Ds(X(e),t)}async function Fs(e,t){const n=Xi(e);var r=await bi(n,"POST","/v1/accounts:signInWithCustomToken",yi(n,{token:t,returnSecureToken:!0})),r=await Es._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(r.user),r}class Us{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?qs._fromServerResponse(e,t):ei(e,"internal-error")}}class qs extends Us{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new qs(t)}}function Vs(e,t,n){var r;si(0<(null===(r=n.url)||void 0===r?void 0:r.length),e,"invalid-continue-uri"),si(void 0===n.dynamicLinkDomain||0<n.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(si(0<n.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(si(0<n.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function Bs(e,t,n){var r=X(e),i={requestType:"PASSWORD_RESET",email:t};n&&Vs(r,i,n),await as(r,i)}async function js(e,t){await _i(e=X(e),"POST","/v1/accounts:update",yi(e,{oobCode:t}))}async function Ks(e,t){var n=X(e),r=await is(n,{oobCode:t}),i=r.requestType;switch(si(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":si(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":si(r.mfaInfo,n,"internal-error");default:si(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=Us._fromServerResponse(Xi(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function $s(e,t,n){var r=X(e),i={requestType:"EMAIL_SIGNIN",email:t};si(n.handleCodeInApp,r,"argument-error"),n&&Vs(r,i,n),await as(r,i)}async function Ws(e,t){var n=hi()?ui():"http://localhost",n=(await _i(e=X(e),"POST","/v1/accounts:createAuthUri",yi(e,{identifier:t,continueUri:n})))["signinMethods"];return n||[]}async function zs(e,t){var n=X(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&Vs(n.auth,r,t);var r=(await as(n.auth,r))["email"];r!==e.email&&await e.reload()}async function Gs(e,t,n){var r=X(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&Vs(r.auth,i,n);var i=(await as(r.auth,i))["email"];i!==e.email&&await e.reload()}async function Hs(e,{displayName:t,photoURL:n}){if(void 0!==t||void 0!==n){const i=X(e);var r=await i.getIdToken(),r=await Ai(i,async function(e,t){return _i(e,"POST","/v1/accounts:update",t)}(i.auth,{idToken:r,displayName:t,photoUrl:n,returnSecureToken:!0}));i.displayName=r.displayName||null,i.photoURL=r.photoUrl||null;const s=i.providerData.find(({providerId:e})=>"password"===e);s&&(s.displayName=i.displayName,s.photoURL=i.photoURL),await i._updateTokensIfNecessary(r)}}async function Qs(e,t,n){var r=e["auth"];const i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);r=await Ai(e,ss(r,i));await e._updateTokensIfNecessary(r,!0)}class Ys{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Js extends Ys{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Xs extends Ys{constructor(e,t){super(e,"facebook.com",t)}}class Zs extends Js{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class ea extends Ys{constructor(e,t){super(e,"google.com",t)}}class ta extends Js{constructor(e,t,n){super(e,"twitter.com",t,n)}}function na(e){var{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){if(!e)return null;var t=e["providerId"],n=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},r=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!t&&null!=e&&e.idToken){var i=null===(i=null===(i=Si(e.idToken))||void 0===i?void 0:i.firebase)||void 0===i?void 0:i.sign_in_provider;if(i){i="anonymous"!==i&&"custom"!==i?i:null;return new Ys(r,i)}}if(!t)return null;switch(t){case"facebook.com":return new Xs(r,n);case"github.com":return new Zs(r,n);case"google.com":return new ea(r,n);case"twitter.com":return new ta(r,n,e.screenName||null);case"custom":case"anonymous":return new Ys(r,null);default:return new Ys(r,t,n)}}(n)}class ra{constructor(e,t,n){this.type=e,this.credential=t,this.auth=n}static _fromIdtoken(e,t){return new ra("enroll",e,t)}static _fromMfaPendingCredential(e){return new ra("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return ra._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.idToken)return ra._fromIdtoken(e.multiFactorSession.idToken)}return null}}class ia{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,i){const s=Xi(e),a=i.customData._serverResponse;var t=(a.mfaInfo||[]).map(e=>Us._fromServerResponse(s,e));si(a.mfaPendingCredential,s,"internal-error");const o=ra._fromMfaPendingCredential(a.mfaPendingCredential);return new ia(o,t,async e=>{var t=await e._process(s,o);delete a.mfaInfo,delete a.mfaPendingCredential;var n=Object.assign(Object.assign({},a),{idToken:t.idToken,refreshToken:t.refreshToken});switch(i.operationType){case"signIn":var r=await Es._fromIdTokenResponse(s,i.operationType,n);return await s._updateCurrentUser(r.user),r;case"reauthenticate":return si(i.user,s,"internal-error"),Es._forOperation(i.user,i.operationType,n);default:ei(s,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class sa{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>Us._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new sa(e)}async getSession(){return ra._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const n=e;var r=await this.getSession(),r=await Ai(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid;var n,r=await this.user.getIdToken(),r=await Ai(this.user,(n=this.user.auth,e={idToken:r,mfaEnrollmentId:t},_i(n,"POST","/v2/accounts/mfaEnrollment:withdraw",yi(n,e))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==(null===e||void 0===e?void 0:e.code))throw e}}}const aa=new WeakMap;const oa="__sak";class ca{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(oa,"1"),this.storage.removeItem(oa),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){var t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class la extends ca{constructor(){var e;super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=(Bi(e=d())||Gi(e))&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Hi(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){var t=this.storage.getItem(r),n=this.localCache[r];t!==n&&e(r,n,t)}}onStorageEvent(e,t=!1){if(e.key){const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}var n=()=>{var e=this.storage.getItem(r);!t&&this.localCache[r]===e||this.notifyListeners(r,e)};const i=this.storage.getItem(r);v()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)})}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}la.type="LOCAL";const ua=la;class ha extends ca{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ha.type="SESSION";const da=ha;class pa{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));if(e)return e;e=new pa(t);return this.receivers.push(e),e}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data;var s=this.handlersMap[r];null!=s&&s.size&&(t.ports[0].postMessage({status:"ack",eventId:n,eventType:r}),s=Array.from(s).map(async e=>e(t.origin,i)),s=await Promise.all(s.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:s}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function fa(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}pa.receivers=[];class ga{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,a=50){const o="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!o)throw new Error("connection_unavailable");let c,l;return new Promise((n,r)=>{const i=fa("",20);o.port1.start();const s=setTimeout(()=>{r(new Error("unsupported_event"))},a);l={messageChannel:o,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),c=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),n(t.data.response);break;default:clearTimeout(s),clearTimeout(c),r(new Error("invalid_response"))}}},this.handlers.add(l),o.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[o.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function ma(){return window}function va(){return void 0!==ma().WorkerGlobalScope&&"function"==typeof ma().importScripts}const ya="firebaseLocalStorageDb",_a="firebaseLocalStorage",wa="fbase_key";class ba{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Ia(e,t){return e.transaction([_a],t?"readwrite":"readonly").objectStore(_a)}function Ta(){const r=indexedDB.open(ya,1);return new Promise((n,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const e=r.result;try{e.createObjectStore(_a,{keyPath:wa})}catch(e){t(e)}}),r.addEventListener("success",async()=>{const e=r.result;var t;e.objectStoreNames.contains(_a)?n(e):(e.close(),t=indexedDB.deleteDatabase(ya),await new ba(t).toPromise(),n(await Ta()))})})}async function Ea(e,t,n){var r=Ia(e,!0).put({fbase_key:t,value:n});return new ba(r).toPromise()}function ka(e,t){var n=Ia(e,!0).delete(t);return new ba(n).toPromise()}class Ca{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Ta(),this.db)}async _withRetries(e){let t=0;for(;;)try{return e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return va()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=pa._getInstance(va()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t,n;this.activeServiceWorker=await async function(){if(null===navigator||void 0===navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),this.activeServiceWorker&&(this.sender=new ga(this.activeServiceWorker),(n=await this.sender._send("ping",{},800))&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0))}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;var e=await Ta();return await Ea(e,oa,"1"),await ka(e,oa),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(e=>Ea(e,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(t){var e=await this._withRetries(e=>async function(e,t){var n=Ia(e,!1).get(t);return void 0===(n=await new ba(n).toPromise())?null:n.value}(e,t));return this.localCache[t]=e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>ka(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e,t,n=await this._withRetries(e=>{var t=Ia(e,!1).getAll();return new ba(t).toPromise()});if(!n)return[];if(0!==this.pendingWrites)return[];const r=[],i=new Set;for({fbase_key:e,value:t}of n)i.add(e),JSON.stringify(this.localCache[e])!==JSON.stringify(t)&&(this.notifyListeners(e,t),r.push(e));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r}notifyListeners(e,t){this.localCache[e]=t;var n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Ca.type="LOCAL";const Sa=Ca;function Aa(i){return new Promise((e,n)=>{const t=document.createElement("script");var r;t.setAttribute("src",i),t.onload=e,t.onerror=e=>{const t=ti("internal-error");t.customData=e,n(t)},t.type="text/javascript",t.charset="UTF-8",(null!==(r=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==r?r:document).appendChild(t)})}function Na(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Ra{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var n=this.counter;return this._widgets.set(n,new xa(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t,n=e||1e12;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;return(null===(t=this._widgets.get(e||1e12))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;return null===(t=this._widgets.get(e||1e12))||void 0===t||t.execute(),""}}class xa{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};var r="string"==typeof e?document.getElementById(e):e;si(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Da=Na("rcb"),Pa=new pi(3e4,6e4);class Oa{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!(null===(e=ma().grecaptcha)||void 0===e||!e.render)}load(s,a=""){var e;return si((e=a).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e),s,"argument-error"),this.shouldResolveImmediately(a)?Promise.resolve(ma().grecaptcha):new Promise((t,n)=>{const i=ma().setTimeout(()=>{n(ti(s,"network-request-failed"))},Pa.get());ma()[Da]=()=>{ma().clearTimeout(i),delete ma()[Da];const e=ma().grecaptcha;if(e){const r=e.render;e.render=(e,t)=>{var n=r(e,t);return this.counter++,n},this.hostLanguage=a,t(e)}else n(ti(s,"internal-error"))},Aa(`https://www.google.com/recaptcha/api.js??${O({onload:Da,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(i),n(ti(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!(null===(t=ma().grecaptcha)||void 0===t||!t.render)&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class Ma{async load(e){return new Ra(e)}clearedOneInstance(){}}const La="recaptcha",Fa={theme:"light",type:"image"};class Ua{constructor(e,t=Object.assign({},Fa),n){this.parameters=t,this.type=La,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Xi(n),this.isInvisible="invisible"===this.parameters.size,si("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");var r="string"==typeof e?document.getElementById(e):e;si(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?Ma:Oa),this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha();var t=r.getResponse(e);return t||new Promise(t=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),t(e))};this.tokenChangeListeners.add(n),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){si(!this.parameters.sitekey,this.auth,"argument-error"),si(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),si("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof n)n(t);else if("string"==typeof n){const e=ma()[n];"function"==typeof e&&e(t)}}}assertNotDestroyed(){si(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){si(hi()&&!va(),this.auth,"internal-error"),await function(){let t=null;return new Promise(e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await _i(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");si(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return si(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class qa{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){var t=hs._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Va(t,n,r){var i,s,a,o,c,l,u=await r.verify();try{si("string"==typeof u,t,"argument-error"),si(r.type===La,t,"argument-error");let e;if(e="string"==typeof n?{phoneNumber:n}:n,"session"in e){var h=e.session;if("phoneNumber"in e)return si("enroll"===h.type,t,"internal-error"),(c=t,l={idToken:h.credential,phoneEnrollmentInfo:{phoneNumber:e.phoneNumber,recaptchaToken:u}},await _i(c,"POST","/v2/accounts/mfaEnrollment:start",yi(c,l))).phoneSessionInfo.sessionInfo;si("signin"===h.type,t,"internal-error");var d=(null===(i=e.multiFactorHint)||void 0===i?void 0:i.uid)||e.multiFactorUid;return si(d,t,"missing-multi-factor-info"),(o={mfaPendingCredential:h.credential,mfaEnrollmentId:d,phoneSignInInfo:{recaptchaToken:u}},await _i(t,"POST","/v2/accounts/mfaSignIn:start",yi(t,o))).phoneResponseInfo.sessionInfo}var p=(s=t,a={phoneNumber:e.phoneNumber,recaptchaToken:u},await _i(s,"POST","/v1/accounts:sendVerificationCode",yi(s,a)))["sessionInfo"];return p}finally{r._reset()}}class Ba{constructor(e){this.providerId=Ba.PROVIDER_ID,this.auth=Xi(e)}verifyPhoneNumber(e,t){return Va(this.auth,e,X(t))}static credential(e,t){return hs._fromVerification(e,t)}static credentialFromResult(e){var t=e;return Ba.credentialFromTaggedObject(t)}static credentialFromError(e){return Ba.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{phoneNumber:t,temporaryProof:n}=e;return t&&n?hs._fromTokenResponse(t,n):null}}function ja(e,t){return t?li(t):(si(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Ba.PROVIDER_ID="phone",Ba.PHONE_SIGN_IN_METHOD="phone";class Ka extends rs{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return cs(e,this._buildIdpRequest())}_linkToIdToken(e,t){return cs(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return cs(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function $a(e){return Ps(e.auth,new Ka(e),e.bypassAuthState)}function Wa(e){var{auth:t,user:n}=e;return si(n,t,"internal-error"),Ds(n,new Ka(e),e.bypassAuthState)}async function za(e){var{auth:t,user:n}=e;return si(n,t,"internal-error"),Rs(n,new Ka(e),e.bypassAuthState)}class Ga{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)this.reject(s);else{r={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(r))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return $a;case"linkViaPopup":case"linkViaRedirect":return za;case"reauthViaPopup":case"reauthViaRedirect":return Wa;default:ei(this.auth,"internal-error")}}resolve(e){oi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){oi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ha=new pi(2e3,1e4);class Qa extends Ga{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Qa.currentPopupAction&&Qa.currentPopupAction.cancel(),Qa.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return si(e,this.auth,"internal-error"),e}async onExecution(){oi(1===this.filter.length,"Popup operations only handle one event");var e=fa();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(ti(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(ti(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Qa.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e;null!==(e=null===(e=this.authWindow)||void 0===e?void 0:e.window)&&void 0!==e&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ti(this.auth,"popup-closed-by-user"))},2e3):this.pollId=window.setTimeout(t,Ha.get())};t()}}Qa.currentPopupAction=null;const Ya="pendingRedirect",Ja=new Map;class Xa extends Ga{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let t=Ja.get(this.auth._key());if(!t){try{const e=await async function(e,t){const n=no(t),r=to(e);if(!await r._isAvailable())return!1;var i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(e)}catch(e){t=()=>Promise.reject(e)}Ja.set(this.auth._key(),t)}return this.bypassAuthState||Ja.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Za(e,t){return to(e)._set(no(t),"true")}function eo(e,t){Ja.set(e._key(),t)}function to(e){return li(e._redirectPersistence)}function no(e){return Fi(Ya,e.config.apiKey,e.name)}function ro(e,t,n){return async function(e,t,n){var r=Xi(e);ri(e,t,fs);const i=ja(r,n);return await Za(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function io(e,t,n){return async function(e,t,n){var r=X(e);ri(r.auth,t,fs);const i=ja(r.auth,n);await Za(i,r.auth);var s=await oo(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}function so(e,t,n){return async function(e,t,n){var r=X(e);ri(r.auth,t,fs);const i=ja(r.auth,n);await xs(!1,r,t.providerId),await Za(i,r.auth);var s=await oo(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}async function ao(e,t,n=!1){const r=Xi(e);var i=ja(r,t);const s=new Xa(r,i,n),a=await s.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}async function oo(e){var t=fa(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class co{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(n=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return uo(e);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(e,t){var n;e.error&&!uo(e)?(n=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error",t.onError(ti(this.auth,n))):t.onAuthEvent(e)}isEventForConsumer(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(lo(e))}saveEventToCache(e){this.cachedEventUids.add(lo(e)),this.lastProcessedEventTime=Date.now()}}function lo(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function uo({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function ho(e,t={}){return _i(e,"GET","/v1/projects",t)}const po=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,fo=/^https?/;async function go(e){if(!e.config.emulator){var t=(await ho(e))["authorizedDomains"];for(const n of t)try{if(function(e){const t=ui(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){var i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!fo.test(n))return!1;if(po.test(e))return r===e;const s=e.replace(/\./g,"\\."),a=new RegExp("^(.+\\."+s+"|"+s+")$","i");return a.test(r)}(n))return}catch(e){}ei(e,"unauthorized-domain")}}const mo=new pi(3e4,6e4);function vo(){const t=ma().___jsl;if(null!==t&&void 0!==t&&t.H)for(const n of Object.keys(t.H))if(t.H[n].r=t.H[n].r||[],t.H[n].L=t.H[n].L||[],t.H[n].r=[...t.H[n].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let yo=null;function _o(e){var i;return yo=yo||(i=e,new Promise((e,t)=>{function n(){vo(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{vo(),t(ti(i,"network-request-failed"))},timeout:mo.get()})}if(null!==(r=null===(r=ma().gapi)||void 0===r?void 0:r.iframes)&&void 0!==r&&r.Iframe)e(gapi.iframes.getContext());else{if(null===(r=ma().gapi)||void 0===r||!r.load){var r=Na("iframefcb");return ma()[r]=()=>{gapi.load?n():t(ti(i,"network-request-failed"))},Aa(`https://apis.google.com/js/api.js?onload=${r}`).catch(e=>t(e))}n()}}).catch(e=>{throw yo=null,e})),yo}const wo=new pi(5e3,15e3),bo="__/auth/iframe",Io="emulator/auth/iframe",To={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Eo=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function ko(a){const e=await _o(a);var t=ma().gapi;return si(t,a,"internal-error"),e.open({where:document.body,url:function(e){var t=e.config;si(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?fi(t,Io):`https://${e.config.authDomain}/${bo}`;const r={apiKey:t.apiKey,appName:e.name,v:$e};(t=Eo.get(e.config.apiHost))&&(r.eid=t);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${O(r).slice(1)}`}(a),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:To,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});const n=ti(a,"network-request-failed"),r=ma().setTimeout(()=>{t(n)},wo.get());function i(){ma().clearTimeout(r),e(s)}s.ping(i).then(i,()=>{t(n)})}))}const Co={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class So{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Ao(e,t,n,r=500,i=600){var s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const c=Object.assign(Object.assign({},Co),{width:r.toString(),height:i.toString(),top:s,left:a});s=d().toLowerCase();n&&(o=ji(s)?"_blank":n),Vi(s)&&(t=t||"http://localhost",c.scrollbars="yes");var l,a=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if([n=d()]=[s],Gi(n)&&null!==(l=window.navigator)&&void 0!==l&&l.standalone&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",o),new So(null);const u=window.open(t||"",o,a);si(u,e,"popup-blocked");try{u.focus()}catch(e){}return new So(u)}const No="__/auth/handler",Ro="emulator/auth/handler";function xo(e,t,n,r,i,s){si(e.config.authDomain,e,"auth-domain-config-required"),si(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:$e,eventId:i};if(t instanceof fs){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",R(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(var[o,c]of Object.entries(s||{}))a[o]=c}if(t instanceof gs){const u=t.getScopes().filter(e=>""!==e);0<u.length&&(a.scopes=u.join(","))}e.tenantId&&(a.tid=e.tenantId);const l=a;for(const h of Object.keys(l))void 0===l[h]&&delete l[h];return`${e=[e["config"]][0],e.emulator?fi(e,Ro):`https://${e.authDomain}/${No}`}?${O(l).slice(1)}`}const Do="webStorageSupport";const Po=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=da,this._completeRedirectFn=ao,this._overrideRedirectResult=eo}async _openPopup(e,t,n,r){var i;return oi(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),Ao(e,xo(e,t,n,ui(),r),fa())}async _openRedirect(e,t,n,r){return await this._originValidation(e),r=xo(e,t,n,ui(),r),ma().location.href=r,new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:r,promise:n}=this.eventManagers[t];return r?Promise.resolve(r):(oi(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(t){const e=await ko(t),n=new co(t);return e.register("authEvent",e=>{return si(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(n,r){const e=this.iframes[n._key()];e.send(Do,{type:Do},e=>{var t=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t[Do];void 0!==t&&r(!!t),ei(n,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=go(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Hi()||Bi()||Gi()}};class Oo extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return ai("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Oo(e)}_finalizeEnroll(e,t,n){return e=e,n={idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()},_i(e,"POST","/v2/accounts/mfaEnrollment:finalize",yi(e,n))}_finalizeSignIn(e,t){return e=e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()},_i(e,"POST","/v2/accounts/mfaSignIn:finalize",yi(e,t))}}class Mo{constructor(){}static assertion(e){return Oo._fromCredential(e)}}Mo.FACTOR_ID="phone";var Lo,Fo="@firebase/auth";class Uo{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null===e||void 0===e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){si(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function qo(){return window}Lo="Browser",Ve(new Z("auth",(e,{options:r})=>{var t=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat");const{apiKey:i,authDomain:s}=t.options;return((e,t)=>{si(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),si(!(null!==s&&void 0!==s&&s.includes(":")),"argument-error",{appName:e.name});var n={apiKey:i,authDomain:s,clientPlatform:Lo,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Qi(Lo)},n=new Ji(e,t,n);return function(e,t){const n=(null==t?void 0:t.persistence)||[];var r=(Array.isArray(n)?n:[n]).map(li);null!=t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(n,r),n})(t,n)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),Ve(new Z("auth-internal",e=>{var t=Xi(e.getProvider("auth").getImmediate());return e=t,new Uo(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),He(Fo,"0.20.7",function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Lo)),He(Fo,"0.20.7","esm2017");async function Vo(e,t,n){var r=qo()["BuildInfo"];oi(t.sessionId,"AuthEvent did not contain a session ID");var i=await async function(e){const t=function(e){if(oi(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId);const s={};return Gi()?s.ibi=r.packageName:$i()?s.apn=r.packageName:ei(e,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=i,xo(e,n,t.type,void 0,null!==(i=t.eventId)&&void 0!==i?i:void 0,s)}function Bo(r){const i=qo()["cordova"];return new Promise(n=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(r):t=i.InAppBrowser.open(r,(e=d(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),n(t)})})}const jo=20;class Ko extends co{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}function $o(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:function(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<jo;r++){var n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}(),postBody:null,tenantId:e.tenantId,error:ti(e,"no-auth-event")}}async function Wo(e){var t=await Go()._get(Ho(e));return t&&await Go()._remove(Ho(e)),t}function zo(e,t){var n,r,i;const s=(n=Qo(t=t),a=n.link?decodeURIComponent(n.link):void 0,r=Qo(a).link,i=n.deep_link_id?decodeURIComponent(n.deep_link_id):void 0,(n=Qo(i).link)||i||r||a||t);if(s.includes("/__/auth/callback")){var a=Qo(s),a=a.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(a.firebaseError)):null,a=null===(a=null===(a=null==a?void 0:a.code)||void 0===a?void 0:a.split("auth/"))||void 0===a?void 0:a[1],a=a?ti(a):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:s,postBody:null}}return null}function Go(){return li(ua)}function Ho(e){return Fi("authEvent",e.config.apiKey,e.name)}function Qo(e){if(null==e||!e.includes("?"))return{};const[,...t]=e.split("?");return M(t.join("?"))}const Yo=class{constructor(){this._redirectPersistence=da,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=ao,this._overrideRedirectResult=eo}async _initialize(e){var t=e._key();let n=this.eventManagers.get(t);return n||(n=new Ko(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){ei(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i,s;i=e,o=qo(),si("function"==typeof(null===(s=null==o?void 0:o.universalLinks)||void 0===s?void 0:s.subscribe),i,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),si(void 0!==(null===(s=null==o?void 0:o.BuildInfo)||void 0===s?void 0:s.packageName),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),si("function"==typeof(null===(s=null===(s=null===(s=null==o?void 0:o.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.openUrl),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),si("function"==typeof(null===(s=null===(s=null===(s=null==o?void 0:o.cordova)||void 0===s?void 0:s.plugins)||void 0===s?void 0:s.browsertab)||void 0===s?void 0:s.isAvailable),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),si("function"==typeof(null===(o=null===(o=null==o?void 0:o.cordova)||void 0===o?void 0:o.InAppBrowser)||void 0===o?void 0:o.open),i,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});const a=await this._initialize(e);await a.initialized(),a.resetRedirect(),Ja.clear(),await this._originValidation(e);var o=$o(e,n,r);n=e,r=o,await Go()._set(Ho(n),r);o=await Bo(await Vo(e,o,t));return async function(a,o,c){const l=qo()["cordova"];let u=()=>{};try{await new Promise((n,e)=>{let t=null;function r(){var e;n();const t=null===(e=l.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==c?void 0:c.close)&&c.close()}function i(){t=t||window.setTimeout(()=>{e(ti(a,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&i()}o.addPassiveListener(r),document.addEventListener("resume",i,!1),$i()&&document.addEventListener("visibilitychange",s,!1),u=()=>{o.removePassiveListener(r),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),t&&window.clearTimeout(t)}})}finally{u()}}(e,a,o)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){var t=qo()["BuildInfo"];const n={};Gi()?n.iosBundleId=t.packageName:$i()?n.androidPackageName=t.packageName:ei(e,"operation-not-supported-in-this-environment"),await ho(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(r,i){const{universalLinks:e,handleOpenURL:t,BuildInfo:n}=qo(),s=setTimeout(async()=>{await Wo(r),i.onEvent(Jo())},500),a=async e=>{clearTimeout(s);var t=await Wo(r);let n=null;t&&null!=e&&e.url&&(n=zo(t,e.url)),i.onEvent(n||Jo())};void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,a);const o=t,c=`${n.packageName.toLowerCase()}://`;qo().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&a({url:e}),"function"==typeof o)try{o(e)}catch(e){console.error(e)}}}};function Jo(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:ti("no-auth-event")}}var Xo;function Zo(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function ec(e=d()){return!("file:"!==Zo()&&"ionic:"!==Zo()&&"capacitor:"!==Zo()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function tc(e=d()){return v()&&11===(null===document||void 0===document?void 0:document.documentMode)||([e=d()]=[e],/Edge\/\d+/.test(e))}function nc(){try{const t=self.localStorage;var e=fa();if(t)return t.setItem(e,"1"),t.removeItem(e),!tc()||_()}catch(e){return rc()&&_()}return!1}function rc(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function ic(){return("http:"===Zo()||"https:"===Zo()||g()||ec())&&!(m()||p())&&nc()&&!rc()}function sc(){return ec()&&"undefined"!=typeof document}const ac={LOCAL:"local",NONE:"none",SESSION:"session"},oc=si,cc="persistence";async function lc(e){await e._initializationPromise;const t=uc();var n=Fi(cc,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function uc(){var e;try{return(null===(e="undefined"!=typeof window?window:null)?void 0:e.sessionStorage)||null}catch(e){return null}}const hc=si;class dc{constructor(){this.browserResolver=li(Po),this.cordovaResolver=li(Yo),this.underlyingResolver=null,this._redirectPersistence=da,this._completeRedirectFn=ao,this._overrideRedirectResult=eo}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return sc()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return hc(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!sc()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function pc(e){return e.unwrap()}function fc(e,t){var n,r,i,s=null===(r=t.customData)||void 0===r?void 0:r._tokenResponse;if("auth/multi-factor-auth-required"===(null===t||void 0===t?void 0:t.code)){const o=t;o.resolver=new yc(e,(n=t,i=X(e),si((a=n).customData.operationType,i,"argument-error"),si(null===(r=a.customData._serverResponse)||void 0===r?void 0:r.mfaPendingCredential,i,"argument-error"),ia._fromError(i,a)))}else if(s){var a=gc(t);const c=t;a&&(c.credential=a,c.tenantId=s.tenantId||void 0,c.email=s.email||void 0,c.phoneNumber=s.phoneNumber||void 0)}}function gc(e){var t=(e instanceof I?e.customData:e)["_tokenResponse"];if(!t)return null;if(!(e instanceof I)&&"temporaryProof"in t&&"phoneNumber"in t)return Ba.credentialFromResult(e);const n=t.providerId;if(!n||n===zr.PASSWORD)return null;let r;switch(n){case zr.GOOGLE:r=ys;break;case zr.FACEBOOK:r=vs;break;case zr.GITHUB:r=_s;break;case zr.TWITTER:r=Is;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:a,pendingToken:o,nonce:c}=t;return s||a||i||o?o?n.startsWith("saml.")?ws._create(n,o):ls._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:i,accessToken:s}):new ms(n).credential({idToken:i,accessToken:s,rawNonce:c}):null}return e instanceof I?r.credentialFromError(e):r.credentialFromResult(e)}function mc(t,e){return e.catch(e=>{throw e instanceof I&&fc(t,e),e}).then(e=>{var t=e.operationType,n=e.user;return{operationType:t,credential:gc(e),additionalUserInfo:na(e),user:_c.getOrCreate(n)}})}async function vc(t,e){const n=await e;return{verificationId:n.verificationId,confirm:e=>mc(t,n.confirm(e))}}class yc{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return mc(pc(this.auth),this.resolver.resolveSignIn(e))}}class _c{constructor(e){var t;this._delegate=e,this.multiFactor=(t=X(e),aa.has(t)||aa.set(t,sa._fromUser(t)),aa.get(t))}static getOrCreate(e){return _c.USER_MAP.has(e)||_c.USER_MAP.set(e,new _c(e)),_c.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return mc(this.auth,Ms(this._delegate,e))}async linkWithPhoneNumber(e,t){return vc(this.auth,async function(e,t,n){const r=X(e);await xs(!1,r,"phone");var i=await Va(r.auth,t,X(n));return new qa(i,e=>Ms(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return mc(this.auth,async function(e,t,n){var r=X(e);ri(r.auth,t,fs);var i=ja(r.auth,n);const s=new Qa(r.auth,"linkViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,dc))}async linkWithRedirect(e){return await lc(Xi(this.auth)),so(this._delegate,e,dc)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return mc(this.auth,Ls(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return vc(this.auth,async function(e,t,n){const r=X(e);var i=await Va(r.auth,t,X(n));return new qa(i,e=>Ls(r,e))}(this._delegate,e,t))}reauthenticateWithPopup(e){return mc(this.auth,async function(e,t,n){var r=X(e);ri(r.auth,t,fs);var i=ja(r.auth,n);const s=new Qa(r.auth,"reauthViaPopup",t,i,r);return s.executeNotNull()}(this._delegate,e,dc))}async reauthenticateWithRedirect(e){return await lc(Xi(this.auth)),io(this._delegate,e,dc)}sendEmailVerification(e){return zs(this._delegate,e)}async unlink(e){return await Ns(this._delegate,e),this}updateEmail(e){return Qs(X(this._delegate),e,null)}updatePassword(e){return Qs(X(this._delegate),null,e)}updatePhoneNumber(e){return async function(e,t){await Rs(X(e),t)}(this._delegate,e)}updateProfile(e){return Hs(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return Gs(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}_c.USER_MAP=new WeakMap;const wc=si;class bc{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();var n=e.options["apiKey"];wc(n,"invalid-api-key",{appName:e.name}),wc(n,"invalid-api-key",{appName:e.name});var r="undefined"!=typeof window?dc:void 0;this._delegate=t.initialize({options:{persistence:function(e,t){const n=function(e,t){const n=uc();if(!n)return[];var r=Fi(cc,e,t);switch(n.getItem(r)){case ac.NONE:return[Li];case ac.LOCAL:return[Sa,da];case ac.SESSION:return[da];default:return[]}}(e,t);"undefined"==typeof self||n.includes(Sa)||n.push(Sa);if("undefined"!=typeof window)for(const r of[ua,da])n.includes(r)||n.push(r);n.includes(Li)||n.push(Li);return n}(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(Qr),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?_c.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){es(this._delegate,e,t)}applyActionCode(e){return js(this._delegate,e)}checkActionCode(e){return Ks(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await is(X(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return mc(this._delegate,async function(e,t,n){const r=Xi(e);var i=await Ts(r,{returnSecureToken:!0,email:t,password:n}),i=await Es._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(i.user),i}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return Ws(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,e=e,"EMAIL_SIGNIN"===(null==(t=ds.parseLink(e))?void 0:t.operation);var t}async getRedirectResult(){wc(ic(),this._delegate,"operation-not-supported-in-this-environment");var e,t,n=(e=this._delegate,t=dc,await Xi(e)._initializationPromise,await ao(e,t,!1));return n?mc(this._delegate,Promise.resolve(n)):{credential:null,user:null}}addFrameworkForLogging(e){Xi(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){var{next:r,error:i,complete:s}=Ic(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){var{next:r,error:i,complete:s}=Ic(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return $s(this._delegate,e,t)}sendPasswordResetEmail(e,t){return Bs(this._delegate,e,t||void 0)}async setPersistence(e){var t,n;t=this._delegate,n=e,oc(Object.values(ac).includes(n),t,"invalid-persistence-type"),m()?oc(n!==ac.SESSION,t,"unsupported-persistence-type"):p()?oc(n===ac.NONE,t,"unsupported-persistence-type"):rc()?oc(n===ac.NONE||n===ac.LOCAL&&_(),t,"unsupported-persistence-type"):oc(n===ac.NONE||nc(),t,"unsupported-persistence-type");let r;switch(e){case ac.SESSION:r=da;break;case ac.LOCAL:var i=await li(Sa)._isAvailable();r=i?Sa:ua;break;case ac.NONE:r=Li;break;default:return ei("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return mc(this._delegate,async function(e){const t=Xi(e);if(await t._initializationPromise,null!==(n=t.currentUser)&&void 0!==n&&n.isAnonymous)return new Es({user:t.currentUser,providerId:null,operationType:"signIn"});var n=await Ts(t,{returnSecureToken:!0}),n=await Es._fromIdTokenResponse(t,"signIn",n,!0);return await t._updateCurrentUser(n.user),n}(this._delegate))}signInWithCredential(e){return mc(this._delegate,Os(this._delegate,e))}signInWithCustomToken(e){return mc(this._delegate,Fs(this._delegate,e))}signInWithEmailAndPassword(e,t){return mc(this._delegate,(n=this._delegate,e=e,t=t,Os(X(n),ps.credential(e,t))));var n}signInWithEmailLink(e,t){return mc(this._delegate,async function(e,t,n){var r=X(e),i=ps.credentialWithLink(t,n||ui());return si(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Os(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return vc(this._delegate,async function(e,t,n){const r=Xi(e);var i=await Va(r,t,X(n));return new qa(i,e=>Os(r,e))}(this._delegate,e,t))}async signInWithPopup(e){return wc(ic(),this._delegate,"operation-not-supported-in-this-environment"),mc(this._delegate,async function(e,t,n){var r=Xi(e);ri(e,t,fs);var i=ja(r,n);const s=new Qa(r,"signInViaPopup",t,i);return s.executeNotNull()}(this._delegate,e,dc))}async signInWithRedirect(e){return wc(ic(),this._delegate,"operation-not-supported-in-this-environment"),await lc(this._delegate),ro(this._delegate,e,dc)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){var n=(await Ks(X(e),t))["data"];return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function Ic(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&_c.getOrCreate(e)),error:t,complete:n}}bc.Persistence=ac;class Tc{constructor(){this.providerId="phone",this._delegate=new Ba(pc(ft.auth()))}static credential(e,t){return Ba.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Tc.PHONE_SIGN_IN_METHOD=Ba.PHONE_SIGN_IN_METHOD,Tc.PROVIDER_ID=Ba.PROVIDER_ID;const Ec=si;class kc{constructor(e,t,n=ft.app()){var r;Ec(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new Ua(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}(Xo=ft).INTERNAL.registerComponent(new Z("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new bc(t,n)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Gr.EMAIL_SIGNIN,PASSWORD_RESET:Gr.PASSWORD_RESET,RECOVER_EMAIL:Gr.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Gr.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Gr.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Gr.VERIFY_EMAIL}},EmailAuthProvider:ps,FacebookAuthProvider:vs,GithubAuthProvider:_s,GoogleAuthProvider:ys,OAuthProvider:ms,SAMLAuthProvider:bs,PhoneAuthProvider:Tc,PhoneMultiFactorGenerator:Mo,RecaptchaVerifier:kc,TwitterAuthProvider:Is,Auth:bc,AuthCredential:rs,Error:I}).setInstantiationMode("LAZY").setMultipleInstances(!1)),Xo.registerVersion("@firebase/auth-compat","0.2.20");const Cc="@firebase/database";let Sc="";function Ac(e){Sc=e}class Nc{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),C(t))}get(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:k(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Rc{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return A(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}var xc,Dc,Pc,Oc,Mc,Lc,Fc=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Nc(t)}}catch(e){}return new Rc};function Uc(e){var t=function(t){const n=[];let r=0;for(let a=0;a<t.length;a++){let e=t.charCodeAt(a);var i,s;55296<=e&&e<=56319&&(i=e-55296,a++,f(a<t.length,"Surrogate pair missing trail surrogate."),s=t.charCodeAt(a)-56320,e=65536+(i<<10)+s),e<128?n[r++]=e:(e<2048?n[r++]=e>>6|192:(e<65536?n[r++]=e>>12|224:(n[r++]=e>>18|240,n[r++]=e>>12&63|128),n[r++]=e>>6&63|128),n[r++]=63&e|128)}return n}(e);const n=new F;return n.update(t),t=n.digest(),l.encodeByteArray(t)}const qc=Fc("localStorage"),Vc=Fc("sessionStorage"),Bc=new ue("@firebase/database"),jc=function(){let e=1;return function(){return e++}}(),Kc=function(...e){let t="";for(let r=0;r<e.length;r++){var n=e[r];Array.isArray(n)||n&&"object"==typeof n&&"number"==typeof n.length?t+=Kc.apply(null,n):t+="object"==typeof n?C(n):n,t+=" "}return t};let $c=null,Wc=!0;function zc(t){return function(...e){Zc(t,...e)}}function Gc(...e){var t="FIREBASE INTERNAL ERROR: "+Kc(...e);Bc.error(t)}function Hc(e,t){return e===t?0:e<t?-1:1}function Qc(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+C(t))}function Yc(e){if("object"!=typeof e||null===e)return C(e);const t=[];for(const r in e)t.push(r);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=C(t[i]),n+=":",n+=Yc(e[t[i]]);return n+="}",n}function Jc(e,t){var n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r}const Xc=function(e,t){f(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(Bc.logLevel=ie.VERBOSE,$c=Bc.log.bind(Bc),t&&Vc.set("logging_enabled",!0)):"function"==typeof e?$c=e:($c=null,Vc.remove("logging_enabled"))},Zc=function(...e){var t;!0===Wc&&(Wc=!1,null===$c&&!0===Vc.get("logging_enabled")&&Xc(!0)),$c&&(t=Kc.apply(null,e),$c(t))},el=function(...e){var t=`FIREBASE FATAL ERROR: ${Kc(...e)}`;throw Bc.error(t),new Error(t)},tl=function(...e){var t="FIREBASE WARNING: "+Kc(...e);Bc.warn(t)},nl=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&tl("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},rl=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},il="[MIN_NAME]",sl="[MAX_NAME]",al=function(e,t){if(e===t)return 0;if(e===il||t===sl)return-1;if(t===il||e===sl)return 1;var n=pl(e),r=pl(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1};function ol(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}function cl(e){f(!rl(e),"Invalid JSON number");let t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),r=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));const a=[];for(s=52;s;--s)a.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();const o=a.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(o.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()}function ll(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n}const ul=new RegExp("^-?(0*)\\d{1,10}$"),hl=-2147483648,dl=2147483647,pl=function(e){if(ul.test(e)){var t=Number(e);if(t>=hl&&t<=dl)return t}return null},fl=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw tl("Exception was thrown by user callback.",e),t},Math.floor(0))}};class gl{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(n){return this.appCheck?this.appCheck.getToken(n):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!==(e=this.appCheckProvider)&&void 0!==e&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){tl(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class ml{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(e=>e&&"auth/token-not-initialized"===e.code?(Zc("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',tl(e)}}class vl{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}vl.OWNER="owner";const yl=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,_l="websocket",wl="long_polling";class bl{constructor(e,t,n,r,i=!1,s="",a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=qc.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&qc.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Il(e,t,n){f("string"==typeof t,"typeof type must == string"),f("object"==typeof n,"typeof params must == object");let r;if(t===_l)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==wl)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);const i=[];return ol(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class Tl{constructor(){this.counters_={}}incrementCounter(e,t=1){A(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return c(void 0,this.counters_)}}const El={},kl={};function Cl(e){var t=e.toString();return El[t]||(El[t]=new Tl),El[t]}class Sl{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<n.length;++e)n[e]&&fl(()=>{this.onMessage_(n[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Al{constructor(e,t,n,r,i,s,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=zc(e),this.stats_=Cl(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Il(t,wl,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Sl(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(!this.isClosed_){this.scriptTagHolder=new Nl((...e)=>{var[t,n,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&yl.test(location.hostname)&&(t.r="f");var e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})}})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Al.forceAllow_=!0}static forceDisallow(){Al.forceDisallow_=!0}static isAvailable(){return!!Al.forceAllow_||!(Al.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){var t=C(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var t=i(t),n=Jc(t,1840);for(let r=0;r<n.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){var t=C(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Nl{constructor(t,n,e,r){this.onDisconnect=e,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=jc(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=Nl.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){Zc("frame writing exception"),e.stack&&Zc(e.stack),Zc(e)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||Zc("No IE domain setting required")}catch(e){var n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;var n=this.urlFn(i);let e="",t=0;for(;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+e.length<=1870))break;var r=this.pendingSegs.shift();e=e+"&seg"+t+"="+r.seg+"&ts"+t+"="+r.ts+"&d"+t+"="+r.d,t++}return n+=e,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),n())},t.onerror=()=>{Zc("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}catch(e){}},Math.floor(1))}}let Rl=null;"undefined"!=typeof MozWebSocket?Rl=MozWebSocket:"undefined"!=typeof WebSocket&&(Rl=WebSocket);class xl{constructor(e,t,n,r,i,s,a){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=zc(this.connId),this.stats_=Cl(t),this.connURL=xl.connectionURL_(t,s,a,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&yl.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),Il(e,_l,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,qc.set("previous_websocket_failure",!0);try{y(),this.mySock=new Rl(this.connURL,[],void 0)}catch(e){this.log_("Error instantiating WebSocket.");var n=e.message||e.data;return n&&this.log_(n),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){xl.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return"undefined"==typeof navigator||!navigator.userAgent||(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4&&(e=!0),!e&&null!==Rl&&!xl.forceDisallow_}static previouslyFailed(){return qc.isInMemoryStorage||!0===qc.get("previous_websocket_failure")}markConnectionHealthy(){qc.remove("previous_websocket_failure")}appendFrame_(e){var t;this.frames.push(e),this.frames.length===this.totalFrames&&(t=this.frames.join(""),this.frames=null,t=k(t),this.onMessage(t))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(f(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){var t;null!==this.mySock&&(t=e.data,this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(t):null!==(t=this.extractFrameCount_(t))&&this.appendFrame_(t))}send(e){this.resetKeepAlive();var t=C(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=Jc(t,16384);1<n.length&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}xl.responsesRequiredToBeHealthy=2,xl.healthyTimeout=3e4;class Dl{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Al,xl]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){var t=xl&&xl.isAvailable();let n=t&&!xl.previouslyFailed();if(e.webSocketOnly&&(t||tl("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[xl];else{const r=this.transports_=[];for(const i of Dl.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i);Dl.globalTransportInitialized_=!0}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}Dl.globalTransportInitialized_=!1;class Pl{constructor(e,t,n,r,i,s,a,o,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=o,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=zc("c:"+this.id+":"),this.transportManager_=new Dl(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));var r=e.healthyTimeout||0;0<r&&(this.healthyTimeout_=ll(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){var t;"t"in e&&("a"===(t=e.t)?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=Qc("t",e),n=Qc("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=Qc("t",e),n=Qc("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=Qc("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?Gc("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Gc("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&tl("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),ll(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ll(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(qc.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Ol{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Ml{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(t,...n){if(Array.isArray(this.listeners_[t])){const r=[...this.listeners_[t]];for(let e=0;e<r.length;e++)r[e].callback.apply(r[e].context,n)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}validateEventType_(t){f(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class Ll extends Ml{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||r()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Ll}getInitialEvent(e){return f("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class Fl{constructor(n,e){if(void 0===e){this.pieces_=n.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)0<this.pieces_[t].length&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=n,this.pieceNum_=e}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Ul(){return new Fl("")}function ql(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Vl(e){return e.pieces_.length-e.pieceNum_}function Bl(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Fl(e.pieces_,t)}function jl(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Kl(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function $l(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Fl(t,0)}function Wl(e,t){const n=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);if(t instanceof Fl)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{var r=t.split("/");for(let e=0;e<r.length;e++)0<r[e].length&&n.push(r[e])}return new Fl(n,0)}function zl(e){return e.pieceNum_>=e.pieces_.length}function Gl(e,t){var n=ql(e),r=ql(t);if(null===n)return t;if(n===r)return Gl(Bl(e),Bl(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Hl(e,t){var n=Kl(e,0),r=Kl(t,0);for(let s=0;s<n.length&&s<r.length;s++){var i=al(n[s],r[s]);if(0!==i)return i}return n.length===r.length?0:n.length<r.length?-1:1}function Ql(e,t){if(Vl(e)!==Vl(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function Yl(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(Vl(e)>Vl(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class Jl{constructor(e,t){this.errorPrefix_=t,this.parts_=Kl(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=z(this.parts_[n]);Xl(this)}}function Xl(e){if(768<e.byteLength_)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(32<e.parts_.length)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Zl(e))}function Zl(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class eu extends Ml{constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}static getInstance(){return new eu}getInitialEvent(e){return f("visible"===e,"Unknown event type: "+e),[this.visible_]}}class tu extends Ol{constructor(e,t,n,r,i,s,a,o){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=a,this.authOverride_=o,this.id=tu.nextPersistentConnectionId_++,this.log_=zc("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,o&&!y())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");eu.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Ll.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(C(i)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const n=new h;var t={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:t,onComplete:e=>{var t=e.d;"ok"===e.s?n.resolve(t):n.reject(t)}}),this.outstandingGetCount_++;t=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(t),n.promise}listen(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,a),this.connected_&&this.sendListen_(a)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(e)})}sendListen_(r){const i=r.query,s=i._path.toString(),a=i._queryIdentifier;this.log_("Listen on "+s+" for "+a);const e={p:s};r.tag&&(e.q=i._queryObject,e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,n=e.s;tu.warnOnListenWarnings_(t,i),(this.listens.get(s)&&this.listens.get(s).get(a))===r&&(this.log_("listen response",e),"ok"!==n&&this.removeListen_(s,a),r.onComplete&&r.onComplete(n,t))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&A(e,"w")){const i=N(e,"w");var n,r;Array.isArray(i)&&~i.indexOf("no_index")&&(n='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString(),tl("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${n} at `+`${r} to your security rules for better performance.`))}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){var t;(e&&40===e.length||(e=e,"object"==typeof(t=S(e).claims)&&!0===t.admin))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const r=this.authToken_;var e=function(e){const t=S(e),n=t.claims;return!!n&&"object"==typeof n&&n.hasOwnProperty("iat")}(r)?"auth":"gauth";const t={cred:r};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,n=e.d||"error";this.authToken_===r&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,n))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(t){const n=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;const r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,e,e=>{this.log_(n+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(e.s,e.d)})}reportStats(e){var t;this.connected_&&(this.log_("reportStats",t={c:e}),this.sendRequest("s",t,e=>{var t;"ok"!==e.s&&(t=e.d,this.log_("reportStats","Error sending stats: "+t))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+C(e));var t=e.r;const n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Gc("Unrecognized action received from server: "+C(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this);const u=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+tu.nextConnectionId_++,s=this.lastSessionId;let t=!1,n=null;var a=function(){n?n.close():(t=!0,u())};this.realtime_={close:a,sendRequest:function(e){f(n,"sendRequest call when we're not connected not allowed."),n.sendRequest(e)}};var o=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{var[c,l]=await Promise.all([this.authTokenProvider_.getToken(o),this.appCheckTokenProvider_.getToken(o)]);t?Zc("getToken() completed but was canceled"):(Zc("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=l&&l.token,n=new Pl(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,u,e=>{tl(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),t||(this.repoInfo_.nodeAdmin&&tl(e),a())}}}interrupt(e){Zc("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Zc("Resuming connection for reason: "+e),delete this.interruptReasons_[e],R(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>Yc(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){var n=new Fl(e).toString();let r;if(this.listens.has(n)){const i=this.listens.get(n);r=i.get(t),i.delete(t),0===i.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){Zc("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Zc("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let r=0;r<this.outstandingPuts_.length;r++)this.outstandingPuts_[r]&&this.sendPut_(r);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)}sendConnectStats_(){const e={};e["sdk.js."+Sc.replace(/\./g,"-")]=1,r()?e["framework.cordova"]=1:m()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=Ll.getInstance().currentlyOnline();return R(this.interruptReasons_)&&e}}tu.nextPersistentConnectionId_=0,tu.nextConnectionId_=0;class nu{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new nu(e,t)}}class ru{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){var n=new nu(il,e),r=new nu(il,t);return 0!==this.compare(n,r)}minPost(){return nu.MIN}}let iu;class su extends ru{static get __EMPTY_NODE(){return iu}static set __EMPTY_NODE(e){iu=e}compare(e,t){return al(e.name,t.name)}isDefinedOn(e){throw u("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return nu.MIN}maxPost(){return new nu(sl,iu)}makePost(e,t){return f("string"==typeof e,"KeyIndex indexValue must always be a string."),new nu(e,iu)}toString(){return".key"}}const au=new su;class ou{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class cu{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:cu.RED,this.left=null!=r?r:lu.EMPTY_NODE,this.right=null!=i?i:lu.EMPTY_NODE}copy(e,t,n,r,i){return new cu(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return lu.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return lu.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){var e=this.copy(null,null,cu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,cu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}cu.RED=!0,cu.BLACK=!1;class lu{constructor(e,t=lu.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new lu(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,cu.BLACK,null,null))}remove(e){return new lu(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,cu.BLACK,null,null))}get(e){var t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ou(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ou(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ou(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ou(this.root_,null,this.comparator_,!0,e)}}function uu(e,t){return al(e.name,t.name)}function hu(e,t){return al(e,t)}lu.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new cu(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let du;function pu(e){return"number"==typeof e?"number:"+cl(e):"string:"+e}function fu(e){var t;e.isLeafNode()?(t=e.val(),f("string"==typeof t||"number"==typeof t||"object"==typeof t&&A(t,".sv"),"Priority must be a string or number.")):f(e===du||e.isEmpty(),"priority of unexpected type."),f(e===du||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}let gu;class mu{constructor(e,t=mu.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,f(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),fu(this.priorityNode_)}static set __childrenNodeConstructor(e){gu=e}static get __childrenNodeConstructor(){return gu}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new mu(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:mu.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return zl(e)?this:".priority"===ql(e)?this.priorityNode_:mu.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:mu.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var n=ql(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(f(".priority"!==n||1===Vl(e),".priority must be the last token in a path"),this.updateImmediateChild(n,mu.__childrenNodeConstructor.EMPTY_NODE.updateChild(Bl(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+pu(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"==t?cl(this.value_):this.value_,this.lazyHash_=Uc(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===mu.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof mu.__childrenNodeConstructor?-1:(f(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,n=typeof this.value_,r=mu.VALUE_TYPE_ORDER.indexOf(t),i=mu.VALUE_TYPE_ORDER.indexOf(n);return f(0<=r,"Unknown leaf type: "+t),f(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}mu.VALUE_TYPE_ORDER=["object","boolean","number","string"];let vu,yu;const _u=new class extends ru{compare(e,t){const n=e.node.getPriority();var r=t.node.getPriority(),r=n.compareTo(r);return 0===r?al(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return nu.MIN}maxPost(){return new nu(sl,new mu("[PRIORITY-POST]",yu))}makePost(e,t){var n=vu(e);return new nu(t,new mu("[PRIORITY-POST]",n))}toString(){return".priority"}},wu=Math.log(2);class bu{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/wu,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}function Iu(c,e,l,t){c.sort(e);const u=function(e,t){var n=t-e;let r,i;if(0==n)return null;if(1==n)return r=c[e],i=l?l(r):r,new cu(i,r.node,cu.BLACK,null,null);var s=parseInt(n/2,10)+e,a=u(e,s),n=u(s+1,t);return r=c[s],i=l?l(r):r,new cu(i,r.node,cu.BLACK,a,n)};var n=function(e){let s=null,a=null,o=c.length;function t(e,t){var n=o-e,r=o;o-=e;var i=u(1+n,r),r=c[n],n=l?l(r):r;!function(e){if(s){s.left=e;s=e}else{a=e;s=e}}(new cu(n,r.node,t,null,i))}for(let i=0;i<e.count;++i){var n=e.nextBitIsOne(),r=Math.pow(2,e.count-(i+1));n?t(r,cu.BLACK):(t(r,cu.BLACK),t(r,cu.RED))}return a}(new bu(c.length));return new lu(t||e,n)}let Tu;const Eu={};class ku{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return f((Eu,_u),"ChildrenNode.ts has not been loaded"),Tu=Tu||new ku({".priority":Eu},{".priority":_u}),Tu}get(e){var t=N(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof lu?t:null}hasIndex(e){return A(this.indexSet_,e.toString())}addIndex(e,t){f(e!==au,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(nu.Wrap);let s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();let a;a=r?Iu(n,e.getCompare()):Eu;var o=e.toString();const c=Object.assign({},this.indexSet_);c[o]=e;const l=Object.assign({},this.indexes_);return l[o]=a,new ku(l,c)}addToIndexes(a,o){var e=x(this.indexes_,(t,e)=>{const n=N(this.indexSet_,e);if(f(n,"Missing index implementation for "+e),t===Eu){if(n.isDefinedOn(a.node)){const i=[],s=o.getIterator(nu.Wrap);let e=s.getNext();for(;e;)e.name!==a.name&&i.push(e),e=s.getNext();return i.push(a),Iu(i,n.getCompare())}return Eu}{var r=o.get(a.name);let e=t;return r&&(e=e.remove(new nu(a.name,r))),e.insert(a,a.node)}});return new ku(e,this.indexSet_)}removeFromIndexes(n,r){var e=x(this.indexes_,e=>{if(e===Eu)return e;var t=r.get(n.name);return t?e.remove(new nu(n.name,t)):e});return new ku(e,this.indexSet_)}}let Cu;class Su{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&fu(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Cu=Cu||new Su(new lu(hu),null,ku.Default)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Cu}updatePriority(e){return this.children_.isEmpty()?this:new Su(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Cu:t}getChild(e){var t=ql(e);return null===t?this:this.getImmediateChild(t).getChild(Bl(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(n,r){if(f(r,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(r);{var i=new nu(n,r);let e,t;t=r.isEmpty()?(e=this.children_.remove(n),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,r),this.indexMap_.addToIndexes(i,this.children_));i=e.isEmpty()?Cu:this.priorityNode_;return new Su(e,i,t)}}updateChild(e,t){var n=ql(e);if(null===n)return t;f(".priority"!==ql(e)||1===Vl(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(Bl(e),t);return this.updateImmediateChild(n,r)}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const r={};let i=0,s=0,a=!0;if(this.forEachChild(_u,(e,t)=>{r[e]=t.val(n),i++,a&&Su.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):a=!1}),!n&&a&&s<2*i){const e=[];for(const t in r)e[t]=r[t];return e}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let r="";this.getPriority().isEmpty()||(r+="priority:"+pu(this.getPriority().val())+":"),this.forEachChild(_u,(e,t)=>{var n=t.hash();""!==n&&(r+=":"+e+":"+n)}),this.lazyHash_=""===r?"":Uc(r)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new nu(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()}getFirstChild(e){var t=this.getFirstChildName(e);return t?new nu(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()}getLastChild(e){var t=this.getLastChildName(e);return t?new nu(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getIteratorFrom(t,e=>e);{const r=this.children_.getIteratorFrom(t.name,nu.Wrap);let e=r.peek();for(;null!=e&&n.compare(e,t)<0;)r.getNext(),e=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getReverseIteratorFrom(t,e=>e);{const r=this.children_.getReverseIteratorFrom(t.name,nu.Wrap);let e=r.peek();for(;null!=e&&0<n.compare(e,t);)r.getNext(),e=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Nu?-1:0}withIndex(e){if(e===au||this.indexMap_.hasIndex(e))return this;var t=this.indexMap_.addIndex(e,this.children_);return new Su(this.children_,this.priorityNode_,t)}isIndexed(e){return e===au||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority())){if(this.children_.count()!==n.children_.count())return!1;{const r=this.getIterator(_u),i=n.getIterator(_u);let e=r.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=r.getNext(),t=i.getNext()}return null===e&&null===t}}return!1}}resolveIndex_(e){return e===au?null:this.indexMap_.get(e.toString())}}Su.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Au extends Su{constructor(){super(new lu(hu),Su.EMPTY_NODE,ku.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Su.EMPTY_NODE}isEmpty(){return!1}}const Nu=new Au;Object.defineProperties(nu,{MIN:{value:new nu(il,Su.EMPTY_NODE)},MAX:{value:new nu(sl,Nu)}}),su.__EMPTY_NODE=Su.EMPTY_NODE,mu.__childrenNodeConstructor=Su,xc=Nu,du=xc,Dc=Nu,yu=Dc;const Ru=!0;function xu(i,e=null){if(null===i)return Su.EMPTY_NODE;if("object"==typeof i&&".priority"in i&&(e=i[".priority"]),f(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(i="object"==typeof i&&".value"in i&&null!==i[".value"]?i[".value"]:i)||".sv"in i){var t=i;return new mu(t,xu(e))}if(i instanceof Array||!Ru){let r=Su.EMPTY_NODE;return ol(i,(e,t)=>{if(A(i,e)&&"."!==e.substring(0,1)){const n=xu(t);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(e,n))}}),r.updatePriority(xu(e))}{const s=[];let r=!1;if(ol(i,(e,t)=>{if("."!==e.substring(0,1)){const n=xu(t);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),s.push(new nu(e,n)))}}),0===s.length)return Su.EMPTY_NODE;var n=Iu(s,uu,e=>e.name,hu);if(r){t=Iu(s,_u.getCompare());return new Su(n,xu(e),new ku({".priority":t},{".priority":_u}))}return new Su(n,xu(e),ku.Default)}}vu=xu;class Du extends ru{constructor(e){super(),this.indexPath_=e,f(!zl(e)&&".priority"!==ql(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node);var r=this.extractChild(t.node),r=n.compareTo(r);return 0===r?al(e.name,t.name):r}makePost(e,t){var n=xu(e),n=Su.EMPTY_NODE.updateChild(this.indexPath_,n);return new nu(t,n)}maxPost(){var e=Su.EMPTY_NODE.updateChild(this.indexPath_,Nu);return new nu(sl,e)}toString(){return Kl(this.indexPath_,0).join("/")}}function Pu(e){if(e===""+dl)return Fu;var t=pl(e);if(null!=t)return""+(t+1);const n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e.charAt(i);if(n.length<qu)return n.push(Fu),n.join("");let r=n.length-1;for(;0<=r&&n[r]===Uu;)r--;return-1===r?sl:(t=n[r],t=Lu.charAt(Lu.indexOf(t)+1),n[r]=t,n.slice(0,r+1).join(""))}function Ou(e){if(e===""+hl)return il;var t=pl(e);if(null!=t)return""+(t-1);const n=new Array(e.length);for(let r=0;r<n.length;r++)n[r]=e.charAt(r);return n[n.length-1]===Fu?1===n.length?""+dl:(delete n[n.length-1],n.join("")):(n[n.length-1]=Lu.charAt(Lu.indexOf(n[n.length-1])-1),n.join("")+Uu.repeat(qu-n.length))}const Mu=new class extends ru{compare(e,t){var n=e.node.compareTo(t.node);return 0===n?al(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return nu.MIN}maxPost(){return nu.MAX}makePost(e,t){var n=xu(e);return new nu(t,n)}toString(){return".value"}},Lu="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Fu="-",Uu="z",qu=786,Vu=function(){let s=0;const a=[];return function(e){var t=e===s;s=e;let n;const r=new Array(8);for(n=7;0<=n;n--)r[n]=Lu.charAt(e%64),e=Math.floor(e/64);f(0===e,"Cannot push at time == 0");let i=r.join("");if(t){for(n=11;0<=n&&63===a[n];n--)a[n]=0;a[n]++}else for(n=0;n<12;n++)a[n]=Math.floor(64*Math.random());for(n=0;n<12;n++)i+=Lu.charAt(a[n]);return f(20===i.length,"nextPushId: Length should be 20."),i}}();function Bu(e){return{type:"value",snapshotNode:e}}function ju(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Ku(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function $u(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Wu{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(Ku(t,a)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(ju(t,n)):s.trackChildChange($u(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(_u,(e,t)=>{n.hasChild(e)||i.trackChildChange(Ku(e,t))}),n.isLeafNode()||n.forEachChild(_u,(e,t)=>{if(r.hasChild(e)){const n=r.getImmediateChild(e);n.equals(t)||i.trackChildChange($u(e,t,n))}else i.trackChildChange(ju(e,t))})),n.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Su.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class zu{constructor(e){this.indexedFilter_=new Wu(e.getIndex()),this.index_=e.getIndex(),this.startPost_=zu.getStartPost_(e),this.endPost_=zu.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,n,r,i,s){return this.matches(new nu(t,n))||(n=Su.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){let r=(t=t.isLeafNode()?Su.EMPTY_NODE:t).withIndex(this.index_);r=r.updatePriority(Su.EMPTY_NODE);const i=this;return t.forEachChild(_u,(e,t)=>{i.matches(new nu(e,t))||(r=r.updateImmediateChild(e,Su.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class Gu{constructor(e){this.rangedFilter_=new zu(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new nu(t,n))||(n=Su.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,a,t){let o;if(a.isLeafNode()||a.isEmpty())o=Su.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<a.numChildren()&&a.isIndexed(this.index_)){o=Su.EMPTY_NODE.withIndex(this.index_);let t;t=this.reverse_?a.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):a.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;t.hasNext()&&n<this.limit_;){var r=t.getNext();let e;if(e=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),r)<=0:this.index_.compare(r,this.rangedFilter_.getEndPost())<=0,!e)break;o=o.updateImmediateChild(r.name,r.node),n++}}else{o=a.withIndex(this.index_),o=o.updatePriority(Su.EMPTY_NODE);let e,t,n,r;if(this.reverse_){r=o.getReverseIterator(this.index_),e=this.rangedFilter_.getEndPost(),t=this.rangedFilter_.getStartPost();const l=this.index_.getCompare();n=(e,t)=>l(t,e)}else r=o.getIterator(this.index_),e=this.rangedFilter_.getStartPost(),t=this.rangedFilter_.getEndPost(),n=this.index_.getCompare();let i=0,s=!1;for(;r.hasNext();){var c=r.getNext();!s&&n(e,c)<=0&&(s=!0),s&&i<this.limit_&&n(c,t)<=0?i++:o=o.updateImmediateChild(c.name,Su.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,o,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const d=this.index_.getCompare();s=(e,t)=>d(t,e)}else s=this.index_.getCompare();const a=e;f(a.numChildren()===this.limit_,"");var o=new nu(t,n),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(a.hasChild(t)){var u=a.getImmediateChild(t);let e=r.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=e&&(e.name===t||a.hasChild(e.name));)e=r.getChildAfterChild(this.index_,e,this.reverse_);var h=null==e?1:s(e,o);if(l&&!n.isEmpty()&&0<=h)return null!=i&&i.trackChildChange($u(t,n,u)),a.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(Ku(t,u));const p=a.updateImmediateChild(t,Su.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(ju(e.name,e.node)),p.updateImmediateChild(e.name,e.node)):p}}return!n.isEmpty()&&l&&0<=s(c,o)?(null!=i&&(i.trackChildChange(Ku(c.name,c.node)),i.trackChildChange(ju(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(c.name,Su.EMPTY_NODE)):e}}class Hu{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=_u}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:il}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:sl}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===_u}copy(){const e=new Hu;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Qu(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function Yu(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function Ju(e,t){const n=e.copy();return n.index_=t,n}function Xu(e){const t={};if(e.isDefault())return t;let n;return n=e.index_===_u?"$priority":e.index_===Mu?"$value":e.index_===au?"$key":(f(e.index_ instanceof Du,"Unrecognized index type!"),e.index_.toString()),t.orderBy=C(n),e.startSet_&&(t.startAt=C(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+C(e.indexStartName_))),e.endSet_&&(t.endAt=C(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+C(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Zu(t){const n={};if(t.startSet_&&(n.sp=t.indexStartValue_,t.startNameSet_&&(n.sn=t.indexStartName_)),t.endSet_&&(n.ep=t.indexEndValue_,t.endNameSet_&&(n.en=t.indexEndName_)),t.limitSet_){n.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),n.vf=e}return t.index_!==_u&&(n.i=t.index_.toString()),n}class eh extends Ol{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=zc("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const a=eh.getListenId_(e,r),o={};this.listens_[a]=o;var n=Xu(e._queryParams);this.restRequest_(s+".json",n,(t,e)=>{let n=e;if(null===(t=404===t?n=null:t)&&this.onDataUpdate_(s,n,!1,r),N(this.listens_,a)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}})}unlisten(e,t){var n=eh.getListenId_(e,t);delete this.listens_[n]}get(e){var t=Xu(e._queryParams);const r=e._path.toString(),i=new h;return this.restRequest_(r+".json",t,(e,t)=>{let n=t;null===(e=404===e?n=null:e)?(this.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},a){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+O(s);this.log_("Sending REST request for "+n);const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(a&&4===r.readyState){this.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);let e=null;if(200<=r.status&&r.status<300){try{e=k(r.responseText)}catch(e){tl("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,e)}else 401!==r.status&&404!==r.status&&tl("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})}}class th{constructor(){this.rootNode_=Su.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function nh(){return{value:null,children:new Map}}function rh(e,t,n){var r;zl(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=ql(t),e.children.has(r)||e.children.set(r,nh()),rh(e.children.get(r),t=Bl(t),n))}function ih(e,n,r){var i;null!==e.value?r(n,e.value):(i=(e,t)=>{ih(t,new Fl(n.toString()+"/"+e),r)},e.children.forEach((e,t)=>{i(t,e)}))}class sh{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();const n=Object.assign({},e);return this.last_&&ol(this.last_,(e,t)=>{n[e]=n[e]-t}),this.last_=e,n}}class ah{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new sh(e);var n=1e4+2e4*Math.random();ll(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){var e=this.statsListener_.get();const n={};let r=!1;ol(e,(e,t)=>{0<t&&A(this.statsToReport_,e)&&(n[e]=t,r=!0)}),r&&this.server_.reportStats(n),ll(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function oh(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function ch(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function lh(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(OC=Pc=Pc||{})[OC.OVERWRITE=0]="OVERWRITE",OC[OC.MERGE=1]="MERGE",OC[OC.ACK_USER_WRITE=2]="ACK_USER_WRITE",OC[OC.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class uh{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Pc.ACK_USER_WRITE,this.source=oh()}operationForChild(e){if(zl(this.path)){if(null!=this.affectedTree.value)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new Fl(e));return new uh(Ul(),t,this.revert)}return f(ql(this.path)===e,"operationForChild called for unrelated child."),new uh(Bl(this.path),this.affectedTree,this.revert)}}class hh{constructor(e,t){this.source=e,this.path=t,this.type=Pc.LISTEN_COMPLETE}operationForChild(e){return zl(this.path)?new hh(this.source,Ul()):new hh(this.source,Bl(this.path))}}class dh{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Pc.OVERWRITE}operationForChild(e){return zl(this.path)?new dh(this.source,Ul(),this.snap.getImmediateChild(e)):new dh(this.source,Bl(this.path),this.snap)}}class ph{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Pc.MERGE}operationForChild(e){if(zl(this.path)){const t=this.children.subtree(new Fl(e));return t.isEmpty()?null:t.value?new dh(this.source,Ul(),t.value):new ph(this.source,Ul(),t)}return f(ql(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new ph(this.source,Bl(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class fh{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(zl(e))return this.isFullyInitialized()&&!this.filtered_;var t=ql(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class gh{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function mh(n,e,t,r){var i=[];const s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),vh(n,i,"child_removed",e,r,t),vh(n,i,"child_added",e,r,t),vh(n,i,"child_moved",s,r,t),vh(n,i,"child_changed",e,r,t),vh(n,i,"value",e,r,t),i}function vh(s,a,t,e,o,c){const n=e.filter(e=>e.type===t);n.sort((e,t)=>function(e,t,n){if(null==t.childName||null==n.childName)throw u("Should only compare child_ events.");var r=new nu(t.childName,t.snapshotNode),i=new nu(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(s,e,t)),n.forEach(t=>{const n=(e=s,i=c,"value"===(r=t).type||"child_removed"===r.type||(r.prevName=i.getPredecessorChildName(r.childName,r.snapshotNode,e.index_)),r);var e,r,i;o.forEach(e=>{e.respondsTo(t.type)&&a.push(e.createEvent(n,s.query_))})})}function yh(e,t){return{eventCache:e,serverCache:t}}function _h(e,t,n,r){return yh(new fh(t,n,r),e.serverCache)}function wh(e,t,n,r){return yh(e.eventCache,new fh(t,n,r))}function bh(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Ih(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Th;class Eh{constructor(e,t=(Th=Th||new lu(Hc),Th)){this.value=e,this.children=t}static fromObject(e){let n=new Eh(null);return ol(e,(e,t)=>{n=n.set(new Fl(e),t)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Ul(),value:this.value};if(zl(e))return null;{var n=ql(e);const i=this.children.get(n);if(null===i)return null;var r=i.findRootMostMatchingPathAndValue(Bl(e),t);return null==r?null:{path:Wl(new Fl(n),r.path),value:r.value}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(zl(e))return this;{var t=ql(e);const n=this.children.get(t);return null!==n?n.subtree(Bl(e)):new Eh(null)}}set(e,t){if(zl(e))return new Eh(t,this.children);{var n=ql(e);const i=this.children.get(n)||new Eh(null);var r=i.set(Bl(e),t),r=this.children.insert(n,r);return new Eh(this.value,r)}}remove(t){if(zl(t))return this.children.isEmpty()?new Eh(null):new Eh(null,this.children);{var n=ql(t);const r=this.children.get(n);if(r){const i=r.remove(Bl(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new Eh(null):new Eh(this.value,e)}return this}}get(e){if(zl(e))return this.value;{var t=ql(e);const n=this.children.get(t);return n?n.get(Bl(e)):null}}setTree(t,n){if(zl(t))return n;{var r=ql(t);const i=this.children.get(r)||new Eh(null),s=i.setTree(Bl(t),n);let e;return e=s.isEmpty()?this.children.remove(r):this.children.insert(r,s),new Eh(this.value,e)}}fold(e){return this.fold_(Ul(),e)}fold_(n,r){const i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(Wl(n,e),r)}),r(n,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,Ul(),t)}findOnPath_(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(zl(e))return null;{r=ql(e);const i=this.children.get(r);return i?i.findOnPath_(Bl(e),Wl(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Ul(),t)}foreachOnPath_(e,t,n){if(zl(e))return this;{this.value&&n(t,this.value);var r=ql(e);const i=this.children.get(r);return i?i.foreachOnPath_(Bl(e),Wl(t,r),n):new Eh(null)}}foreach(e){this.foreach_(Ul(),e)}foreach_(n,r){this.children.inorderTraversal((e,t)=>{t.foreach_(Wl(n,e),r)}),this.value&&r(n,this.value)}foreachChild(n){this.children.inorderTraversal((e,t)=>{t.value&&n(e,t.value)})}}class kh{constructor(e){this.writeTree_=e}static empty(){return new kh(new Eh(null))}}function Ch(t,n,r){if(zl(n))return new kh(new Eh(r));var i=t.writeTree_.findRootMostValueAndPath(n);if(null!=i){var s=i.path;let e=i.value;i=Gl(s,n);return e=e.updateChild(i,r),new kh(t.writeTree_.set(s,e))}s=new Eh(r),s=t.writeTree_.setTree(n,s);return new kh(s)}function Sh(e,n,t){let r=e;return ol(t,(e,t)=>{r=Ch(r,Wl(n,e),t)}),r}function Ah(e,t){if(zl(t))return kh.empty();var n=e.writeTree_.setTree(t,new Eh(null));return new kh(n)}function Nh(e,t){return null!=Rh(e,t)}function Rh(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Gl(n.path,t)):null}function xh(e){const n=[],t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(_u,(e,t)=>{n.push(new nu(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&n.push(new nu(e,t.value))}),n}function Dh(e,t){if(zl(t))return e;var n=Rh(e,t);return null!=n?new kh(new Eh(n)):new kh(e.writeTree_.subtree(t))}function Ph(e){return e.writeTree_.isEmpty()}function Oh(e,t){return function r(i,e,s){{if(null!=e.value)return s.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(f(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):s=r(Wl(i,e),t,s)}),s=!s.getChild(i).isEmpty()&&null!==n?s.updateChild(Wl(i,".priority"),n):s}}}(Ul(),e.writeTree_,t)}function Mh(e,t){return Gh(t,e)}function Lh(t,n){var e,r=t.allWrites.findIndex(e=>e.writeId===n);f(0<=r,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,a=!1,o=t.allWrites.length-1;for(;s&&0<=o;){var c=t.allWrites[o];c.visible&&(o>=r&&function(e,t){{if(e.snap)return Yl(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Yl(Wl(e.path,n),t))return!0;return!1}}(c,i.path)?s=!1:Yl(i.path,c.path)&&(a=!0)),o--}return!!s&&(a?((e=t).visibleWrites=Uh(e.allWrites,Fh,Ul()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=Ah(t.visibleWrites,i.path):ol(i.children,e=>{t.visibleWrites=Ah(t.visibleWrites,Wl(i.path,e))}),!0)}function Fh(e){return e.visible}function Uh(e,t,n){let r=kh.empty();for(let s=0;s<e.length;++s){const a=e[s];if(t(a)){var i=a.path;let e;if(a.snap)Yl(n,i)?(e=Gl(n,i),r=Ch(r,e,a.snap)):Yl(i,n)&&(e=Gl(i,n),r=Ch(r,Ul(),a.snap.getChild(e)));else{if(!a.children)throw u("WriteRecord should have .snap or .children");if(Yl(n,i))e=Gl(n,i),r=Sh(r,e,a.children);else if(Yl(i,n))if(e=Gl(i,n),zl(e))r=Sh(r,Ul(),a.children);else{const o=N(a.children,ql(e));o&&(i=o.getChild(Bl(e)),r=Ch(r,Ul(),i))}}}}return r}function qh(e,t,n,r,i){if(r||i){var s=Dh(e.visibleWrites,t);if(!i&&Ph(s))return n;if(i||null!=n||Nh(s,Ul()))return Oh(Uh(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(Yl(e.path,t)||Yl(t,e.path))},t),n||Su.EMPTY_NODE);return null}s=Rh(e.visibleWrites,t);if(null!=s)return s;s=Dh(e.visibleWrites,t);return Ph(s)?n:null!=n||Nh(s,Ul())?Oh(s,n||Su.EMPTY_NODE):null}function Vh(e,t,n,r){return qh(e.writeTree,e.treePath,t,n,r)}function Bh(e,t){return function(e,t,n){let r=Su.EMPTY_NODE;const i=Rh(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(_u,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const s=Dh(e.visibleWrites,t);return n.forEachChild(_u,(e,t)=>{var n=Oh(Dh(s,new Fl(e)),t);r=r.updateImmediateChild(e,n)}),xh(s).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return xh(Dh(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function jh(e,t,n,r){return function(e,t,n,r,i){f(r||i,"Either existingEventSnap or existingServerSnap must exist");var s=Wl(t,n);return Nh(e.visibleWrites,s)?null:Ph(s=Dh(e.visibleWrites,s))?i.getChild(n):Oh(s,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function Kh(e,t){return n=e.writeTree,t=Wl(e.treePath,t),Rh(n.visibleWrites,t);var n}function $h(e,t,n,r,i,s){return function(e,t,n,r,i,s,a){let o;var c=Dh(e.visibleWrites,t),l=Rh(c,Ul());if(null!=l)o=l;else{if(null==n)return[];o=Oh(c,n)}if(o=o.withIndex(a),o.isEmpty()||o.isLeafNode())return[];{const u=[],h=a.getCompare(),d=s?o.getReverseIteratorFrom(r,a):o.getIteratorFrom(r,a);let e=d.getNext();for(;e&&u.length<i;)0!==h(e,r)&&u.push(e),e=d.getNext();return u}}(e.writeTree,e.treePath,t,n,r,i,s)}function Wh(e,t,n){return r=e.writeTree,e=e.treePath,n=n,i=Wl(e,t=t),null!=(s=Rh(r.visibleWrites,i))?s:n.isCompleteForChild(t)?Oh(Dh(r.visibleWrites,i),n.getNode().getImmediateChild(t)):null;var r,i,s}function zh(e,t){return Gh(Wl(e.treePath,t),e.writeTree)}function Gh(e,t){return{treePath:e,writeTree:t}}class Hh{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,n=e.childName;f("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),f(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,$u(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Ku(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,ju(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw u("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,$u(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Qh=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Yh{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new fh(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Wh(this.writes_,e,n)}getChildAfterChild(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Ih(this.viewCache_),r=$h(this.writes_,r,t,1,n,e);return 0===r.length?null:r[0]}}function Jh(e,t,n,r,i){const s=new Hh;let a,o;if(n.type===Pc.OVERWRITE){var c=n;a=c.source.fromUser?ed(e,t,c.path,c.snap,r,i,s):(f(c.source.fromServer,"Unknown source."),o=c.source.tagged||t.serverCache.isFiltered()&&!zl(c.path),Zh(e,t,c.path,c.snap,r,i,o,s))}else if(n.type===Pc.MERGE){c=n;a=c.source.fromUser?function(r,i,s,e,a,o,c){let l=i;return e.foreach((e,t)=>{var n=Wl(s,e);td(i,ql(n))&&(l=ed(r,l,n,t,a,o,c))}),e.foreach((e,t)=>{var n=Wl(s,e);td(i,ql(n))||(l=ed(r,l,n,t,a,o,c))}),l}(e,t,c.path,c.children,r,i,s):(f(c.source.fromServer,"Unknown source."),o=c.source.tagged||t.serverCache.isFiltered(),rd(e,t,c.path,c.children,r,i,o,s))}else if(n.type===Pc.ACK_USER_WRITE){var l=n;a=l.revert?function(n,r,i,s,e,a){let o;{if(null!=Kh(s,i))return r;{var c=new Yh(s,r,e);const u=r.eventCache.getNode();let t;if(zl(i)||".priority"===ql(i)){let e;e=r.serverCache.isFullyInitialized()?Vh(s,Ih(r)):(l=r.serverCache.getNode(),f(l instanceof Su,"serverChildren would be complete if leaf node"),Bh(s,l)),e=e,t=n.filter.updateFullNode(u,e,a)}else{var l=ql(i);let e=Wh(s,l,r.serverCache);null==e&&r.serverCache.isCompleteForChild(l)&&(e=u.getImmediateChild(l)),t=null!=e?n.filter.updateChild(u,l,e,Bl(i),c,a):r.eventCache.getNode().hasChild(l)?n.filter.updateChild(u,l,Su.EMPTY_NODE,Bl(i),c,a):u,t.isEmpty()&&r.serverCache.isFullyInitialized()&&(o=Vh(s,Ih(r)),o.isLeafNode()&&(t=n.filter.updateFullNode(t,o,a)))}return o=r.serverCache.isFullyInitialized()||null!=Kh(s,Ul()),_h(r,t,o,n.filter.filtersNodes())}}}(e,t,l.path,r,i,s):function(e,t,i,n,s,a,o){if(null!=Kh(s,i))return t;const c=t.serverCache.isFiltered(),l=t.serverCache;{if(null!=n.value){if(zl(i)&&l.isFullyInitialized()||l.isCompleteForPath(i))return Zh(e,t,i,l.getNode().getChild(i),s,a,c,o);if(zl(i)){let n=new Eh(null);return l.getNode().forEachChild(au,(e,t)=>{n=n.set(new Fl(e),t)}),rd(e,t,i,n,s,a,c,o)}return t}{let r=new Eh(null);return n.foreach((e,t)=>{var n=Wl(i,e);l.isCompleteForPath(n)&&(r=r.set(e,l.getNode().getChild(n)))}),rd(e,t,i,r,s,a,c,o)}}}(e,t,l.path,l.affectedTree,r,i,s)}else{if(n.type!==Pc.LISTEN_COMPLETE)throw u("Unknown operation type: "+n.type);a=function(e,t,n,r,i){const s=t.serverCache,a=wh(t,s.getNode(),s.isFullyInitialized()||zl(n),s.isFiltered());return Xh(e,a,n,r,Qh,i)}(e,t,n.path,r,s)}l=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty();const s=bh(e);(0<n.length||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(Bu(bh(t)))}}(t,a,l),{viewCache:a,changes:l}}function Xh(r,i,s,a,o,c){const l=i.eventCache;if(null!=Kh(a,s))return i;{let t,n;if(zl(s)){var e;f(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t=i.serverCache.isFiltered()?(e=Bh(a,(e=Ih(i))instanceof Su?e:Su.EMPTY_NODE),r.filter.updateFullNode(i.eventCache.getNode(),e,c)):(u=Vh(a,Ih(i)),r.filter.updateFullNode(i.eventCache.getNode(),u,c))}else{var u=ql(s);if(".priority"===u){f(1===Vl(s),"Can't have a priority with additional path components");var h=l.getNode();n=i.serverCache.getNode();var d=jh(a,s,h,n);t=null!=d?r.filter.updatePriority(h,d):l.getNode()}else{h=Bl(s);let e;e=l.isCompleteForChild(u)?(n=i.serverCache.getNode(),null!=(d=jh(a,s,l.getNode(),n))?l.getNode().getImmediateChild(u).updateChild(h,d):l.getNode().getImmediateChild(u)):Wh(a,u,i.serverCache),t=null!=e?r.filter.updateChild(l.getNode(),u,e,h,o,c):l.getNode()}}return _h(i,t,l.isFullyInitialized()||zl(s),r.filter.filtersNodes())}}function Zh(e,t,n,r,i,s,a,o){const c=t.serverCache;let l;const u=a?e.filter:e.filter.getIndexedFilter();if(zl(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),h,null)}else{var d=ql(n);if(!c.isCompleteForPath(n)&&1<Vl(n))return t;var p=Bl(n);const f=c.getNode().getImmediateChild(d);h=f.updateChild(p,r);l=".priority"===d?u.updatePriority(c.getNode(),h):u.updateChild(c.getNode(),d,h,p,Qh,null)}p=wh(t,l,c.isFullyInitialized()||zl(n),u.filtersNodes());return Xh(e,p,n,i,new Yh(i,p,s),o)}function ed(t,n,r,i,e,s,a){const o=n.eventCache;let c,l;const u=new Yh(e,n,s);if(zl(r))l=t.filter.updateFullNode(n.eventCache.getNode(),i,a),c=_h(n,l,!0,t.filter.filtersNodes());else{var h=ql(r);if(".priority"===h)l=t.filter.updatePriority(n.eventCache.getNode(),i),c=_h(n,l,o.isFullyInitialized(),o.isFiltered());else{var d=Bl(r);const p=o.getNode().getImmediateChild(h);let e;if(zl(d))e=i;else{const f=u.getCompleteChild(h);e=null!=f?".priority"===jl(d)&&f.getChild($l(d)).isEmpty()?f:f.updateChild(d,i):Su.EMPTY_NODE}c=p.equals(e)?n:_h(n,t.filter.updateChild(o.getNode(),h,e,d,u,a),o.isFullyInitialized(),t.filter.filtersNodes())}}return c}function td(e,t){return e.eventCache.isCompleteForChild(t)}function nd(e,n,t){return t.foreach((e,t)=>{n=n.updateChild(e,t)}),n}function rd(r,i,e,t,s,a,o,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let l=i,n;n=zl(e)?t:new Eh(null).setTree(e,t);const u=i.serverCache.getNode();return n.children.inorderTraversal((e,t)=>{var n;u.hasChild(e)&&(n=nd(0,i.serverCache.getNode().getImmediateChild(e),t),l=Zh(r,l,new Fl(e),n,s,a,o,c))}),n.children.inorderTraversal((e,t)=>{var n=!i.serverCache.isCompleteForChild(e)&&null===t.value;u.hasChild(e)||n||(n=nd(0,i.serverCache.getNode().getImmediateChild(e),t),l=Zh(r,l,new Fl(e),n,s,a,o,c))}),l}class id{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new Wu(n.getIndex()),i=(e=n).loadsAllData()?new Wu(e.getIndex()):new(e.hasLimit()?Gu:zu)(e);this.processor_={filter:i};const s=t.serverCache,a=t.eventCache;var o=r.updateFullNode(Su.EMPTY_NODE,s.getNode(),null),c=i.updateFullNode(Su.EMPTY_NODE,a.getNode(),null),o=new fh(o,s.isFullyInitialized(),r.filtersNodes()),c=new fh(c,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=yh(c,o),this.eventGenerator_=new gh(this.query_)}get query(){return this.query_}}function sd(e){return 0===e.eventRegistrations_.length}function ad(n,r,i){const s=[];if(i){f(null==r,"A cancel should cancel all event registrations.");const a=n.query._path;n.eventRegistrations_.forEach(e=>{var t=e.createCancelEvent(i,a);t&&s.push(t)})}if(r){let e=[];for(let t=0;t<n.eventRegistrations_.length;++t){const o=n.eventRegistrations_[t];if(o.matches(r)){if(r.hasAnyCallback()){e=e.concat(n.eventRegistrations_.slice(t+1));break}}else e.push(o)}n.eventRegistrations_=e}else n.eventRegistrations_=[];return s}function od(e,t,n,r){t.type===Pc.MERGE&&null!==t.source.queryId&&(f(Ih(e.viewCache_),"We should always have a full cache before handling merges"),f(bh(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=Jh(e.processor_,i,t,n,r);return n=e.processor_,r=s.viewCache,f(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),f(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,cd(e,s.changes,s.viewCache.eventCache.getNode(),null)}function cd(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return mh(e.eventGenerator_,t,n,i)}let ld;class ud{constructor(){this.views=new Map}}function hd(t,n,r,i){var e=n.source.queryId;if(null!==e){e=t.views.get(e);return f(null!=e,"SyncTree gave us an op for an invalid query."),od(e,n,r,i)}{let e=[];for(const s of t.views.values())e=e.concat(od(s,n,r,i));return e}}function dd(e,n,r,i,s){var a=n._queryIdentifier,a=e.views.get(a);if(a)return a;{let e=Vh(r,s?i:null),t=!1;t=!!e||(e=i instanceof Su?Bh(r,i):Su.EMPTY_NODE,!1);a=yh(new fh(e,t,!1),new fh(i,s,!1));return new id(n,a)}}function pd(e,t,n,r,i,s){var a=dd(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,a),a.eventRegistrations_.push(n),function(e,t){const n=e.viewCache_.eventCache,r=[];if(!n.getNode().isLeafNode()){const i=n.getNode();i.forEachChild(_u,(e,t)=>{r.push(ju(e,t))})}return n.isFullyInitialized()&&r.push(Bu(n.getNode())),cd(e,r,n.getNode(),t)}(a,n)}function fd(e,t,n,r){var i=t._queryIdentifier;const s=[];let a=[];var o=_d(e);if("default"===i)for(var[c,l]of e.views.entries())a=a.concat(ad(l,n,r)),sd(l)&&(e.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{const u=e.views.get(i);u&&(a=a.concat(ad(u,n,r)),sd(u)&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return o&&!_d(e)&&s.push((f(ld,"Reference.ts has not been loaded"),new ld(t._repo,t._path))),{removed:s,events:a}}function gd(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function md(e,t){let n=null;for(const r of e.views.values())n=n||function(e,t){const n=Ih(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!zl(t)&&!n.getImmediateChild(ql(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function vd(e,t){const n=t._queryParams;if(n.loadsAllData())return wd(e);var r=t._queryIdentifier;return e.views.get(r)}function yd(e,t){return null!=vd(e,t)}function _d(e){return null!=wd(e)}function wd(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let bd;let Id=1;class Td{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Eh(null),this.pendingWriteTree_={visibleWrites:kh.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Ed(e,t,n,r,i){var s,a,o,c;return s=e.pendingWriteTree_,a=t,o=n,c=r,r=i,f(c>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:a,snap:o,writeId:c,visible:r=void 0===r?!0:r}),r&&(s.visibleWrites=Ch(s.visibleWrites,a,o)),s.lastWriteId=c,i?Pd(e,new dh(oh(),t,n)):[]}function kd(e,t,n,r){var i,s,a;i=e.pendingWriteTree_,s=t,a=n,r=r,f(r>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:s,children:a,writeId:r,visible:!0}),i.visibleWrites=Sh(i.visibleWrites,s,a),i.lastWriteId=r;var o=Eh.fromObject(n);return Pd(e,new ph(oh(),t,o))}function Cd(e,t,n=!1){var r=function(e,t){for(let r=0;r<e.allWrites.length;r++){var n=e.allWrites[r];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(Lh(e.pendingWriteTree_,t)){let t=new Eh(null);return null!=r.snap?t=t.set(Ul(),!0):ol(r.children,e=>{t=t.set(new Fl(e),!0)}),Pd(e,new uh(r.path,t,n))}return[]}function Sd(e,t,n){return Pd(e,new dh(ch(),t,n))}function Ad(n,e,t,r,i=!1){var s=e._path,a=n.syncPointTree_.get(s);let o=[];if(a&&("default"===e._queryIdentifier||yd(a,e))){var c=fd(a,e,t,r);0===a.views.size&&(n.syncPointTree_=n.syncPointTree_.remove(s));const d=c.removed;if(o=c.events,!i){a=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),c=n.syncPointTree_.findOnPath(s,(e,t)=>_d(t));if(a&&!c){const p=n.syncPointTree_.subtree(s);if(!p.isEmpty()){var l=p.fold((e,t,r)=>{if(t&&_d(t))return[wd(t)];{let n=[];return t&&(n=gd(t)),ol(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<l.length;++e){var u=l[e],h=u.query,u=Md(n,u);n.listenProvider_.startListening(Bd(h),Ld(n,h),u.hashFn,u.onComplete)}}}!c&&0<d.length&&!r&&(a?n.listenProvider_.stopListening(Bd(e),null):d.forEach(e=>{var t=n.queryToTagMap.get(Fd(e));n.listenProvider_.stopListening(Bd(e),t)}))}!function(e,t){for(let i=0;i<t.length;++i){const s=t[i];var n,r;s._queryParams.loadsAllData()||(n=Fd(s),r=e.queryToTagMap.get(n),e.queryToTagMap.delete(n),e.tagToQueryMap.delete(r))}}(n,d)}return o}function Nd(e,t,n,r){var i=Ud(e,r);if(null==i)return[];var s=qd(i),a=s.path,i=s.queryId,s=Gl(a,t);return Vd(e,a,new dh(lh(i),s,n))}function Rd(e,t,n,r=!1){const i=t._path;let s=null,a=!1;e.syncPointTree_.foreachOnPath(i,(e,t)=>{var n=Gl(e,i);s=s||md(t,n),a=a||_d(t)});let o=e.syncPointTree_.get(i);o?(a=a||_d(o),s=s||md(o,Ul())):(o=new ud,e.syncPointTree_=e.syncPointTree_.set(i,o));let c;if(null!=s)c=!0;else{c=!1,s=Su.EMPTY_NODE;const p=e.syncPointTree_.subtree(i);p.foreachChild((e,t)=>{var n=md(t,Ul());n&&(s=s.updateImmediateChild(e,n))})}var l,u=yd(o,t);u||t._queryParams.loadsAllData()||(h=Fd(t),f(!e.queryToTagMap.has(h),"View does not exist, but we have a tag"),l=Id++,e.queryToTagMap.set(h,l),e.tagToQueryMap.set(l,h));var h=Mh(e.pendingWriteTree_,i);let d=pd(o,t,n,h,s,c);return u||a||r||(u=vd(o,t),d=d.concat(function(t,e,n){const r=e._path,i=Ld(t,e),s=Md(t,n),a=t.listenProvider_.startListening(Bd(e),i,s.hashFn,s.onComplete),o=t.syncPointTree_.subtree(r);if(i)f(!_d(o.value),"If we're adding a query, it shouldn't be shadowed");else{var c=o.fold((e,t,r)=>{if(!zl(e)&&t&&_d(t))return[wd(t).query];{let n=[];return t&&(n=n.concat(gd(t).map(e=>e.query))),ol(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<c.length;++e){var l=c[e];t.listenProvider_.stopListening(Bd(l),Ld(t,l))}}return a}(e,t,u))),d}function xd(e,r,t){var n=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(r,(e,t)=>{var n=md(t,Gl(e,r));if(n)return n});return qh(n,r,i,t,!0)}function Dd(e,t){const r=t._path;let i=null;e.syncPointTree_.foreachOnPath(r,(e,t)=>{var n=Gl(e,r);i=i||md(t,n)});let n=e.syncPointTree_.get(r);n?i=i||md(n,Ul()):(n=new ud,e.syncPointTree_=e.syncPointTree_.set(r,n));var s=null!=i;const a=s?new fh(i,!0,!1):null;var o=Mh(e.pendingWriteTree_,t._path);return bh(dd(n,t,o,s?a.getNode():Su.EMPTY_NODE,s).viewCache_)}function Pd(e,t){return function t(n,r,i,s){{if(zl(n.path))return Od(n,r,i,s);{const a=r.get(Ul());null==i&&null!=a&&(i=md(a,Ul()));let e=[];const o=ql(n.path),c=n.operationForChild(o),l=r.children.get(o);if(l&&c){const u=i?i.getImmediateChild(o):null,h=zh(s,o);e=e.concat(t(c,l,u,h))}return a&&(e=e.concat(hd(a,n,s,i))),e}}}(t,e.syncPointTree_,null,Mh(e.pendingWriteTree_,Ul()))}function Od(s,e,a,o){var t=e.get(Ul());null==a&&null!=t&&(a=md(t,Ul()));let c=[];return e.children.inorderTraversal((e,t)=>{var n=a?a.getImmediateChild(e):null,r=zh(o,e),i=s.operationForChild(e);i&&(c=c.concat(Od(i,t,n,r)))}),t&&(c=c.concat(hd(t,s,o,a))),c}function Md(i,t){const s=t.query,a=Ld(i,s);return{hashFn:()=>{const e=t.viewCache_.serverCache.getNode()||Su.EMPTY_NODE;return e.hash()},onComplete:e=>{if("ok"===e)return a?function(e,t,n){if(s=Ud(e,n)){var r=qd(s),i=r.path,s=r.queryId,r=Gl(i,t);return Vd(e,i,new hh(lh(s),r))}return[]}(i,s._path,a):(t=i,n=s._path,Pd(t,new hh(ch(),n)));var t,n,r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,s);return Ad(i,s,null,r)}}}function Ld(e,t){var n=Fd(t);return e.queryToTagMap.get(n)}function Fd(e){return e._path.toString()+"$"+e._queryIdentifier}function Ud(e,t){return e.tagToQueryMap.get(t)}function qd(e){var t=e.indexOf("$");return f(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Fl(e.substr(0,t))}}function Vd(e,t,n){var r=e.syncPointTree_.get(t);return f(r,"Missing sync point for query tag that we're tracking"),hd(r,n,Mh(e.pendingWriteTree_,t),null)}function Bd(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(f(bd,"Reference.ts has not been loaded"),new bd(e._repo,e._path)):e}class jd{constructor(e){this.node_=e}getImmediateChild(e){var t=this.node_.getImmediateChild(e);return new jd(t)}node(){return this.node_}}class Kd{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){var t=Wl(this.path_,e);return new Kd(this.syncTree_,t)}node(){return xd(this.syncTree_,this.path_)}}function $d(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}function Wd(e,t,n){return e&&"object"==typeof e?(f(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?zd(e[".sv"],t,n):"object"==typeof e[".sv"]?Gd(e[".sv"],t):void f(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e}const zd=function(e,t,n){if("timestamp"===e)return n.timestamp;f(!1,"Unexpected server value: "+e)},Gd=function(e,t,n){e.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&f(!1,"Unexpected increment value: "+r);const i=t.node();if(f(null!==i&&void 0!==i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i;var a=s.getValue();return"number"!=typeof a?r:a+r},Hd=function(e,t,n,r){return Yd(t,new Kd(n,e),r)},Qd=function(e,t,n){return Yd(e,new jd(t),n)};function Yd(e,r,i){var t=e.getPriority().val(),n=Wd(t,r.getImmediateChild(".priority"),i);let s;if(e.isLeafNode()){const a=e;t=Wd(a.getValue(),r,i);return t!==a.getValue()||n!==a.getPriority().val()?new mu(t,xu(n)):e}{const o=e;return s=o,n!==o.getPriority().val()&&(s=s.updatePriority(new mu(n))),o.forEachChild(_u,(e,t)=>{var n=Yd(t,r.getImmediateChild(e),i);n!==t&&(s=s.updateImmediateChild(e,n))}),s}}class Jd{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Xd(e,t){let n=t instanceof Fl?t:new Fl(t),r=e,i=ql(n);for(;null!==i;){var s=N(r.node.children,i)||{children:{},childCount:0};r=new Jd(i,r,s),n=Bl(n),i=ql(n)}return r}function Zd(e){return e.node.value}function ep(e,t){e.node.value=t,ip(e)}function tp(e){return 0<e.node.childCount}function np(n,r){ol(n.node.children,(e,t)=>{r(new Jd(e,n,t))})}function rp(e){return new Fl(null===e.parent?e.name:rp(e.parent)+"/"+e.name)}function ip(e){var t,n,r,i;null!==e.parent&&(t=e.parent,n=e.name,r=function(e){return void 0===Zd(e)&&!tp(e)}(e=e),i=A(t.node.children,n),r&&i?(delete t.node.children[n],t.node.childCount--,ip(t)):r||i||(t.node.children[n]=e.node,t.node.childCount++,ip(t)))}function sp(e,t,n,r){r&&void 0===t||yp(j(e,"value"),t,n)}function ap(e,t,r,n){if(!n||void 0!==t){const i=j(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];ol(t,(e,t)=>{const n=new Fl(e);if(yp(i,t,Wl(r,n)),".priority"===jl(n)&&!vp(t))throw new Error(i+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,n){let r,i;for(r=0;r<n.length;r++){i=n[r];var s=Kl(i);for(let e=0;e<s.length;e++)if((".priority"!==s[e]||e!==s.length-1)&&!fp(s[e]))throw new Error(t+"contains an invalid key ("+s[e]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}n.sort(Hl);let e=null;for(r=0;r<n.length;r++){if(i=n[r],null!==e&&Yl(e,i))throw new Error(t+"contains a path "+e.toString()+" that is ancestor of another path "+i.toString());e=i}}(i,s)}}function op(e,t,n){if(!n||void 0!==t){if(rl(t))throw new Error(j(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!vp(t))throw new Error(j(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function cp(e,t,n,r){if(!(r&&void 0===n||fp(n)))throw new Error(j(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function lp(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),_p(e,t,n,r)}function up(e,t){if(".info"===ql(t))throw new Error(e+" failed = Can't modify data under /.info/")}const hp=/[\[\].#$\/\u0000-\u001F\u007F]/,dp=/[\[\].#$\u0000-\u001F\u007F]/,pp=10485760,fp=function(e){return"string"==typeof e&&0!==e.length&&!hp.test(e)},gp=function(e){return"string"==typeof e&&0!==e.length&&!dp.test(e)},mp=function(e){return e=e&&e.replace(/^\/*\.info(\/|$)/,"/"),gp(e)},vp=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!rl(e)||e&&"object"==typeof e&&A(e,".sv")},yp=function(a,e,t){const o=t instanceof Fl?new Jl(t,a):t;if(void 0===e)throw new Error(a+"contains undefined "+Zl(o));if("function"==typeof e)throw new Error(a+"contains a function "+Zl(o)+" with contents = "+e.toString());if(rl(e))throw new Error(a+"contains "+e.toString()+" "+Zl(o));if("string"==typeof e&&e.length>pp/3&&z(e)>pp)throw new Error(a+"contains a string greater than "+pp+" utf8 bytes "+Zl(o)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let i=!1,s=!1;if(ol(e,(e,t)=>{if(".value"===e)i=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!fp(e)))throw new Error(a+" contains an invalid key ("+e+") "+Zl(o)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var n,r;n=o,e=e,0<n.parts_.length&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=z(e),Xl(n),yp(a,t,o),t=o,r=t.parts_.pop(),t.byteLength_-=z(r),0<t.parts_.length&&--t.byteLength_}),i&&s)throw new Error(a+' contains ".value" child '+Zl(o)+" in addition to actual children.")}},_p=function(e,t,n,r){if(!(r&&void 0===n||gp(n)))throw new Error(j(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},wp=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!fp(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!mp(n))throw new Error(j(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class bp{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ip(e,t){let n=null;for(let i=0;i<t.length;i++){const s=t[i];var r=s.getPath();null===n||Ql(r,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&e.eventLists_.push(n)}function Tp(e,t,n){Ip(e,n),kp(e,e=>Ql(e,t))}function Ep(e,t,n){Ip(e,n),kp(e,e=>Yl(e,t)||Yl(t,e))}function kp(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){var r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let n=0;n<e.events.length;n++){const r=e.events[n];var t;null!==r&&(e.events[n]=null,t=r.getEventRunner(),$c&&Zc("event: "+r.toString()),fl(t))}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}const Cp="repo_interrupt",Sp=25;class Ap{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new bp,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=nh(),this.transactionQueueTree_=new Jd,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Np(a,e,t){if(a.stats_=Cl(a.repoInfo_),a.forceRestClient_||function(){const e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return 0<=e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)}())a.server_=new eh(a.repoInfo_,(e,t,n,r)=>{Dp(a,e,t,n,r)},a.authTokenProvider_,a.appCheckProvider_),setTimeout(()=>Pp(a,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{C(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}a.persistentConnection_=new tu(a.repoInfo_,e,(e,t,n,r)=>{Dp(a,e,t,n,r)},e=>{Pp(a,e)},e=>{var n;n=a,ol(e,(e,t)=>{Op(n,e,t)})},a.authTokenProvider_,a.appCheckProvider_,t),a.server_=a.persistentConnection_}var n;a.authTokenProvider_.addTokenChangeListener(e=>{a.server_.refreshAuthToken(e)}),a.appCheckProvider_.addTokenChangeListener(e=>{a.server_.refreshAppCheckToken(e.token)}),a.statsReporter_=(e=a.repoInfo_,t=()=>new ah(a.stats_,a.server_),n=e.toString(),kl[n]||(kl[n]=t()),kl[n]),a.infoData_=new th,a.infoSyncTree_=new Td({startListening:(e,t,n,r)=>{let i=[];const s=a.infoData_.getNode(e._path);return s.isEmpty()||(i=Sd(a.infoSyncTree_,e._path,s),setTimeout(()=>{r("ok")},0)),i},stopListening:()=>{}}),Op(a,"connected",!1),a.serverSyncTree_=new Td({startListening:(r,e,t,i)=>(a.server_.listen(r,t,e,(e,t)=>{var n=i(e,t);Ep(a.eventQueue_,r._path,n)}),[]),stopListening:(e,t)=>{a.server_.unlisten(e,t)}})}function Rp(e){const t=e.infoData_.getNode(new Fl(".info/serverTimeOffset"));var n=t.val()||0;return(new Date).getTime()+n}function xp(e){return $d({timestamp:Rp(e)})}function Dp(e,t,n,r,i){e.dataUpdateCount++;var s,a,o=new Fl(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let c=[];c=i?r?(s=x(n,e=>xu(e)),function(e,t,n,r){if(o=Ud(e,r)){var i=qd(o),s=i.path,a=i.queryId,o=Gl(s,t),i=Eh.fromObject(n);return Vd(e,s,new ph(lh(a),o,i))}return[]}(e.serverSyncTree_,o,s,i)):(s=xu(n),Nd(e.serverSyncTree_,o,s,i)):r?(a=x(n,e=>xu(e)),t=e.serverSyncTree_,i=o,r=a,a=Eh.fromObject(r),Pd(t,new ph(ch(),i,a))):(a=xu(n),Sd(e.serverSyncTree_,o,a));let l=o;0<c.length&&(l=Wp(e,o)),Ep(e.eventQueue_,l,c)}function Pp(e,t){Op(e,"connected",t),!1===t&&function(r){Bp(r,"onDisconnectEvents");const i=xp(r),s=nh();ih(r.onDisconnect_,Ul(),(e,t)=>{var n=Hd(e,t,r.serverSyncTree_,i);rh(s,e,n)});let a=[];ih(s,Ul(),(e,t)=>{a=a.concat(Sd(r.serverSyncTree_,e,t));var n=Qp(r,e);Wp(r,n)}),r.onDisconnect_=nh(),Ep(r.eventQueue_,Ul(),a)}(e)}function Op(e,t,n){var r=new Fl("/.info/"+t),i=xu(n);e.infoData_.updateSnapshot(r,i);i=Sd(e.infoSyncTree_,r,i);Ep(e.eventQueue_,r,i)}function Mp(e){return e.nextWriteId_++}function Lp(r,i,e,t,s){Bp(r,"set",{path:i.toString(),value:e,priority:t});var n=xp(r);const a=xu(e,t);var o=xd(r.serverSyncTree_,i),n=Qd(a,o,n);const c=Mp(r);n=Ed(r.serverSyncTree_,i,n,c,!0);Ip(r.eventQueue_,n),r.server_.put(i.toString(),a.val(!0),(e,t)=>{var n="ok"===e;n||tl("set at "+i+" failed: "+e);n=Cd(r.serverSyncTree_,c,!n);Ep(r.eventQueue_,i,n),jp(0,s,e,t)});n=Qp(r,i);Wp(r,n),Ep(r.eventQueue_,n,[])}function Fp(n,r,i){n.server_.onDisconnectCancel(r.toString(),(e,t)=>{"ok"===e&&!function e(n,t){if(zl(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const i=n.value;return n.value=null,i.forEachChild(_u,(e,t)=>{rh(n,new Fl(e),t)}),e(n,t)}}if(0<n.children.size){var r=ql(t);return t=Bl(t),n.children.has(r)&&e(n.children.get(r),t)&&n.children.delete(r),0===n.children.size}return!0}(n.onDisconnect_,r),jp(0,i,e,t)})}function Up(n,r,e,i){const s=xu(e);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&rh(n.onDisconnect_,r,s),jp(0,i,e,t)})}function qp(e,t,n){let r;r=".info"===ql(t._path)?Ad(e.infoSyncTree_,t,n):Ad(e.serverSyncTree_,t,n),Tp(e.eventQueue_,t._path,r)}function Vp(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Cp)}function Bp(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),Zc(n,...t)}function jp(e,r,i,s){r&&fl(()=>{if("ok"===i)r(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);const n=new Error(e);n.code=t,r(n)}})}function Kp(e,t,n){return xd(e.serverSyncTree_,t,n)||Su.EMPTY_NODE}function $p(t,e=t.transactionQueueTree_){if(e||Hp(t,e),Zd(e)){const n=Gp(t,e);f(0<n.length,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(i,s,a){const e=a.map(e=>e.currentWriteId),t=Kp(i,s,e);let n=t;var r=t.hash();for(let u=0;u<a.length;u++){const h=a[u];f(0===h.status,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;var o=Gl(s,h.path);n=n.updateChild(o,h.currentOutputSnapshotRaw)}const c=n.val(!0),l=s;i.server_.put(l.toString(),c,t=>{Bp(i,"transaction put response",{path:l.toString(),status:t});let n=[];if("ok"===t){const r=[];for(let e=0;e<a.length;e++)a[e].status=2,n=n.concat(Cd(i.serverSyncTree_,a[e].currentWriteId)),a[e].onComplete&&r.push(()=>a[e].onComplete(null,!0,a[e].currentOutputSnapshotResolved)),a[e].unwatcher();Hp(i,Xd(i.transactionQueueTree_,s)),$p(i,i.transactionQueueTree_),Ep(i.eventQueue_,s,n);for(let t=0;t<r.length;t++)fl(r[t])}else{if("datastale"===t)for(let e=0;e<a.length;e++)3===a[e].status?a[e].status=4:a[e].status=0;else{tl("transaction at "+l.toString()+" failed: "+t);for(let e=0;e<a.length;e++)a[e].status=4,a[e].abortReason=t}Wp(i,s)}},r)}(t,rp(e),n)}else tp(e)&&np(e,e=>{$p(t,e)})}function Wp(e,t){var n=zp(e,t),r=rp(n);return function(i,s,a){if(0!==s.length){const l=[];let n=[];const t=s.filter(e=>0===e.status),u=t.map(e=>e.currentWriteId);for(let r=0;r<s.length;r++){const h=s[r];var o=Gl(a,h.path);let e=!1,t;if(f(null!==o,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)e=!0,t=h.abortReason,n=n.concat(Cd(i.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=Sp)e=!0,t="maxretry",n=n.concat(Cd(i.serverSyncTree_,h.currentWriteId,!0));else{const d=Kp(i,h.path,u);h.currentInputSnapshot=d;var c=s[r].update(d.val());if(void 0!==c){yp("transaction failed: Data returned ",c,h.path);let e=xu(c);"object"==typeof c&&null!=c&&A(c,".priority")||(e=e.updatePriority(d.getPriority()));o=h.currentWriteId,c=xp(i),c=Qd(e,d,c);h.currentOutputSnapshotRaw=e,h.currentOutputSnapshotResolved=c,h.currentWriteId=Mp(i),u.splice(u.indexOf(o),1),n=n.concat(Ed(i.serverSyncTree_,h.path,c,h.currentWriteId,h.applyLocally)),n=n.concat(Cd(i.serverSyncTree_,o,!0))}else e=!0,t="nodata",n=n.concat(Cd(i.serverSyncTree_,h.currentWriteId,!0))}Ep(i.eventQueue_,a,n),n=[],e&&(s[r].status=2,function(e){setTimeout(e,Math.floor(0))}(s[r].unwatcher),s[r].onComplete&&("nodata"===t?l.push(()=>s[r].onComplete(null,!1,s[r].currentInputSnapshot)):l.push(()=>s[r].onComplete(new Error(t),!1,null))))}Hp(i,i.transactionQueueTree_);for(let e=0;e<l.length;e++)fl(l[e]);$p(i,i.transactionQueueTree_)}}(e,Gp(e,n),r),r}function zp(e,t){let n,r=e.transactionQueueTree_;for(n=ql(t);null!==n&&void 0===Zd(r);)r=Xd(r,n),t=Bl(t),n=ql(t);return r}function Gp(e,t){const n=[];return function t(n,e,r){const i=Zd(e);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);np(e,e=>{t(n,e,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function Hp(t,n){const r=Zd(n);if(r){let e=0;for(let t=0;t<r.length;t++)2!==r[t].status&&(r[e]=r[t],e++);r.length=e,ep(n,0<r.length?r:void 0)}np(n,e=>{Hp(t,e)})}function Qp(t,e){var n=rp(zp(t,e)),r=Xd(t.transactionQueueTree_,e);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return;r=r.parent}}(r,e=>{Yp(t,e)}),Yp(t,r),function t(e,n,r,i){r&&!i&&n(e),np(e,e=>{t(e,n,!0,i)}),r&&i&&n(e)}(r,e=>{Yp(t,e)}),n}function Yp(i,s){const a=Zd(s);if(a){const o=[];let e=[],t=-1;for(let n=0;n<a.length;n++)3===a[n].status||(1===a[n].status?(f(t===n-1,"All SENT items should be at beginning of queue."),t=n,a[n].status=3,a[n].abortReason="set"):(f(0===a[n].status,"Unexpected transaction status in abort"),a[n].unwatcher(),e=e.concat(Cd(i.serverSyncTree_,a[n].currentWriteId,!0)),a[n].onComplete&&o.push(a[n].onComplete.bind(null,new Error("set"),!1,null))));-1===t?ep(s,void 0):a.length=t+1,Ep(i.eventQueue_,rp(s),e);for(let r=0;r<o.length;r++)fl(o[r])}}const Jp=function(e,t){var n=Xp(e),r=n.namespace;"firebase.com"===n.domain&&el(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||el("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||nl();var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new bl(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new Fl(n.pathString)}},Xp=function(r){let i="",s="",a="",o="",c="",l=!0,u="https",h=443;if("string"==typeof r){let e=r.indexOf("//");0<=e&&(u=r.substring(0,e-1),r=r.substring(e+2));let t=r.indexOf("/");-1===t&&(t=r.length);let n=r.indexOf("?");-1===n&&(n=r.length),i=r.substring(0,Math.min(t,n)),t<n&&(o=function(e){let t="";var n=e.split("/");for(let r=0;r<n.length;r++)if(0<n[r].length){let e=n[r];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}t+="/"+e}return t}(r.substring(t,n)));var d,p=function(e){const t={};for(const r of(e="?"===e.charAt(0)?e.substring(1):e).split("&")){var n;0!==r.length&&(2===(n=r.split("=")).length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):tl(`Invalid query segment '${r}' in query '${e}'`))}return t}(r.substring(Math.min(r.length,n)));e=i.indexOf(":"),0<=e?(l="https"===u||"wss"===u,h=parseInt(i.substring(e+1),10)):e=i.length;const f=i.slice(0,e);"localhost"===f.toLowerCase()?s="localhost":f.split(".").length<=2?s=f:(d=i.indexOf("."),a=i.substring(0,d).toLowerCase(),s=i.substring(d+1),c=a),"ns"in p&&(c=p.ns)}return{host:i,port:h,domain:s,subdomain:a,secure:l,scheme:u,pathString:o,namespace:c}};class Zp{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+C(this.snapshot.exportVal())}}class ef{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class tf{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class nf{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new h;return Fp(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){up("OnDisconnect.remove",this._path);const e=new h;return Up(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){up("OnDisconnect.set",this._path),sp("OnDisconnect.set",e,this._path,!1);const t=new h;return Up(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){up("OnDisconnect.setWithPriority",this._path),sp("OnDisconnect.setWithPriority",e,this._path,!1),op("OnDisconnect.setWithPriority",t,!1);const n=new h;return function(n,r,e,t,i){const s=xu(e,t);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&rh(n.onDisconnect_,r,s),jp(0,i,e,t)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){up("OnDisconnect.update",this._path),ap("OnDisconnect.update",e,this._path,!1);const t=new h;return function(r,i,n,s){if(R(n))return Zc("onDisconnect().update() called with empty data.  Don't do anything."),jp(0,s,"ok",void 0);r.server_.onDisconnectMerge(i.toString(),n,(e,t)=>{"ok"===e&&ol(n,(e,t)=>{var n=xu(t);rh(r.onDisconnect_,Wl(i,e),n)}),jp(0,s,e,t)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class rf{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return zl(this._path)?null:jl(this._path)}get ref(){return new cf(this._repo,this._path)}get _queryIdentifier(){var e=Zu(this._queryParams),e=Yc(e);return"{}"===e?"default":e}get _queryObject(){return Zu(this._queryParams)}isEqual(e){if(!((e=X(e))instanceof rf))return!1;var t=this._repo===e._repo,n=Ql(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}function sf(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function af(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===au){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==il)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==sl)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===_u){if(null!=t&&!vp(t)||null!=n&&!vp(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(f(e.getIndex()instanceof Du||e.getIndex()===Mu,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function of(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class cf extends rf{constructor(e,t){super(e,t,new Hu,!1)}get parent(){var e=$l(this._path);return null===e?null:new cf(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class lf{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new Fl(e),n=df(this.ref,e);return new lf(this._node.getChild(t),n,_u)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,(e,t)=>n(new lf(t,df(this.ref,e),_u)))}hasChild(e){var t=new Fl(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function uf(e,t){return(e=X(e))._checkNotDeleted("ref"),void 0!==t?df(e._root,t):e._root}function hf(e,t){(e=X(e))._checkNotDeleted("refFromURL");const n=Jp(t,e._repo.repoInfo_.nodeAdmin);wp("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||el("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),uf(e,n.path.toString())}function df(e,t){return(null===ql((e=X(e))._path)?lp:_p)("child","path",t,!1),new cf(e._repo,Wl(e._path,t))}function pf(e,t){e=X(e),up("set",e._path),sp("set",t,e._path,!1);const n=new h;return Lp(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function ff(e,t){ap("update",t,e._path,!1);const n=new h;return function(i,s,e,a){Bp(i,"update",{path:s.toString(),value:e});let n=!0;const r=xp(i),o={};if(ol(e,(e,t)=>{n=!1,o[e]=Hd(Wl(s,e),xu(t),i.serverSyncTree_,r)}),n)Zc("update() called with empty data.  Don't do anything."),jp(0,a,"ok",void 0);else{const c=Mp(i);var t=kd(i.serverSyncTree_,s,o,c);Ip(i.eventQueue_,t),i.server_.merge(s.toString(),e,(e,t)=>{var n="ok"===e;n||tl("update at "+s+" failed: "+e);var r=Cd(i.serverSyncTree_,c,!n),n=0<r.length?Wp(i,s):s;Ep(i.eventQueue_,n,r),jp(0,a,e,t)}),ol(e,e=>{var t=Qp(i,Wl(s,e));Wp(i,t)}),Ep(i.eventQueue_,s,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}function gf(t){t=X(t);var i,s,a,e=new tf(()=>{}),e=new mf(e);return i=t._repo,s=t,a=e,(null!=(e=Dd(i.serverSyncTree_,s))?Promise.resolve(e):i.server_.get(s).then(e=>{var t,n=xu(e).withIndex(s._queryParams.getIndex());Rd(i.serverSyncTree_,s,a,!0);let r;return r=s._queryParams.loadsAllData()?Sd(i.serverSyncTree_,s._path,n):(t=Ld(i.serverSyncTree_,s),Nd(i.serverSyncTree_,s._path,n,t)),Ep(i.eventQueue_,s._path,r),Ad(i.serverSyncTree_,s,a,null,!0),n},e=>(Bp(i,"get for query "+C(s)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new lf(e,new cf(t._repo,t._path),t._queryParams.getIndex()))}class mf{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var n=t._queryParams.getIndex();return new Zp("value",this,new lf(e.snapshotNode,new cf(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ef(this,e,t):null}matches(e){return e instanceof mf&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class vf{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ef(this,e,t):null}createEvent(e,t){f(null!=e.childName,"Child events should have a childName.");var n=df(new cf(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Zp(e.type,this,new lf(e.snapshotNode,n,r),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof vf&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function yf(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const c=t;var a=(e,t)=>{qp(n._repo,n,o),c(e,t)};a.userCallback=t.userCallback,a.context=t.context,t=a}a=new tf(t,s||void 0);const o="value"===e?new mf(a):new vf(e,a);return function(e,t,n){let r;r=".info"===ql(t._path)?Rd(e.infoSyncTree_,t,n):Rd(e.serverSyncTree_,t,n),Tp(e.eventQueue_,t._path,r)}(n._repo,n,o),()=>qp(n._repo,n,o)}function _f(e,t,n,r){return yf(e,"value",t,n,r)}function wf(e,t,n,r){return yf(e,"child_added",t,n,r)}function bf(e,t,n,r){return yf(e,"child_changed",t,n,r)}function If(e,t,n,r){return yf(e,"child_moved",t,n,r)}function Tf(e,t,n,r){return yf(e,"child_removed",t,n,r)}function Ef(e,t,n){let r=null;var i=n?new tf(n):null;"value"===t?r=new mf(i):t&&(r=new vf(t,i)),qp(e._repo,e,r)}class kf{}class Cf extends kf{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){sp("endAt",this._value,e._path,!0);var t=Yu(e._queryParams,this._value,this._key);if(of(t),af(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new rf(e._repo,e._path,t,e._orderByCalled)}}class Sf extends kf{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){sp("endBefore",this._value,e._path,!1);var t=function(e,t,n){let r,i;return i=e.index_===au?Yu(e,t="string"==typeof t?Ou(t):t,n):(r=null==n?il:Ou(n),Yu(e,t,r)),i.endBeforeSet_=!0,i}(e._queryParams,this._value,this._key);if(of(t),af(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new rf(e._repo,e._path,t,e._orderByCalled)}}class Af extends kf{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){sp("startAt",this._value,e._path,!0);var t=Qu(e._queryParams,this._value,this._key);if(of(t),af(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new rf(e._repo,e._path,t,e._orderByCalled)}}class Nf extends kf{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){sp("startAfter",this._value,e._path,!1);var t=function(t,n,r){let i;if(t.index_===au)"string"==typeof n&&(n=Pu(n)),i=Qu(t,n,r);else{let e;e=null==r?sl:Pu(r),i=Qu(t,n,e)}return i.startAfterSet_=!0,i}(e._queryParams,this._value,this._key);if(of(t),af(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new rf(e._repo,e._path,t,e._orderByCalled)}}class Rf extends kf{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new rf(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class xf extends kf{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new rf(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class Df extends kf{constructor(e){super(),this._path=e}_apply(e){sf(e,"orderByChild");var t=new Fl(this._path);if(zl(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");t=new Du(t),t=Ju(e._queryParams,t);return af(t),new rf(e._repo,e._path,t,!0)}}class Pf extends kf{_apply(e){sf(e,"orderByKey");var t=Ju(e._queryParams,au);return af(t),new rf(e._repo,e._path,t,!0)}}class Of extends kf{_apply(e){sf(e,"orderByPriority");var t=Ju(e._queryParams,_u);return af(t),new rf(e._repo,e._path,t,!0)}}class Mf extends kf{_apply(e){sf(e,"orderByValue");var t=Ju(e._queryParams,Mu);return af(t),new rf(e._repo,e._path,t,!0)}}class Lf extends kf{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(sp("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Cf(this._value,this._key)._apply(new Af(this._value,this._key)._apply(e))}}function Ff(e,...t){let n=X(e);for(const r of t)n=r._apply(n);return n}Oc=cf,f(!ld,"__referenceConstructor has already been defined"),ld=Oc,Mc=cf,f(!bd,"__referenceConstructor has already been defined"),bd=Mc;const Uf="FIREBASE_DATABASE_EMULATOR_HOST",qf={};let Vf=!1;function Bf(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||el("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Zc("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let a=Jp(s,i),o=a.repoInfo,c,l=void 0;"undefined"!=typeof process&&process.env&&(l=process.env[Uf]),l?(c=!0,s=`http://${l}?ns=${o.namespace}`,a=Jp(s,i),o=a.repoInfo):c=!a.repoInfo.secure;var u=i&&c?new vl(vl.OWNER):new ml(e.name,e.options,t);wp("Invalid Firebase Database URL",a),zl(a.path)||el("Database URL must point to the root of a Firebase Database (not including a child path).");u=function(e,t,n,r){let i=qf[t.name];i||(i={},qf[t.name]=i);var s=i[e.toURLString()];s&&el("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Ap(e,Vf,n,r),i[e.toURLString()]=s}(o,e,u,new gl(e.name,n));return new jf(u,e)}class jf{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Np(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new cf(this._repo,Ul())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=qf[t];n&&n[e.key]===e||el(`Database ${t}(${e.repoInfo_}) has already been deleted.`),Vp(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&el("Cannot call "+e+" on a deleted database.")}}function Kf(){Dl.IS_TRANSPORT_INITIALIZED&&tl("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function $f(){Kf(),Al.forceDisallow()}function Wf(){Kf(),xl.forceDisallow(),Al.forceAllow()}function zf(e,t,n,r={}){(e=X(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&el("Cannot call useEmulator() after instance has already been initialized.");var i,s=e._repoInternal;let a=void 0;s.repoInfo_.nodeAdmin?(r.mockUserToken&&el('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new vl(vl.OWNER)):r.mockUserToken&&(i="string"==typeof r.mockUserToken?r.mockUserToken:o(r.mockUserToken,e.app.options.projectId),a=new vl(i)),r=s,e=t,t=n,n=a,r.repoInfo_=new bl(`${e}:${t}`,!1,r.repoInfo_.namespace,r.repoInfo_.webSocketOnly,r.repoInfo_.nodeAdmin,r.repoInfo_.persistenceKey,r.repoInfo_.includeNamespaceInQueryParams),n&&(r.authTokenProvider_=n)}function Gf(e){(e=X(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(Cp)}function Hf(e,t){Xc(e,t)}const Qf={".sv":"timestamp"};class Yf{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function Jf(i,e,t){if(i=X(i),up("Reference.transaction",i._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";var n=null===(r=null==t?void 0:t.applyLocally)||void 0===r||r;const s=new h;var r=_f(i,()=>{});return function(t,n,e,r,i,s){Bp(t,"transaction on "+n);const a={path:n,update:e,onComplete:r,status:null,order:jc(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},o=Kp(t,n,void 0);a.currentInputSnapshot=o;var c=a.update(o.val());if(void 0===c)a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete&&a.onComplete(null,!1,a.currentInputSnapshot);else{yp("transaction failed: Data returned ",c,a.path),a.status=0;var l=Xd(t.transactionQueueTree_,n);const u=Zd(l)||[];u.push(a),ep(l,u);let e;if("object"==typeof c&&null!==c&&A(c,".priority"))e=N(c,".priority"),f(vp(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const h=xd(t.serverSyncTree_,n)||Su.EMPTY_NODE;e=h.getPriority().val()}l=xp(t),c=xu(c,e),l=Qd(c,o,l);a.currentOutputSnapshotRaw=c,a.currentOutputSnapshotResolved=l,a.currentWriteId=Mp(t);l=Ed(t.serverSyncTree_,n,l,a.currentWriteId,a.applyLocally);Ep(t.eventQueue_,n,l),$p(t,t.transactionQueueTree_)}}(i._repo,i._path,e,(e,t,n)=>{var r;e?s.reject(e):(r=new lf(n,new cf(i._repo,i._path),_u),s.resolve(new Yf(t,r)))},r,n),s.promise}tu.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},tu.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},Ac($e),Ve(new Z("database",(e,{instanceIdentifier:t})=>{return Bf(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),He(Cc,"0.13.6",Lc),He(Cc,"0.13.6","esm2017");function Xf(e){var t="FIREBASE WARNING: "+e;Zf.warn(t)}const Zf=new ue("@firebase/database-compat");class eg{constructor(e){this._delegate=e}cancel(t){B("OnDisconnect.cancel",0,1,arguments.length),K("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){B("OnDisconnect.remove",0,1,arguments.length),K("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){B("OnDisconnect.set",1,2,arguments.length),K("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){B("OnDisconnect.setWithPriority",2,3,arguments.length),K("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(t,n){if(B("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,Xf("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}K("OnDisconnect.update","onComplete",n,!0);const e=this._delegate.update(t);return n&&e.then(()=>n(null),e=>n(e)),e}}class tg{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return B("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class ng{constructor(e,t){this._database=e,this._delegate=t}val(){return B("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return B("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return B("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return B("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return B("DataSnapshot.child",0,1,arguments.length),e=String(e),_p("DataSnapshot.child","path",e,!1),new ng(this._database,this._delegate.child(e))}hasChild(e){return B("DataSnapshot.hasChild",1,1,arguments.length),_p("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return B("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return B("DataSnapshot.forEach",1,1,arguments.length),K("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new ng(this._database,e)))}hasChildren(){return B("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return B("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return B("DataSnapshot.ref",0,0,arguments.length),new ig(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class rg{constructor(e,t){this.database=e,this._delegate=t}on(e,n,t,r){var i;B("Query.on",2,4,arguments.length),K("Query.on","callback",n,!1);const s=rg.getCancelAndContextArgs_("Query.on",t,r);var a=(e,t)=>{n.call(s.context,new ng(this.database,e),t)};a.userCallback=n,a.context=s.context;var o=null===(i=s.cancel)||void 0===i?void 0:i.bind(s.context);switch(e){case"value":return _f(this._delegate,a,o),n;case"child_added":return wf(this._delegate,a,o),n;case"child_removed":return Tf(this._delegate,a,o),n;case"child_changed":return bf(this._delegate,a,o),n;case"child_moved":return If(this._delegate,a,o),n;default:throw new Error(j("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){var r;B("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(j(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),K("Query.off","callback",t,!0),$("Query.off","context",n,!0),t?((r=()=>{}).userCallback=t,r.context=n,Ef(this._delegate,e,r)):Ef(this._delegate,e)}get(){return gf(this._delegate).then(e=>new ng(this.database,e))}once(e,r,t,n){B("Query.once",1,4,arguments.length),K("Query.once","callback",r,!0);const i=rg.getCancelAndContextArgs_("Query.once",t,n),s=new h;var a=(e,t)=>{var n=new ng(this.database,e);r&&r.call(i.context,n,t),s.resolve(n)};a.userCallback=r,a.context=i.context;var o=e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)};switch(e){case"value":_f(this._delegate,a,o,{onlyOnce:!0});break;case"child_added":wf(this._delegate,a,o,{onlyOnce:!0});break;case"child_removed":Tf(this._delegate,a,o,{onlyOnce:!0});break;case"child_changed":bf(this._delegate,a,o,{onlyOnce:!0});break;case"child_moved":If(this._delegate,a,o,{onlyOnce:!0});break;default:throw new Error(j("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return B("Query.limitToFirst",1,1,arguments.length),new rg(this.database,Ff(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Rf(e)}(e)))}limitToLast(e){return B("Query.limitToLast",1,1,arguments.length),new rg(this.database,Ff(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new xf(e)}(e)))}orderByChild(e){return B("Query.orderByChild",1,1,arguments.length),new rg(this.database,Ff(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return _p("orderByChild","path",e,!1),new Df(e)}(e)))}orderByKey(){return B("Query.orderByKey",0,0,arguments.length),new rg(this.database,Ff(this._delegate,new Pf))}orderByPriority(){return B("Query.orderByPriority",0,0,arguments.length),new rg(this.database,Ff(this._delegate,new Of))}orderByValue(){return B("Query.orderByValue",0,0,arguments.length),new rg(this.database,Ff(this._delegate,new Mf))}startAt(e=null,t){return B("Query.startAt",0,2,arguments.length),new rg(this.database,Ff(this._delegate,([e=null,t]=[e,t],cp("startAt","key",t,!0),new Af(e,t))))}startAfter(e=null,t){return B("Query.startAfter",0,2,arguments.length),new rg(this.database,Ff(this._delegate,(e=e,t=t,cp("startAfter","key",t,!0),new Nf(e,t))))}endAt(e=null,t){return B("Query.endAt",0,2,arguments.length),new rg(this.database,Ff(this._delegate,(e=e,t=t,cp("endAt","key",t,!0),new Cf(e,t))))}endBefore(e=null,t){return B("Query.endBefore",0,2,arguments.length),new rg(this.database,Ff(this._delegate,(e=e,t=t,cp("endBefore","key",t,!0),new Sf(e,t))))}equalTo(e,t){return B("Query.equalTo",1,2,arguments.length),new rg(this.database,Ff(this._delegate,(e=e,t=t,cp("equalTo","key",t,!0),new Lf(e,t))))}toString(){return B("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return B("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(B("Query.isEqual",1,1,arguments.length),e instanceof rg)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,K(e,"cancel",r.cancel,!0),r.context=n,$(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(j(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new ig(this.database,new cf(this._delegate._repo,this._delegate._path))}}class ig extends rg{constructor(e,t){super(e,new rf(t._repo,t._path,new Hu,!1)),this.database=e,this._delegate=t}getKey(){return B("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return B("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new ig(this.database,df(this._delegate,e))}getParent(){B("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new ig(this.database,e):null}getRoot(){return B("Reference.root",0,0,arguments.length),new ig(this.database,this._delegate.root)}set(e,t){B("Reference.set",1,2,arguments.length),K("Reference.set","onComplete",t,!0);const n=pf(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(t,n){if(B("Reference.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,Xf("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}up("Reference.update",this._delegate._path),K("Reference.update","onComplete",n,!0);const e=ff(this._delegate,t);return n&&e.then(()=>n(null),e=>n(e)),e}setWithPriority(e,t,n){B("Reference.setWithPriority",2,3,arguments.length),K("Reference.setWithPriority","onComplete",n,!0);const r=function(e,t,n){if(up("setWithPriority",e._path),sp("setWithPriority",t,e._path,!1),op("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new h;return Lp(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(t){B("Reference.remove",0,1,arguments.length),K("Reference.remove","onComplete",t,!0);const e=(n=this._delegate,up("remove",n._path),pf(n,null));var n;return t&&e.then(()=>t(null),e=>t(e)),e}transaction(e,t,n){B("Reference.transaction",1,3,arguments.length),K("Reference.transaction","transactionUpdate",e,!1),K("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(j(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=Jf(this._delegate,e,{applyLocally:n}).then(e=>new tg(e.committed,new ng(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){B("Reference.setPriority",1,2,arguments.length),K("Reference.setPriority","onComplete",t,!0);const n=function(e,t){e=X(e),up("setPriority",e._path),op("setPriority",t,!1);const n=new h;return Lp(e._repo,Wl(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){B("Reference.push",0,2,arguments.length),K("Reference.push","onComplete",t,!0);const n=function(e,t){e=X(e),up("push",e._path),sp("push",t,e._path,!0);var n=Rp(e._repo),n=Vu(n);const r=df(e,n),i=df(e,n);let s;return s=null!=t?pf(i,t).then(()=>i):Promise.resolve(i),r.then=s.then.bind(s),r.catch=s.then.bind(s,void 0),r}(this._delegate,e),r=n.then(e=>new ig(this.database,e));t&&r.then(()=>t(null),e=>t(e));const i=new ig(this.database,n);return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return up("Reference.onDisconnect",this._delegate._path),new eg(new nf(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class sg{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:$f,forceLongPolling:Wf}}useEmulator(e,t,n={}){zf(this._delegate,e,t,n)}ref(e){if(B("database.ref",0,1,arguments.length),e instanceof ig){var t=hf(this._delegate,e.toString());return new ig(this,t)}t=uf(this._delegate,e);return new ig(this,t)}refFromURL(e){B("database.refFromURL",1,1,arguments.length);var t=hf(this._delegate,e);return new ig(this,t)}goOffline(){var e;B("database.goOffline",0,0,arguments.length),(e=X(e=this._delegate))._checkNotDeleted("goOffline"),Vp(e._repo)}goOnline(){return B("database.goOnline",0,0,arguments.length),Gf(this._delegate)}}sg.ServerValue={TIMESTAMP:Qf,increment:e=>({".sv":{increment:e}})};var ag,og=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:i,nodeAdmin:s=!1}){Ac(n);const a=new te("auth-internal",new ne("database-standalone"));return a.setComponent(new Z("auth-internal",()=>r,"PRIVATE")),{instance:new sg(Bf(e,a,void 0,t,s),e),namespace:i}}});const cg=sg.ServerValue;(ag=ft).INTERNAL.registerComponent(new Z("database-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("database").getImmediate({identifier:t});return new sg(r,n)},"PUBLIC").setServiceProps({Reference:ig,Query:rg,Database:sg,DataSnapshot:ng,enableLogging:Hf,INTERNAL:og,ServerValue:cg}).setMultipleInstances(!0)),ag.registerVersion("@firebase/database-compat","0.2.6");var dt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},lg={},ug=dt||self;function hg(){}function dg(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function pg(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var fg="closure_uid_"+(1e9*Math.random()>>>0),gg=0;function mg(e,t,n){return e.call.apply(e.bind,arguments)}function vg(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function yg(e,t,n){return(yg=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?mg:vg).apply(null,arguments)}function _g(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function wg(e,s){function t(){}t.prototype=s.prototype,e.X=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Vb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function bg(){this.s=this.s,this.o=this.o}var Ig={};bg.prototype.s=!1,bg.prototype.na=function(){var e,t;!this.s&&(this.s=!0,this.M(),0)&&(t=this,e=Object.prototype.hasOwnProperty.call(t,fg)&&t[fg]||(t[fg]=++gg),delete Ig[e])},bg.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Tg=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Eg(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function kg(t){for(let e=1;e<arguments.length;e++){var n=arguments[e];if(dg(n)){var r=t.length||0,i=n.length||0;t.length=r+i;for(let e=0;e<i;e++)t[r+e]=n[e]}else t.push(n)}}function Cg(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Cg.prototype.h=function(){this.defaultPrevented=!0};var Sg=function(){if(!ug.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{ug.addEventListener("test",hg,t),ug.removeEventListener("test",hg,t)}catch(e){}return e}();function Ag(e){return/^[\s\xa0]*$/.test(e)}var Ng=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Rg(e,t){return e<t?-1:t<e?1:0}function xg(){var e=ug.navigator;return(e=e&&e.userAgent)?e:""}function Dg(e){return-1!=xg().indexOf(e)}function Pg(e){return Pg[" "](e),e}Pg[" "]=hg;var Og,Mg=Dg("Opera"),Lg=Dg("Trident")||Dg("MSIE"),Fg=Dg("Edge"),Ug=Fg||Lg,qg=Dg("Gecko")&&!(-1!=xg().toLowerCase().indexOf("webkit")&&!Dg("Edge"))&&!(Dg("Trident")||Dg("MSIE"))&&!Dg("Edge"),Vg=-1!=xg().toLowerCase().indexOf("webkit")&&!Dg("Edge");function Bg(){var e=ug.document;return e?e.documentMode:void 0}e:{var jg="",Kg=(Kg=xg(),qg?/rv:([^\);]+)(\)|;)/.exec(Kg):Fg?/Edge\/([\d\.]+)/.exec(Kg):Lg?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Kg):Vg?/WebKit\/(\S+)/.exec(Kg):Mg?/(?:Version)[ \/]?(\S+)/.exec(Kg):void 0);if(Kg&&(jg=Kg?Kg[1]:""),Lg){Kg=Bg();if(null!=Kg&&Kg>parseFloat(jg)){Og=String(Kg);break e}}Og=jg}var $g={};function Wg(){return e=function(){let e=0;var t=Ng(String(Og)).split("."),n=Ng("9").split("."),r=Math.max(t.length,n.length);for(let a=0;0==e&&a<r;a++)for(var i=t[a]||"",s=n[a]||"";i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=i[0].length||0!=s[0].length)&&(e=Rg(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||Rg(0==i[2].length,0==s[2].length)||Rg(i[2],s[2]),i=i[3],s=s[3],0==e););return 0<=e},t=$g,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9);var e,t}var zg=ug.document&&Lg&&(Bg()||parseInt(Og,10))||void 0;function Gg(e,t){if(Cg.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(qg){e:{try{Pg(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Hg[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&Gg.X.h.call(this)}}wg(Gg,Cg);var Hg={2:"touch",3:"pen",4:"mouse"};Gg.prototype.h=function(){Gg.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Qg="closure_listenable_"+(1e6*Math.random()|0),Yg=0;function Jg(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++Yg,this.ba=this.ea=!1}function Xg(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Zg(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function em(e){const t={};for(const n in e)t[n]=e[n];return t}const tm="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function nm(t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(let e=0;e<tm.length;e++)n=tm[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function rm(e){this.src=e,this.g={},this.h=0}function im(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=Tg(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(Xg(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function sm(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ba&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}rm.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=sm(e,t,r,i);return-1<a?(t=e[a],n||(t.ea=!1)):((t=new Jg(t,this.src,s,!!r,i)).ea=n,e.push(t)),t};var am="closure_lm_"+(1e6*Math.random()|0),om={};function cm(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}r=gm(r);return t&&t[Qg]?t.O(n,r,pg(i)?!!i.capture:!!i,s):lm(t,n,r,!0,i,s)}(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)cm(e,t[s],n,r,i);return null}return n=gm(n),e&&e[Qg]?e.N(t,n,pg(r)?!!r.capture:!!r,i):lm(e,t,n,!1,r,i)}function lm(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=pg(i)?!!i.capture:!!i,o=pm(e);if(o||(e[am]=o=new rm(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function(){const n=dm;return function e(t){return n.call(e.src,e.listener,t)}}(),(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(i=!Sg?a:i)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(hm(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function um(e){var t,n,r;"number"!=typeof e&&e&&!e.ba&&((t=e.src)&&t[Qg]?im(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(hm(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=pm(t))?(im(n,e),0==n.h&&(n.src=null,t[am]=null)):Xg(e)))}function hm(e){return e in om?om[e]:om[e]="on"+e}function dm(e,t){var n,r;return e=!!e.ba||(t=new Gg(t,this),n=e.listener,r=e.ha||e.src,e.ea&&um(e),n.call(r,t))}function pm(e){return(e=e[am])instanceof rm?e:null}var fm="__closure_events_fn_"+(1e9*Math.random()>>>0);function gm(t){return"function"==typeof t?t:(t[fm]||(t[fm]=function(e){return t.handleEvent(e)}),t[fm])}function mm(){bg.call(this),this.i=new rm(this),(this.P=this).I=null}function vm(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new Cg(t,e):t instanceof Cg?t.target=t.target||e:(a=t,nm(t=new Cg(r,e),a)),a=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],a=ym(s,r,!0,t)&&a;if(a=ym(s=t.g=e,r,!0,t)&&a,a=ym(s,r,!1,t)&&a,n)for(i=0;i<n.length;i++)a=ym(s=t.g=n[i],r,!1,t)&&a}function ym(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a,o,c=t[s];c&&!c.ba&&c.capture==n&&(a=c.listener,o=c.ha||c.src,c.ea&&im(e.i,c),i=!1!==a.call(o,r)&&i)}return i&&!r.defaultPrevented}wg(mm,bg),mm.prototype[Qg]=!0,mm.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else i=pg(i)?!!i.capture:!!i,r=gm(r),t&&t[Qg]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=sm(a=t.g[n],r,i,s))&&(Xg(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):(t=t&&pm(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?sm(n,r,i,s):t)?n[t]:null)&&um(r))}(this,e,t,n,r)},mm.prototype.M=function(){if(mm.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Xg(n[r]);delete t.g[e],t.h--}}this.I=null},mm.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},mm.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var _m=ug.JSON.stringify;var wm,bm=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Im,e=>e.reset());class Im{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Tm(e,t){var n;wm||(n=ug.Promise.resolve(void 0),wm=function(){n.then(Cm)}),Em||(wm(),Em=!0),km.add(e,t)}var Em=!1,km=new class{constructor(){this.h=this.g=null}add(e,t){const n=bm.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Cm(){for(var e;e=function(){var e=km;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){ug.setTimeout(()=>{throw e},0)}(e)}var t=bm;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Em=!1}function Sm(e,t){mm.call(this),this.h=e||1,this.g=t||ug,this.j=yg(this.kb,this),this.l=Date.now()}function Am(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function Nm(e,t,n){if("function"==typeof e)n&&(e=yg(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=yg(e.handleEvent,e)}return 2147483647<Number(t)?-1:ug.setTimeout(e,t||0)}wg(Sm,mm),(gt=Sm.prototype).ca=!1,gt.R=null,gt.kb=function(){var e;this.ca&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),vm(this,"tick"),this.ca&&(Am(this),this.start())))},gt.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},gt.M=function(){Sm.X.M.call(this),Am(this),delete this.g};class Rm extends bg{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=Nm(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(ug.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function xm(e){bg.call(this),this.h=e,this.g={}}wg(xm,bg);var Dm=[];function Pm(e,t,n,r){Array.isArray(n)||(n&&(Dm[0]=n.toString()),n=Dm);for(var i=0;i<n.length;i++){var s=cm(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Om(e){Zg(e.g,function(e,t){this.g.hasOwnProperty(t)&&um(e)},e),e.g={}}function Mm(){this.g=!0}function Lm(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return _m(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}xm.prototype.M=function(){xm.X.M.call(this),Om(this)},xm.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Mm.prototype.Aa=function(){this.g=!1},Mm.prototype.info=function(){};var Fm={},Um=null;function qm(){return Um=Um||new mm}function Vm(e){Cg.call(this,Fm.Oa,e)}function Bm(){var e=qm();vm(e,new Vm(e))}function jm(e,t){Cg.call(this,Fm.STAT_EVENT,e),this.stat=t}function Km(e){var t=qm();vm(t,new jm(t,e))}function $m(e,t){Cg.call(this,Fm.Pa,e),this.size=t}function Wm(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return ug.setTimeout(function(){e()},t)}Fm.Oa="serverreachability",wg(Vm,Cg),Fm.STAT_EVENT="statevent",wg(jm,Cg),Fm.Pa="timingevent",wg($m,Cg);mt={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,La:7,TIMEOUT:8,Cb:9},Fc={qb:"complete",Mb:"success",Ma:"error",La:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function zm(){}function Gm(e){return e.h||(e.h=e.i())}function Hm(){}zm.prototype.h=null;dt={OPEN:"a",pb:"b",Ma:"c",Bb:"d"};function Qm(){Cg.call(this,"d")}function Ym(){Cg.call(this,"c")}function Jm(){}function Xm(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new xm(this),this.O=tv,this.T=new Sm(e=Ug?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Zm}function Zm(){this.i=null,this.g="",this.h=!1}wg(Qm,Cg),wg(Ym,Cg),wg(Jm,zm),Jm.prototype.g=function(){return new XMLHttpRequest},Jm.prototype.i=function(){return{}};var ev=new Jm,tv=45e3,nv={},rv={};function iv(e,t,n){e.K=1,e.v=Iv(vv(t)),e.s=n,e.P=!0,sv(e,null)}function sv(e,t){e.F=Date.now(),cv(e),e.A=vv(e.v);var a,o,c,l,u,h,n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),Mv(n.i,"t",r),e.C=0,n=e.l.H,e.h=new Zm,e.g=Oy(e.l,n?t:null,!e.s),0<e.N&&(e.L=new Rm(yg(e.Ka,e,e.g),e.N)),Pm(e.S,e.g,"readystatechange",e.hb),t=e.H?em(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),Bm(),a=e.j,o=e.u,c=e.A,l=e.m,u=e.U,h=e.s,a.info(function(){if(a.g)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+l+") [attempt "+u+"]: "+o+"\n"+c+"\n"+e})}function av(e){return e.g&&("GET"==e.u&&2!=e.K&&e.l.Da)}function ov(e,t,n){let r=!0,i;for(;!e.I&&e.C<n.length;){if(i=(a=n,c=o=void 0,o=(s=e).C,-1==(c=a.indexOf("\n",o))?rv:(o=Number(a.substring(o,c)),isNaN(o)?nv:(c+=1)+o>a.length?rv:(a=a.substr(c,o),s.C=c+o,a))),i==rv){4==t&&(e.o=4,Km(14),r=!1),Lm(e.j,e.m,null,"[Incomplete Response]");break}if(i==nv){e.o=4,Km(15),Lm(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}Lm(e.j,e.m,i,null),pv(e,i)}var s,a,o,c;av(e)&&i!=rv&&i!=nv&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Km(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),Cy(t),t.K=!0,Km(11))):(Lm(e.j,e.m,n,"[Invalid Chunked Response]"),dv(e),hv(e))}function cv(e){e.V=Date.now()+e.O,lv(e,e.O)}function lv(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Wm(yg(e.fb,e),t)}function uv(e){e.B&&(ug.clearTimeout(e.B),e.B=null)}function hv(e){0==e.l.G||e.I||Ny(e.l,e)}function dv(e){uv(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Am(e.T),Om(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function pv(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||jv(n.h,e)))if(!e.J&&jv(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Ay(n),yy(n)}ky(n),Km(18)}}else n.Ba=i[1],0<n.Ba-n.T&&i[2]<37500&&n.L&&0==n.A&&!n.v&&(n.v=Wm(yg(n.bb,n),6e3));if(Bv(n.h)<=1&&n.ja){try{n.ja()}catch(e){}n.ja=void 0}}else xy(n,11)}else if(!e.J&&n.g!=e||Ay(n),!Ag(t))for(i=n.Fa.g.parse(t),t=0;t<i.length;t++){var s=i[t];if(n.T=s[0],s=s[1],2==n.G)if("c"==s[0]){n.I=s[1],n.ka=s[2];var a=s[3];null!=a&&(n.ma=a,n.j.info("VER="+n.ma));var o=s[4];null!=o&&(n.Ca=o,n.j.info("SVER="+n.Ca));var c,l,u=s[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const f=e.g;if(f){const g=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;g&&((c=r.h).g||-1==g.indexOf("spdy")&&-1==g.indexOf("quic")&&-1==g.indexOf("h2")||(c.j=c.l,c.g=new Set,c.h&&(Kv(c,c.h),c.h=null))),!r.D||(l=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.za=l,bv(r.F,r.D,l))}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var h,d,p=e;(r=n).sa=Py(r,r.H?r.ka:null,r.V),p.J?($v(r.h,p),h=p,(d=r.J)&&h.setTimeout(d),h.B&&(uv(h),cv(h)),r.g=p):Ey(r),0<n.i.length&&wy(n)}else"stop"!=s[0]&&"close"!=s[0]||xy(n,7);else 3==n.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?xy(n,7):vy(n):"noop"!=s[0]&&n.l&&n.l.wa(s),n.A=0)}Bm()}catch(e){}}function fv(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(dg(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(dg(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(dg(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(gt=Xm.prototype).setTimeout=function(e){this.O=e},gt.hb=function(e){e=e.target;const t=this.L;t&&3==hy(e)?t.l():this.Ka(e)},gt.Ka=function(e){try{if(e==this.g)e:{var t=hy(this.g),n=this.g.Ea();this.g.aa();if(!(t<3)&&(3!=t||Ug||this.g&&(this.h.h||this.g.fa()||dy(this.g)))){this.I||4!=t||7==n||Bm(),uv(this);var r=this.g.aa();this.Y=r;t:if(av(this)){var i=dy(this.g);e="";var s=i.length,a=4==hy(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){dv(this),hv(this);var o="";break t}this.h.i=new ug.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:a&&n==s-1});i.splice(0,s),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==r,h=this.j,d=this.u,p=this.A,f=this.m,g=this.U,m=t,v=r,h.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+g+"]: "+d+"\n"+p+"\n"+m+" "+v}),this.i){if(this.Z&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ag(c)){var u=c;break t}}u=null}if(!(r=u)){this.i=!1,this.o=3,Km(12),dv(this),hv(this);break e}Lm(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,pv(this,r)}this.P?(ov(this,t,o),Ug&&this.i&&3==t&&(Pm(this.S,this.T,"tick",this.gb),this.T.start())):(Lm(this.j,this.m,o,null),pv(this,o)),4==t&&dv(this),this.i&&!this.I&&(4==t?Ny(this.l,this):(this.i=!1,cv(this)))}else 400==r&&0<o.indexOf("Unknown SID")?(this.o=3,Km(12)):(this.o=0,Km(13)),dv(this),hv(this)}}}catch(e){}var h,d,p,f,g,m,v},gt.gb=function(){var e,t;this.g&&(e=hy(this.g),t=this.g.fa(),this.C<t.length&&(uv(this),ov(this,e,t),this.i&&4!=e&&cv(this)))},gt.cancel=function(){this.I=!0,dv(this)},gt.fb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.V?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(Bm(),Km(17)),dv(this),this.o=2,hv(this)):lv(this,this.V-n)};var gv=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mv(e,t){var n;this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof mv?(this.h=void 0!==t?t:e.h,yv(this,e.j),this.s=e.s,this.g=e.g,_v(this,e.m),this.l=e.l,t=e.i,(n=new xv).i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),wv(this,n),this.o=e.o):e&&(n=String(e).match(gv))?(this.h=!!t,yv(this,n[1]||"",!0),this.s=Tv(n[2]||""),this.g=Tv(n[3]||"",!0),_v(this,n[4]),this.l=Tv(n[5]||"",!0),wv(this,n[6]||"",!0),this.o=Tv(n[7]||"")):(this.h=!!t,this.i=new xv(null,this.h))}function vv(e){return new mv(e)}function yv(e,t,n){e.j=n?Tv(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function _v(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function wv(e,t,n){var r,i;t instanceof xv?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(Dv(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Pv(this,t),Mv(this,n,e))},r)),r.j=i):(n||(t=Ev(t,Nv)),e.i=new xv(t,e.h))}function bv(e,t,n){e.i.set(t,n)}function Iv(e){return bv(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Tv(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ev(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,kv),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function kv(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}mv.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ev(t,Cv,!0),":");var n=this.g;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(Ev(t,Cv,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Ev(n,"/"==n.charAt(0)?Av:Sv,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Ev(n,Rv)),e.join("")};var Cv=/[#\/\?@]/g,Sv=/[#\?:]/g,Av=/[#\?]/g,Nv=/[#\?@]/g,Rv=/#/g;function xv(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Dv(n){n.g||(n.g=new Map,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,i=e[n].indexOf("="),s=null;0<=i?(r=e[n].substring(0,i),s=e[n].substring(i+1)):r=e[n],t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Pv(e,t){Dv(e),t=Lv(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Ov(e,t){return Dv(e),t=Lv(e,t),e.g.has(t)}function Mv(e,t,n){Pv(e,t),0<n.length&&(e.i=null,e.g.set(Lv(e,t),Eg(n)),e.h+=n.length)}function Lv(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(gt=xv.prototype).add=function(e,t){Dv(this),this.i=null,e=Lv(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},gt.forEach=function(n,r){Dv(this),this.g.forEach(function(e,t){e.forEach(function(e){n.call(r,e,t,this)},this)},this)},gt.oa=function(){Dv(this);const t=Array.from(this.g.values()),n=Array.from(this.g.keys()),r=[];for(let s=0;s<n.length;s++){var i=t[s];for(let e=0;e<i.length;e++)r.push(n[s])}return r},gt.W=function(t){Dv(this);let n=[];if("string"==typeof t)Ov(this,t)&&(n=n.concat(this.g.get(Lv(this,t))));else{t=Array.from(this.g.values());for(let e=0;e<t.length;e++)n=n.concat(t[e])}return n},gt.set=function(e,t){return Dv(this),this.i=null,Ov(this,e=Lv(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},gt.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},gt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),s=this.W(r),r=0;r<s.length;r++){var a=i;""!==s[r]&&(a+="="+encodeURIComponent(String(s[r]))),e.push(a)}return this.i=e.join("&")};var Fv=class{constructor(e,t){this.h=e,this.g=t}};function Uv(e){this.l=e||10,e=ug.PerformanceNavigationTiming?0<(e=ug.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(ug.g&&ug.g.Ga&&ug.g.Ga()&&ug.g.Ga().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var qv;function Vv(e){return e.h||e.g&&e.g.size>=e.j}function Bv(e){return e.h?1:e.g?e.g.size:0}function jv(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function Kv(e,t){e.g?e.g.add(t):e.h=t}function $v(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Wv(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return Eg(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function zv(){}function Gv(){this.g=new zv}function Hv(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function Qv(e){this.l=e.$b||null,this.j=e.ib||!1}function Yv(e,t){mm.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Jv,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Uv.prototype.cancel=function(){if(this.i=Wv(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},zv.prototype.stringify=function(e){return ug.JSON.stringify(e,void 0)},zv.prototype.parse=function(e){return ug.JSON.parse(e,void 0)},wg(Qv,zm),Qv.prototype.g=function(){return new Yv(this.l,this.j)},Qv.prototype.i=(qv={},function(){return qv}),wg(Yv,mm);var Jv=0;function Xv(e){e.j.read().then(e.Sa.bind(e)).catch(e.ga.bind(e))}function Zv(e){e.readyState=4,e.l=null,e.j=null,e.A=null,ey(e)}function ey(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(gt=Yv.prototype).open=function(e,t){if(this.readyState!=Jv)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,ey(this)},gt.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||ug).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ga.bind(this))},gt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Zv(this)),this.readyState=Jv},gt.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,ey(this)),this.g&&(this.readyState=3,ey(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ga.bind(this));else if(void 0!==ug.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Xv(this)}else e.text().then(this.Ua.bind(this),this.ga.bind(this))},gt.Sa=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?Zv:ey)(this),3==this.readyState&&Xv(this))},gt.Ua=function(e){this.g&&(this.response=this.responseText=e,Zv(this))},gt.Ta=function(e){this.g&&(this.response=e,Zv(this))},gt.ga=function(){this.g&&Zv(this)},gt.setRequestHeader=function(e,t){this.v.append(e,t)},gt.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},gt.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Yv.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var ty=ug.JSON.parse;function ny(e){mm.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=ry,this.K=this.L=!1}wg(ny,mm);var ry="",iy=/^https?$/i,sy=["POST","PUT"];function ay(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,oy(e),ly(e)}function oy(e){e.D||(e.D=!0,vm(e,"complete"),vm(e,"error"))}function cy(e){if(e.h&&void 0!==lg&&(!e.C[1]||4!=hy(e)||2!=e.aa()))if(e.v&&4==hy(e))Nm(e.Ha,0,e);else if(vm(e,"readystatechange"),4==hy(e)){e.h=!1;try{var t,n,r,i,s=e.aa();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var a=!0;break e;default:a=!1}if((t=a)||((n=0===s)&&(!(i=String(e.H).match(gv)[1]||null)&&ug.self&&ug.self.location&&(i=(r=ug.self.location.protocol).substr(0,r.length-1)),n=!iy.test(i?i.toLowerCase():"")),t=n),t)vm(e,"complete"),vm(e,"success");else{e.m=6;try{var o=2<hy(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.aa()+"]",oy(e)}}finally{ly(e)}}}function ly(e,t){if(e.g){uy(e);const n=e.g,r=e.C[0]?hg:null;e.g=null,e.C=null,t||vm(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function uy(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(ug.clearTimeout(e.A),e.A=null)}function hy(e){return e.g?e.g.readyState:0}function dy(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case ry:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function py(e){let n="";return Zg(e,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}function fy(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=py(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):bv(e,t,n))}function gy(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function my(e){this.Ca=0,this.i=[],this.j=new Mm,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.$a=this.U=0,this.Ya=gy("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Wa=gy("baseRetryDelayMs",5e3,e),this.ab=gy("retryDelaySeedMs",1e4,e),this.Za=gy("forwardChannelMaxRetries",2,e),this.ta=gy("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Yb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new Uv(e&&e.concurrentRequestLimit),this.Fa=new Gv,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Xa=e&&e.Wb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function vy(e){var t,n;_y(e),3==e.G&&(t=e.U++,bv(n=vv(e.F),"SID",e.I),bv(n,"RID",t),bv(n,"TYPE","terminate"),Iy(e,n),(t=new Xm(e,e.j,t,void 0)).K=2,t.v=Iv(vv(n)),n=!1,!(n=ug.navigator&&ug.navigator.sendBeacon?ug.navigator.sendBeacon(t.v.toString(),""):n)&&ug.Image&&((new Image).src=t.v,n=!0),n||(t.g=Oy(t.l,null),t.g.da(t.v)),t.F=Date.now(),cv(t)),Dy(e)}function yy(e){e.g&&(Cy(e),e.g.cancel(),e.g=null)}function _y(e){yy(e),e.u&&(ug.clearTimeout(e.u),e.u=null),Ay(e),e.h.cancel(),e.m&&("number"==typeof e.m&&ug.clearTimeout(e.m),e.m=null)}function wy(e){Vv(e.h)||e.m||(e.m=!0,Tm(e.Ja,e),e.C=0)}function by(e,t){var n=t?t.m:e.U++,r=vv(e.F);bv(r,"SID",e.I),bv(r,"RID",n),bv(r,"AID",e.T),Iy(e,r),e.o&&e.s&&fy(r,e.o,e.s),n=new Xm(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=Ty(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),Kv(e.h,n),iv(n,r,t)}function Iy(e,n){e.ia&&Zg(e.ia,function(e,t){bv(n,t,e)}),e.l&&fv({},function(e,t){bv(n,t,e)})}function Ty(e,t,r){r=Math.min(e.i.length,r);var i=e.l?yg(e.l.Qa,e.l,e):null;e:{var s=e.i;let n=-1;for(;;){const c=["count="+r];-1==n?0<r?(n=s[0].h,c.push("ofs="+n)):n=0:c.push("ofs="+n);let e=!0;for(let t=0;t<r;t++){var a=s[t].h,o=s[t].g;if((a-=n)<0)n=Math.max(0,s[t].h-100),e=!1;else try{!function(e,r,t){const i=t||"";try{fv(e,function(e,t){let n=e;pg(e)&&(n=_m(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(o,c,"req"+a+"_")}catch(e){i&&i(o)}}if(e){i=c.join("&");break e}}}return e=e.i.splice(0,r),t.D=e,i}function Ey(e){e.g||e.u||(e.Z=1,Tm(e.Ia,e),e.A=0)}function ky(e){return!(e.g||e.u||3<=e.A)&&(e.Z++,e.u=Wm(yg(e.Ia,e),Ry(e,e.A)),e.A++,1)}function Cy(e){null!=e.B&&(ug.clearTimeout(e.B),e.B=null)}function Sy(e){e.g=new Xm(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=vv(e.sa);bv(t,"RID","rpc"),bv(t,"SID",e.I),bv(t,"CI",e.L?"0":"1"),bv(t,"AID",e.T),bv(t,"TYPE","xmlhttp"),Iy(e,t),e.o&&e.s&&fy(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=Iv(vv(t)),n.s=null,n.P=!0,sv(n,e)}function Ay(e){null!=e.v&&(ug.clearTimeout(e.v),e.v=null)}function Ny(e,t){var n,r,i,s=null;if(e.g==t){Ay(e),Cy(e),e.g=null;var a=2}else{if(!jv(e.h,t))return;s=t.D,$v(e.h,t),a=1}if(0!=e.G)if(e.pa=t.Y,t.i)1==a?(s=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,vm(a=qm(),new $m(a,s)),wy(e)):Ey(e);else if(3==(n=t.o)||0==n&&0<e.pa||(1!=a||(i=t,Bv((r=e).h)>=r.h.j-(r.m?1:0)||(r.m?(r.i=i.D.concat(r.i),0):1==r.G||2==r.G||r.C>=(r.Ya?0:r.Za)||(r.m=Wm(yg(r.Ja,r,i),Ry(r,r.C)),r.C++,0))))&&(2!=a||!ky(e)))switch(s&&0<s.length&&(t=e.h,t.i=t.i.concat(s)),n){case 1:xy(e,5);break;case 4:xy(e,10);break;case 3:xy(e,6);break;default:xy(e,2)}}function Ry(e,t){let n=e.Wa+Math.floor(Math.random()*e.ab);return e.l||(n*=2),n*t}function xy(e,t){var n,r;e.j.info("Error code "+t),2==t?(n=null,e.l&&(n=null),r=yg(e.jb,e),n||(n=new mv("//www.google.com/images/cleardot.gif"),ug.location&&"http"==ug.location.protocol||yv(n,"https"),Iv(n)),function(e,t){var n=new Mm;if(ug.Image){const r=new Image;r.onload=_g(Hv,n,r,"TestLoadImage: loaded",!0,t),r.onerror=_g(Hv,n,r,"TestLoadImage: error",!1,t),r.onabort=_g(Hv,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=_g(Hv,n,r,"TestLoadImage: timeout",!1,t),ug.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):Km(2),e.G=0,e.l&&e.l.va(t),Dy(e),_y(e)}function Dy(e){var t;e.G=0,e.la=[],e.l&&(0==(t=Wv(e.h)).length&&0==e.i.length||(kg(e.la,t),kg(e.la,e.i),e.h.i.length=0,Eg(e.i),e.i.length=0),e.l.ua())}function Py(e,t,n){var r,i,s=n instanceof mv?vv(n):new mv(n,void 0);return""!=s.g?(t&&(s.g=t+"."+s.g),_v(s,s.m)):(s=(r=ug.location).protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port,i=new mv(null,void 0),s&&yv(i,s),t&&(i.g=t),r&&_v(i,r),n&&(i.l=n),s=i),n=e.D,t=e.za,n&&t&&bv(s,n,t),bv(s,"VER",e.ma),Iy(e,s),s}function Oy(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new ny(new Qv({ib:!0})):new ny(e.ra)).L=e.H,t}function My(){}function Ly(){if(Lg&&!(10<=Number(zg)))throw Error("Environmental error: no available transport.")}function Fy(e,t){mm.call(this),this.g=new my(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Xb)&&!Ag(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Ag(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Vy(this)}function Uy(e){Qm.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function qy(){Ym.call(this),this.status=1}function Vy(e){this.g=e}(gt=ny.prototype).da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||ev).g(),this.C=this.u?Gm(this.u):Gm(ev),this.g.onreadystatechange=yg(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void ay(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const c of r.keys())n.set(c,r.get(c))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=ug.FormData&&e instanceof ug.FormData,0<=Tg(sy,t)&&!r&&!i&&n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(var[s,a]of n)this.g.setRequestHeader(s,a);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{uy(this),0<this.B&&((this.K=(o=this.g,Lg&&Wg()&&"number"==typeof o.timeout&&void 0!==o.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=yg(this.qa,this)):this.A=Nm(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){ay(this,e)}var o},gt.qa=function(){void 0!==lg&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,vm(this,"timeout"),this.abort(8))},gt.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,vm(this,"complete"),vm(this,"abort"),ly(this))},gt.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ly(this,!0)),ny.X.M.call(this)},gt.Ha=function(){this.s||(this.F||this.v||this.l?cy(this):this.eb())},gt.eb=function(){cy(this)},gt.aa=function(){try{return 2<hy(this)?this.g.status:-1}catch(e){return-1}},gt.fa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},gt.Ra=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ty(t)}},gt.Ea=function(){return this.m},gt.Na=function(){return"string"==typeof this.j?this.j:String(this.j)},(gt=my.prototype).ma=8,gt.G=1,gt.Ja=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const s=new Xm(this,this.j,t,void 0);let e=this.s;if(this.S&&(e?(e=em(e),nm(e,this.S)):e=this.S),null!==this.o||this.N||(s.H=e,e=null),this.O)e:{for(var n=0,r=0;r<this.i.length;r++){var i=this.i[r];if("__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i=i.length:i=void 0,void 0===i)break;if(4096<(n+=i)){n=r;break e}if(4096===n||r===this.i.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=Ty(this,s,n),bv(r=vv(this.F),"RID",t),bv(r,"CVER",22),this.D&&bv(r,"X-HTTP-Session-Id",this.D),Iy(this,r),e&&(this.N?n="headers="+encodeURIComponent(String(py(e)))+"&"+n:this.o&&fy(r,this.o,e)),Kv(this.h,s),this.Xa&&bv(r,"TYPE","init"),this.O?(bv(r,"$req",n),bv(r,"SID","null"),s.Z=!0,iv(s,r,null)):iv(s,r,n),this.G=2}}else 3==this.G&&(t?by(this,t):0==this.i.length||Vv(this.h)||by(this))},gt.Ia=function(){var e;this.u=null,Sy(this),this.$&&!(this.K||null==this.g||this.P<=0)&&(e=2*this.P,this.j.info("BP detection timer enabled: "+e),this.B=Wm(yg(this.cb,this),e))},gt.cb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Km(10),yy(this),Sy(this))},gt.bb=function(){null!=this.v&&(this.v=null,yy(this),ky(this),Km(19))},gt.jb=function(e){e?(this.j.info("Successfully pinged google.com"),Km(2)):(this.j.info("Failed to ping google.com"),Km(1))},(gt=My.prototype).xa=function(){},gt.wa=function(){},gt.va=function(){},gt.ua=function(){},gt.Qa=function(){},Ly.prototype.g=function(e,t){return new Fy(e,t)},wg(Fy,mm),Fy.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;Km(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=Py(e,null,e.V),wy(e)},Fy.prototype.close=function(){vy(this.g)},Fy.prototype.u=function(e){var t,n=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.v&&((t={}).__data__=_m(e),e=t),n.i.push(new Fv(n.$a++,e)),3==n.G&&wy(n)},Fy.prototype.M=function(){this.g.l=null,delete this.j,vy(this.g),delete this.g,Fy.X.M.call(this)},wg(Uy,Qm),wg(qy,Ym),wg(Vy,My),Vy.prototype.xa=function(){vm(this.g,"a")},Vy.prototype.wa=function(e){vm(this.g,new Uy(e))},Vy.prototype.va=function(e){vm(this.g,new qy)},Vy.prototype.ua=function(){vm(this.g,"b")},Ly.prototype.createWebChannel=Ly.prototype.g,Fy.prototype.send=Fy.prototype.u,Fy.prototype.open=Fy.prototype.m,mt.NO_ERROR=0,mt.TIMEOUT=8,mt.HTTP_ERROR=6,Fc.COMPLETE="complete",(Hm.EventType=dt).OPEN="a",dt.CLOSE="b",dt.ERROR="c",dt.MESSAGE="d",mm.prototype.listen=mm.prototype.N,ny.prototype.listenOnce=ny.prototype.O,ny.prototype.getLastError=ny.prototype.Na,ny.prototype.getLastErrorCode=ny.prototype.Ea,ny.prototype.getStatus=ny.prototype.aa,ny.prototype.getResponseJson=ny.prototype.Ra,ny.prototype.getResponseText=ny.prototype.fa,ny.prototype.send=ny.prototype.da;var By,jy=qm,Ky=mt,$y=Fc,Wy=Fm,zy=10,Gy=11,Hy=Qv,Qy=Hm,Yy=ny;const Jy="@firebase/firestore";class Xy{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Xy.UNAUTHENTICATED=new Xy(null),Xy.GOOGLE_CREDENTIALS=new Xy("google-credentials-uid"),Xy.FIRST_PARTY=new Xy("first-party-uid"),Xy.MOCK_USER=new Xy("mock-user");let Zy="9.10.0";const e_=new ue("@firebase/firestore");function t_(){return e_.logLevel}function n_(e,...t){var n;e_.logLevel<=ie.DEBUG&&(n=t.map(s_),e_.debug(`Firestore (${Zy}): ${e}`,...n))}function r_(e,...t){var n;e_.logLevel<=ie.ERROR&&(n=t.map(s_),e_.error(`Firestore (${Zy}): ${e}`,...n))}function i_(e,...t){var n;e_.logLevel<=ie.WARN&&(n=t.map(s_),e_.warn(`Firestore (${Zy}): ${e}`,...n))}function s_(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function a_(e="Unexpected state"){var t=`FIRESTORE (${Zy}) INTERNAL ASSERTION FAILED: `+e;throw r_(t),new Error(t)}function o_(e){e||a_()}const c_={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class l_ extends I{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class u_{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class h_{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class d_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Xy.UNAUTHENTICATED))}shutdown(){}}class p_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class f_{constructor(e){this.t=e,this.currentUser=Xy.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const i=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let s=new u_;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new u_,t.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},o=e=>{n_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(e=>o(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?o(e):(n_("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new u_))},0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(n_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(o_("string"==typeof e.accessToken),new h_(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return o_(null===e||"string"==typeof e),new Xy(e)}}class g_{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r,this.type="FirstParty",this.user=Xy.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(o_(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);var e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class m_{constructor(e,t,n,r){this.h=e,this.l=t,this.m=n,this.g=r}getToken(){return Promise.resolve(new g_(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(Xy.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class v_{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class y_{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(t,n){const r=e=>{null!=e.error&&n_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);var t=e.token!==this.A;return this.A=e.token,n_("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>r(e))};const i=e=>{n_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.T.onInit(e=>i(e)),setTimeout(()=>{var e;this.appCheck||((e=this.T.getImmediate({optional:!0}))?i(e):n_("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(o_("string"==typeof e.token),this.A=e.token,new v_(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class __{static R(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(t){const n="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(n&&"function"==typeof n.getRandomValues)n.getRandomValues(r);else for(let e=0;e<t;e++)r[e]=Math.floor(256*Math.random());return r}(40);for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function w_(e,t){return e<t?-1:t<e?1:0}function b_(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function I_(e){return e+"\0"}class T_{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new l_(c_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new l_(c_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new l_(c_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new l_(c_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return T_.fromMillis(Date.now())}static fromDate(e){return T_.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new T_(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?w_(this.nanoseconds,e.nanoseconds):w_(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class E_{constructor(e){this.timestamp=e}static fromTimestamp(e){return new E_(e)}static min(){return new E_(new T_(0,0))}static max(){return new E_(new T_(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class k_{constructor(e,t,n){void 0===t?t=0:t>e.length&&a_(),void 0===n?n=e.length-t:n>e.length-t&&a_(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===k_.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof k_?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class C_ extends k_{construct(e,t,n){return new C_(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new l_(c_.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new C_(t)}static emptyPath(){return new C_([])}}const S_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class A_ extends k_{construct(e,t,n){return new A_(e,t,n)}static isValidIdentifier(e){return S_.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!A_.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new A_(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new l_(c_.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new l_(c_.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new l_(c_.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new l_(c_.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new A_(t)}static emptyPath(){return new A_([])}}class N_{constructor(e){this.path=e}static fromPath(e){return new N_(C_.fromString(e))}static fromName(e){return new N_(C_.fromString(e).popFirst(5))}static empty(){return new N_(C_.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===C_.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return C_.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new N_(new C_(e.slice()))}}class R_{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function x_(e){return e.fields.find(e=>2===e.kind)}function D_(e){return e.fields.filter(e=>2!==e.kind)}R_.UNKNOWN_ID=-1;class P_{constructor(e,t){this.fieldPath=e,this.kind=t}}class O_{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new O_(0,F_.min())}}function M_(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,r=E_.fromTimestamp(1e9===r?new T_(n+1,0):new T_(n,r));return new F_(r,N_.empty(),t)}function L_(e){return new F_(e.readTime,e.key,-1)}class F_{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new F_(E_.min(),N_.empty(),-1)}static max(){return new F_(E_.max(),N_.empty(),-1)}}function U_(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=N_.comparator(e.documentKey,t.documentKey),0!==n?n:w_(e.largestBatchId,t.largestBatchId))}const q_="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class V_{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function B_(e){if(e.code!==c_.FAILED_PRECONDITION||e.message!==q_)throw e;n_("LocalStore","Unexpectedly lost primary lease")}class j_{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&a_(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new j_((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof j_?t:j_.resolve(t)}catch(e){return j_.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):j_.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):j_.reject(t)}static resolve(n){return new j_((e,t)=>{e(n)})}static reject(n){return new j_((e,t)=>{t(n)})}static waitFor(e){return new j_((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=j_.resolve(!1);for(const n of e)t=t.next(e=>e?j_.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}static mapArray(o,c){return new j_((t,n)=>{const r=o.length,i=new Array(r);let s=0;for(let e=0;e<r;e++){const a=e;c(o[a]).next(e=>{i[a]=e,++s,s===r&&t(i)},e=>n(e))}})}static doWhile(r,i){return new j_((e,t)=>{const n=()=>{!0===r()?i().next(()=>{n()},t):e()};n()})}}class K_{constructor(n,e){this.action=n,this.transaction=e,this.aborted=!1,this.P=new u_,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{e.error?this.P.reject(new z_(n,e.error)):this.P.resolve()},this.transaction.onerror=e=>{var t=J_(e.target.error);this.P.reject(new z_(n,t))}}static open(e,t,n,r){try{return new K_(t,e.transaction(r,n))}catch(e){throw new z_(t,e)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(n_("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){var t=this.transaction.objectStore(e);return new H_(t)}}class $_{constructor(e,t,n){this.name=e,this.version=t,this.S=n,12.2===$_.D(d())&&r_("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return n_("SimpleDb","Removing database:",e),Q_(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!_())return!1;if($_.N())return!0;const e=d(),t=$_.D(e),n=0<t&&t<10,r=$_.k(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.M)}static O(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static k(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async F(s){return this.db||(n_("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=e=>{var t=e.target.result;n(t)},i.onblocked=()=>{r(new z_(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=e=>{var t=e.target.error;"VersionError"===t.name?r(new l_(c_.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===t.name?r(new l_(c_.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+t)):r(new z_(s,t))},i.onupgradeneeded=e=>{n_("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.S.$(t,i.transaction,e.oldVersion,this.version).next(()=>{n_("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=e=>this.B(e)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.F(e);const t=K_.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.V(),e)).catch(e=>(t.abort(e),j_.reject(e))).toPromise();return s.catch(()=>{}),await t.v,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(n_("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class W_{constructor(e){this.U=e,this.q=!1,this.K=null}get isDone(){return this.q}get G(){return this.K}set cursor(e){this.U=e}done(){this.q=!0}j(e){this.K=e}delete(){return Q_(this.U.delete())}}class z_ extends l_{constructor(e,t){super(c_.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function G_(e){return"IndexedDbTransactionError"===e.name}class H_{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(n_("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(n_("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),Q_(n)}add(e){return n_("SimpleDb","ADD",this.store.name,e,e),Q_(this.store.add(e))}get(t){return Q_(this.store.get(t)).next(e=>(n_("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return n_("SimpleDb","DELETE",this.store.name,e),Q_(this.store.delete(e))}count(){return n_("SimpleDb","COUNT",this.store.name),Q_(this.store.count())}W(e,n){var t=this.options(e,n);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.H(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new j_((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new j_((t,n)=>{r.onerror=e=>{n(e.target.error)},r.onsuccess=e=>{t(e.target.result)}})}Y(e,t){n_("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.X=!1;var r=this.cursor(n);return this.H(r,(e,t,n)=>n.delete())}Z(e,t){let n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.H(r,t)}tt(i){const e=this.cursor({});return new j_((n,r)=>{e.onerror=e=>{var t=J_(e.target.error);r(t)},e.onsuccess=e=>{const t=e.target.result;t?i(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}H(e,s){const a=[];return new j_((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new W_(t),r=s(t.primaryKey,t.value,n);if(r instanceof j_){const e=r.catch(e=>(n.done(),j_.reject(e)));a.push(e)}n.isDone?i():null===n.G?t.continue():t.continue(n.G)}else i()}}).next(()=>j_.waitFor(a))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Q_(e){return new j_((n,r)=>{e.onsuccess=e=>{var t=e.target.result;n(t)},e.onerror=e=>{var t=J_(e.target.error);r(t)}})}let Y_=!1;function J_(e){const t=$_.D(d());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new l_("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Y_||(Y_=!0,setTimeout(()=>{throw e},0)),e}}return e}class X_{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){n_("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{n_("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(e){G_(e)?n_("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await B_(e)}await this.nt(6e4)})}}class Z_{constructor(e,t){this.localStore=e,this.persistence=t}async st(t=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.it(e,t))}it(e,t){const n=new Set;let r=t,i=!0;return j_.doWhile(()=>!0===i&&0<r,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>null===t||n.has(t)?void(i=!1):(n_("IndexBackiller",`Processing collection: ${t}`),this.rt(e,t,r).next(e=>{r-=e,n.add(t)})))).next(()=>t-r)}rt(r,i,e){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(r,i).next(n=>this.localStore.localDocuments.getNextDocuments(r,i,n,e).next(e=>{const t=e.changes;return this.localStore.indexManager.updateIndexEntries(r,t).next(()=>this.ot(n,e)).next(e=>(n_("IndexBackiller",`Updating offset: ${e}`),this.localStore.indexManager.updateCollectionGroup(r,i,e))).next(()=>t.size)}))}ot(e,t){let r=e;return t.changes.forEach((e,t)=>{var n=L_(t);0<U_(n,r)&&(r=n)}),new F_(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ew{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ut(e),this.ct=e=>t.writeSequenceNumber(e))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.ct&&this.ct(e),e}}function tw(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function nw(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function rw(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}ew.at=-1;class iw{constructor(e,t){this.comparator=e,this.root=t||aw.EMPTY}insert(e,t){return new iw(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,aw.BLACK,null,null))}remove(e){return new iw(this.comparator,this.root.remove(e,this.comparator).copy(null,null,aw.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new sw(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new sw(this.root,e,this.comparator,!1)}getReverseIterator(){return new sw(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new sw(this.root,e,this.comparator,!0)}}class sw{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class aw{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:aw.RED,this.left=null!=r?r:aw.EMPTY,this.right=null!=i?i:aw.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new aw(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return aw.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return aw.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,aw.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,aw.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw a_();if(this.right.isRed())throw a_();var e=this.left.check();if(e!==this.right.check())throw a_();return e+(this.isRed()?0:1)}}aw.EMPTY=null,aw.RED=!0,aw.BLACK=!1,aw.EMPTY=new class{constructor(){this.size=0}get key(){throw a_()}get value(){throw a_()}get color(){throw a_()}get left(){throw a_()}get right(){throw a_()}copy(e,t,n,r,i){return this}insert(e,t,n){return new aw(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ow{constructor(e){this.comparator=e,this.data=new iw(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new cw(this.data.getIterator())}getIteratorFrom(e){return new cw(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof ow))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new ow(this.comparator);return t.data=e,t}}class cw{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function lw(e){return e.hasNext()?e.getNext():void 0}class uw{constructor(e){(this.fields=e).sort(A_.comparator)}static empty(){return new uw([])}unionWith(e){let t=new ow(A_.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new uw(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return b_(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class hw{constructor(e){this.binaryString=e}static fromBase64String(e){var t=atob(e);return new hw(t)}static fromUint8Array(e){var t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new hw(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return w_(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}hw.EMPTY_BYTE_STRING=new hw("");const dw=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function pw(t){if(o_(!!t),"string"!=typeof t)return{seconds:fw(t.seconds),nanos:fw(t.nanos)};{let e=0;var n=dw.exec(t);o_(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function fw(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function gw(e){return"string"==typeof e?hw.fromBase64String(e):hw.fromUint8Array(e)}function mw(e){var t;return"server_timestamp"===(null===(t=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function vw(e){var t=pw(e.mapValue.fields.__local_write_time__.timestampValue);return new T_(t.seconds,t.nanos)}class yw{constructor(e,t,n,r,i,s,a,o){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class _w{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new _w("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof _w&&e.projectId===this.projectId&&e.database===this.database}}function ww(e){return null==e}function bw(e){return 0===e&&1/e==-1/0}function Iw(e){return"number"==typeof e&&Number.isInteger(e)&&!bw(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const Tw={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ew={nullValue:"NULL_VALUE"};function kw(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?mw(e)?4:Uw(e)?9007199254740991:10:a_()}function Cw(r,i){if(r===i)return!0;var e,t,n=kw(r);if(n!==kw(i))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return vw(r).isEqual(vw(i));case 3:return function(e){if("string"==typeof r.timestampValue&&"string"==typeof e.timestampValue&&r.timestampValue.length===e.timestampValue.length)return r.timestampValue===e.timestampValue;var t=pw(r.timestampValue),n=pw(e.timestampValue);return t.seconds===n.seconds&&t.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return t=i,gw(r.bytesValue).isEqual(gw(t.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,fw((t=r).geoPointValue.latitude)===fw(e.geoPointValue.latitude)&&fw(t.geoPointValue.longitude)===fw(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return fw(e.integerValue)===fw(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=fw(e.doubleValue),r=fw(t.doubleValue);return n===r?bw(n)===bw(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return b_(r.arrayValue.values||[],i.arrayValue.values||[],Cw);case 10:return function(e){const t=e.mapValue.fields||{},n=i.mapValue.fields||{};if(tw(t)!==tw(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!Cw(t[e],n[e])))return!1;return!0}(r);default:return a_()}}function Sw(e,t){return void 0!==(e.values||[]).find(e=>Cw(e,t))}function Aw(e,t){if(e===t)return 0;var n,r,i,s,a=kw(e),o=kw(t);if(a!==o)return w_(a,o);switch(a){case 0:case 9007199254740991:return 0;case 1:return w_(e.booleanValue,t.booleanValue);case 2:return r=t,i=fw(e.integerValue||e.doubleValue),s=fw(r.integerValue||r.doubleValue),i<s?-1:s<i?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return Nw(e.timestampValue,t.timestampValue);case 4:return Nw(vw(e),vw(t));case 5:return w_(e.stringValue,t.stringValue);case 6:return function(e,t){const n=gw(e),r=gw(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const t=w_(n[i],r[i]);if(0!==t)return t}return w_(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0!==(s=w_(fw(n.latitude),fw(r.latitude)))?s:w_(fw(n.longitude),fw(r.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const t=Aw(n[i],r[i]);if(t)return t}return w_(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===Tw.mapValue&&t===Tw.mapValue)return 0;if(e===Tw.mapValue)return 1;if(t===Tw.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const t=w_(r[o],s[o]);if(0!==t)return t;var a=Aw(n[r[o]],i[s[o]]);if(0!==a)return a}return w_(r.length,s.length)}(e.mapValue,t.mapValue);default:throw a_()}}function Nw(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return w_(e,t);var n=pw(e),r=pw(t),i=w_(n.seconds,r.seconds);return 0!==i?i:w_(n.nanos,r.nanos)}function Rw(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=pw(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?gw(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,N_.fromName(t).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=s(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${s(e.fields[i])}`;return n+"}"}(e.mapValue):a_();var t}(e)}function xw(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Dw(e){return e&&"integerValue"in e}function Pw(e){return!!e&&"arrayValue"in e}function Ow(e){return e&&"nullValue"in e}function Mw(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Lw(e){return e&&"mapValue"in e}function Fw(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return nw(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=Fw(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=Fw(t.arrayValue.values[e]);return r}return Object.assign({},t)}function Uw(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function qw(e,t){var n=Aw(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Vw(e,t){var n=Aw(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Bw{constructor(e){this.value=e}static empty(){return new Bw({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let e=this.value;for(let t=0;t<n.length-1;++t)if(e=(e.mapValue.fields||{})[n.get(t)],!Lw(e))return null;return e=(e.mapValue.fields||{})[n.lastSegment()],e||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Fw(t)}setAll(e){let n=A_.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=Fw(e):i.push(t.lastSegment())});var t=this.getFieldsMap(n);this.applyChanges(t,r,i)}delete(e){const t=this.field(e.popLast());Lw(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Cw(this.value,e.value)}getFieldsMap(t){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<t.length;++r){let e=n.mapValue.fields[t.get(r)];Lw(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=e),n=e}return n.mapValue.fields}applyChanges(n,e,t){nw(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new Bw(Fw(this.value))}}class jw{constructor(e,t,n,r,i,s){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.data=i,this.documentState=s}static newInvalidDocument(e){return new jw(e,0,E_.min(),E_.min(),Bw.empty(),0)}static newFoundDocument(e,t,n){return new jw(e,1,t,E_.min(),n,0)}static newNoDocument(e,t){return new jw(e,2,t,E_.min(),Bw.empty(),0)}static newUnknownDocument(e,t){return new jw(e,3,t,E_.min(),Bw.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Bw.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Bw.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=E_.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof jw&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new jw(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Kw{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ht=null}}function $w(e,t=null,n=[],r=[],i=null,s=null,a=null){return new Kw(e,t,n,r,i,s,a)}function Ww(e){const t=e;if(null===t.ht){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>{return(t=e).field.canonicalString()+t.op.toString()+Rw(t.value);var t}).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),ww(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Rw(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Rw(e)).join(",")),t.ht=e}return t.ht}function zw(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let a=0;a<e.orderBy.length;a++)if(n=e.orderBy[a],r=t.orderBy[a],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;var n,r,i,s;if(e.filters.length!==t.filters.length)return!1;for(let o=0;o<e.filters.length;o++)if(i=e.filters[o],s=t.filters[o],i.op!==s.op||!i.field.isEqual(s.field)||!Cw(i.value,s.value))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!lb(e.startAt,t.startAt)&&lb(e.endAt,t.endAt)}function Gw(e){return N_.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Hw(e,t){return e.filters.filter(e=>e instanceof Jw&&e.field.isEqual(t))}function Qw(t,n,r){let i=Ew,s=!0;for(const r of Hw(t,n)){let e=Ew,t=!0;switch(r.op){case"<":case"<=":e="nullValue"in(a=r.value)?Ew:"booleanValue"in a?{booleanValue:!1}:"integerValue"in a||"doubleValue"in a?{doubleValue:NaN}:"timestampValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in a?{stringValue:""}:"bytesValue"in a?{bytesValue:""}:"referenceValue"in a?xw(_w.empty(),N_.empty()):"geoPointValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in a?{arrayValue:{}}:"mapValue"in a?{mapValue:{}}:a_();break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=Ew}qw({value:i,inclusive:s},{value:e,inclusive:t})<0&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];qw({value:i,inclusive:s},{value:t,inclusive:r.inclusive})<0&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}function Yw(t,n,r){let i=Tw,s=!0;for(const r of Hw(t,n)){let e=Tw,t=!0;switch(r.op){case">=":case">":e="nullValue"in(a=r.value)?{booleanValue:!1}:"booleanValue"in a?{doubleValue:NaN}:"integerValue"in a||"doubleValue"in a?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in a?{stringValue:""}:"stringValue"in a?{bytesValue:""}:"bytesValue"in a?xw(_w.empty(),N_.empty()):"referenceValue"in a?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in a?{arrayValue:{}}:"arrayValue"in a?{mapValue:{}}:"mapValue"in a?Tw:a_(),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=Tw}0<Vw({value:i,inclusive:s},{value:e,inclusive:t})&&(i=e,s=t)}var a;if(null!==r)for(let e=0;e<t.orderBy.length;++e)if(t.orderBy[e].field.isEqual(n)){const t=r.position[e];0<Vw({value:i,inclusive:s},{value:t,inclusive:r.inclusive})&&(i=t,s=r.inclusive);break}return{value:i,inclusive:s}}class Jw extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.lt(e,t,n):new Xw(e,t,n):"array-contains"===t?new nb(e,n):"in"===t?new rb(e,n):"not-in"===t?new ib(e,n):"array-contains-any"===t?new sb(e,n):new Jw(e,t,n)}static lt(e,t,n){return new("in"===t?Zw:eb)(e,n)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.ft(Aw(t,this.value)):null!==t&&kw(this.value)===kw(t)&&this.ft(Aw(t,this.value))}ft(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return a_()}}dt(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}}class Xw extends Jw{constructor(e,t,n){super(e,t,n),this.key=N_.fromName(n.referenceValue)}matches(e){var t=N_.comparator(e.key,this.key);return this.ft(t)}}class Zw extends Jw{constructor(e,t){super(e,"in",t),this.keys=tb(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class eb extends Jw{constructor(e,t){super(e,"not-in",t),this.keys=tb(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function tb(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>N_.fromName(e.referenceValue))}class nb extends Jw{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return Pw(t)&&Sw(t.arrayValue,this.value)}}class rb extends Jw{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&Sw(this.value.arrayValue,t)}}class ib extends Jw{constructor(e,t){super(e,"not-in",t)}matches(e){if(Sw(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Sw(this.value.arrayValue,t)}}class sb extends Jw{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Pw(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Sw(this.value.arrayValue,e))}}class ab{constructor(e,t){this.position=e,this.inclusive=t}}class ob{constructor(e,t="asc"){this.field=e,this.dir=t}}function cb(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],a=e.position[i];if(r=s.field.isKeyField()?N_.comparator(N_.fromName(a.referenceValue),n.key):Aw(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function lb(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Cw(e.position[n],t.position[n]))return!1;return!0}class ub{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this._t=null,this.wt=null,this.startAt,this.endAt}}function hb(e,t,n,r,i,s,a,o){return new ub(e,t,n,r,i,s,a,o)}function db(e){return new ub(e)}function pb(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function fb(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function gb(e){for(const t of e.filters)if(t.dt())return t.field;return null}function mb(e){return null!==e.collectionGroup}function vb(t){const n=t;if(null===n._t){n._t=[];const t=gb(n),e=fb(n);if(null!==t&&null===e)t.isKeyField()||n._t.push(new ob(t)),n._t.push(new ob(A_.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n._t.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n._t.push(new ob(A_.keyField(),t))}}}return n._t}function yb(e){const t=e;if(!t.wt)if("F"===t.limitType)t.wt=$w(t.path,t.collectionGroup,vb(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of vb(t)){const t="desc"===i.dir?"asc":"desc";e.push(new ob(i.field,t))}var n=t.endAt?new ab(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new ab(t.startAt.position,t.startAt.inclusive):null;t.wt=$w(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.wt}function _b(e,t,n){return new ub(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function wb(e,t){return zw(yb(e),yb(t))&&e.limitType===t.limitType}function bb(e){return`${Ww(yb(e))}|lt:${e.limitType}`}function Ib(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>{return`${(t=e).field.canonicalString()} ${t.op} ${Rw(t.value)}`;var t}).join(", ")}]`),ww(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Rw(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Rw(e)).join(",")),`Target(${t})`}(yb(e))}; limitType=${e.limitType})`}function Tb(n,e){return e.isFoundDocument()&&(i=n,a=(s=e).key.path,null!==i.collectionGroup?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(a):N_.isDocumentKey(i.path)?i.path.isEqual(a):i.path.isImmediateParentOf(a))&&function(e){for(const t of n.explicitOrderBy)if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(i=e,(!(e=n).startAt||(t=e.startAt,r=cb(t,vb(e),i),t.inclusive?r<=0:r<0))&&(!e.endAt||(t=e.endAt,r=cb(t,vb(e),i),t.inclusive?0<=r:0<r)));var t,r,i,s,a}function Eb(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function kb(i){return(e,t)=>{let n=!1;for(const r of vb(i)){const i=function(e,i,t){var n=e.field.isKeyField()?N_.comparator(i.key,t.key):function(e,t){var n=i.data.field(e),r=t.data.field(e);return null!==n&&null!==r?Aw(n,r):a_()}(e.field,t);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return a_()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}function Cb(e,t){if(e.gt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bw(t)?"-0":t}}function Sb(e){return{integerValue:""+e}}function Ab(e,t){return Iw(t)?Sb(t):Cb(e,t)}class Nb{constructor(){this._=void 0}}function Rb(e,t){return e instanceof Lb?Dw(n=t)||n&&"doubleValue"in n?t:{integerValue:0}:null;var n}class xb extends Nb{}class Db extends Nb{constructor(e){super(),this.elements=e}}function Pb(e,t){const n=Ub(t);for(const t of e.elements)n.some(e=>Cw(e,t))||n.push(t);return{arrayValue:{values:n}}}class Ob extends Nb{constructor(e){super(),this.elements=e}}function Mb(e,t){let n=Ub(t);for(const t of e.elements)n=n.filter(e=>!Cw(e,t));return{arrayValue:{values:n}}}class Lb extends Nb{constructor(e,t){super(),this.It=e,this.yt=t}}function Fb(e){return fw(e.integerValue||e.doubleValue)}function Ub(e){return Pw(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class qb{constructor(e,t){this.field=e,this.transform=t}}class Vb{constructor(e,t){this.version=e,this.transformResults=t}}class Bb{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Bb}static exists(e){return new Bb(void 0,e)}static updateTime(e){return new Bb(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function jb(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Kb{}function $b(e,n){if(!e.hasLocalMutations||n&&0===n.fields.length)return null;if(null===n)return e.isNoDocument()?new Zb(e.key,Bb.none()):new Hb(e.key,e.data,Bb.none());{const i=e.data,s=Bw.empty();let t=new ow(A_.comparator);for(var r of n.fields)if(!t.has(r)){let e=i.field(r);null===e&&1<r.length&&(r=r.popLast(),e=i.field(r)),null===e?s.delete(r):s.set(r,e),t=t.add(r)}return new Qb(e.key,s,new uw(t.toArray()),Bb.none())}}function Wb(e,t,n){e instanceof Hb?function(e,t,n){const r=e.value.clone(),i=Jb(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Qb?function(e,t,n){if(!jb(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=Jb(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Yb(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function zb(e,t,n,r){return e instanceof Hb?function(e,t,n,r){if(!jb(e.precondition,t))return n;const i=e.value.clone(),s=Xb(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Qb?function(e,t,n,r){if(!jb(e.precondition,t))return n;const i=Xb(e.fieldTransforms,r,t),s=t.data;return s.setAll(Yb(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):(t=t,n=n,jb(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n)}function Gb(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&b_(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof Db&&t instanceof Db||e instanceof Ob&&t instanceof Ob?b_(e.elements,t.elements,Cw):e instanceof Lb&&t instanceof Lb?Cw(e.yt,t.yt):e instanceof xb&&t instanceof xb)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class Hb extends Kb{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Qb extends Kb{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Yb(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function Jb(e,t,n){const r=new Map;o_(e.length===n.length);for(let u=0;u<n.length;u++){var i=e[u],s=i.transform,a=t.data.field(i.field);r.set(i.field,(o=s,c=a,l=n[u],o instanceof Db?Pb(o,c):o instanceof Ob?Mb(o,c):l))}var o,c,l;return r}function Xb(e,t,n){const r=new Map;for(const l of e){const e=l.transform,u=n.data.field(l.field);r.set(l.field,(i=e,s=u,a=t,c=o=void 0,i instanceof xb?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return s&&(e.fields.__previous_value__=s),{mapValue:e}}():i instanceof Db?Pb(i,s):i instanceof Ob?Mb(i,s):(o=Rb(i=i,s),c=Fb(o)+Fb(i.yt),Dw(o)&&Dw(i.yt)?Sb(c):Cb(i.It,c))))}var i,s,a,o,c;return r}class Zb extends Kb{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class eI extends Kb{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class tI{constructor(e){this.count=e}}function nI(e){switch(e){default:return a_(),0;case c_.CANCELLED:case c_.UNKNOWN:case c_.DEADLINE_EXCEEDED:case c_.RESOURCE_EXHAUSTED:case c_.INTERNAL:case c_.UNAVAILABLE:case c_.UNAUTHENTICATED:return;case c_.INVALID_ARGUMENT:case c_.NOT_FOUND:case c_.ALREADY_EXISTS:case c_.PERMISSION_DENIED:case c_.FAILED_PRECONDITION:case c_.ABORTED:case c_.OUT_OF_RANGE:case c_.UNIMPLEMENTED:case c_.DATA_LOSS:return 1}}function rI(e){if(void 0===e)return r_("GRPC error has no .code"),c_.UNKNOWN;switch(e){case By.OK:return c_.OK;case By.CANCELLED:return c_.CANCELLED;case By.UNKNOWN:return c_.UNKNOWN;case By.DEADLINE_EXCEEDED:return c_.DEADLINE_EXCEEDED;case By.RESOURCE_EXHAUSTED:return c_.RESOURCE_EXHAUSTED;case By.INTERNAL:return c_.INTERNAL;case By.UNAVAILABLE:return c_.UNAVAILABLE;case By.UNAUTHENTICATED:return c_.UNAUTHENTICATED;case By.INVALID_ARGUMENT:return c_.INVALID_ARGUMENT;case By.NOT_FOUND:return c_.NOT_FOUND;case By.ALREADY_EXISTS:return c_.ALREADY_EXISTS;case By.PERMISSION_DENIED:return c_.PERMISSION_DENIED;case By.FAILED_PRECONDITION:return c_.FAILED_PRECONDITION;case By.ABORTED:return c_.ABORTED;case By.OUT_OF_RANGE:return c_.OUT_OF_RANGE;case By.UNIMPLEMENTED:return c_.UNIMPLEMENTED;case By.DATA_LOSS:return c_.DATA_LOSS;default:return a_()}}(mt=By=By||{})[mt.OK=0]="OK",mt[mt.CANCELLED=1]="CANCELLED",mt[mt.UNKNOWN=2]="UNKNOWN",mt[mt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",mt[mt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",mt[mt.NOT_FOUND=5]="NOT_FOUND",mt[mt.ALREADY_EXISTS=6]="ALREADY_EXISTS",mt[mt.PERMISSION_DENIED=7]="PERMISSION_DENIED",mt[mt.UNAUTHENTICATED=16]="UNAUTHENTICATED",mt[mt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",mt[mt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",mt[mt.ABORTED=10]="ABORTED",mt[mt.OUT_OF_RANGE=11]="OUT_OF_RANGE",mt[mt.UNIMPLEMENTED=12]="UNIMPLEMENTED",mt[mt.INTERNAL=13]="INTERNAL",mt[mt.UNAVAILABLE=14]="UNAVAILABLE",mt[mt.DATA_LOSS=15]="DATA_LOSS";class iI{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(r){nw(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return rw(this.inner)}size(){return this.innerSize}}const sI=new iw(N_.comparator);const aI=new iw(N_.comparator);function oI(...e){let t=aI;for(const n of e)t=t.insert(n.key,n);return t}function cI(e){let n=aI;return e.forEach((e,t)=>n=n.insert(e,t.overlayedDocument)),n}function lI(){return new iI(e=>e.toString(),(e,t)=>e.isEqual(t))}const uI=new iw(N_.comparator),hI=new ow(N_.comparator);function dI(...e){let t=hI;for(const n of e)t=t.add(n);return t}const pI=new ow(w_);class fI{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,gI.createSynthesizedTargetChangeForCurrentChange(e,t)),new fI(E_.min(),n,pI,sI,dI())}}class gI{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new gI(hw.EMPTY_BYTE_STRING,t,dI(),dI(),dI())}}class mI{constructor(e,t,n,r){this.Tt=e,this.removedTargetIds=t,this.key=n,this.Et=r}}class vI{constructor(e,t){this.targetId=e,this.At=t}}class yI{constructor(e,t,n=hw.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class _I{constructor(){this.Rt=0,this.bt=II(),this.Pt=hw.EMPTY_BYTE_STRING,this.vt=!1,this.Vt=!0}get current(){return this.vt}get resumeToken(){return this.Pt}get St(){return 0!==this.Rt}get Dt(){return this.Vt}Ct(e){0<e.approximateByteSize()&&(this.Vt=!0,this.Pt=e)}xt(){let n=dI(),r=dI(),i=dI();return this.bt.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:a_()}}),new gI(this.Pt,this.vt,n,r,i)}Nt(){this.Vt=!1,this.bt=II()}kt(e,t){this.Vt=!0,this.bt=this.bt.insert(e,t)}Mt(e){this.Vt=!0,this.bt=this.bt.remove(e)}Ot(){this.Rt+=1}Ft(){--this.Rt}$t(){this.Vt=!0,this.vt=!0}}class wI{constructor(e){this.Bt=e,this.Lt=new Map,this.Ut=sI,this.qt=bI(),this.Kt=new ow(w_)}Gt(e){for(const t of e.Tt)e.Et&&e.Et.isFoundDocument()?this.Qt(t,e.Et):this.jt(t,e.key,e.Et);for(const n of e.removedTargetIds)this.jt(n,e.key,e.Et)}Wt(n){this.forEachTarget(n,e=>{const t=this.zt(e);switch(n.state){case 0:this.Ht(e)&&t.Ct(n.resumeToken);break;case 1:t.Ft(),t.St||t.Nt(),t.Ct(n.resumeToken);break;case 2:t.Ft(),t.St||this.removeTarget(e);break;case 3:this.Ht(e)&&(t.$t(),t.Ct(n.resumeToken));break;case 4:this.Ht(e)&&(this.Jt(e),t.Ct(n.resumeToken));break;default:a_()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.Lt.forEach((e,t)=>{this.Ht(t)&&n(t)})}Yt(e){const t=e.targetId,n=e.At.count,r=this.Xt(t);if(r){const e=r.target;if(Gw(e))if(0===n){const n=new N_(e.path);this.jt(t,n,jw.newNoDocument(n,E_.min()))}else o_(1===n);else this.Zt(t)!==n&&(this.Jt(t),this.Kt=this.Kt.add(t))}}te(r){const i=new Map;this.Lt.forEach((e,t)=>{var n=this.Xt(t);if(n){if(e.current&&Gw(n.target)){const i=new N_(n.target.path);null!==this.Ut.get(i)||this.ee(t,i)||this.jt(t,i,jw.newNoDocument(i,r))}e.Dt&&(i.set(t,e.xt()),e.Nt())}});let s=dI();this.qt.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{var t=this.Xt(e);return!t||2===t.purpose||(n=!1)}),n&&(s=s.add(e))}),this.Ut.forEach((e,t)=>t.setReadTime(r));var e=new fI(r,i,this.Kt,this.Ut,s);return this.Ut=sI,this.qt=bI(),this.Kt=new ow(w_),e}Qt(e,t){var n;this.Ht(e)&&(n=this.ee(e,t.key)?2:0,this.zt(e).kt(t.key,n),this.Ut=this.Ut.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ne(t.key).add(e)))}jt(e,t,n){if(this.Ht(e)){const r=this.zt(e);this.ee(e,t)?r.kt(t,1):r.Mt(t),this.qt=this.qt.insert(t,this.ne(t).delete(e)),n&&(this.Ut=this.Ut.insert(t,n))}}removeTarget(e){this.Lt.delete(e)}Zt(e){var t=this.zt(e).xt();return this.Bt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.zt(e).Ot()}zt(e){let t=this.Lt.get(e);return t||(t=new _I,this.Lt.set(e,t)),t}ne(e){let t=this.qt.get(e);return t||(t=new ow(w_),this.qt=this.qt.insert(e,t)),t}Ht(e){var t=null!==this.Xt(e);return t||n_("WatchChangeAggregator","Detected inactive target",e),t}Xt(e){var t=this.Lt.get(e);return t&&t.St?null:this.Bt.se(e)}Jt(t){this.Lt.set(t,new _I),this.Bt.getRemoteKeysForTarget(t).forEach(e=>{this.jt(t,e,null)})}ee(e,t){return this.Bt.getRemoteKeysForTarget(e).has(t)}}function bI(){return new iw(N_.comparator)}function II(){return new iw(N_.comparator)}const TI={asc:"ASCENDING",desc:"DESCENDING"},EI={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class kI{constructor(e,t){this.databaseId=e,this.gt=t}}function CI(e,t){return e.gt?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function SI(e,t){return e.gt?t.toBase64():t.toUint8Array()}function AI(e){return o_(!!e),E_.fromTimestamp((t=pw(e),new T_(t.seconds,t.nanos)));var t}function NI(e,t){return e=e,new C_(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function RI(e){var t=C_.fromString(e);return o_(HI(t)),t}function xI(e,t){return NI(e.databaseId,t.path)}function DI(e,t){const n=RI(t);if(n.get(1)!==e.databaseId.projectId)throw new l_(c_.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new l_(c_.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new N_(LI(n))}function PI(e,t){return NI(e.databaseId,t)}function OI(e){var t=RI(e);return 4===t.length?C_.emptyPath():LI(t)}function MI(e){return new C_(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function LI(e){return o_(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function FI(e,t,n){return{name:xI(e,t),fields:n.value.mapValue.fields}}function UI(e,t,n){const r=DI(e,t.name),i=AI(t.updateTime),s=new Bw({mapValue:{fields:t.fields}}),a=jw.newFoundDocument(r,i,s);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function qI(e,t){let n;if(t instanceof Hb)n={update:FI(e,t.key,t.value)};else if(t instanceof Zb)n={delete:xI(e,t.key)};else if(t instanceof Qb)n={update:FI(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof eI))return a_();n={verify:xI(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof xb)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Db)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Ob)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Lb)return{fieldPath:e.field.canonicalString(),increment:t.yt};throw a_()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:(t=r.updateTime,CI(e,t.toTimestamp()))}:void 0!==r.exists?{exists:r.exists}:a_()),n;var r}function VI(t,n){const e=n.currentDocument?void 0!==(i=n.currentDocument).updateTime?Bb.updateTime(AI(i.updateTime)):void 0!==i.exists?Bb.exists(i.exists):Bb.none():Bb.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)o_("REQUEST_TIME"===t.setToServerValue),n=new xb;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Db(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Ob(e)}else"increment"in t?n=new Lb(e,t.increment):a_();var r=A_.fromServerFormat(t.fieldPath);return new qb(r,n)}(t,e)):[];var i;if(n.update){n.update.name;var s=DI(t,n.update.name),a=new Bw({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new uw(e.map(e=>A_.fromServerFormat(e)))}();return new Qb(s,a,t,e,r)}return new Hb(s,a,e,r)}if(n.delete){const r=DI(t,n.delete);return new Zb(r,e)}if(n.verify){const r=DI(t,n.verify);return new eI(r,e)}return a_()}function BI(e,t){return{documents:[PI(e,t.path)]}}function jI(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=PI(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=PI(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map(e=>function(e){if("=="===e.op){if(Mw(e.value))return{unaryFilter:{field:$I(e.field),op:"IS_NAN"}};if(Ow(e.value))return{unaryFilter:{field:$I(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Mw(e.value))return{unaryFilter:{field:$I(e.field),op:"IS_NOT_NAN"}};if(Ow(e.value))return{unaryFilter:{field:$I(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:$I(e.field),op:(t=e.op,EI[t]),value:e.value}};var t}(e));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);i=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:$I(e.field),direction:(e=e.dir,TI[e])}}(e))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);var s,i=(s=t.limit,e.gt||ww(s)?s:{value:s});return null!==i&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt={before:(i=t.startAt).inclusive,values:i.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function KI(e){let t=OI(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(0<r){o_(1===r);const f=n.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[GI(e)]:void 0!==e.fieldFilter?[zI(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((e,t)=>e.concat(t)):a_():[]}(n.where));let a=[];n.orderBy&&(a=n.orderBy.map(e=>function(e){return new ob(WI(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let o=null;var c,l,u,h;n.limit&&(o=(e=n.limit,ww(c="object"==typeof e?e.value:e)?null:c));let d=null;n.startAt&&(d=(l=n.startAt,h=!!l.before,u=l.values||[],new ab(u,h)));let p=null;return n.endAt&&(p=(l=n.endAt,u=!l.before,h=l.values||[],new ab(h,u))),hb(t,i,a,s,o,"F",d,p)}function $I(e){return{fieldPath:e.canonicalString()}}function WI(e){return A_.fromServerFormat(e.fieldPath)}function zI(e){return Jw.create(WI(e.fieldFilter.field),function(){switch(e.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return a_()}}(),e.fieldFilter.value)}function GI(e){switch(e.unaryFilter.op){case"IS_NAN":var t=WI(e.unaryFilter.field);return Jw.create(t,"==",{doubleValue:NaN});case"IS_NULL":t=WI(e.unaryFilter.field);return Jw.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=WI(e.unaryFilter.field);return Jw.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=WI(e.unaryFilter.field);return Jw.create(n,"!=",{nullValue:"NULL_VALUE"});default:return a_()}}function HI(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function QI(e){let t="";for(let n=0;n<e.length;n++)0<t.length&&(t=YI(t)),t=function(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const r=e.charAt(i);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(e.get(n),t);return YI(t)}function YI(e){return e+""}function JI(t){const n=t.length;if(o_(2<=n),2===n)return o_(""===t.charAt(0)&&""===t.charAt(1)),C_.emptyPath();const r=n-2,i=[];let s="";for(let a=0;a<n;){const n=t.indexOf("",a);switch((n<0||n>r)&&a_(),t.charAt(n+1)){case"":const r=t.substring(a,n);let e;0===s.length?e=r:(s+=r,e=s,s=""),i.push(e);break;case"":s+=t.substring(a,n),s+="\0";break;case"":s+=t.substring(a,n+1);break;default:a_()}a=n+2}return new C_(i)}const XI=["userId","batchId"];function ZI(e,t){return[e,QI(t)]}function eT(e,t,n){return[e,QI(t),n]}const tT={},nT=["prefixPath","collectionGroup","readTime","documentId"],rT=["prefixPath","collectionGroup","documentId"],iT=["collectionGroup","readTime","prefixPath","documentId"],sT=["canonicalId","targetId"],aT=["targetId","path"],oT=["path","targetId"],cT=["collectionId","parent"],lT=["indexId","uid"],uT=["uid","sequenceNumber"],hT=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],dT=["indexId","uid","orderedDocumentKey"],pT=["userId","collectionPath","documentId"],fT=["userId","collectionPath","largestBatchId"],gT=["userId","collectionGroup","largestBatchId"],mT=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],vT=[...mT,"documentOverlays"],yT=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],_T=yT,wT=[..._T,"indexConfiguration","indexState","indexEntries"];class bT extends V_{constructor(e,t){super(),this.ie=e,this.currentSequenceNumber=t}}function IT(e,t){var n=e;return $_.O(n.ie,t)}class TT{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){var n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&Wb(i,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=zb(n,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=zb(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(s,a){const o=lI();return this.mutations.forEach(e=>{const t=s.get(e.key),n=t.overlayedDocument;let r=this.applyToLocalView(n,t.mutatedFields);r=a.has(e.key)?null:r;var i=$b(n,r);null!==i&&o.set(e.key,i),n.isValidDocument()||n.convertToNoDocument(E_.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),dI())}isEqual(e){return this.batchId===e.batchId&&b_(this.mutations,e.mutations,(e,t)=>Gb(e,t))&&b_(this.baseMutations,e.baseMutations,(e,t)=>Gb(e,t))}}class ET{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){o_(e.mutations.length===n.length);let r=uI;var i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new ET(e,t,n,r)}}class kT{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class CT{constructor(e,t,n,r,i=E_.min(),s=E_.min(),a=hw.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a}withSequenceNumber(e){return new CT(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new CT(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new CT(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class ST{constructor(e){this.re=e}}function AT(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:NT(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:xI(i=e.re,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:CI(i,e.version.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:RT(t.version)};else{if(!t.isUnknownDocument())return a_();r.unknownDocument={path:n.path.toArray(),version:RT(t.version)}}var i;return r}function NT(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function RT(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function xT(e){var t=new T_(e.seconds,e.nanoseconds);return E_.fromTimestamp(t)}function DT(t,e){const n=(e.baseMutations||[]).map(e=>VI(t.re,e));for(let s=0;s<e.mutations.length-1;++s){const n=e.mutations[s];if(s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform){const r=e.mutations[s+1];n.updateTransforms=r.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(e=>VI(t.re,e)),i=T_.fromMillis(e.localWriteTimeMs);return new TT(e.batchId,i,n,r)}function PT(e){var t,n=xT(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?xT(e.lastLimboFreeSnapshotVersion):E_.min();let i;return i=void 0!==e.query.documents?(o_(1===(t=e.query).documents.length),yb(db(OI(t.documents[0])))):yb(KI(e.query)),new CT(i,e.targetId,0,e.lastListenSequenceNumber,n,r,hw.fromBase64String(e.resumeToken))}function OT(e,t){var n=RT(t.snapshotVersion),r=RT(t.lastLimboFreeSnapshotVersion),i=(Gw(t.target)?BI:jI)(e.re,t.target),s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Ww(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function MT(e){var t=KI({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?_b(t,t.limit,"L"):t}function LT(e,t){return new kT(t.largestBatchId,VI(e.re,t.overlayMutation))}function FT(e,t){var n=t.path.lastSegment();return[e,QI(t.path.popLast()),n]}function UT(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:RT(r.readTime),documentKey:QI(r.documentKey.path),largestBatchId:r.largestBatchId}}class qT{getBundleMetadata(e,t){return VT(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:xT(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return VT(e).put({bundleId:(n=t).id,createTime:RT(AI(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return BT(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:MT(t.bundledQuery),readTime:xT(t.readTime)};var t})}saveNamedQuery(e,t){return BT(e).put({name:(t=t).name,readTime:RT(AI(t.readTime)),bundledQuery:t.bundledQuery})}}function VT(e){return IT(e,"bundles")}function BT(e){return IT(e,"namedQueries")}class jT{constructor(e,t){this.It=e,this.userId=t}static oe(e,t){var n=t.uid||"";return new jT(e,n)}getOverlay(e,t){return KT(e).get(FT(this.userId,t)).next(e=>e?LT(this.It,e):null)}getOverlays(e,t){const n=lI();return j_.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(r,i,e){const s=[];return e.forEach((e,t)=>{var n=new kT(i,t);s.push(this.ue(r,n))}),j_.waitFor(s)}removeOverlaysForBatchId(n,e,r){const t=new Set;e.forEach(e=>t.add(QI(e.getCollectionPath())));const i=[];return t.forEach(e=>{var t=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,r+1],!1,!0);i.push(KT(n).Y("collectionPathOverlayIndex",t))}),j_.waitFor(i)}getOverlaysForCollection(e,t,n){const r=lI(),i=QI(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return KT(e).W("collectionPathOverlayIndex",s).next(e=>{for(const t of e){const e=LT(this.It,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,i){const s=lI();let a;var r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return KT(e).Z({index:"collectionGroupOverlayIndex",range:r},(e,t,n)=>{const r=LT(this.It,t);s.size()<i||r.largestBatchId===a?(s.set(r.getKey(),r),a=r.largestBatchId):n.done()}).next(()=>s)}ue(e,t){return KT(e).put(function(e,t,n){var[,r,i]=FT(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:qI(e.re,n.mutation)}}(this.It,this.userId,t))}}function KT(e){return IT(e,"documentOverlays")}class $T{constructor(){}ce(e,t){this.ae(e,t),t.he()}ae(e,t){var n,r;"nullValue"in e?this.le(t,5):"booleanValue"in e?(this.le(t,10),t.fe(e.booleanValue?1:0)):"integerValue"in e?(this.le(t,15),t.fe(fw(e.integerValue))):"doubleValue"in e?(n=fw(e.doubleValue),isNaN(n)?this.le(t,13):(this.le(t,15),bw(n)?t.fe(0):t.fe(n))):"timestampValue"in e?(r=e.timestampValue,this.le(t,20),"string"==typeof r?t.de(r):(t.de(`${r.seconds||""}`),t.fe(r.nanos||0))):"stringValue"in e?(this._e(e.stringValue,t),this.we(t)):"bytesValue"in e?(this.le(t,30),t.me(gw(e.bytesValue)),this.we(t)):"referenceValue"in e?this.ge(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.le(t,45),t.fe(r.latitude||0),t.fe(r.longitude||0)):"mapValue"in e?Uw(e)?this.le(t,Number.MAX_SAFE_INTEGER):(this.ye(e.mapValue,t),this.we(t)):"arrayValue"in e?(this.pe(e.arrayValue,t),this.we(t)):a_()}_e(e,t){this.le(t,25),this.Ie(e,t)}Ie(e,t){t.de(e)}ye(e,t){var n=e.fields||{};this.le(t,55);for(const e of Object.keys(n))this._e(e,t),this.ae(n[e],t)}pe(e,t){var n=e.values||[];this.le(t,50);for(const e of n)this.ae(e,t)}ge(e,t){this.le(t,37),N_.fromName(e).path.forEach(e=>{this.le(t,60),this.Ie(e,t)})}le(e,t){e.fe(t)}we(e){e.fe(2)}}function WT(e){var t=64-function(e){let t=0;for(let r=0;r<8;++r){var n=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e);return Math.ceil(t/8)}$T.Te=new $T;class zT{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ee(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ae(n.value),n=t.next();this.Re()}be(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Pe(n.value),n=t.next();this.ve()}Ve(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ae(e);else if(e<2048)this.Ae(960|e>>>6),this.Ae(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ae(480|e>>>12),this.Ae(128|63&e>>>6),this.Ae(128|63&e);else{const e=t.codePointAt(0);this.Ae(240|e>>>18),this.Ae(128|63&e>>>12),this.Ae(128|63&e>>>6),this.Ae(128|63&e)}}this.Re()}Se(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Pe(e);else if(e<2048)this.Pe(960|e>>>6),this.Pe(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Pe(480|e>>>12),this.Pe(128|63&e>>>6),this.Pe(128|63&e);else{const e=t.codePointAt(0);this.Pe(240|e>>>18),this.Pe(128|63&e>>>12),this.Pe(128|63&e>>>6),this.Pe(128|63&e)}}this.ve()}De(e){var t=this.Ce(e),n=WT(t);this.xe(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Ne(e){var t=this.Ce(e),n=WT(t);this.xe(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}ke(){this.Me(255),this.Me(255)}Oe(){this.Fe(255),this.Fe(255)}reset(){this.position=0}seed(e){this.xe(e.length),this.buffer.set(e,this.position),this.position+=e.length}$e(){return this.buffer.slice(0,this.position)}Ce(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Ae(e){var t=255&e;0==t?(this.Me(0),this.Me(255)):255==t?(this.Me(255),this.Me(0)):this.Me(t)}Pe(e){var t=255&e;0==t?(this.Fe(0),this.Fe(255)):255==t?(this.Fe(255),this.Fe(0)):this.Fe(e)}Re(){this.Me(0),this.Me(1)}ve(){this.Fe(0),this.Fe(1)}Me(e){this.xe(1),this.buffer[this.position++]=e}Fe(e){this.xe(1),this.buffer[this.position++]=~e}xe(e){var t=e+this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class GT{constructor(e){this.Be=e}me(e){this.Be.Ee(e)}de(e){this.Be.Ve(e)}fe(e){this.Be.De(e)}he(){this.Be.ke()}}class HT{constructor(e){this.Be=e}me(e){this.Be.be(e)}de(e){this.Be.Se(e)}fe(e){this.Be.Ne(e)}he(){this.Be.Oe()}}class QT{constructor(){this.Be=new zT,this.Le=new GT(this.Be),this.Ue=new HT(this.Be)}seed(e){this.Be.seed(e)}qe(e){return 0===e?this.Le:this.Ue}$e(){return this.Be.$e()}reset(){this.Be.reset()}}class YT{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Ke(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new YT(this.indexId,this.documentKey,this.arrayValue,n)}}function JT(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=XT(e.arrayValue,t.arrayValue),0!==n?n:(n=XT(e.directionalValue,t.directionalValue),0!==n?n:N_.comparator(e.documentKey,t.documentKey)))}function XT(e,t){for(let r=0;r<e.length&&r<t.length;++r){var n=e[r]-t[r];if(0!=n)return n}return e.length-t.length}class ZT{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ge=e.orderBy,this.Qe=[];for(const t of e.filters){const e=t;e.dt()?this.je=e:this.Qe.push(e)}}We(e){var t=x_(e);if(void 0!==t&&!this.ze(t))return!1;var n=D_(e);let r=0,i=0;for(;r<n.length&&this.ze(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.je){const e=n[r];if(!this.He(this.je,e)||!this.Je(this.Ge[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Ge.length||!this.Je(this.Ge[i++],e))return!1}return!0}ze(e){for(const t of this.Qe)if(this.He(t,e))return!0;return!1}He(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind==n}Je(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}class e0{constructor(){this.Ye=new t0}addToCollectionParentIndex(e,t){return this.Ye.add(t),j_.resolve()}getCollectionParents(e,t){return j_.resolve(this.Ye.getEntries(t))}addFieldIndex(e,t){return j_.resolve()}deleteFieldIndex(e,t){return j_.resolve()}getDocumentsMatchingTarget(e,t){return j_.resolve(null)}getIndexType(e,t){return j_.resolve(0)}getFieldIndexes(e,t){return j_.resolve([])}getNextCollectionGroupToUpdate(e){return j_.resolve(null)}getMinOffset(e,t){return j_.resolve(F_.min())}getMinOffsetFromCollectionGroup(e,t){return j_.resolve(F_.min())}updateCollectionGroup(e,t,n){return j_.resolve()}updateIndexEntries(e,t){return j_.resolve()}}class t0{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ow(C_.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new ow(C_.comparator)).toArray()}}const n0=new Uint8Array(0);class r0{constructor(e,t){this.user=e,this.databaseId=t,this.Xe=new t0,this.Ze=new iI(e=>Ww(e),(e,t)=>zw(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.Xe.has(t))return j_.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Xe.add(t)});r={collectionId:n,parent:QI(r)};return i0(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[I_(n),""],!1,!0);return i0(e).W(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(JI(t.parent))}return r})}addFieldIndex(e,t){const n=a0(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;const i=n.add(r);if(t.indexState){const n=o0(e);return i.next(e=>{n.put(UT(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=a0(e),r=o0(e),i=s0(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,l){const u=s0(e);let h=!0;const n=new Map;return j_.forEach(this.tn(l),t=>this.en(e,t).next(e=>{h=h&&!!e,n.set(t,e)})).next(()=>{if(h){let c=dI();const h=[];return j_.forEach(n,(e,t)=>{n_("IndexedDbIndexManager",`Using index ${o=e,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`} to execute ${Ww(l)}`);var n=function(e,t){var n=x_(t);if(void 0===n)return null;for(const t of Hw(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(t,e),r=function(e,t){const n=new Map;for(const r of D_(t))for(const t of Hw(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(t,e),i=function(e,t){const n=[];let r=!0;for(const i of D_(t)){const t=(0===i.kind?Qw:Yw)(e,i.fieldPath,e.startAt);n.push(t.value),r=r&&t.inclusive}return new ab(n,r)}(t,e),s=function(e,t){const n=[];let r=!0;for(const i of D_(t)){const t=(0===i.kind?Yw:Qw)(e,i.fieldPath,e.endAt);n.push(t.value),r=r&&t.inclusive}return new ab(n,r)}(t,e),a=this.nn(e,t,i),o=this.nn(e,t,s),r=this.sn(e,t,r),r=this.rn(e.indexId,n,a,i.inclusive,o,s.inclusive,r);return j_.forEach(r,e=>u.J(e,l.limit).next(e=>{e.forEach(e=>{var t=N_.fromSegments(e.documentKey);c.has(t)||(c=c.add(t),h.push(t))})}))}).next(()=>h)}return j_.resolve(null)})}tn(e){var t;return(t=this.Ze.get(e))||(this.Ze.set(e,t=[e]),t)}rn(t,e,n,r,i,s,a){const o=(null!=e?e.length:1)*Math.max(n.length,i.length),c=o/(null!=e?e.length:1),l=[];for(let u=0;u<o;++u){const o=e?this.on(e[u/c]):n0,h=this.un(t,o,n[u%c],r),d=this.cn(t,o,i[u%c],s),p=a.map(e=>this.un(t,o,e,!0));l.push(...this.createRange(h,d,p))}return l}un(e,t,n,r){const i=new YT(e,N_.empty(),t,n);return r?i:i.Ke()}cn(e,t,n,r){const i=new YT(e,N_.empty(),t,n);return r?i.Ke():i}en(e,t){const r=new ZT(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(const n of e)r.We(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let n=2;return j_.forEach(this.tn(t),t=>this.en(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new ow(A_.comparator),n=!1;for(const r of e.filters){const e=r;e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field))}for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>n)}an(e,t){const n=new QT;for(const i of D_(e)){const e=t.data.field(i.fieldPath);if(null==e)return null;var r=n.qe(i.kind);$T.Te.ce(e,r)}return n.$e()}on(e){const t=new QT;return $T.Te.ce(e,t.qe(0)),t.$e()}hn(e,t){const n=new QT;return $T.Te.ce(xw(this.databaseId,t),n.qe(0===(r=D_(e)).length?0:r[r.length-1].kind)),n.$e();var r}sn(e,t,n){if(null===n)return[];let r=[];r.push(new QT);let i=0;for(const s of D_(e)){const e=n[i++];for(const n of r)if(this.ln(t,s.fieldPath)&&Pw(e))r=this.fn(r,s,e);else{const t=n.qe(s.kind);$T.Te.ce(e,t)}}return this.dn(r)}nn(e,t,n){return this.sn(e,t,n.position)}dn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].$e();return t}fn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new QT;r.seed(n.$e()),$T.Te.ce(e,r.qe(t.kind)),i.push(r)}return i}ln(e,t){return!!e.filters.find(e=>e instanceof Jw&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const n=a0(e),r=o0(e);return(t?n.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.W()).next(e=>{const s=[];return j_.forEach(e,i=>r.get([i.indexId,this.uid]).next(e=>{var t,n,r;s.push((t=i,n=(e=e)?new O_(e.sequenceNumber,new F_(xT(e.readTime),new N_(JI(e.documentKey)),e.largestBatchId)):O_.empty(),r=t.fields.map(([e,t])=>new P_(A_.fromServerFormat(e),t)),new R_(t.indexId,t.collectionGroup,r,n)))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=n?n:w_(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=a0(e),s=o0(e);return this._n(e).next(t=>i.W("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(e=>j_.forEach(e,e=>s.put(UT(e.indexId,this.user,t,r)))))}updateIndexEntries(i,e){const n=new Map;return j_.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?j_.resolve(e):this.getFieldIndexes(i,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),j_.forEach(e,n=>this.wn(i,t,n).next(e=>{var t=this.mn(r,n);return e.isEqual(t)?j_.resolve():this.gn(i,r,n,e,t)}))))})}yn(e,t,n,r){return s0(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.hn(n,t.key),documentKey:t.key.path.toArray()})}pn(e,t,n,r){return s0(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.hn(n,t.key),t.key.path.toArray()])}wn(e,n,r){const t=s0(e);let i=new ow(JT);return t.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.hn(r,n)])},(e,t)=>{i=i.add(new YT(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>i)}mn(e,t){let n=new ow(JT);var r=this.an(t,e);if(null==r)return n;const i=x_(t);if(null!=i){var s=e.data.field(i.fieldPath);if(Pw(s))for(const i of s.arrayValue.values||[])n=n.add(new YT(t.indexId,e.key,this.on(i),r))}else n=n.add(new YT(t.indexId,e.key,n0,r));return n}gn(t,n,r,l,e){n_("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const i=[];return function(e,n,r,i){var s=l.getIterator(),a=e.getIterator();let o=lw(s),c=lw(a);for(;o||c;){let e=!1,t=!1;if(o&&c){const r=n(o,c);r<0?t=!0:0<r&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(c),c=lw(a)):t?(i(o),o=lw(s)):(o=lw(s),c=lw(a))}}(e,JT,e=>{i.push(this.yn(t,n,r,e))},e=>{i.push(this.pn(t,n,r,e))}),j_.waitFor(i)}_n(e){let r=1;return o0(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}createRange(e,t,n){n=n.sort((e,t)=>JT(e,t)).filter((e,t,n)=>!t||0!==JT(e,n[t-1]));const r=[];r.push(e);for(const i of n){const n=JT(i,e),s=JT(i,t);if(0===n)r[0]=e.Ke();else if(0<n&&s<0)r.push(i),r.push(i.Ke());else if(0<s)break}r.push(t);const i=[];for(let a=0;a<r.length;a+=2)i.push(IDBKeyRange.bound([r[a].indexId,this.uid,r[a].arrayValue,r[a].directionalValue,n0,[]],[r[a+1].indexId,this.uid,r[a+1].arrayValue,r[a+1].directionalValue,n0,[]]));return i}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(c0)}getMinOffset(t,e){return j_.mapArray(this.tn(e),e=>this.en(t,e).next(e=>e||a_())).next(c0)}}function i0(e){return IT(e,"collectionParents")}function s0(e){return IT(e,"indexEntries")}function a0(e){return IT(e,"indexConfiguration")}function o0(e){return IT(e,"indexState")}function c0(e){o_(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let i=1;i<e.length;i++){var r=e[i].indexState.offset;U_(r,t)<0&&(t=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new F_(t.readTime,t.documentKey,n)}const l0={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class u0{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new u0(e,u0.DEFAULT_COLLECTION_PERCENTILE,u0.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function h0(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId);let o=0;const c=r.Z({range:a},(e,t,n)=>(o++,n.delete()));s.push(c.next(()=>{o_(1===o)}));const l=[];for(const e of n.mutations){const r=eT(t,e.key.path,n.batchId);s.push(i.delete(r)),l.push(e.key)}return j_.waitFor(s).next(()=>l)}function d0(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw a_();t=e.noDocument}return JSON.stringify(t).length}u0.DEFAULT_COLLECTION_PERCENTILE=10,u0.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,u0.DEFAULT=new u0(41943040,u0.DEFAULT_COLLECTION_PERCENTILE,u0.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),u0.DISABLED=new u0(-1,0,0);class p0{constructor(e,t,n,r){this.userId=e,this.It=t,this.indexManager=n,this.referenceDelegate=r,this.In={}}static oe(e,t,n,r){o_(""!==e.uid);var i=e.isAuthenticated()?e.uid:"";return new p0(i,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return g0(e).Z({index:"userMutationsIndex",range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(u,h,d,p){const f=m0(u),g=g0(u);return g.add({}).next(e=>{o_("number"==typeof e);const t=new TT(e,h,d,p),n=(i=this.It,s=this.userId,a=t,o=a.baseMutations.map(e=>qI(i.re,e)),c=a.mutations.map(e=>qI(i.re,e)),{userId:s,batchId:a.batchId,localWriteTimeMs:a.localWriteTime.toMillis(),baseMutations:o,mutations:c}),r=[];var i,s,a,o,c;let l=new ow((e,t)=>w_(e.canonicalString(),t.canonicalString()));for(const u of p){const h=eT(this.userId,u.key.path,e);l=l.add(u.key.path.popLast()),r.push(g.put(n)),r.push(f.put(h,tT))}return l.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(u,e))}),u.addOnCommittedListener(()=>{this.In[e]=t.keys()}),j_.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return g0(e).get(t).next(e=>e?(o_(e.userId===this.userId),DT(this.It,e)):null)}Tn(e,n){return this.In[n]?j_.resolve(this.In[n]):this.lookupMutationBatch(e,n).next(e=>{if(e){var t=e.keys();return this.In[n]=t}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return g0(e).Z({index:"userMutationsIndex",range:n},(e,t,n)=>{t.userId===this.userId&&(o_(t.batchId>=r),i=DT(this.It,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return g0(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return g0(e).W("userMutationsIndex",t).next(e=>e.map(e=>DT(this.It,e)))}getAllMutationBatchesAffectingDocumentKey(a,o){const e=ZI(this.userId,o.path),t=IDBKeyRange.lowerBound(e),c=[];return m0(a).Z({range:t},(e,t,n)=>{var[r,i,s]=e,i=JI(i);if(r===this.userId&&o.path.isEqual(i))return g0(a).get(s).next(e=>{if(!e)throw a_();o_(e.userId===this.userId),c.push(DT(this.It,e))});n.done()}).next(()=>c)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new ow(w_);const n=[];return e.forEach(a=>{var e=ZI(this.userId,a.path),e=IDBKeyRange.lowerBound(e),e=m0(t).Z({range:e},(e,t,n)=>{var[r,i,s]=e,i=JI(i);r===this.userId&&a.path.isEqual(i)?o=o.add(s):n.done()});n.push(e)}),j_.waitFor(n).next(()=>this.En(t,o))}getAllMutationBatchesAffectingQuery(e,t){const a=t.path,o=a.length+1,n=ZI(this.userId,a),r=IDBKeyRange.lowerBound(n);let c=new ow(w_);return m0(e).Z({range:r},(e,t,n)=>{var[r,i,s]=e,i=JI(i);r===this.userId&&a.isPrefixOf(i)?i.length===o&&(c=c.add(s)):n.done()}).next(()=>this.En(e,c))}En(t,e){const n=[],r=[];return e.forEach(e=>{r.push(g0(t).get(e).next(e=>{if(null===e)throw a_();o_(e.userId===this.userId),n.push(DT(this.It,e))}))}),j_.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return h0(t.ie,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.An(n.batchId)}),j_.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}An(e){delete this.In[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return j_.resolve();var t=IDBKeyRange.lowerBound([this.userId]);const r=[];return m0(n).Z({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=JI(e[1]);r.push(t)}else n.done()}).next(()=>{o_(0===r.length)})})}containsKey(e,t){return f0(e,this.userId,t)}Rn(e){return v0(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function f0(e,s,t){const n=ZI(s,t.path),a=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return m0(e).Z({range:r,X:!0},(e,t,n)=>{var[r,i]=e;r===s&&i===a&&(o=!0),n.done()}).next(()=>o)}function g0(e){return IT(e,"mutations")}function m0(e){return IT(e,"documentMutations")}function v0(e){return IT(e,"mutationQueues")}class y0{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new y0(0)}static vn(){return new y0(-1)}}class _0{constructor(e,t){this.referenceDelegate=e,this.It=t}allocateTargetId(n){return this.Vn(n).next(e=>{const t=new y0(e.highestTargetId);return e.highestTargetId=t.next(),this.Sn(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(e=>E_.fromTimestamp(new T_(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Vn(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.Sn(t,e)))}addTargetData(t,n){return this.Dn(t,n).next(()=>this.Vn(t).next(e=>(e.targetCount+=1,this.Cn(n,e),this.Sn(t,e))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>w0(t).delete(e.targetId)).next(()=>this.Vn(t)).next(e=>(o_(0<e.targetCount),--e.targetCount,this.Sn(t,e)))}removeTargets(r,i,s){let a=0;const o=[];return w0(r).Z((e,t)=>{var n=PT(t);n.sequenceNumber<=i&&null===s.get(n.targetId)&&(a++,o.push(this.removeTargetData(r,n)))}).next(()=>j_.waitFor(o)).next(()=>a)}forEachTarget(e,r){return w0(e).Z((e,t)=>{var n=PT(t);r(n)})}Vn(e){return b0(e).get("targetGlobalKey").next(e=>(o_(null!==e),e))}Sn(e,t){return b0(e).put("targetGlobalKey",t)}Dn(e,t){return w0(e).put(OT(this.It,t))}Cn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Vn(e).next(e=>e.targetCount)}getTargetData(e,i){var t=Ww(i),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let s=null;return w0(e).Z({range:t,index:"queryTargetsIndex"},(e,t,n)=>{var r=PT(t);zw(i,r.target)&&(s=r,n.done())}).next(()=>s)}addMatchingKeys(n,e,r){const i=[],s=I0(n);return e.forEach(e=>{var t=QI(e.path);i.push(s.put({targetId:r,path:t})),i.push(this.referenceDelegate.addReference(n,r,e))}),j_.waitFor(i)}removeMatchingKeys(n,e,r){const i=I0(n);return j_.forEach(e,e=>{var t=QI(e.path);return j_.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=I0(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=I0(e);let i=dI();return r.Z({range:n,X:!0},(e,t,n)=>{var r=JI(e[1]),r=new N_(r);i=i.add(r)}).next(()=>i)}containsKey(e,t){var n=QI(t.path),n=IDBKeyRange.bound([n],[I_(n)],!1,!0);let r=0;return I0(e).Z({index:"documentTargetsIndex",X:!0,range:n},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}se(e,t){return w0(e).get(t).next(e=>e?PT(e):null)}}function w0(e){return IT(e,"targets")}function b0(e){return IT(e,"targetGlobal")}function I0(e){return IT(e,"targetDocuments")}function T0([e,t],[n,r]){var i=w_(e,n);return 0===i?w_(t,r):i}class E0{constructor(e){this.xn=e,this.buffer=new ow(T0),this.Nn=0}kn(){return++this.Nn}Mn(e){var t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();T0(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class k0{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.On=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.On&&(this.On.cancel(),this.On=null)}get started(){return null!==this.On}Fn(e){n_("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.On=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.On=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){G_(e)?n_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await B_(e)}await this.Fn(3e5)})}}class C0{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return j_.resolve(ew.at);const n=new E0(t);return this.$n.forEachTarget(e,e=>n.Mn(e.sequenceNumber)).next(()=>this.$n.Ln(e,e=>n.Mn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.$n.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(n_("LruGarbageCollector","Garbage collection skipped; disabled"),j_.resolve(l0)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(n_("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),l0):this.Un(t,n))}getCacheSize(e){return this.$n.getCacheSize(e)}Un(t,n){let r,i,s,a,o,c,l;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(n_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,a=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,o=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(l=Date.now(),t_()<=ie.DEBUG&&n_("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-u}ms\n\tDetermined least recently used ${i} in `+(o-a)+"ms\n"+`\tRemoved ${s} targets in `+(c-o)+"ms\n"+`\tRemoved ${e} documents in `+(l-c)+"ms\n"+`Total Duration: ${l-u}ms`),j_.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class S0{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new C0(e,t))}Bn(e){const n=this.qn(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}qn(e){let t=0;return this.Ln(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,n){return this.Kn(e,(e,t)=>n(t))}addReference(e,t,n){return A0(e,n)}removeReference(e,t,n){return A0(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return A0(e,t)}Gn(t,n){let r=!1;return v0(t).tt(e=>f0(t,e,n).next(e=>(e&&(r=!0),j_.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let a=0;return this.Kn(n,(t,e)=>{if(e<=r){const r=this.Gn(n,t).next(e=>{if(!e)return a++,i.getEntry(n,t).next(()=>(i.removeEntry(t,E_.min()),I0(n).delete([0,QI(t.path)])))});s.push(r)}}).next(()=>j_.waitFor(s)).next(()=>i.apply(n)).next(()=>a)}removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return A0(e,t)}Kn(e,r){const t=I0(e);let i,s=ew.at;return t.Z({index:"documentTargetsIndex"},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==ew.at&&r(new N_(JI(i)),s),s=n,i=t):s=ew.at}).next(()=>{s!==ew.at&&r(new N_(JI(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function A0(e,t){return I0(e).put((e=e.currentSequenceNumber,{targetId:0,path:QI(t.path),sequenceNumber:e}))}class N0{constructor(){this.changes=new iI(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,jw.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?j_.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class R0{constructor(e){this.It=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return O0(e).put(n)}removeEntry(e,n,t){return O0(e).delete(function(e){const t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],NT(e),t[t.length-1]]}(t))}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.Qn(t,e)))}getEntry(e,n){let r=jw.newInvalidDocument(n);return O0(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(M0(n))},(e,t)=>{r=this.jn(n,t)}).next(()=>r)}Wn(e,n){let r={size:0,document:jw.newInvalidDocument(n)};return O0(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(M0(n))},(e,t)=>{r={document:this.jn(n,t),size:d0(t)}}).next(()=>r)}getEntries(e,t){let r=sI;return this.zn(e,t,(e,t)=>{var n=this.jn(e,t);r=r.insert(e,n)}).next(()=>r)}Hn(e,t){let r=sI,i=new iw(N_.comparator);return this.zn(e,t,(e,t)=>{var n=this.jn(e,t);r=r.insert(e,n),i=i.insert(e,d0(t))}).next(()=>({documents:r,Jn:i}))}zn(e,t,i){if(t.isEmpty())return j_.resolve();let n=new ow(F0);t.forEach(e=>n=n.add(e));const r=IDBKeyRange.bound(M0(n.first()),M0(n.last())),s=n.getIterator();let a=s.getNext();return O0(e).Z({index:"documentKeyIndex",range:r},(e,t,n)=>{for(var r=N_.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&F0(a,r)<0;)i(a,null),a=s.getNext();a&&a.isEqual(r)&&(i(a,t),a=s.hasNext()?s.getNext():null),a?n.j(M0(a)):n.done()}).next(()=>{for(;a;)i(a,null),a=s.hasNext()?s.getNext():null})}getAllFromCollection(e,t,n){var r=[t.popLast().toArray(),t.lastSegment(),NT(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],i=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return O0(e).W(IDBKeyRange.bound(r,i,!0)).next(e=>{let t=sI;for(const n of e){const e=this.jn(N_.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);t=t.insert(e.key,e)}return t})}getAllFromCollectionGroup(e,t,n,i){let s=sI;var r=L0(t,n),a=L0(t,F_.max());return O0(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(r,a,!0)},(e,t,n)=>{var r=this.jn(N_.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);s=s.insert(r.key,r),s.size===i&&n.done()}).next(()=>s)}newChangeBuffer(e){return new D0(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return P0(e).get("remoteDocumentGlobalKey").next(e=>(o_(!!e),e))}Qn(e,t){return P0(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const e=function(e,t){let n;if(t.document)n=UI(e.re,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=N_.fromSegments(t.noDocument.path),i=xT(t.noDocument.readTime);n=jw.newNoDocument(e,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return a_();{const e=N_.fromSegments(t.unknownDocument.path),s=xT(t.unknownDocument.version);n=jw.newUnknownDocument(e,s)}}return t.readTime&&n.setReadTime((t=t.readTime,r=new T_(t[0],t[1]),E_.fromTimestamp(r))),n;var r}(this.It,t);if(!e.isNoDocument()||!e.version.isEqual(E_.min()))return e}return jw.newInvalidDocument(e)}}function x0(e){return new R0(e)}class D0 extends N0{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new iI(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(s){const a=[];let o=0,c=new ow((e,t)=>w_(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.Xn.get(e);if(a.push(this.Yn.removeEntry(s,e,n.readTime)),t.isValidDocument()){var r=AT(this.Yn.It,t);c=c.add(e.path.popLast());var i=d0(r);o+=i-n.size,a.push(this.Yn.addEntry(s,e,r))}else if(o-=n.size,this.trackRemovals){const o=AT(this.Yn.It,t.convertToNoDocument(E_.min()));a.push(this.Yn.addEntry(s,e,o))}}),c.forEach(e=>{a.push(this.Yn.indexManager.addToCollectionParentIndex(s,e))}),a.push(this.Yn.updateMetadata(s,o)),j_.waitFor(a)}getFromCache(e,t){return this.Yn.Wn(e,t).next(e=>(this.Xn.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:n,Jn:e})=>(e.forEach((e,t)=>{this.Xn.set(e,{size:t,readTime:n.get(e).readTime})}),n))}}function P0(e){return IT(e,"remoteDocumentGlobal")}function O0(e){return IT(e,"remoteDocumentsV14")}function M0(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function L0(e,t){const n=t.documentKey.path.toArray();return[e,NT(t.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function F0(e,t){var n=e.path.toArray(),r=t.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=w_(n[s],r[s]),i)return i;return i=w_(n.length,r.length),i||(i=w_(n[n.length-2],r[r.length-2]),i||w_(n[n.length-1],r[r.length-1]))}class U0{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class q0{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,n){let r=null;return this.documentOverlayCache.getOverlay(t,n).next(e=>(r=e,this.getBaseDocument(t,n,r))).next(e=>(null!==r&&zb(r.mutation,e,uw.empty(),T_.now()),e))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,dI()).next(()=>e))}getLocalViewOfDocuments(e,t,n=dI()){const r=lI();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let n=oI();return e.forEach((e,t)=>{n=n.insert(e,t.overlayedDocument)}),n}))}getOverlayedDocuments(e,t){const n=lI();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,dI()))}populateOverlays(e,n,t){const r=[];return t.forEach(e=>{n.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,t)=>{n.set(e,t)})})}computeViews(e,t,r,i){let s=sI;const a=lI(),o=lI();return t.forEach((e,t)=>{const n=r.get(t.key);i.has(t.key)&&(void 0===n||n.mutation instanceof Qb)?s=s.insert(t.key,t):void 0!==n&&(a.set(t.key,n.mutation.getFieldMask()),zb(n.mutation,t,n.mutation.getFieldMask(),T_.now()))}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>a.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new U0(t,null!==(n=a.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(s,a){const o=lI();let c=new iw((e,t)=>e-t),l=dI();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(s,a).next(e=>{for(const r of e)r.keys().forEach(e=>{var t,n=a.get(e);null!==n&&(t=o.get(e)||uw.empty(),t=r.applyToLocalView(n,t),o.set(e,t),t=(c.get(r.batchId)||dI()).add(e),c=c.insert(r.batchId,t))})}).next(()=>{const e=[],t=c.getReverseIterator();for(;t.hasNext();){const c=t.getNext(),n=c.key,r=c.value,i=lI();r.forEach(e=>{var t;l.has(e)||(null!==(t=$b(a.get(e),o.get(e)))&&i.set(e,t),l=l.add(e))}),e.push(this.documentOverlayCache.saveOverlays(s,n,i))}return j_.waitFor(e)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,N_.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):mb(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n);var r}getNextDocuments(s,t,a,o){return this.remoteDocumentCache.getAllFromCollectionGroup(s,t,a,o).next(n=>{const e=0<o-n.size?this.documentOverlayCache.getOverlaysForCollectionGroup(s,t,a.largestBatchId,o-n.size):j_.resolve(lI());let r=-1,i=n;return e.next(e=>j_.forEach(e,(t,e)=>(r<e.largestBatchId&&(r=e.largestBatchId),n.get(t)?j_.resolve():this.getBaseDocument(s,t,e).next(e=>{i=i.insert(t,e)}))).next(()=>this.populateOverlays(s,e,n)).next(()=>this.computeViews(s,i,e,dI())).next(e=>({batchId:r,changes:cI(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new N_(t)).next(e=>{let t=oI();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(r,i,s){const a=i.collectionGroup;let o=oI();return this.indexManager.getCollectionParents(r,a).next(e=>j_.forEach(e,e=>{var t,n=(t=i,e=e.child(a),new ub(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.getDocumentsMatchingCollectionQuery(r,n,s).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,s,n){let a;return this.remoteDocumentCache.getAllFromCollection(t,s.path,n).next(e=>(a=e,this.documentOverlayCache.getOverlaysForCollection(t,s.path,n.largestBatchId))).next(r=>{r.forEach((e,t)=>{var n=t.getKey();null===a.get(n)&&(a=a.insert(n,jw.newInvalidDocument(n)))});let i=oI();return a.forEach((e,t)=>{var n=r.get(e);void 0!==n&&zb(n.mutation,t,uw.empty(),T_.now()),Tb(s,t)&&(i=i.insert(e,t))}),i})}getBaseDocument(e,t,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(e,t):j_.resolve(jw.newInvalidDocument(t))}}class V0{constructor(e){this.It=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return j_.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){return this.Zn.set(t.id,{id:t.id,version:t.version,createTime:AI(t.createTime)}),j_.resolve()}getNamedQuery(e,t){return j_.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:(t=t).name,query:MT(t.bundledQuery),readTime:AI(t.readTime)}),j_.resolve()}}class B0{constructor(){this.overlays=new iw(N_.comparator),this.es=new Map}getOverlay(e,t){return j_.resolve(this.overlays.get(t))}getOverlays(e,t){const n=lI();return j_.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(n,r,e){return e.forEach((e,t)=>{this.ue(n,r,t)}),j_.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.es.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.es.delete(n)),j_.resolve()}getOverlaysForCollection(e,t,n){const r=lI(),i=t.length+1,s=new N_(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return j_.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new iw((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=lI(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const a=lI(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return j_.resolve(a)}ue(e,t,n){var r=this.overlays.get(n.key);if(null!==r){const e=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new kT(t,n));let i=this.es.get(t);void 0===i&&(i=dI(),this.es.set(t,i)),this.es.set(t,i.add(n.key))}}class j0{constructor(){this.ns=new ow(K0.ss),this.rs=new ow(K0.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){var n=new K0(e,t);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}us(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.cs(new K0(e,t))}hs(e,t){e.forEach(e=>this.removeReference(e,t))}ls(e){const t=new N_(new C_([])),n=new K0(t,e),r=new K0(t,e+1),i=[];return this.rs.forEachInRange([n,r],e=>{this.cs(e),i.push(e.key)}),i}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){var t=new N_(new C_([])),n=new K0(t,e),t=new K0(t,e+1);let r=dI();return this.rs.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new K0(e,0),t=this.ns.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class K0{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return N_.comparator(e.key,t.key)||w_(e._s,t._s)}static os(e,t){return w_(e._s,t._s)||N_.comparator(e.key,t.key)}}class $0{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new ow(K0.ss)}checkEmpty(e){return j_.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){var i=this.ws;this.ws++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1];var s=new TT(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.gs=this.gs.add(new K0(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return j_.resolve(s)}lookupMutationBatch(e,t){return j_.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){var n=this.ps(t+1),n=n<0?0:n;return j_.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return j_.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return j_.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new K0(t,0),r=new K0(t,Number.POSITIVE_INFINITY),i=[];return this.gs.forEachInRange([n,r],e=>{var t=this.ys(e._s);i.push(t)}),j_.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ow(w_);return t.forEach(e=>{var t=new K0(e,0),n=new K0(e,Number.POSITIVE_INFINITY);this.gs.forEachInRange([t,n],e=>{r=r.add(e._s)})}),j_.resolve(this.Is(r))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;N_.isDocumentKey(i)||(i=i.child(""));var s=new K0(new N_(i),0);let a=new ow(w_);return this.gs.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e._s)),!0)},s),j_.resolve(this.Is(a))}Is(e){const n=[];return e.forEach(e=>{var t=this.ys(e);null!==t&&n.push(t)}),n}removeMutationBatch(n,r){o_(0===this.Ts(r.batchId,"removed")),this.mutationQueue.shift();let i=this.gs;return j_.forEach(r.mutations,e=>{var t=new K0(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.gs=i})}An(e){}containsKey(e,t){var n=new K0(t,0),n=this.gs.firstAfterOrEqual(n);return j_.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,j_.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){var t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class W0{constructor(e){this.Es=e,this.docs=new iw(N_.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return j_.resolve(n?n.document.mutableCopy():jw.newInvalidDocument(t))}getEntries(e,t){let n=sI;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():jw.newInvalidDocument(e))}),j_.resolve(n)}getAllFromCollection(e,t,n){let r=sI;const i=new N_(t.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i}}=s.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||U_(L_(i),n)<=0||(r=r.insert(i.key,i.mutableCopy()))}return j_.resolve(r)}getAllFromCollectionGroup(e,t,n,r){a_()}As(e,t){return j_.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new z0(this)}getSize(e){return j_.resolve(this.size)}}class z0 extends N0{constructor(e){super(),this.Yn=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.Yn.addEntry(n,t)):this.Yn.removeEntry(e)}),j_.waitFor(r)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class G0{constructor(e){this.persistence=e,this.Rs=new iI(e=>Ww(e),zw),this.lastRemoteSnapshotVersion=E_.min(),this.highestTargetId=0,this.bs=0,this.Ps=new j0,this.targetCount=0,this.vs=y0.Pn()}forEachTarget(e,n){return this.Rs.forEach((e,t)=>n(t)),j_.resolve()}getLastRemoteSnapshotVersion(e){return j_.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return j_.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),j_.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),j_.resolve()}Dn(e){this.Rs.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.vs=new y0(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,j_.resolve()}updateTargetData(e,t){return this.Dn(t),j_.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),--this.targetCount,j_.resolve()}removeTargets(n,r,i){let s=0;const a=[];return this.Rs.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.Rs.delete(e),a.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),j_.waitFor(a).next(()=>s)}getTargetCount(e){return j_.resolve(this.targetCount)}getTargetData(e,t){var n=this.Rs.get(t)||null;return j_.resolve(n)}addMatchingKeys(e,t,n){return this.Ps.us(t,n),j_.resolve()}removeMatchingKeys(t,e,n){this.Ps.hs(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),j_.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),j_.resolve()}getMatchingKeysForTargetId(e,t){var n=this.Ps.ds(t);return j_.resolve(n)}containsKey(e,t){return j_.resolve(this.Ps.containsKey(t))}}class H0{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new ew(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new G0(this),this.indexManager=new e0,this.remoteDocumentCache=(e=e=>this.referenceDelegate.xs(e),new W0(e)),this.It=new ST(t),this.Ns=new V0(this.It)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new B0,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Vs[e.toKey()];return n||(n=new $0(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,n){n_("MemoryPersistence","Starting transaction:",e);const r=new Q0(this.Ss.next());return this.referenceDelegate.ks(),n(r).next(e=>this.referenceDelegate.Ms(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Os(t,n){return j_.or(Object.values(this.Vs).map(e=>()=>e.containsKey(t,n)))}}class Q0 extends V_{constructor(e){super(),this.currentSequenceNumber=e}}class Y0{constructor(e){this.persistence=e,this.Fs=new j0,this.$s=null}static Bs(e){return new Y0(e)}get Ls(){if(this.$s)return this.$s;throw a_()}addReference(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),j_.resolve()}removeReference(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),j_.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),j_.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(e=>this.Ls.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Ls.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}ks(){this.$s=new Set}Ms(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return j_.forEach(this.Ls,e=>{const t=N_.fromPath(e);return this.Us(n,t).next(e=>{e||r.removeEntry(t,E_.min())})}).next(()=>(this.$s=null,r.apply(n)))}updateLimboDocument(e,t){return this.Us(e,t).next(e=>{e?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}Us(e,t){return j_.or([()=>j_.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Os(e,t)])}}class J0{constructor(e){this.It=e}$(t,e,n,r){const i=new K_("createOrUpgrade",e);var s;n<1&&1<=r&&(t.createObjectStore("owner"),(s=t).createObjectStore("mutationQueues",{keyPath:"userId"}),s.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",XI,{unique:!0}),s.createObjectStore("documentMutations"),X0(t),t.createObjectStore("remoteDocuments"));let a=j_.resolve();return n<3&&3<=r&&(0!==n&&((s=t).deleteObjectStore("targetDocuments"),s.deleteObjectStore("targets"),s.deleteObjectStore("targetGlobal"),X0(t)),a=a.next(()=>function(){const e=i.store("targetGlobal"),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:E_.min().toTimestamp(),targetCount:0};return e.put("targetGlobalKey",t)}())),n<4&&4<=r&&(0!==n&&(a=a.next(()=>function(r,i){return i.store("mutations").W().next(e=>{r.deleteObjectStore("mutations"),r.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",XI,{unique:!0});const t=i.store("mutations"),n=e.map(e=>t.put(e));return j_.waitFor(n)})}(t,i))),a=a.next(()=>{t.createObjectStore("clientMetadata",{keyPath:"clientId"})})),n<5&&5<=r&&(a=a.next(()=>this.qs(i))),n<6&&6<=r&&(a=a.next(()=>(t.createObjectStore("remoteDocumentGlobal"),this.Ks(i)))),n<7&&7<=r&&(a=a.next(()=>this.Gs(i))),n<8&&8<=r&&(a=a.next(()=>this.Qs(t,i))),n<9&&9<=r&&(a=a.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&10<=r&&(a=a.next(()=>this.js(i))),n<11&&11<=r&&(a=a.next(()=>{t.createObjectStore("bundles",{keyPath:"bundleId"}),t.createObjectStore("namedQueries",{keyPath:"name"})})),n<12&&12<=r&&(a=a.next(()=>{!function(){const e=t.createObjectStore("documentOverlays",{keyPath:pT});e.createIndex("collectionPathOverlayIndex",fT,{unique:!1}),e.createIndex("collectionGroupOverlayIndex",gT,{unique:!1})}()})),n<13&&13<=r&&(a=a.next(()=>function(){const e=t.createObjectStore("remoteDocumentsV14",{keyPath:nT});e.createIndex("documentKeyIndex",rT),e.createIndex("collectionGroupIndex",iT)}()).next(()=>this.Ws(t,i)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&14<=r&&(a=a.next(()=>this.zs(t,i))),n<15&&15<=r&&(a=a.next(()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:lT}).createIndex("sequenceNumberIndex",uT,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:hT}).createIndex("documentKeyIndex",dT,{unique:!1})}(t))),a}Ks(t){let n=0;return t.store("remoteDocuments").Z((e,t)=>{n+=d0(t)}).next(()=>{var e={byteSize:n};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",e)})}qs(r){const e=r.store("mutationQueues"),t=r.store("mutations");return e.W().next(e=>j_.forEach(e,n=>{var e=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return t.W("userMutationsIndex",e).next(e=>j_.forEach(e,e=>{o_(e.userId===n.userId);var t=DT(this.It,e);return h0(r,n.userId,t).next(()=>{})}))}))}Gs(e){const a=e.store("targetDocuments"),t=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return t.Z((e,t)=>{const n=new C_(e),r=[0,QI(n)];s.push(a.get(r).next(e=>e?j_.resolve():(e=>a.put({targetId:0,path:QI(e),sequenceNumber:i.highestListenSequenceNumber}))(n)))}).next(()=>j_.waitFor(s))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:cT});const n=t.store("collectionParents"),r=new t0,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:QI(r)})}};return t.store("remoteDocuments").Z({X:!0},(e,t)=>{const n=new C_(e);return i(n.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([,e],t)=>{const n=JI(e);return i(n.popLast())}))}js(e){const r=e.store("targets");return r.Z((e,t)=>{var n=PT(t),n=OT(this.It,n);return r.put(n)})}Ws(e,s){const t=s.store("remoteDocuments"),a=[];return t.Z((e,t)=>{const n=s.store("remoteDocumentsV14"),r=((i=t).document?new N_(C_.fromString(i.document.name).popFirst(5)):i.noDocument?N_.fromSegments(i.noDocument.path):i.unknownDocument?N_.fromSegments(i.unknownDocument.path):a_()).path.toArray();var i={prefixPath:r.slice(0,r.length-2),collectionGroup:r[r.length-2],documentId:r[r.length-1],readTime:t.readTime||[0,0],unknownDocument:t.unknownDocument,noDocument:t.noDocument,document:t.document,hasCommittedMutations:!!t.hasCommittedMutations};a.push(n.put(i))}).next(()=>j_.waitFor(a))}zs(e,s){const t=s.store("mutations"),a=x0(this.It),o=new H0(Y0.Bs,this.It.re);return t.W().next(e=>{const r=new Map;return e.forEach(e=>{var t;let n=null!==(t=r.get(e.userId))&&void 0!==t?t:dI();DT(this.It,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),j_.forEach(r,(e,t)=>{var n=new Xy(t),r=jT.oe(this.It,n),i=o.getIndexManager(n),n=p0.oe(n,this.It,i,o.referenceDelegate);return new q0(a,n,r,i).recalculateAndSaveOverlaysForDocumentKeys(new bT(s,ew.at),e).next()})})}}function X0(e){e.createObjectStore("targetDocuments",{keyPath:aT}).createIndex("documentTargetsIndex",oT,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",sT,{unique:!0}),e.createObjectStore("targetGlobal")}const Z0="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class eE{constructor(e,t,n,r,i,s,a,o,c,l,u=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Hs=i,this.window=s,this.document=a,this.Js=c,this.Ys=l,this.Xs=u,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=e=>Promise.resolve(),!eE.C())throw new l_(c_.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new S0(this,r),this.ii=t+"main",this.It=new ST(o),this.ri=new $_(this.ii,this.Xs,new J0(this.It)),this.Cs=new _0(this.referenceDelegate,this.It),this.remoteDocumentCache=x0(this.It),this.Ns=new qT,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===l&&r_("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new l_(c_.FAILED_PRECONDITION,Z0);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new ew(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(t){return this.si=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.ri.L(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>nE(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(t).next(e=>{e||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(t)).next(e=>this.isPrimary&&!e?this._i(t).next(()=>!1):!!e&&this.wi(t).next(()=>!0))).catch(e=>{if(G_(e))return n_("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return n_("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return tE(e).get("owner").next(e=>j_.resolve(this.mi(e)))}gi(e){return nE(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=IT(e,"clientMetadata");return r.W().next(e=>{const t=this.Ii(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return j_.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.oi)for(const t of e)this.oi.removeItem(this.Ti(t.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(t){return this.Ys?j_.resolve(!0):tE(t).get("owner").next(e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)){if(this.mi(e)&&this.networkEnabled)return!0;if(!this.mi(e)){if(!e.allowTabSynchronization)throw new l_(c_.FAILED_PRECONDITION,Z0);return!1}}return!(!this.networkEnabled||!this.inForeground)||nE(t).W().next(e=>void 0===this.Ii(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&n_("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new bT(e,ew.at);return this._i(t).next(()=>this.gi(t))}),this.ri.close(),this.Pi()}Ii(e,t){return e.filter(e=>this.pi(e.updateTimeMs,t)&&!this.Ei(e.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>nE(e).W().next(e=>this.Ii(e,18e5).map(e=>e.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return p0.oe(e,this.It,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new r0(e,this.It.re.databaseId)}getDocumentOverlayCache(e){return jT.oe(this.It,e)}getBundleCache(){return this.Ns}runTransaction(t,n,r){n_("IndexedDbPersistence","Starting transaction:",t);var e,i="readonly"===n?"readonly":"readwrite",e=15===(e=this.Xs)?wT:14===e?_T:13===e?yT:12===e?vT:11===e?mT:void a_();let s;return this.ri.runTransaction(t,i,e,e=>(s=new bT(e,this.Ss?this.Ss.next():ew.at),"readwrite-primary"===n?this.fi(s).next(e=>!!e||this.di(s)).next(e=>{if(!e)throw r_(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new l_(c_.FAILED_PRECONDITION,q_);return r(s)}).next(e=>this.wi(s).next(()=>e)):this.Vi(s).next(()=>r(s)))).then(e=>(s.raiseOnCommittedEvent(),e))}Vi(e){return tE(e).get("owner").next(e=>{if(null!==e&&this.pi(e.leaseTimestampMs,5e3)&&!this.Ei(e.ownerId)&&!this.mi(e)&&!(this.Ys||this.allowTabSynchronization&&e.allowTabSynchronization))throw new l_(c_.FAILED_PRECONDITION,Z0)})}wi(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return tE(e).put("owner",t)}static C(){return $_.C()}_i(e){const t=tE(e);return t.get("owner").next(e=>this.mi(e)?(n_("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):j_.resolve())}pi(e,t){var n=Date.now();return!(e<n-t||n<e&&(r_(`Detected an update time that is in the future: ${e} > ${n}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),!p()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{var n=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return n_("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return r_("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){r_("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function tE(e){return IT(e,"owner")}function nE(e){return IT(e,"clientMetadata")}function rE(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class iE{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Si=n,this.Di=r}static Ci(e,t){let n=dI(),r=dI();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new iE(e,t.fromCache,n,r)}}class sE{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(t,n,r,i){return this.ki(t,n).next(e=>e||this.Mi(t,n,i,r)).next(e=>e||this.Oi(t,n))}ki(i,s){if(pb(s))return j_.resolve(null);let t=yb(s);return this.indexManager.getIndexType(i,t).next(e=>0===e?null:(null!==s.limit&&1===e&&(s=_b(s,null,"F"),t=yb(s)),this.indexManager.getDocumentsMatchingTarget(i,t).next(e=>{const r=dI(...e);return this.Ni.getDocuments(i,r).next(n=>this.indexManager.getMinOffset(i,t).next(e=>{var t=this.Fi(s,n);return this.$i(s,t,r,e.readTime)?this.ki(i,_b(s,null,"F")):this.Bi(i,t,s,e)}))})))}Mi(n,r,i,s){return pb(r)||s.isEqual(E_.min())?this.Oi(n,r):this.Ni.getDocuments(n,i).next(e=>{var t=this.Fi(r,e);return this.$i(r,t,i,s)?this.Oi(n,r):(t_()<=ie.DEBUG&&n_("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Ib(r)),this.Bi(n,t,r,M_(s,-1)))})}Fi(n,e){let r=new ow(kb(n));return e.forEach((e,t)=>{Tb(n,t)&&(r=r.add(t))}),r}$i(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Oi(e,t){return t_()<=ie.DEBUG&&n_("QueryEngine","Using full collection scan to execute query:",Ib(t)),this.Ni.getDocumentsMatchingQuery(e,t,F_.min())}Bi(e,n,t,r){return this.Ni.getDocumentsMatchingQuery(e,t,r).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t))}}class aE{constructor(e,t,n,r){this.persistence=e,this.Li=t,this.It=r,this.Ui=new iw(w_),this.qi=new iI(e=>Ww(e),zw),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(n)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new q0(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ui))}}function oE(e,t,n,r){return new aE(e,t,n,r)}async function cE(e,t){const a=e;return a.persistence.runTransaction("Handle user change","readonly",i=>{let s;return a.mutationQueue.getAllMutationBatches(i).next(e=>(s=e,a.Qi(t),a.mutationQueue.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=dI();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return a.localDocuments.getDocuments(i,r).next(e=>({ji:e,removedBatchIds:t,addedBatchIds:n}))})})}function lE(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Cs.getLastRemoteSnapshotVersion(e))}function uE(e,l){const u=e,h=l.snapshotVersion;let d=u.Ui;return u.persistence.runTransaction("Apply remote event","readwrite-primary",o=>{const e=u.Gi.newChangeBuffer({trackRemovals:!0});d=u.Ui;const c=[];l.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){c.push(u.Cs.removeMatchingKeys(o,t.removedDocuments,n).next(()=>u.Cs.addMatchingKeys(o,t.addedDocuments,n)));let e=r.withSequenceNumber(o.currentSequenceNumber);var i,s,a;l.targetMismatches.has(n)?e=e.withResumeToken(hw.EMPTY_BYTE_STRING,E_.min()).withLastLimboFreeSnapshotVersion(E_.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,h)),d=d.insert(n,e),i=r,s=e,a=t,0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size)||c.push(u.Cs.updateTargetData(o,e))}});let t=sI,n=dI();if(l.documentUpdates.forEach(e=>{l.resolvedLimboDocuments.has(e)&&c.push(u.persistence.referenceDelegate.updateLimboDocument(o,e))}),c.push(hE(o,e,l.documentUpdates).next(e=>{t=e.Wi,n=e.zi})),!h.isEqual(E_.min())){const l=u.Cs.getLastRemoteSnapshotVersion(o).next(e=>u.Cs.setTargetsMetadata(o,o.currentSequenceNumber,h));c.push(l)}return j_.waitFor(c).next(()=>e.apply(o)).next(()=>u.localDocuments.getLocalViewOfDocuments(o,t,n)).next(()=>t)}).then(e=>(u.Ui=d,e))}function hE(e,s,t){let n=dI(),a=dI();return t.forEach(e=>n=n.add(e)),s.getEntries(e,n).next(r=>{let i=sI;return t.forEach((e,t)=>{const n=r.get(e);t.isFoundDocument()!==n.isFoundDocument()&&(a=a.add(e)),t.isNoDocument()&&t.version.isEqual(E_.min())?(s.removeEntry(e,t.readTime),i=i.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(t),i=i.insert(e,t)):n_("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),{Wi:i,zi:a}})}function dE(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.Cs.getTargetData(t,r).next(e=>e?(n=e,j_.resolve(n)):i.Cs.allocateTargetId(t).next(e=>(n=new CT(r,e,0,t.currentSequenceNumber),i.Cs.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.Ui.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.Ui=i.Ui.insert(e.targetId,e),i.qi.set(r,e.targetId)),e})}async function pE(e,t,n){const r=e,i=r.Ui.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!G_(e))throw e;n_("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ui=r.Ui.remove(t),r.qi.delete(i.target)}function fE(e,n,r){const i=e;let s=E_.min(),a=dI();return i.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,i=r.qi.get(n);return void 0!==i?j_.resolve(r.Ui.get(i)):r.Cs.getTargetData(t,n)}(i,t,yb(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.Cs.getMatchingKeysForTargetId(t,e.targetId).next(e=>{a=e})}).next(()=>i.Li.getDocumentsMatchingQuery(t,n,r?s:E_.min(),r?a:dI())).next(e=>(vE(i,Eb(n),e),{documents:e,Hi:a})))}function gE(e,t){const n=e,r=n.Cs,i=n.Ui.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.se(e,t).next(e=>e?e.target:null))}function mE(e,t){const n=e,r=n.Ki.get(t)||E_.min();return n.persistence.runTransaction("Get new document changes","readonly",e=>n.Gi.getAllFromCollectionGroup(e,t,M_(r,-1),Number.MAX_SAFE_INTEGER)).then(e=>(vE(n,t,e),e))}function vE(e,t,n){let r=E_.min();n.forEach((e,t)=>{0<t.readTime.compareTo(r)&&(r=t.readTime)}),e.Ki.set(t,r)}function yE(e,t){return`firestore_clients_${e}_${t}`}function _E(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function wE(e,t){return`firestore_targets_${e}_${t}`}class bE{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Zi(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new l_(r.error.code,r.error.message))),s?new bE(e,t,r.state,i):(r_("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class IE{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Zi(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new l_(n.error.code,n.error.message))),i?new IE(e,n.state,r):(r_("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class TE{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=pI;for(let s=0;r&&s<n.activeTargetIds.length;++s)r=Iw(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new TE(e,i):(r_("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class EE{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new EE(t.clientId,t.onlineState):(r_("SharedClientState",`Failed to parse online state: ${e}`),null)}}class kE{constructor(){this.activeTargetIds=pI}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class CE{constructor(e,t,n,r,i){this.window=e,this.Hs=t,this.persistenceKey=n,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new iw(w_),this.started=!1,this.cr=[];var s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ar=yE(this.persistenceKey,this.sr),this.hr=`firestore_sequence_number_${this.persistenceKey}`,this.ur=this.ur.insert(this.sr,new kE),this.lr=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.wr=`firestore_online_state_${this.persistenceKey}`,this.mr=`firestore_bundle_loaded_v2_${this.persistenceKey}`,this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.vi();for(const n of e)if(n!==this.sr){const e=this.getItem(yE(this.persistenceKey,n));var t;!e||(t=TE.Zi(n,e))&&(this.ur=this.ur.insert(t.clientId,t))}this.gr();const n=this.storage.getItem(this.wr);if(n){const e=this.yr(n);e&&this.pr(e)}for(const e of this.cr)this.rr(e);this.cr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(n){let r=!1;return this.ur.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,n){this.Tr(e,t,n),this.Er(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(wE(this.persistenceKey,e)))||(n=IE.Zi(e,n))&&(t=n.state)),this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(wE(this.persistenceKey,e))}updateQueryState(e,t,n){this.Rr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Er(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return n_("SharedClientState","READ",e,t),t}setItem(e,t){n_("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){n_("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){const i=e;i.storageArea===this.storage&&(n_("SharedClientState","EVENT",i.key,i.newValue),i.key!==this.ar?this.Hs.enqueueRetryable(async()=>{if(this.started){if(null!==i.key)if(this.lr.test(i.key)){if(null==i.newValue){var e=this.vr(i.key);return this.Vr(e,null)}e=this.Sr(i.key,i.newValue);if(e)return this.Vr(e.clientId,e)}else if(this.dr.test(i.key)){if(null!==i.newValue){var t=this.Dr(i.key,i.newValue);if(t)return this.Cr(t)}}else if(this._r.test(i.key)){if(null!==i.newValue){t=this.Nr(i.key,i.newValue);if(t)return this.kr(t)}}else if(i.key===this.wr){if(null!==i.newValue){var n=this.yr(i.newValue);if(n)return this.pr(n)}}else if(i.key===this.hr){n=function(e){let t=ew.at;if(null!=e)try{var n=JSON.parse(e);o_("number"==typeof n),t=n}catch(e){r_("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(i.newValue);n!==ew.at&&this.sequenceNumberHandler(n)}else if(i.key===this.mr){const r=this.Mr(i.newValue);await Promise.all(r.map(e=>this.syncEngine.Or(e)))}}else this.cr.push(i)}):r_("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,n){const r=new bE(this.currentUser,e,t,n),i=_E(this.persistenceKey,this.currentUser,e);this.setItem(i,r.tr())}Er(e){var t=_E(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){var t={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(t))}Rr(e,t,n){const r=wE(this.persistenceKey,e),i=new IE(e,t,n);this.setItem(r,i.tr())}Pr(e){var t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){var t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){var n=this.vr(e);return TE.Zi(n,t)}Dr(e,t){var n=this.dr.exec(e),r=Number(n[1]),n=void 0!==n[2]?n[2]:null;return bE.Zi(new Xy(n),r,t)}Nr(e,t){var n=this._r.exec(e),n=Number(n[1]);return IE.Zi(n,t)}yr(e){return EE.Zi(e)}Mr(e){return JSON.parse(e)}async Cr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Fr(e.batchId,e.state,e.error);n_("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const n=t?this.ur.insert(e,t):this.ur.remove(e),r=this.Ir(this.ur),i=this.Ir(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Br(s,a).then(()=>{this.ur=n})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let n=pI;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class SE{constructor(){this.Lr=new kE,this.Ur={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Lr.er(e),this.Ur[e]||"not-current"}updateQueryState(e,t,n){this.Ur[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.Ur[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new kE,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class AE{qr(e){}shutdown(){}}class NE{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}qr(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){n_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){n_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const RE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class xE{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class DE extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}co(t,e,n,r,i){const s=this.ao(t,e);n_("RestConnection","Sending: ",s,n);var a={};return this.ho(a,r,i),this.lo(t,s,a,n).then(e=>(n_("RestConnection","Received: ",e),e),e=>{throw i_("RestConnection",`${t} failed with error: `,e,"url: ",s,"request:",n),e})}fo(e,t,n,r,i,s){return this.co(e,t,n,r,i)}ho(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+Zy,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}ao(e,t){var n=RE[e];return`${this.oo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}lo(o,t,n,r){return new Promise((i,s)=>{const a=new Yy;a.listenOnce($y.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Ky.NO_ERROR:var e=a.getResponseJson();n_("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Ky.TIMEOUT:n_("Connection",'RPC "'+o+'" timed out'),s(new l_(c_.DEADLINE_EXCEEDED,"Request time out"));break;case Ky.HTTP_ERROR:var t,n=a.getStatus();if(n_("Connection",'RPC "'+o+'" failed with status:',n,"response text:",a.getResponseText()),0<n){const o=a.getResponseJson().error;o&&o.status&&o.message?(r=o.status.toLowerCase().replace(/_/g,"-"),t=0<=Object.values(c_).indexOf(r)?r:c_.UNKNOWN,s(new l_(t,o.message))):s(new l_(c_.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new l_(c_.UNAVAILABLE,"Connection failed."));break;default:a_()}}finally{n_("Connection",'RPC "'+o+'" completed.')}var r});var e=JSON.stringify(r);a.send(t,"POST",e,n,15)})}_o(e,t,n){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=new Ly,s=jy(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new Hy({})),this.ho(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;var o=r.join("");n_("Connection","Creating WebChannel: "+o,a);const c=i.createWebChannel(o,a);let l=!1,u=!1;const h=new xE({Hr:e=>{u?n_("Connection","Not sending because WebChannel is closed:",e):(l||(n_("Connection","Opening WebChannel transport."),c.open(),l=!0),n_("Connection","WebChannel sending:",e),c.send(e))},Jr:()=>c.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return d(c,Qy.EventType.OPEN,()=>{u||n_("Connection","WebChannel transport opened.")}),d(c,Qy.EventType.CLOSE,()=>{u||(u=!0,n_("Connection","WebChannel transport closed"),h.io())}),d(c,Qy.EventType.ERROR,e=>{u||(u=!0,i_("Connection","WebChannel transport errored:",e),h.io(new l_(c_.UNAVAILABLE,"The operation could not be completed")))}),d(c,Qy.EventType.MESSAGE,n=>{if(!u){var e=n.data[0];o_(!!e);var r=e.error||(null===(r=e[0])||void 0===r?void 0:r.error);if(r){n_("Connection","WebChannel received error:",r);const n=r.status;let e=function(e){var t=By[e];if(void 0!==t)return rI(t)}(n),t=r.message;void 0===e&&(e=c_.INTERNAL,t="Unknown error status: "+n+" with message "+r.message),u=!0,h.io(new l_(e,t)),c.close()}else n_("Connection","WebChannel received:",e),h.ro(e)}}),d(s,Wy.STAT_EVENT,e=>{e.stat===zy?n_("Connection","Detected buffering proxy"):e.stat===Gy&&n_("Connection","Detected no buffering proxy")}),setTimeout(()=>{h.so()},0),h}}function PE(){return"undefined"!=typeof window?window:null}function OE(){return"undefined"!=typeof document?document:null}function ME(e){return new kI(e,!0)}class LE{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Hs=e,this.timerId=t,this.wo=n,this.mo=r,this.yo=i,this.po=0,this.Io=null,this.To=Date.now(),this.reset()}reset(){this.po=0}Eo(){this.po=this.yo}Ao(e){this.cancel();var t=Math.floor(this.po+this.Ro()),n=Math.max(0,Date.now()-this.To),r=Math.max(0,t-n);0<r&&n_("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.po} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Io=this.Hs.enqueueAfterDelay(this.timerId,r,()=>(this.To=Date.now(),e())),this.po*=this.mo,this.po<this.wo&&(this.po=this.wo),this.po>this.yo&&(this.po=this.yo)}bo(){null!==this.Io&&(this.Io.skipDelay(),this.Io=null)}cancel(){null!==this.Io&&(this.Io.cancel(),this.Io=null)}Ro(){return(Math.random()-.5)*this.po}}class FE{constructor(e,t,n,r,i,s,a,o){this.Hs=e,this.Po=n,this.vo=r,this.Vo=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new LE(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Mo()}async stop(){this.No()&&await this.close(0)}Oo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.Po,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.Uo(),this.xo.cancel(),this.So++,4!==e?this.xo.reset():t&&t.code===c_.RESOURCE_EXHAUSTED?(r_(t.toString()),r_("Using maximum backoff delay to prevent overloading the backend."),this.xo.Eo()):t&&t.code===c_.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.qo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}qo(){}auth(){this.state=1;const e=this.Ko(this.So),n=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.So===n&&this.Go(e,t)},t=>{e(()=>{var e=new l_(c_.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Qo(e)})})}Go(e,t){const n=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{n(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(e=>{n(()=>this.Qo(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Mo(){this.state=5,this.xo.Ao(async()=>{this.state=0,this.start()})}Qo(e){return n_("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(t){return e=>{this.Hs.enqueueAndForget(()=>this.So===t?e():(n_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class UE extends FE{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.It=i}jo(e,t){return this.Vo._o("Listen",e,t)}onMessage(e){this.xo.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(p=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===p?1:"REMOVE"===p?2:"CURRENT"===p?3:"RESET"===p?4:a_(),i=t.targetChange.targetIds||[],s=(p=t.targetChange.resumeToken,e.gt?(o_(void 0===p||"string"==typeof p),hw.fromBase64String(p||"")):(o_(void 0===p||p instanceof Uint8Array),hw.fromUint8Array(p||new Uint8Array))),a=t.targetChange.cause,o=a&&(o=void 0===(p=a).code?c_.UNKNOWN:rI(p.code),new l_(o,p.message||""));n=new yI(r,i,s,o||null)}else if("documentChange"in t){t.documentChange;var c=t.documentChange;c.document,c.document.name,c.document.updateTime;var o=DI(e,c.document.name),l=AI(c.document.updateTime),u=new Bw({mapValue:{fields:c.document.fields}}),l=jw.newFoundDocument(o,l,u),u=c.targetIds||[],c=c.removedTargetIds||[];n=new mI(u,c,l.key,l)}else if("documentDelete"in t){t.documentDelete;u=t.documentDelete;u.document;c=DI(e,u.document),l=u.readTime?AI(u.readTime):E_.min(),l=jw.newNoDocument(c,l),u=u.removedTargetIds||[];n=new mI([],u,l.key,l)}else if("documentRemove"in t){t.documentRemove;var h=t.documentRemove;h.document;var d=DI(e,h.document),h=h.removedTargetIds||[];n=new mI([],h,d,null)}else{if(!("filter"in t))return a_();{t.filter;const e=t.filter;e.targetId;h=e.count||0,d=new tI(h),h=e.targetId;n=new vI(h,d)}}var o,p;return n}(this.It,e),n=function(e){if(!("targetChange"in e))return E_.min();var t=e.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?AI(t.readTime):E_.min()}(e);return this.listener.Wo(t,n)}zo(e){const t={};t.database=MI(this.It),t.addTarget=function(e,t){let n;var r=t.target;return n=Gw(r)?{documents:BI(e,r)}:{query:jI(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=SI(e,t.resumeToken):0<t.snapshotVersion.compareTo(E_.min())&&(n.readTime=CI(e,t.snapshotVersion.toTimestamp())),n}(this.It,e);var n,r,r=(this.It,n=e,null==(r=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return a_()}}())?null:{"goog-listen-tags":r});r&&(t.labels=r),this.Bo(t)}Ho(e){const t={};t.database=MI(this.It),t.removeTarget=e,this.Bo(t)}}class qE extends FE{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.It=i,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}qo(){this.Jo&&this.Xo([])}jo(e,t){return this.Vo._o("Write",e,t)}onMessage(e){if(o_(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();var t=(r=e.writeResults,i=e.commitTime,r&&0<r.length?(o_(void 0!==i),r.map(e=>function(e,t){let n=e.updateTime?AI(e.updateTime):AI(t);return n.isEqual(E_.min())&&(n=AI(t)),new Vb(n,e.transformResults||[])}(e,i))):[]),n=AI(e.commitTime);return this.listener.Zo(n,t)}var r,i;return o_(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=MI(this.It),this.Bo(e)}Xo(e){var t={streamToken:this.lastStreamToken,writes:e.map(e=>qI(this.It,e))};this.Bo(t)}}class VE extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.Vo=n,this.It=r,this.nu=!1}su(){if(this.nu)throw new l_(c_.FAILED_PRECONDITION,"The client has already been terminated.")}co(n,r,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.Vo.co(n,r,i,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===c_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new l_(c_.UNKNOWN,e.toString())})}fo(n,r,i,s){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.Vo.fo(n,r,i,e,t,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===c_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new l_(c_.UNKNOWN,e.toString())})}terminate(){this.nu=!0}}class BE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,1<=this.iu&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){var t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(r_(t),this.ou=!1):n_("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class jE{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=i,this.mu.qr(e=>{n.enqueueAndForget(async()=>{JE(this)&&(n_("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t._u.add(4),await $E(t),t.gu.set("Unknown"),t._u.delete(4),await KE(t)}(this))})}),this.gu=new BE(n,r)}}async function KE(e){if(JE(e))for(const t of e.wu)await t(!0)}async function $E(e){for(const t of e.wu)await t(!1)}function WE(e,t){const n=e;n.du.has(t.targetId)||(n.du.set(t.targetId,t),YE(n)?QE(n):ak(n).ko()&&GE(n,t))}function zE(e,t){const n=e,r=ak(n);n.du.delete(t),r.ko()&&HE(n,t),0===n.du.size&&(r.ko()?r.Fo():JE(n)&&n.gu.set("Unknown"))}function GE(e,t){e.yu.Ot(t.targetId),ak(e).zo(t)}function HE(e,t){e.yu.Ot(t),ak(e).Ho(t)}function QE(t){t.yu=new wI({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),se:e=>t.du.get(e)||null}),ak(t).start(),t.gu.uu()}function YE(e){return JE(e)&&!ak(e).No()&&0<e.du.size}function JE(e){return 0===e._u.size}function XE(e){e.yu=void 0}async function ZE(e,t,n){if(!G_(t))throw t;e._u.add(1),await $E(e),e.gu.set("Offline"),n=n||(()=>lE(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{n_("RemoteStore","Retrying IndexedDB access"),await n(),e._u.delete(1),await KE(e)})}function ek(t,n){return n().catch(e=>ZE(t,e,n))}async function tk(e){const t=e,n=ok(t);let r=0<t.fu.length?t.fu[t.fu.length-1].batchId:-1;for(;JE(i=t)&&i.fu.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.fu.length&&n.Fo();break}r=e.batchId,function(e,t){e.fu.push(t);const n=ok(e);n.ko()&&n.Yo&&n.Xo(t.mutations)}(t,e)}catch(e){await ZE(t,e)}var i;nk(t)&&rk(t)}function nk(e){return JE(e)&&!ok(e).No()&&0<e.fu.length}function rk(e){ok(e).start()}async function ik(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),n_("RemoteStore","RemoteStore received new credentials");var r=JE(n);n._u.add(3),await $E(n),r&&n.gu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n._u.delete(3),await KE(n)}async function sk(e,t){const n=e;t?(n._u.delete(2),await KE(n)):(n._u.add(2),await $E(n),n.gu.set("Unknown"))}function ak(t){return t.pu||(t.pu=function(e,t,n){const r=e;return r.su(),new UE(t,r.Vo,r.authCredentials,r.appCheckCredentials,r.It,n)}(t.datastore,t.asyncQueue,{Yr:(async function(n){n.du.forEach((e,t)=>{GE(n,e)})}).bind(null,t),Zr:(async function(e,t){XE(e),YE(e)?(e.gu.hu(t),QE(e)):e.gu.set("Unknown")}).bind(null,t),Wo:(async function(e,r,t){if(e.gu.set("Online"),r instanceof yI&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.du.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.du.delete(n),e.yu.removeTarget(n))}(e)}catch(t){n_("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await ZE(e,t)}else if(r instanceof mI?e.yu.Gt(r):r instanceof vI?e.yu.Yt(r):e.yu.Wt(r),!t.isEqual(E_.min()))try{const r=await lE(e.localStore);0<=t.compareTo(r)&&await function(r,i){const e=r.yu.te(i);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.du.get(t);n&&r.du.set(t,n.withResumeToken(e.resumeToken,i))}}),e.targetMismatches.forEach(e=>{const t=r.du.get(e);var n;t&&(r.du.set(e,t.withResumeToken(hw.EMPTY_BYTE_STRING,t.snapshotVersion)),HE(r,e),n=new CT(t.target,e,1,t.sequenceNumber),GE(r,n))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){n_("RemoteStore","Failed to raise snapshot:",r),await ZE(e,r)}}).bind(null,t)}),t.wu.push(async e=>{e?(t.pu.Oo(),YE(t)?QE(t):t.gu.set("Unknown")):(await t.pu.stop(),XE(t))})),t.pu}function ok(t){return t.Iu||(t.Iu=function(e,t,n){const r=e;return r.su(),new qE(t,r.Vo,r.authCredentials,r.appCheckCredentials,r.It,n)}(t.datastore,t.asyncQueue,{Yr:(async function(e){ok(e).eu()}).bind(null,t),Zr:(async function(e,t){t&&ok(e).Yo&&await async function(e,t){if(nI(n=t.code)&&n!==c_.ABORTED){const n=e.fu.shift();ok(e).Oo(),await ek(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await tk(e)}var n}(e,t),nk(e)&&rk(e)}).bind(null,t),tu:(async function(e){const t=ok(e);for(const n of e.fu)t.Xo(n.mutations)}).bind(null,t),Zo:(async function(e,t,n){const r=e.fu.shift(),i=ET.from(r,t,n);await ek(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await tk(e)}).bind(null,t)}),t.wu.push(async e=>{e?(t.Iu.Oo(),await tk(t)):(await t.Iu.stop(),0<t.fu.length&&(n_("RemoteStore",`Stopping write stream with ${t.fu.length} pending writes`),t.fu=[]))})),t.Iu}class ck{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new u_,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,a=new ck(e,t,s,r,i);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new l_(c_.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function lk(e,t){if(r_("AsyncQueue",`${t}: ${e}`),G_(e))return new l_(c_.UNAVAILABLE,`${t}: ${e}`);throw e}class uk{constructor(n){this.comparator=n?(e,t)=>n(e,t)||N_.comparator(e.key,t.key):(e,t)=>N_.comparator(e.key,t.key),this.keyedMap=oI(),this.sortedSet=new iw(this.comparator)}static emptySet(e){return new uk(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof uk))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new uk;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class hk{constructor(){this.Tu=new iw(N_.comparator)}track(e){var t=e.doc.key,n=this.Tu.get(t);!n||0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):a_()}Eu(){const n=[];return this.Tu.inorderTraversal((e,t)=>{n.push(t)}),n}}class dk{constructor(e,t,n,r,i,s,a,o){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new dk(e,t,uk.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&wb(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class pk{constructor(){this.Au=void 0,this.listeners=[]}}class fk{constructor(){this.queries=new iI(e=>bb(e),wb),this.onlineState="Unknown",this.Ru=new Set}}async function gk(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new pk),i)try{s.Au=await n.onListen(r)}catch(e){const n=lk(e,`Initialization of query '${Ib(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.bu(n.onlineState),!s.Au||t.Pu(s.Au)&&vk(n)}async function mk(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function vk(e){e.Ru.forEach(e=>{e.next()})}class yk{constructor(e,t,n){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=n||{}}Pu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new dk(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||!(this.options.Nu&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}Du(e){if(0<e.docChanges.length)return!0;var t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}xu(e){e=dk.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.Vu=!0,this.vu.next(e)}}class _k{constructor(e,t){this.payload=e,this.byteLength=t}ku(){return"metadata"in this.payload}}class wk{constructor(e){this.It=e}Ji(e){return DI(this.It,e)}Yi(e){return e.metadata.exists?UI(this.It,e.document,!1):jw.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return AI(e)}}class bk{constructor(e,t,n){this.Mu=e,this.localStore=t,this.It=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Ik(e)}Ou(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;const n=C_.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Fu(e){const t=new Map,n=new wk(this.It);for(const i of e)if(i.metadata.queries){const e=n.Ji(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||dI()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=dI(),a=sI;for(const e of n){const n=t.Ji(e.metadata.name);e.document&&(s=s.add(n));const l=t.Yi(e);l.setReadTime(t.Xi(e.metadata.readTime)),a=a.insert(n,l)}const o=i.Gi.newChangeBuffer({trackRemovals:!0}),c=await dE(i,(r=r,yb(db(C_.fromString(`__bundle__/docs/${r}`)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>hE(t,o,a).next(e=>(o.apply(t),e)).next(e=>i.Cs.removeMatchingKeysForTargetId(t,c.targetId).next(()=>i.Cs.addMatchingKeys(t,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(t,e.Wi,e.zi)).next(()=>e.Wi)))}(this.localStore,new wk(this.It),this.documents,this.Mu.id),t=this.Fu(this.documents);for(const e of this.queries)await async function(e,n,r=dI()){const i=await dE(e,yb(MT(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=AI(n.readTime);if(0<=i.snapshotVersion.compareTo(t))return s.Ns.saveNamedQuery(e,n);t=i.withResumeToken(hw.EMPTY_BYTE_STRING,t);return s.Ui=s.Ui.insert(t.targetId,t),s.Cs.updateTargetData(e,t).next(()=>s.Cs.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.Cs.addMatchingKeys(e,r,i.targetId)).next(()=>s.Ns.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,$u:this.collectionGroups,Bu:e}}}function Ik(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Tk{constructor(e){this.key=e}}class Ek{constructor(e){this.key=e}}class kk{constructor(e,t){this.query=e,this.Lu=t,this.Uu=null,this.current=!1,this.qu=dI(),this.mutatedKeys=dI(),this.Ku=kb(e),this.Gu=new uk(this.Ku)}get Qu(){return this.Lu}ju(e,t){const o=t?t.Wu:new hk,c=(t||this).Gu;let l=(t||this).mutatedKeys,u=c,h=!1;const d="F"===this.query.limitType&&c.size===this.query.limit?c.last():null,p="L"===this.query.limitType&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((e,t)=>{const n=c.get(e),r=Tb(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let a=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(o.track({type:3,doc:r}),a=!0):this.zu(n,r)||(o.track({type:2,doc:r}),a=!0,(d&&0<this.Ku(r,d)||p&&this.Ku(r,p)<0)&&(h=!0)):!n&&r?(o.track({type:0,doc:r}),a=!0):n&&!r&&(o.track({type:1,doc:n}),a=!0,(d||p)&&(h=!0)),a&&(l=r?(u=u.add(r),s?l.add(e):l.delete(e)):(u=u.delete(e),l.delete(e)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const e="F"===this.query.limitType?u.last():u.first();u=u.delete(e.key),l=l.delete(e.key),o.track({type:1,doc:e})}return{Gu:u,Wu:o,$i:h,mutatedKeys:l}}zu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.Gu;this.Gu=e.Gu,this.mutatedKeys=e.mutatedKeys;const i=e.Wu.Eu();i.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return a_()}};return n(e)-n(t)}(e.type,t.type)||this.Ku(e.doc,t.doc)),this.Hu(n);var s=t?this.Ju():[],a=0===this.qu.size&&this.current?1:0,o=a!==this.Uu;return this.Uu=a,0!==i.length||o?{snapshot:new dk(this.query,e.Gu,r,i,e.mutatedKeys,0==a,o,!1),Yu:s}:{Yu:s}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Gu:this.Gu,Wu:new hk,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Yu:[]}}Xu(e){return!this.Lu.has(e)&&!!this.Gu.has(e)&&!this.Gu.get(e).hasLocalMutations}Hu(e){e&&(e.addedDocuments.forEach(e=>this.Lu=this.Lu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Lu=this.Lu.delete(e)),this.current=e.current)}Ju(){if(!this.current)return[];const t=this.qu;this.qu=dI(),this.Gu.forEach(e=>{this.Xu(e.key)&&(this.qu=this.qu.add(e.key))});const n=[];return t.forEach(e=>{this.qu.has(e)||n.push(new Ek(e))}),this.qu.forEach(e=>{t.has(e)||n.push(new Tk(e))}),n}Zu(e){this.Lu=e.Hi,this.qu=dI();var t=this.ju(e.documents);return this.applyChanges(t,!0)}tc(){return dk.fromInitialDocuments(this.query,this.Gu,this.mutatedKeys,0===this.Uu)}}class Ck{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Sk{constructor(e){this.key=e,this.ec=!1}}class Ak{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.nc={},this.sc=new iI(e=>bb(e),wb),this.ic=new Map,this.rc=new Set,this.oc=new iw(N_.comparator),this.uc=new Map,this.cc=new j0,this.ac={},this.hc=new Map,this.lc=y0.vn(),this.onlineState="Unknown",this.fc=void 0}get isPrimaryClient(){return!0===this.fc}}async function Nk(n,e,t,r){n.dc=(e,s,t)=>async function(e,t,n){let r=t.view.ju(s);r.$i&&(r=await fE(e.localStore,t.query,!1).then(({documents:e})=>t.view.ju(e,r)));var i=n&&n.targetChanges.get(t.targetId),i=t.view.applyChanges(r,e.isPrimaryClient,i);return Uk(e,t.targetId,i.Yu),i.snapshot}(n,e,t);const i=await fE(n.localStore,e,!0),s=new kk(e,i.Hi),a=s.ju(i.documents),o=gI.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),c=s.applyChanges(a,n.isPrimaryClient,o);Uk(n,t,c.Yu);var l=new Ck(e,t,s);return n.sc.set(e,l),n.ic.has(t)?n.ic.get(t).push(e):n.ic.set(t,[e]),c.snapshot}async function Rk(e,t,n){const r=Wk(e);try{const e=await function(e,i){const s=e,a=T_.now(),o=i.reduce((e,t)=>e.add(t.key),dI());let c,l;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>{let t=sI,r=dI();return s.Gi.getEntries(n,o).next(e=>{t=e,t.forEach((e,t)=>{t.isValidDocument()||(r=r.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(n,t)).next(e=>{c=e;const t=[];for(const n of i){const i=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Rb(r.transform,e||null);null!=i&&(null===n&&(n=Bw.empty()),n.set(r.field,i))}return n||null}(n,c.get(n.key).overlayedDocument);null!=i&&t.push(new Qb(n.key,i,function r(e){const i=[];return nw(e.fields,(e,t)=>{const n=new A_([e]);if(Lw(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new uw(i)}(i.value.mapValue),Bb.exists(!0)))}return s.mutationQueue.addMutationBatch(n,a,t,i)}).next(e=>{var t=(l=e).applyToLocalDocumentSet(c,r);return s.documentOverlayCache.saveOverlays(n,e.batchId,t)})}).then(()=>({batchId:l.batchId,changes:cI(c)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.ac[e.currentUser.toKey()];r=r||new iw(w_),r=r.insert(t,n),e.ac[e.currentUser.toKey()]=r}(r,e.batchId,n),await Vk(r,e.changes),await tk(r.remoteStore)}catch(e){const t=lk(e,"Failed to persist write");n.reject(t)}}async function xk(e,t){const r=e;try{const e=await uE(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.uc.get(t);n&&(o_(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.ec=!0:0<e.modifiedDocuments.size?o_(n.ec):0<e.removedDocuments.size&&(o_(n.ec),n.ec=!1))}),await Vk(r,e,t)}catch(e){await B_(e)}}function Dk(r,i,e){const t=r;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const r=[];t.sc.forEach((e,t)=>{var n=t.view.bu(i);n.snapshot&&r.push(n.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.bu(n)&&(r=!0)}),r&&vk(t)}(t.eventManager,i),r.length&&t.nc.Wo(r),t.onlineState=i,t.isPrimaryClient&&t.sharedClientState.setOnlineState(i)}}async function Pk(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.Gi.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let a=j_.resolve();return n.forEach(n=>{a=a.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);o_(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),i.addEntry(e)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,t,r.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=dI();for(let n=0;n<e.mutationResults.length;++n)0<e.mutationResults[n].transformResults.length&&(t=t.add(e.batch.mutations[n].key));return t}(r))).next(()=>i.localDocuments.getDocuments(e,t))})}(n.localStore,t);Mk(n,r,null),Ok(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Vk(n,e)}catch(e){await B_(e)}}function Ok(e,t){(e.hc.get(t)||[]).forEach(e=>{e.resolve()}),e.hc.delete(t)}function Mk(e,t,n){const r=e;let i=r.ac[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.ac[r.currentUser.toKey()]=i}}function Lk(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.ic.get(e))t.sc.delete(r),n&&t.nc._c(r,n);t.ic.delete(e),t.isPrimaryClient&&t.cc.ls(e).forEach(e=>{t.cc.containsKey(e)||Fk(t,e)})}function Fk(e,t){e.rc.delete(t.path.canonicalString());var n=e.oc.get(t);null!==n&&(zE(e.remoteStore,n),e.oc=e.oc.remove(t),e.uc.delete(n),qk(e))}function Uk(e,t,n){for(const r of n)r instanceof Tk?(e.cc.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.oc.get(n)||e.rc.has(r)||(n_("SyncEngine","New document in limbo: "+n),e.rc.add(r),qk(e))}(e,r)):r instanceof Ek?(n_("SyncEngine","Document no longer in limbo: "+r.key),e.cc.removeReference(r.key,t),e.cc.containsKey(r.key)||Fk(e,r.key)):a_()}function qk(e){for(;0<e.rc.size&&e.oc.size<e.maxConcurrentLimboResolutions;){var t=e.rc.values().next().value;e.rc.delete(t);var n=new N_(C_.fromString(t)),t=e.lc.next();e.uc.set(t,new Sk(n)),e.oc=e.oc.insert(n,t),WE(e.remoteStore,new CT(yb(db(n.path)),t,2,ew.at))}}async function Vk(e,t,r){const i=e,s=[],a=[],o=[];i.sc.isEmpty()||(i.sc.forEach((e,n)=>{o.push(i.dc(n,t,r).then(e=>{var t;e&&(i.isPrimaryClient&&i.sharedClientState.updateQueryState(n.targetId,e.fromCache?"not-current":"current"),s.push(e),t=iE.Ci(n.targetId,e),a.push(t))}))}),await Promise.all(o),i.nc.Wo(s),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>j_.forEach(t,t=>j_.forEach(t.Si,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>j_.forEach(t.Di,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!G_(e))throw e;n_("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Ui.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.Ui=r.Ui.insert(t,i)}}}(i.localStore,a))}async function Bk(r,e){const i=r;if($k(i),Wk(i),!0===e&&!0!==i.fc){const r=i.sharedClientState.getAllActiveQueryTargets(),e=await jk(i,r.toArray());i.fc=!0,await sk(i.remoteStore,!0);for(const r of e)WE(i.remoteStore,r)}else if(!1===e&&!1!==i.fc){const r=[];let n=Promise.resolve();i.ic.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(Lk(i,t),pE(i.localStore,t,!0))),zE(i.remoteStore,t)}),await n,await jk(i,r),function(){const n=i;n.uc.forEach((e,t)=>{zE(n.remoteStore,t)}),n.cc.fs(),n.uc=new Map,n.oc=new iw(N_.comparator)}(),i.fc=!1,await sk(i.remoteStore,!1)}}async function jk(t,n){const r=t,i=[],s=[];for(const t of n){let e;const u=r.ic.get(t);if(u&&0!==u.length){e=await dE(r.localStore,yb(u[0]));for(const t of u){const n=r.sc.get(t),u=(a=r,o=n,l=c=void 0,l=await fE((c=a).localStore,o.query,!0),l=o.view.Zu(l),c.isPrimaryClient&&Uk(c,o.targetId,l.Yu),await l);u.snapshot&&s.push(u.snapshot)}}else{const u=await gE(r.localStore,t);e=await dE(r.localStore,u),await Nk(r,Kk(u),t,!1)}i.push(e)}var a,o,c,l;return r.nc.Wo(s),i}function Kk(e){return hb(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function $k(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=xk.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=(function(e,t){const n=e,r=n.uc.get(t);if(r&&r.ec)return dI().add(r.key);{let e=dI();const r=n.ic.get(t);if(!r)return e;for(const t of r){const r=n.sc.get(t);e=e.unionWith(r.view.Qu)}return e}}).bind(null,t),t.remoteStore.remoteSyncer.rejectListen=(async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.uc.get(t),s=i&&i.key;if(s){let e=new iw(N_.comparator);e=e.insert(s,jw.newNoDocument(s,E_.min()));const n=dI().add(s),i=new fI(E_.min(),new Map,new ow(w_),e,n);await xk(r,i),r.oc=r.oc.remove(s),r.uc.delete(t),qk(r)}else await pE(r.localStore,t,!1).then(()=>Lk(r,t,n)).catch(B_)}).bind(null,t),t.nc.Wo=(function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Pu(e)&&(r=!0);i.Au=e}}r&&vk(n)}).bind(null,t.eventManager),t.nc._c=(function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}).bind(null,t.eventManager),t}function Wk(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=Pk.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=(async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i.mutationQueue.lookupMutationBatch(t,r).next(e=>(o_(null!==e),n=e.keys(),i.mutationQueue.removeMutationBatch(t,e))).next(()=>i.mutationQueue.performConsistencyCheck(t)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(t,n,r)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,n)).next(()=>i.localDocuments.getDocuments(t,n))})}(r.localStore,t);Mk(r,t,n),Ok(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Vk(r,e)}catch(n){await B_(n)}}).bind(null,t),t}class zk{constructor(){this.synchronizeTabs=!1}async initialize(e){this.It=ME(e.databaseInfo.databaseId),this.sharedClientState=this.mc(e),this.persistence=this.gc(e),await this.persistence.start(),this.localStore=this.yc(e),this.gcScheduler=this.Ic(e,this.localStore),this.indexBackfillerScheduler=this.Tc(e,this.localStore)}Ic(e,t){return null}Tc(e,t){return null}yc(e){return oE(this.persistence,new sE,e.initialUser,this.It)}gc(e){return new H0(Y0.Bs,this.It)}mc(e){return new SE}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Gk extends zk{constructor(e,t,n){super(),this.Ec=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ec.initialize(this,e),await Wk(this.Ec.syncEngine),await tk(this.Ec.remoteStore),await this.persistence.li(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}yc(e){return oE(this.persistence,new sE,e.initialUser,this.It)}Ic(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new k0(n,e.asyncQueue,t)}Tc(e,t){var n=new Z_(t,this.persistence);return new X_(e.asyncQueue,n)}gc(e){var t=rE(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?u0.withCacheSize(this.cacheSizeBytes):u0.DEFAULT;return new eE(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,PE(),OE(),this.It,this.sharedClientState,!!this.forceOwnership)}mc(e){return new SE}}class Hk extends Gk{constructor(e,t){super(e,t,!1),this.Ec=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.Ec.syncEngine;this.sharedClientState instanceof CE&&(this.sharedClientState.syncEngine={Fr:(async function(e,t,n,r){var i=e,s=await function(e,n){const r=e,i=r.mutationQueue;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.Tn(t,n).next(e=>e?r.localDocuments.getDocuments(t,e):j_.resolve(null)))}(i.localStore,t);null!==s?("pending"===n?await tk(i.remoteStore):"acknowledged"===n||"rejected"===n?(Mk(i,t,r||null),Ok(i,t),i.localStore.mutationQueue.An(t)):a_(),await Vk(i,s)):n_("SyncEngine","Cannot apply mutation batch with id: "+t)}).bind(null,t),$r:(async function(e,t,n,r){const i=e;if(i.fc)n_("SyncEngine","Ignoring unexpected query state notification.");else{var s=i.ic.get(t);if(s&&0<s.length)switch(n){case"current":case"not-current":{const e=await mE(i.localStore,Eb(s[0])),r=fI.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await Vk(i,e,r);break}case"rejected":await pE(i.localStore,t,!0),Lk(i,t,r);break;default:a_()}}}).bind(null,t),Br:(async function(e,t,n){const r=$k(e);if(r.fc){for(const e of t)if(r.ic.has(e))n_("SyncEngine","Adding an already active target "+e);else{const t=await gE(r.localStore,e),n=await dE(r.localStore,t);await Nk(r,Kk(t),n.targetId,!1),WE(r.remoteStore,n)}for(const e of n)r.ic.has(e)&&await pE(r.localStore,e,!1).then(()=>{zE(r.remoteStore,e),Lk(r,e)}).catch(B_)}}).bind(null,t),vi:(function(e){return e.localStore.persistence.vi()}).bind(null,t),Or:(async function(e,t){const n=e;return mE(n.localStore,t).then(e=>Vk(n,e))}).bind(null,t)},await this.sharedClientState.start()),await this.persistence.li(async e=>{await Bk(this.Ec.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}mc(e){var t=PE();if(!CE.C(t))throw new l_(c_.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=rE(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new CE(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Qk{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Dk(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=(async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){n_("SyncEngine","User change. New user:",t.toKey());const r=await cE(n.localStore,t);n.currentUser=t,(e=n).hc.forEach(e=>{e.forEach(e=>{e.reject(new l_(c_.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.hc.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await Vk(n,r.ji)}}).bind(null,this.syncEngine),await sk(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new fk}createDatastore(e){var t,n,r,i,s=ME(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new DE(t));return n=e.authCredentials,r=e.appCheckCredentials,i=t,e=s,new VE(n,r,i,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Dk(this.syncEngine,e,0),s=new(NE.C()?NE:AE),new jE(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){const o=new Ak(e,t,n,r,i,s);return a&&(o.fc=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;n_("RemoteStore","RemoteStore shutting down."),t._u.add(5),await $E(t),t.mu.shutdown(),t.gu.set("Unknown")}(this.remoteStore)}}function Yk(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Jk{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ac(this.observer.next,e)}error(e){this.observer.error?this.Ac(this.observer.error,e):r_("Uncaught Error in snapshot listener:",e)}Rc(){this.muted=!0}Ac(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Xk{constructor(e,t){this.bc=e,this.It=t,this.metadata=new u_,this.buffer=new Uint8Array,this.Pc=new TextDecoder("utf-8"),this.vc().then(e=>{e&&e.ku()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.bc.cancel()}async getMetadata(){return this.metadata.promise}async wc(){return await this.getMetadata(),this.vc()}async vc(){var e=await this.Vc();if(null===e)return null;var t=this.Pc.decode(e),n=Number(t);isNaN(n)&&this.Sc(`length string (${t}) is not valid number`);t=await this.Dc(n);return new _k(JSON.parse(t),e.length+n)}Cc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Vc(){for(;this.Cc()<0&&!await this.xc(););if(0===this.buffer.length)return null;var e=this.Cc();e<0&&this.Sc("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Dc(e){for(;this.buffer.length<e;)await this.xc()&&this.Sc("Reached the end of bundle when more is expected.");var t=this.Pc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Sc(e){throw this.bc.cancel(),new Error(`Invalid bundle format: ${e}`)}async xc(){var e=await this.bc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Zk{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new l_(c_.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=MI(r.It)+"/documents",i={documents:t.map(e=>xI(r.It,e))},s=await r.fo("BatchGetDocuments",n,i,t.length),a=new Map;s.forEach(e=>{const t=(n=r.It,"found"in(e=e)?function(e,t){o_(!!t.found),t.found.name,t.found.updateTime;var n=DI(e,t.found.name),r=AI(t.found.updateTime),i=new Bw({mapValue:{fields:t.found.fields}});return jw.newFoundDocument(n,r,i)}(n,e):"missing"in e?function(e,t){o_(!!t.missing),o_(!!t.readTime);var n=DI(e,t.missing),r=AI(t.readTime);return jw.newNoDocument(n,r)}(n,e):a_());var n;a.set(t.key.toString(),t)});const o=[];return t.forEach(e=>{var t=a.get(e.toString());o_(!!t),o.push(t)}),o}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Zb(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{var n=N_.fromPath(t);this.mutations.push(new eI(n,this.precondition(n)))}),await async function(e,t){const n=e,r=MI(n.It)+"/documents",i={writes:t.map(e=>qI(n.It,e))};await n.co("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw a_();t=E_.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new l_(c_.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(E_.min())?Bb.exists(!1):Bb.updateTime(t):Bb.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return Bb.exists(!0);if(t.isEqual(E_.min()))throw new l_(c_.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Bb.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class eC{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.Nc=n.maxAttempts,this.xo=new LE(this.asyncQueue,"transaction_retry")}run(){--this.Nc,this.kc()}kc(){this.xo.Ao(async()=>{const t=new Zk(this.datastore),e=this.Mc(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.Oc(e)}))}).catch(e=>{this.Oc(e)})})}Mc(e){try{var t=this.updateFunction(e);return!ww(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Oc(e){0<this.Nc&&this.Fc(e)?(--this.Nc,this.asyncQueue.enqueueAndForget(()=>(this.kc(),Promise.resolve()))):this.deferred.reject(e)}Fc(e){if("FirebaseError"!==e.name)return!1;var t=e.code;return"aborted"===t||"failed-precondition"===t||!nI(t)}}class tC{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Xy.UNAUTHENTICATED,this.clientId=__.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{n_("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(n_("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new l_(c_.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new u_;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=lk(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function nC(e,t){e.asyncQueue.verifyOperationInProgress(),n_("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await cE(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function rC(e,n){e.asyncQueue.verifyOperationInProgress();var t=await iC(e);n_("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await n.initialize(t,r),e.setCredentialChangeListener(e=>ik(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>ik(n.remoteStore,t)),e.onlineComponents=n}async function iC(e){return e.offlineComponents||(n_("FirestoreClient","Using default OfflineComponentProvider"),await nC(e,new zk)),e.offlineComponents}async function sC(e){return e.onlineComponents||(n_("FirestoreClient","Using default OnlineComponentProvider"),await rC(e,new Qk)),e.onlineComponents}function aC(e){return iC(e).then(e=>e.persistence)}function oC(e){return iC(e).then(e=>e.localStore)}function cC(e){return sC(e).then(e=>e.remoteStore)}function lC(e){return sC(e).then(e=>e.syncEngine)}async function uC(e){const t=await sC(e),n=t.eventManager;return n.onListen=(async function(e,t){const n=$k(e);let r,i;const s=n.sc.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.tc();else{const e=await dE(n.localStore,yb(t));n.isPrimaryClient&&WE(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Nk(n,t,r,"current"===s)}return i}).bind(null,t.syncEngine),n.onUnlisten=(async function(e,t){const n=e,r=n.sc.get(t),i=n.ic.get(r.targetId);if(1<i.length)return n.ic.set(r.targetId,i.filter(e=>!wb(e,t))),void n.sc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await pE(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),zE(n.remoteStore,r.targetId),Lk(n,r.targetId)}).catch(B_)):(Lk(n,r.targetId),await pE(n.localStore,r.targetId,!0))}).bind(null,t.syncEngine),n}function hC(e,t,n={}){const r=new u_;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,i,s,a){const e=new Jk({next:e=>{r.enqueueAndForget(()=>mk(n,o));var t=e.docs.has(i);!t&&e.fromCache?a.reject(new l_(c_.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?a.reject(new l_(c_.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(e)},error:e=>a.reject(e)}),o=new yk(db(i.path),e,{includeMetadataChanges:!0,Nu:!0});return gk(n,o)}(await uC(e),e.asyncQueue,t,n,r)),r.promise}function dC(e,t,n={}){const r=new u_;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,i){const s=new Jk({next:e=>{n.enqueueAndForget(()=>mk(t,a)),e.fromCache&&"server"===r.source?i.reject(new l_(c_.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),a=new yk(e,s,{includeMetadataChanges:!0,Nu:!0});return gk(t,a)}(await uC(e),e.asyncQueue,t,n,r)),r.promise}function pC(e,t,n,r){const i=(n=n,t=ME(t),s="string"==typeof n?(new TextEncoder).encode(n):n,n=function(e){if(e instanceof Uint8Array)return Yk(e,void 0);if(e instanceof ArrayBuffer)return Yk(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(s),t=t,new Xk(n,t));var s;e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=AI(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Ns.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes}),Promise.resolve(new Set);r._updateProgress(Ik(i));const a=new bk(i,t.localStore,n.It);let e=await n.wc();for(;e;){const t=await a.Ou(e);t&&r._updateProgress(t),e=await n.wc()}var s=await a.complete();return await Vk(t,s.Bu,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Ns.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress),Promise.resolve(s.$u)}catch(t){return i_("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t),Promise.resolve(new Set)}}(r,t,n).then(e=>{r.sharedClientState.notifyBundleLoaded(e)})}(await lC(e),i,r)})}const fC=new Map;function gC(e,t,n){if(!n)throw new l_(c_.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function mC(e,t,n,r){if(!0===t&&!0===r)throw new l_(c_.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function vC(e){if(!N_.isDocumentKey(e))throw new l_(c_.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function yC(e){if(N_.isDocumentKey(e))throw new l_(c_.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function _C(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":a_();if(e instanceof Array)return"an array";var t=(e=e).constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}function wC(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new l_(c_.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=_C(e);throw new l_(c_.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}function bC(e,t){if(t<=0)throw new l_(c_.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class IC{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new l_(c_.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new l_(c_.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,mC("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class TC{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new IC({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new l_(c_.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new l_(c_.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new IC(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new d_;switch(e.type){case"gapi":var t=e.client;return new m_(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new l_(c_.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=fC.get(e);t&&(n_("ComponentProvider","Removing Datastore"),fC.delete(e),t.terminate())}(this),Promise.resolve()}}class EC{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new CC(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new EC(this.firestore,e,this._key)}}class kC{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new kC(this.firestore,e,this._query)}}class CC extends kC{constructor(e,t,n){super(e,t,db(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new EC(this.firestore,null,new N_(e))}withConverter(e){return new CC(this.firestore,e,this._path)}}function SC(e,t,...n){if(e=X(e),gC("collection","path",t),e instanceof TC){var r=C_.fromString(t,...n);return yC(r),new CC(e,null,r)}if(!(e instanceof EC||e instanceof CC))throw new l_(c_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(C_.fromString(t,...n));return yC(r),new CC(e.firestore,null,r)}function AC(e,t,...n){if(e=X(e),gC("doc","path",t=1===arguments.length?__.R():t),e instanceof TC){var r=C_.fromString(t,...n);return vC(r),new EC(e,null,new N_(r))}if(!(e instanceof EC||e instanceof CC))throw new l_(c_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=e._path.child(C_.fromString(t,...n));return vC(r),new EC(e.firestore,e instanceof CC?e.converter:null,new N_(r))}function NC(e,t){return e=X(e),t=X(t),(e instanceof EC||e instanceof CC)&&(t instanceof EC||t instanceof CC)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function RC(e,t){return e=X(e),t=X(t),e instanceof kC&&t instanceof kC&&e.firestore===t.firestore&&wb(e._query,t._query)&&e.converter===t.converter}class xC{constructor(){this.$c=Promise.resolve(),this.Bc=[],this.Lc=!1,this.Uc=[],this.qc=null,this.Kc=!1,this.Gc=!1,this.Qc=[],this.xo=new LE(this,"async_queue_retry"),this.jc=()=>{var e=OE();e&&n_("AsyncQueue","Visibility state changed to "+e.visibilityState),this.xo.bo()};const e=OE();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.jc)}get isShuttingDown(){return this.Lc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Wc(),this.zc(e)}enterRestrictedMode(e){if(!this.Lc){this.Lc=!0,this.Gc=e||!1;const t=OE();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.jc)}}enqueue(e){if(this.Wc(),this.Lc)return new Promise(()=>{});const t=new u_;return this.zc(()=>this.Lc&&this.Gc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Bc.push(e),this.Hc()))}async Hc(){if(0!==this.Bc.length){try{await this.Bc[0](),this.Bc.shift(),this.xo.reset()}catch(e){if(!G_(e))throw e;n_("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Bc.length&&this.xo.Ao(()=>this.Hc())}}zc(e){var t=this.$c.then(()=>(this.Kc=!0,e().catch(e=>{throw this.qc=e,this.Kc=!1,r_("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.Kc=!1,e))));return this.$c=t}enqueueAfterDelay(e,t,n){this.Wc(),-1<this.Qc.indexOf(e)&&(t=0);var r=ck.createAndSchedule(this,e,t,n,e=>this.Jc(e));return this.Uc.push(r),r}Wc(){this.qc&&a_()}verifyOperationInProgress(){}async Yc(){for(var e;await(e=this.$c),e!==this.$c;);}Xc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}Zc(t){return this.Yc().then(()=>{this.Uc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.Uc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Yc()})}ta(e){this.Qc.push(e)}Jc(e){var t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function DC(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class PC{constructor(){this._progressObserver={},this._taskCompletionResolver=new u_,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var OC,MC,LC,FC,UC;class qC extends TC{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new xC,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||BC(this),this._firestoreClient.terminate()}}function VC(e){return e._firestoreClient||BC(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function BC(e){var t,n,r,i,s,a=e._freezeSettings(),a=(n=e._databaseId,r=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",i=e._persistenceKey,s=a,new yw(n,r,i,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));e._firestoreClient=new tC(e._authCredentials,e._appCheckCredentials,e._queue,a)}function jC(e,n,r){const i=new u_;return e.asyncQueue.enqueue(async()=>{try{await nC(e,r),await rC(e,n),i.resolve()}catch(e){const n=e;if(!("FirebaseError"===(t=n).name?t.code===c_.FAILED_PRECONDITION||t.code===c_.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)))throw n;i_("Error enabling offline persistence. Falling back to persistence disabled: "+n),i.reject(n)}var t}).then(()=>i.promise)}function KC(e){return function(e){const t=new u_;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;JE(n.remoteStore)||n_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.hc.get(e)||[];r.push(t),n.hc.set(e,r)}catch(e){const n=lk(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await lC(e),t)),t.promise}(VC(e=wC(e,qC)))}function $C(e){return(n=VC(e=wC(e,qC))).asyncQueue.enqueue(async()=>{const e=await aC(n),t=await cC(n);return e.setNetworkEnabled(!0),function(){const e=t;return e._u.delete(0),KE(e)}()});var n}function WC(e){return(n=VC(e=wC(e,qC))).asyncQueue.enqueue(async()=>{const e=await aC(n),t=await cC(n);return e.setNetworkEnabled(!1),async function(){const e=t;e._u.add(0),await $E(e),e.gu.set("Offline")}()});var n}function zC(t,e){return n=VC(t=wC(t,qC)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Ns.getNamedQuery(e,t))}(await oC(n),r)).then(e=>e?new kC(t,null,e.query):null);var n,r}function GC(e){if(e._initialized||e._terminated)throw new l_(c_.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class HC{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new l_(c_.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new A_(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class QC{constructor(e){this._byteString=e}static fromBase64String(e){try{return new QC(hw.fromBase64String(e))}catch(e){throw new l_(c_.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new QC(hw.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class YC{constructor(e){this._methodName=e}}class JC{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new l_(c_.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new l_(c_.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return w_(this._lat,e._lat)||w_(this._long,e._long)}}const XC=/^__.*__$/;class ZC{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Qb(e,this.data,this.fieldMask,t,this.fieldTransforms):new Hb(e,this.data,t,this.fieldTransforms)}}class eS{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Qb(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function tS(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw a_()}}class nS{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.It=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ea(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get na(){return this.settings.na}sa(e){return new nS(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.It,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ia(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.sa({path:n,ra:!1});return r.oa(e),r}ua(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.sa({path:n,ra:!1});return r.ea(),r}ca(e){return this.sa({path:void 0,ra:!0})}aa(e){return IS(e,this.settings.methodName,this.settings.ha||!1,this.path,this.settings.la)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}ea(){if(this.path)for(let e=0;e<this.path.length;e++)this.oa(this.path.get(e))}oa(e){if(0===e.length)throw this.aa("Document fields must not be empty");if(tS(this.na)&&XC.test(e))throw this.aa('Document fields cannot begin and end with "__"')}}class rS{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.It=n||ME(e)}fa(e,t,n,r=!1){return new nS({na:e,methodName:t,la:n,path:A_.emptyPath(),ra:!1,ha:r},this.databaseId,this.It,this.ignoreUndefinedProperties)}}function iS(e){var t=e._freezeSettings(),n=ME(e._databaseId);return new rS(e._databaseId,!!t.ignoreUndefinedProperties,n)}function sS(e,t,n,r,i,s={}){const a=e.fa(s.merge||s.mergeFields?2:0,t,n,i);yS("Data must be an object, but it was:",a,r);var o=mS(r,a);let c,l;if(s.merge)c=new uw(a.fieldMask),l=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=_S(t,r,n);if(!a.contains(i))throw new l_(c_.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);TS(e,i)||e.push(i)}c=new uw(e),l=a.fieldTransforms.filter(e=>c.covers(e.field))}else c=null,l=a.fieldTransforms;return new ZC(new Bw(o),c,l)}class aS extends YC{_toFieldTransform(e){if(2!==e.na)throw 1===e.na?e.aa(`${this._methodName}() can only appear at the top level of your update data`):e.aa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof aS}}function oS(e,t,n){return new nS({na:3,la:t.settings.la,methodName:e._methodName,ra:n},t.databaseId,t.It,t.ignoreUndefinedProperties)}class cS extends YC{_toFieldTransform(e){return new qb(e.path,new xb)}isEqual(e){return e instanceof cS}}class lS extends YC{constructor(e,t){super(e),this.da=t}_toFieldTransform(e){const t=oS(this,e,!0),n=this.da.map(e=>gS(e,t)),r=new Db(n);return new qb(e.path,r)}isEqual(e){return this===e}}class uS extends YC{constructor(e,t){super(e),this.da=t}_toFieldTransform(e){const t=oS(this,e,!0),n=this.da.map(e=>gS(e,t)),r=new Ob(n);return new qb(e.path,r)}isEqual(e){return this===e}}class hS extends YC{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){var t=new Lb(e.It,Ab(e.It,this._a));return new qb(e.path,t)}isEqual(e){return this===e}}function dS(e,i,s,t){const a=e.fa(1,i,s);yS("Data must be an object, but it was:",a,t);const o=[],c=Bw.empty();nw(t,(e,t)=>{var n=bS(i,e,s);t=X(t);var r=a.ua(n);if(t instanceof aS)o.push(n);else{const e=gS(t,r);null!=e&&(o.push(n),c.set(n,e))}});var n=new uw(o);return new eS(c,n,a.fieldTransforms)}function pS(e,t,n,r,i,s){const a=e.fa(1,t,n),o=[_S(t,r,n)],c=[i];if(s.length%2!=0)throw new l_(c_.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let p=0;p<s.length;p+=2)o.push(_S(t,s[p])),c.push(s[p+1]);const l=[],u=Bw.empty();for(let f=o.length-1;0<=f;--f)if(!TS(l,o[f])){const t=o[f];var h=X(h=c[f]);const r=a.ua(t);if(h instanceof aS)l.push(t);else{const e=gS(h,r);null!=e&&(l.push(t),u.set(t,e))}}var d=new uw(l);return new eS(u,d,a.fieldTransforms)}function fS(e,t,n,r=!1){return gS(n,e.fa(r?4:3,t))}function gS(s,e){if(vS(s=X(s)))return yS("Unsupported field value:",e,s),mS(s,e);if(s instanceof YC)return function(e,t){if(!tS(t.na))throw t.aa(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.aa(`${e._methodName}() is not currently supported inside arrays`);var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(s,e),null;if(void 0===s&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.ra&&4!==e.na)throw e.aa("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const i of s){let e=gS(i,t.ca(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=X(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Ab(t.It,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=T_.fromDate(e);return{timestampValue:CI(t.It,n)}}if(e instanceof T_){n=new T_(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:CI(t.It,n)}}if(e instanceof JC)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof QC)return{bytesValue:SI(t.It,e._byteString)};if(e instanceof EC){const r=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(r))throw t.aa(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:NI(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.aa(`Unsupported field value: ${_C(e)}`)}(0,e)}function mS(e,r){const i={};return rw(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):nw(e,(e,t)=>{var n=gS(t,r.ia(e));null!=n&&(i[e]=n)}),{mapValue:{fields:i}}}function vS(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof T_||e instanceof JC||e instanceof QC||e instanceof EC||e instanceof YC)}function yS(e,t,n){if(!vS(n)||("object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i))){var r=_C(n);throw"an object"===r?t.aa(e+" a custom object"):t.aa(e+" "+r)}var i}function _S(e,t,n){if((t=X(t))instanceof HC)return t._internalPath;if("string"==typeof t)return bS(e,t);throw IS("Field path arguments must be of type string or ",e,!1,void 0,n)}const wS=new RegExp("[~\\*/\\[\\]]");function bS(t,n,r){if(0<=n.search(wS))throw IS(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new HC(...n.split("."))._internalPath}catch(e){throw IS(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function IS(e,t,n,r,i){var s=r&&!r.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${r}`),a&&(c+=` in document ${i}`),c+=")"),new l_(c_.INVALID_ARGUMENT,o+e+c)}function TS(e,t){return e.some(e=>e.isEqual(t))}class ES{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new EC(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new kS(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){var t=this._document.data.field(CS("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class kS extends ES{data(){return super.data()}}function CS(e,t){return"string"==typeof t?bS(e,t):(t instanceof HC?t:t._delegate)._internalPath}class SS{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class AS extends ES{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new NS(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){var n=this._document.data.field(CS("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class NS extends AS{data(e={}){return super.data(e)}}class RS{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new SS(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new NS(this._firestore,this._userDataWriter,e.key,e,new SS(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new l_(c_.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let t=0;return s._snapshot.docChanges.map(e=>({type:"added",doc:new NS(s._firestore,s._userDataWriter,e.doc.key,e.doc,new SS(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:t++}))}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new NS(s._firestore,s._userDataWriter,e.doc.key,e.doc,new SS(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return a_()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function xS(e,t){return e instanceof AS&&t instanceof AS?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof RS&&t instanceof RS&&e._firestore===t._firestore&&RC(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function DS(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new l_(c_.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class PS{}function OS(e,...t){for(const n of t)e=n._apply(e);return e}class MS extends PS{constructor(e,t,n){super(),this.wa=e,this.ma=t,this.ga=n,this.type="where"}_apply(e){var t=iS(e.firestore),t=function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new l_(c_.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){jS(a,s);const t=[];for(const n of a)t.push(BS(r,e,n));o={arrayValue:{values:t}}}else o=BS(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||jS(a,s),o=fS(n,t,a,"in"===s||"not-in"===s);var c=Jw.create(i,s,o);return function(e,t){if(t.dt()){const r=gb(e);if(null!==r&&!r.isEqual(t.field))throw new l_(c_.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${t.field.toString()}'`);var n=fb(e);null!==n&&KS(0,t.field,n)}const r=function(e,t){for(const n of e.filters)if(0<=t.indexOf(n.op))return n.op;return null}(e,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new l_(c_.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new l_(c_.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}(e,c),c}(e._query,"where",t,e.firestore._databaseId,this.wa,this.ma,this.ga);return new kC(e.firestore,e.converter,(e=e._query,t=e.filters.concat([t]),new ub(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))}}class LS extends PS{constructor(e,t){super(),this.wa=e,this.ya=t,this.type="orderBy"}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new l_(c_.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new l_(c_.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i=new ob(t,n);return n=i,null!==fb(e=e)||null!==(r=gb(e))&&KS(0,r,n.field),i}(e._query,this.wa,this.ya);return new kC(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new ub(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class FS extends PS{constructor(e,t,n){super(),this.type=e,this.pa=t,this.Ia=n}_apply(e){return new kC(e.firestore,e.converter,_b(e._query,this.pa,this.Ia))}}class US extends PS{constructor(e,t,n){super(),this.type=e,this.Ta=t,this.Ea=n}_apply(e){var t,n=VS(e,this.type,this.Ta,this.Ea);return new kC(e.firestore,e.converter,(t=e._query,e=n,new ub(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class qS extends PS{constructor(e,t,n){super(),this.type=e,this.Ta=t,this.Ea=n}_apply(e){var t,n=VS(e,this.type,this.Ta,this.Ea);return new kC(e.firestore,e.converter,(t=e._query,e=n,new ub(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function VS(e,t,n,r){if(n[0]=X(n[0]),n[0]instanceof ES)return function(e,t,n,r,i){if(!r)throw new l_(c_.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of vb(e))if(n.field.isKeyField())s.push(xw(t,r.key));else{const e=r.data.field(n.field);if(mw(e))throw new l_(c_.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new l_(c_.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new ab(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=iS(e.firestore);return function(e,t,n,r,i,s){const a=e.explicitOrderBy;if(i.length>a.length)throw new l_(c_.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const o=[];for(let c=0;c<i.length;c++){const l=i[c];if(a[c].field.isKeyField()){if("string"!=typeof l)throw new l_(c_.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!mb(e)&&-1!==l.indexOf("/"))throw new l_(c_.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);const n=e.path.child(C_.fromString(l));if(!N_.isDocumentKey(n))throw new l_(c_.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new N_(n);o.push(xw(t,i))}else{const e=fS(n,r,l);o.push(e)}}return new ab(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}function BS(e,t,n){if("string"==typeof(n=X(n))){if(""===n)throw new l_(c_.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!mb(t)&&-1!==n.indexOf("/"))throw new l_(c_.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);var r=t.path.child(C_.fromString(n));if(!N_.isDocumentKey(r))throw new l_(c_.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return xw(e,new N_(r))}if(n instanceof EC)return xw(e,n._key);throw new l_(c_.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_C(n)}.`)}function jS(e,t){if(!Array.isArray(e)||0===e.length)throw new l_(c_.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new l_(c_.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function KS(e,t,n){if(!n.isEqual(t))throw new l_(c_.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}const $S={maxAttempts:5};class WS{convertValue(e,t="none"){switch(kw(e)){case 0:return null;case 1:return e.booleanValue;case 2:return fw(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(gw(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw a_()}}convertObject(e,n){const r={};return nw(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new JC(fw(e.latitude),fw(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){var n=t.mapValue.fields.__previous_value__;return mw(n)?e(n):n}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(vw(e));default:return null}}convertTimestamp(e){var t=pw(e);return new T_(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=C_.fromString(e);o_(HI(n));const r=new _w(n.get(1),n.get(3)),i=new N_(n.popFirst(5));return r.isEqual(t)||r_(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function zS(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class GS extends WS{constructor(e){super(),this.firestore=e}convertBytes(e){return new QC(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new EC(this.firestore,null,t)}}class HS{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=iS(e)}set(e,t,n){this._verifyNotCommitted();const r=QS(e,this._firestore),i=zS(r.converter,t,n),s=sS(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Bb.none())),this}update(e,t,n,...r){this._verifyNotCommitted();var i=QS(e,this._firestore);let s;return s="string"==typeof(t=X(t))||t instanceof HC?pS(this._dataReader,"WriteBatch.update",i._key,t,n,r):dS(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Bb.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=QS(e,this._firestore);return this._mutations=this._mutations.concat(new Zb(t._key,Bb.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new l_(c_.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function QS(e,t){if((e=X(e)).firestore!==t)throw new l_(c_.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class YS extends WS{constructor(e){super(),this.firestore=e}convertBytes(e){return new QC(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new EC(this.firestore,null,t)}}function JS(t){t=wC(t,EC);const n=wC(t.firestore,qC),e=VC(n),r=new YS(n);return function(e,t){const n=new u_;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.localDocuments.getDocument(e,t))}(t);i.isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new l_(c_.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){var r=lk(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await oC(e),t,n)),n.promise}(e,t._key).then(e=>new AS(n,r,t._key,e,new SS(null!==e&&e.hasLocalMutations,!0),t.converter))}function XS(t){t=wC(t,kC);const n=wC(t.firestore,qC),e=VC(n),r=new YS(n);return function(e,t){const n=new u_;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const i=await fE(e,t,!0),s=new kk(t,i.Hi),a=s.ju(i.documents),o=s.applyChanges(a,!1);n.resolve(o.snapshot)}catch(e){var r=lk(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await oC(e),t,n)),n.promise}(e,t._query).then(e=>new RS(n,r,t,e))}function ZS(e,t,n){e=wC(e,EC);var r=wC(e.firestore,qC),i=zS(e.converter,t,n);return rA(r,[sS(iS(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Bb.none())])}function eA(e,t,n,...r){e=wC(e,EC);var i=wC(e.firestore,qC),s=iS(i);let a;return a="string"==typeof(t=X(t))||t instanceof HC?pS(s,"updateDoc",e._key,t,n,r):dS(s,"updateDoc",e._key,t),rA(i,[a.toMutation(e._key,Bb.exists(!0))])}function tA(t,...n){var e;t=X(t);let r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||DC(n[i])||(r=n[i],i++);var s={includeMetadataChanges:r.includeMetadataChanges};if(DC(n[i])){const t=n[i];n[i]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[i+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[i+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let a,o,c;if(t instanceof EC)o=wC(t.firestore,qC),c=db(t._key.path),a={next:e=>{n[i]&&n[i](iA(o,t,e))},error:n[i+1],complete:n[i+2]};else{const l=wC(t,kC);o=wC(l.firestore,qC),c=l._query;const u=new YS(o);a={next:e=>{n[i]&&n[i](new RS(o,u,l,e))},error:n[i+1],complete:n[i+2]},DS(t._query)}return function(e,t,n,r){const i=new Jk(r),s=new yk(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>gk(await uC(e),s)),()=>{i.Rc(),e.asyncQueue.enqueueAndForget(async()=>mk(await uC(e),s))}}(VC(o),c,s,a)}function nA(e,t){return function(e,t){const n=new Jk(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Ru.add(t),t.next()}(await uC(e),n)),()=>{n.Rc(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Ru.delete(t)}(await uC(e),n))}}(VC(e=wC(e,qC)),DC(t)?t:{next:t})}function rA(e,t){return function(e,t){const n=new u_;return e.asyncQueue.enqueueAndForget(async()=>Rk(await lC(e),t,n)),n.promise}(VC(e),t)}function iA(e,t,n){var r=n.docs.get(t._key),i=new YS(e);return new AS(e,i,t._key,r,new SS(n.hasPendingWrites,n.fromCache),t.converter)}class sA extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=iS(e)}get(e){const n=QS(e,this._firestore),r=new GS(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return a_();const t=e[0];if(t.isFoundDocument())return new ES(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new ES(this._firestore,r,n._key,null,n.converter);throw a_()})}set(e,t,n){var r=QS(e,this._firestore),i=zS(r.converter,t,n),i=sS(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,i),this}update(e,t,n,...r){var i=QS(e,this._firestore),s="string"==typeof(t=X(t))||t instanceof HC?pS(this._dataReader,"Transaction.update",i._key,t,n,r):dS(this._dataReader,"Transaction.update",i._key,t);return this._transaction.update(i._key,s),this}delete(e){var t=QS(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=QS(e,this._firestore),n=new YS(this._firestore);return super.get(e).then(e=>new AS(this._firestore,n,t._key,e._document,new SS(!1,!1),t.converter))}}function aA(t,n,e){t=wC(t,qC);var r=Object.assign(Object.assign({},$S),e);return function(){if(r.maxAttempts<1)throw new l_(c_.INVALID_ARGUMENT,"Max attempts must be at least 1")}(),function(t,n,r){const i=new u_;return t.asyncQueue.enqueueAndForget(async()=>{var e=await sC(t).then(e=>e.datastore);new eC(t.asyncQueue,e,r,n,i).run()}),i.promise}(VC(t),e=>n(new sA(t,e)),r)}OC=$e,Zy=OC,Ve(new Z("firestore",(e,{instanceIdentifier:t,options:n})=>{const r=e.getProvider("app").getImmediate(),i=new qC(new f_(e.getProvider("auth-internal")),new y_(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new l_(c_.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new _w(e.options.projectId,t)}(r,t),r);return n=Object.assign({useFetchStreams:!0},n),i._setSettings(n),i},"PUBLIC").setMultipleInstances(!0)),He(Jy,"3.5.0",void 0),He(Jy,"3.5.0","esm2017");function oA(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new l_("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function cA(){if("undefined"==typeof Uint8Array)throw new l_("unimplemented","Uint8Arrays are not available in this environment.")}function lA(){if("undefined"==typeof atob)throw new l_("unimplemented","Blobs are unavailable in Firestore in this environment.")}class uA{constructor(e){this._delegate=e}static fromBase64String(e){return lA(),new uA(QC.fromBase64String(e))}static fromUint8Array(e){return cA(),new uA(QC.fromUint8Array(e))}toBase64(){return lA(),this._delegate.toBase64()}toUint8Array(){return cA(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function hA(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class dA{enableIndexedDbPersistence(e,t){return function(e,t){GC(e=wC(e,qC));var n=VC(e),r=e._freezeSettings(),i=new Qk;return jC(n,i,new Gk(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){GC(e=wC(e,qC));var t=VC(e),n=e._freezeSettings(),r=new Qk;return jC(t,r,new Hk(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new l_(c_.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new u_;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!$_.C())return Promise.resolve();var t=e+"main";await $_.delete(t)}(rE(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class pA{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof _w||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||i_("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(n,e,t,r={}){var i;const s=(n=wC(n,TC))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&i_("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let e,t;if("string"==typeof r.mockUserToken)e=r.mockUserToken,t=Xy.MOCK_USER;else{e=o(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new l_(c_.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new Xy(s)}n._authCredentials=new p_(new h_(e,t))}}(this._delegate,e,t,n)}enableNetwork(){return $C(this._delegate)}disableNetwork(){return WC(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,mC("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return KC(this._delegate)}onSnapshotsInSync(e){return nA(this._delegate,e)}get app(){if(!this._appCompat)throw new l_("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new SA(this,SC(this._delegate,e))}catch(e){throw _A(e,"collection()","Firestore.collection()")}}doc(e){try{return new yA(this,AC(this._delegate,e))}catch(e){throw _A(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new EA(this,function(e,t){if(e=wC(e,TC),gC("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new l_(c_.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new kC(e,null,(t=t,new ub(C_.emptyPath(),t)))}(this._delegate,e))}catch(e){throw _A(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return aA(this._delegate,e=>t(new gA(this,e)))}batch(){return VC(this._delegate),new mA(new HS(this._delegate,e=>rA(this._delegate,e)))}loadBundle(e){return t=this._delegate,e=e,n=VC(t=wC(t,qC)),r=new PC,pC(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return zC(this._delegate,e).then(e=>e?new EA(this,e):null)}}class fA extends WS{constructor(e){super(),this.firestore=e}convertBytes(e){return new uA(new QC(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return yA.forKey(t,this.firestore,null)}}class gA{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new fA(e)}get(e){const t=AA(e);return this._delegate.get(t).then(e=>new IA(this._firestore,new AS(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){var r=AA(e);return n?(oA("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=AA(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=AA(e);return this._delegate.delete(t),this}}class mA{constructor(e){this._delegate=e}set(e,t,n){var r=AA(e);return n?(oA("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=AA(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=AA(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class vA{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){var n=new NS(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new TA(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=vA.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new vA(e,new fA(e),t),r.set(t,i)),i}}vA.INSTANCES=new WeakMap;class yA{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fA(e)}static forPath(e,t,n){if(e.length%2!=0)throw new l_("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new yA(t,new EC(t._delegate,n,new N_(e)))}static forKey(e,t,n){return new yA(t,new EC(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new SA(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new SA(this.firestore,SC(this._delegate,e))}catch(e){throw _A(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=X(e))instanceof EC&&NC(this._delegate,e)}set(e,t){t=oA("DocumentReference.set",t);try{return t?ZS(this._delegate,e,t):ZS(this._delegate,e)}catch(e){throw _A(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?eA(this._delegate,e):eA(this._delegate,e,t,...n)}catch(e){throw _A(e,"updateDoc()","DocumentReference.update()")}}delete(){return rA(wC((e=this._delegate).firestore,qC),[new Zb(e._key,Bb.none())]);var e}onSnapshot(...e){var t=wA(e),n=bA(e,e=>new IA(this.firestore,new AS(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return tA(this._delegate,t,n)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?JS:"server"===(null==e?void 0:e.source)?function(t){t=wC(t,EC);const n=wC(t.firestore,qC);return hC(VC(n),t._key,{source:"server"}).then(e=>iA(n,t,e))}:function(t){t=wC(t,EC);const n=wC(t.firestore,qC);return hC(VC(n),t._key).then(e=>iA(n,t,e))})(this._delegate),t.then(e=>new IA(this.firestore,new AS(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new yA(this.firestore,e?this._delegate.withConverter(vA.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function _A(e,t,n){return e.message=e.message.replace(t,n),e}function wA(e){for(const t of e)if("object"==typeof t&&!hA(t))return t;return{}}function bA(e,t){var n;let r;return r=hA(e[0])?e[0]:hA(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{r.next&&r.next(t(e))},error:null===(n=r.error)||void 0===n?void 0:n.bind(r),complete:null===(n=r.complete)||void 0===n?void 0:n.bind(r)}}class IA{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new yA(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return xS(this._delegate,e._delegate)}}class TA extends IA{data(e){var t=this._delegate.data(e);return void 0!==t||a_(),t}}class EA{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new fA(e)}where(e,t,n){try{return new EA(this.firestore,OS(this._delegate,(r=n,i=t,s=CS("where",e),new MS(s,i,r))))}catch(e){throw _A(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new EA(this.firestore,OS(this._delegate,([n,r="asc"]=[e,t],i=r,s=CS("orderBy",n),new LS(s,i))))}catch(e){throw _A(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,i,s}limit(e){try{return new EA(this.firestore,OS(this._delegate,(bC("limit",t=e),new FS("limit",t,"F"))))}catch(e){throw _A(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new EA(this.firestore,OS(this._delegate,(bC("limitToLast",t=e),new FS("limitToLast",t,"L"))))}catch(e){throw _A(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new EA(this.firestore,OS(this._delegate,function(...e){return new US("startAt",e,!0)}(...e)))}catch(e){throw _A(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new EA(this.firestore,OS(this._delegate,function(...e){return new US("startAfter",e,!1)}(...e)))}catch(e){throw _A(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new EA(this.firestore,OS(this._delegate,function(...e){return new qS("endBefore",e,!1)}(...e)))}catch(e){throw _A(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new EA(this.firestore,OS(this._delegate,function(...e){return new qS("endAt",e,!0)}(...e)))}catch(e){throw _A(e,"endAt()","Query.endAt()")}}isEqual(e){return RC(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?XS:"server"===(null==e?void 0:e.source)?function(t){t=wC(t,kC);const n=wC(t.firestore,qC),e=VC(n),r=new YS(n);return dC(e,t._query,{source:"server"}).then(e=>new RS(n,r,t,e))}:function(t){t=wC(t,kC);const n=wC(t.firestore,qC),e=VC(n),r=new YS(n);return DS(t._query),dC(e,t._query).then(e=>new RS(n,r,t,e))})(this._delegate),t.then(e=>new CA(this.firestore,new RS(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=wA(e),n=bA(e,e=>new CA(this.firestore,new RS(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return tA(this._delegate,t,n)}withConverter(e){return new EA(this.firestore,e?this._delegate.withConverter(vA.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class kA{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new TA(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class CA{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new EA(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new TA(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new kA(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new TA(this._firestore,e))})}isEqual(e){return xS(this._delegate,e._delegate)}}class SA extends EA{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new yA(this.firestore,e):null}doc(e){try{return void 0===e?new yA(this.firestore,AC(this._delegate)):new yA(this.firestore,AC(this._delegate,e))}catch(e){throw _A(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=wC(e.firestore,qC),r=AC(e),i=zS(e.converter,t);return rA(n,[sS(iS(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Bb.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new yA(this.firestore,e))}isEqual(e){return NC(this._delegate,e._delegate)}withConverter(e){return new SA(this.firestore,e?this._delegate.withConverter(vA.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function AA(e){return wC(e,EC)}const NA={Firestore:pA,GeoPoint:JC,Timestamp:T_,Blob:uA,Transaction:gA,WriteBatch:mA,DocumentReference:yA,DocumentSnapshot:IA,Query:EA,QueryDocumentSnapshot:TA,QuerySnapshot:CA,CollectionReference:SA,FieldPath:class PP{constructor(...e){this._delegate=new HC(...e)}static documentId(){return new PP(A_.keyField().canonicalString())}isEqual(e){return(e=X(e))instanceof HC&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class OP{constructor(e){this._delegate=e}static serverTimestamp(){const e=new cS("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new OP(e)}static delete(){const e=new aS("deleteField");return e._methodName="FieldValue.delete",new OP(e)}static arrayUnion(...e){const t=function(...e){return new lS("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new OP(t)}static arrayRemove(...e){const t=function(...e){return new uS("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new OP(t)}static increment(e){const t=new hS("increment",e);return t._methodName="FieldValue.increment",new OP(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,e_.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};MC=ft,LC=(e,t)=>new pA(e,t,new dA),MC.INTERNAL.registerComponent(new Z("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return LC(t,n)},"PUBLIC").setServiceProps(Object.assign({},NA))),MC.registerVersion("@firebase/firestore-compat","0.1.25");const RA="type.googleapis.com/google.protobuf.Int64Value",xA="type.googleapis.com/google.protobuf.UInt64Value";function DA(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function PA(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case RA:case xA:var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>PA(e)):"function"==typeof e||"object"==typeof e?DA(e,e=>PA(e)):e}const OA="functions",MA={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class LA extends I{constructor(e,t,n){super(`${OA}/${e}`,t||""),this.details=n}}function FA(e,t){let n=function(e){if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),r=n,i=void 0;try{var s=t&&t.error;if(s){const e=s.status;if("string"==typeof e){if(!MA[e])return new LA("internal","internal");n=MA[e],r=e}var a=s.message;"string"==typeof a&&(r=a),i=s.details,void 0!==i&&(i=PA(i))}}catch(e){}return"ok"===n?null:new LA(n,r,i)}class UA{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return this.messaging.getToken()}catch(e){return}}async getAppCheckToken(){if(this.appCheck){var e=await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken()}}}const qA="us-central1";class VA{constructor(e,t,n,r,i=qA,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new UA(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var a=new URL(i);this.customDomain=a.origin,this.region=qA}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null===this.emulatorOrigin?null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`:`${this.emulatorOrigin}/${t}/${this.region}/${e}`}}function BA(i,s,a){return e=>{return t=e,n=a||{},r=(e=i)._url(s),jA(e,r,t,n);var t,n,r}}async function jA(e,t,n,r){var i={data:n=function t(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>t(e));if("function"==typeof e||"object"==typeof e)return DA(e,e=>t(e));throw new Error("Data cannot be encoded in JSON: "+e)}(n)};const s={};var a=await e.contextProvider.getContext();a.authToken&&(s.Authorization="Bearer "+a.authToken),a.messagingToken&&(s["Firebase-Instance-ID-Token"]=a.messagingToken),null!==a.appCheckToken&&(s["X-Firebase-AppCheck"]=a.appCheckToken);const o=function(n){let r=null;return{promise:new Promise((e,t)=>{r=setTimeout(()=>{t(new LA("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{r&&clearTimeout(r)}}}(r.timeout||7e4);a=await Promise.race([async function(e,t,n,r){n["Content-Type"]="application/json";let i;try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}(t,i,s,e.fetchImpl),o.promise,e.cancelAllRequests]);if(o.cancel(),!a)throw new LA("cancelled","Firebase Functions instance was deleted.");i=FA(a.status,a.json);if(i)throw i;if(!a.json)throw new LA("internal","Response is not valid JSON object.");let c=a.json.data;if(void 0===c&&(c=a.json.result),void 0===c)throw new LA("internal","Response is missing data field.");return{data:PA(c)}}const KA="@firebase/functions";function $A(e,t,n){X(e).emulatorOrigin=`http://${t}:${n}`}function WA(e,t,n){return r=X(e),i=t,s=n,e=>jA(r,i,e,s||{});var r,i,s}FC=fetch.bind(self),Ve(new Z(OA,(e,{instanceIdentifier:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),s=e.getProvider("app-check-internal");return new VA(n,r,i,s,t,FC)},"PUBLIC").setMultipleInstances(!0)),He(KA,"0.8.4",UC),He(KA,"0.8.4","esm2017");var zA,GA,HA,QA;class YA{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return BA(X(this._delegate),e,t)}httpsCallableFromURL(e,t){return WA(this._delegate,e,t)}useFunctionsEmulator(e){var t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==t)throw new I("functions","No origin provided to useFunctionsEmulator()");if(null==t[2])throw new I("functions","Port missing in origin provided to useFunctionsEmulator()");return $A(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return $A(this._delegate,e,t)}}const JA="us-central1",XA=(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("functions").getImmediate({identifier:null!=t?t:JA});return new YA(n,r)};zA={Functions:YA},ft.INTERNAL.registerComponent(new Z("functions-compat",XA,"PUBLIC").setServiceProps(zA).setMultipleInstances(!0)),ft.registerVersion("@firebase/functions-compat","0.2.4");const ZA="/firebase-messaging-sw.js",eN="/firebase-cloud-messaging-push-scope",tN="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",nN="https://fcmregistrations.googleapis.com/v1",rN="google.c.a.c_id",iN="google.c.a.e";function sN(e){var t=new Uint8Array(e);const n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(Fc=gD=gD||{})[Fc.DATA_MESSAGE=1]="DATA_MESSAGE",Fc[Fc.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(Fc=GA=GA||{}).PUSH_RECEIVED="push-received",Fc.NOTIFICATION_CLICKED="notification-clicked";const aN="fcm_token_details_db",oN="fcm_token_object_Store";async function cN(c){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(aN))return null}let l=null;const e=await Ee(aN,5,{upgrade:async(e,t,n,r)=>{var i;if(!(t<2)&&e.objectStoreNames.contains(oN)){const o=r.objectStore(oN);var s,a=await o.index("fcmSenderId").get(c);await o.clear(),a&&(2===t?(s=a).auth&&s.p256dh&&s.endpoint&&(l={token:s.fcmToken,createTime:null!==(i=s.createTime)&&void 0!==i?i:Date.now(),subscriptionOptions:{auth:s.auth,p256dh:s.p256dh,endpoint:s.endpoint,swScope:s.swScope,vapidKey:"string"==typeof s.vapidKey?s.vapidKey:sN(s.vapidKey)}}):3===t?(s=a,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:sN(s.auth),p256dh:sN(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:sN(s.vapidKey)}}):4===t&&(a=a,l={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:sN(a.auth),p256dh:sN(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:sN(a.vapidKey)}}))}}});return e.close(),await ke(aN),await ke("fcm_vapid_details_db"),await ke("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var t=e["subscriptionOptions"];return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(l)?l:null}const lN="firebase-messaging-database",uN=1,hN="firebase-messaging-store";let dN=null;function pN(){return dN=dN||Ee(lN,uN,{upgrade:(e,t)=>{0===t&&e.createObjectStore(hN)}}),dN}async function fN(e){var t=mN(e);const n=await pN();t=await n.transaction(hN).objectStore(hN).get(t);if(t)return t;t=await cN(e.appConfig.senderId);return t?(await gN(e,t),t):void 0}async function gN(e,t){var n=mN(e);const r=await pN(),i=r.transaction(hN,"readwrite");return await i.objectStore(hN).put(t,n),await i.done,t}function mN({appConfig:e}){return e.appId}const vN=new T("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function yN(e,t){var n={method:"DELETE",headers:await wN(e)};try{const s=await fetch(`${_N(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw vN.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw vN.create("token-unsubscribe-failed",{errorInfo:null===e||void 0===e?void 0:e.toString()})}}function _N({projectId:e}){return`${nN}/projects/${e}/registrations`}async function wN({appConfig:e,installations:t}){var n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function bN({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==tN&&(i.web.applicationPubKey=r),i}const IN=6048e5;async function TN(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,a,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:sN(t.getKey("auth")),p256dh:sN(t.getKey("p256dh"))},c=await fN(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,a=o.p256dh===n.p256dh,r&&i&&s&&a)return Date.now()>=c.createTime+IN?async function(t,e){try{var n=await async function(e,t){var n=await wN(e),r=bN(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${_N(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw vN.create("token-update-failed",{errorInfo:null===e||void 0===e?void 0:e.toString()})}if(i.error){r=i.error.message;throw vN.create("token-update-failed",{errorInfo:r})}if(!i.token)throw vN.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await gN(t.firebaseDependencies,r),n}catch(e){throw await EN(t),e}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:o}):c.token;try{await yN(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return kN(e.firebaseDependencies,o)}return kN(e.firebaseDependencies,o)}async function EN(e){var t=await fN(e.firebaseDependencies);t&&(await yN(e.firebaseDependencies,t.token),await async function(e){var t=mN(e);const n=await pN(),r=n.transaction(hN,"readwrite");await r.objectStore(hN).delete(t),await r.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function kN(e,t){var n={token:await async function(e,t){var n=await wN(e),r=bN(t),r={method:"POST",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(_N(e.appConfig),r);i=await s.json()}catch(e){throw vN.create("token-subscribe-failed",{errorInfo:null===e||void 0===e?void 0:e.toString()})}if(i.error){r=i.error.message;throw vN.create("token-subscribe-failed",{errorInfo:r})}if(!i.token)throw vN.create("token-subscribe-no-token");return i.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await gN(e,n),n.token}function CN(e){var t,n,r,i,s,a={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return r=a,(n=e).notification&&(r.notification={},(t=n.notification.title)&&(r.notification.title=t),(t=n.notification.body)&&(r.notification.body=t),(t=n.notification.image)&&(r.notification.image=t)),n=a,(r=e).data&&(n.data=r.data),r=a,((e=e).fcmOptions||null!==(i=e.notification)&&void 0!==i&&i.click_action)&&(r.fcmOptions={},(s=null!==(i=null===(i=e.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==i?i:null===(s=e.notification)||void 0===s?void 0:s.click_action)&&(r.fcmOptions.link=s),(s=null===(s=e.fcmOptions)||void 0===s?void 0:s.analytics_label)&&(r.fcmOptions.analyticsLabel=s)),a}function SN(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}function AN(e){return vN.create("missing-app-config-values",{valueName:e})}SN("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),SN("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class NN{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw AN("App Configuration Object");if(!e.name)throw AN("App Name");var t=e["options"];for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw AN(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function RN(e){try{e.swRegistration=await navigator.serviceWorker.register(ZA,{scope:eN}),e.swRegistration.update().catch(()=>{})}catch(e){throw vN.create("failed-service-worker-registration",{browserErrorMessage:null===e||void 0===e?void 0:e.message})}}async function xN(e,t){if(!navigator)throw vN.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw vN.create("permission-blocked");var n,r;return n=e,await((r=null==t?void 0:t.vapidKey)?n.vapidKey=r:n.vapidKey||(n.vapidKey=tN)),await async function(e,t){if(t||e.swRegistration||await RN(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw vN.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),TN(e)}async function DN(e,t,n){var r=function(e){switch(e){case GA.NOTIFICATION_CLICKED:return"notification_open";case GA.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);const i=await e.firebaseDependencies.analyticsProvider.get();i.logEvent(r,{message_id:n[rN],message_name:n["google.c.a.c_l"],message_time:n["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)})}async function PN(e,t){var n,r=t.data;r.isFirebaseMessaging&&(e.onMessageHandler&&r.messageType===GA.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(CN(r)):e.onMessageHandler.next(CN(r))),n=r.data,"object"==typeof(t=n)&&t&&rN in t&&"1"===n[iN]&&await DN(e,r.messageType,n))}const ON="@firebase/messaging",MN=e=>{const t=new NN(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>PN(t,e)),t},LN=e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>xN(t,e)}};function FN(e){return async function(e){if(!navigator)throw vN.create("only-available-in-window");return e.swRegistration||await RN(e),EN(e)}(e=X(e))}function UN(e,t){return function(e,t){if(!navigator)throw vN.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(e=X(e),t)}Ve(new Z("messaging",MN,"PUBLIC")),Ve(new Z("messaging-internal",LN,"PRIVATE")),He(ON,"0.9.16"),He(ON,"0.9.16","esm2017");const qN="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",VN="https://fcmregistrations.googleapis.com/v1",BN="FCM_MSG",jN="google.c.a.c_id",KN=3,$N=1;function WN(e){var t=new Uint8Array(e);const n=btoa(String.fromCharCode(...t));return n.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(Fc=HA=HA||{})[Fc.DATA_MESSAGE=1]="DATA_MESSAGE",Fc[Fc.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(mt=QA=QA||{}).PUSH_RECEIVED="push-received",mt.NOTIFICATION_CLICKED="notification-clicked";const zN="fcm_token_details_db",GN="fcm_token_object_Store";async function HN(c){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(zN))return null}let l=null;const e=await Ee(zN,5,{upgrade:async(e,t,n,r)=>{var i;if(!(t<2)&&e.objectStoreNames.contains(GN)){const o=r.objectStore(GN);var s,a=await o.index("fcmSenderId").get(c);await o.clear(),a&&(2===t?(s=a).auth&&s.p256dh&&s.endpoint&&(l={token:s.fcmToken,createTime:null!==(i=s.createTime)&&void 0!==i?i:Date.now(),subscriptionOptions:{auth:s.auth,p256dh:s.p256dh,endpoint:s.endpoint,swScope:s.swScope,vapidKey:"string"==typeof s.vapidKey?s.vapidKey:WN(s.vapidKey)}}):3===t?(s=a,l={token:s.fcmToken,createTime:s.createTime,subscriptionOptions:{auth:WN(s.auth),p256dh:WN(s.p256dh),endpoint:s.endpoint,swScope:s.swScope,vapidKey:WN(s.vapidKey)}}):4===t&&(a=a,l={token:a.fcmToken,createTime:a.createTime,subscriptionOptions:{auth:WN(a.auth),p256dh:WN(a.p256dh),endpoint:a.endpoint,swScope:a.swScope,vapidKey:WN(a.vapidKey)}}))}}});return e.close(),await ke(zN),await ke("fcm_vapid_details_db"),await ke("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var t=e["subscriptionOptions"];return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(l)?l:null}const QN="firebase-messaging-database",YN=1,JN="firebase-messaging-store";let XN=null;function ZN(){return XN=XN||Ee(QN,YN,{upgrade:(e,t)=>{0===t&&e.createObjectStore(JN)}}),XN}async function eR(e){var t=nR(e);const n=await ZN();t=await n.transaction(JN).objectStore(JN).get(t);if(t)return t;t=await HN(e.appConfig.senderId);return t?(await tR(e,t),t):void 0}async function tR(e,t){var n=nR(e);const r=await ZN(),i=r.transaction(JN,"readwrite");return await i.objectStore(JN).put(t,n),await i.done,t}function nR({appConfig:e}){return e.appId}const rR=new T("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function iR(e,t){var n={method:"DELETE",headers:await aR(e)};try{const s=await fetch(`${sR(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw rR.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw rR.create("token-unsubscribe-failed",{errorInfo:null===e||void 0===e?void 0:e.toString()})}}function sR({projectId:e}){return`${VN}/projects/${e}/registrations`}async function aR({appConfig:e,installations:t}){var n=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${n}`})}function oR({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==qN&&(i.web.applicationPubKey=r),i}async function cR(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const n=atob(t),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,a,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:WN(t.getKey("auth")),p256dh:WN(t.getKey("p256dh"))},c=await eR(e.firebaseDependencies);if(c){if(n=c.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,a=o.p256dh===n.p256dh,r&&i&&s&&a)return Date.now()>=c.createTime+6048e5?async function(t,e){try{var n=await async function(e,t){var n=await aR(e),r=oR(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${sR(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw rR.create("token-update-failed",{errorInfo:null===e||void 0===e?void 0:e.toString()})}if(i.error){r=i.error.message;throw rR.create("token-update-failed",{errorInfo:r})}if(!i.token)throw rR.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await tR(t.firebaseDependencies,r),n}catch(e){throw await lR(t),e}}(e,{token:c.token,createTime:Date.now(),subscriptionOptions:o}):c.token;try{await iR(e.firebaseDependencies,c.token)}catch(e){console.warn(e)}return uR(e.firebaseDependencies,o)}return uR(e.firebaseDependencies,o)}async function lR(e){var t=await eR(e.firebaseDependencies);t&&(await iR(e.firebaseDependencies,t.token),await async function(e){var t=nR(e);const n=await ZN(),r=n.transaction(JN,"readwrite");await r.objectStore(JN).delete(t),await r.done}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function uR(e,t){var n={token:await async function(e,t){var n=await aR(e),r=oR(t),r={method:"POST",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(sR(e.appConfig),r);i=await s.json()}catch(e){throw rR.create("token-subscribe-failed",{errorInfo:null===e||void 0===e?void 0:e.toString()})}if(i.error){r=i.error.message;throw rR.create("token-subscribe-failed",{errorInfo:r})}if(!i.token)throw rR.create("token-subscribe-no-token");return i.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await tR(e,n),n.token}async function hR(e,t){var n=function(e,t){var n;const r={};e.from&&(r.project_number=e.from);e.fcmMessageId&&(r.message_id=e.fcmMessageId);r.instance_id=t,e.notification?r.message_type=HA.DISPLAY_NOTIFICATION.toString():r.message_type=HA.DATA_MESSAGE.toString();r.sdk_platform=KN.toString(),r.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(r.collapse_key=e.collapse_key);r.event=$N.toString(),null!==(n=e.fcmOptions)&&void 0!==n&&n.analytics_label&&(r.analytics_label=null===(n=e.fcmOptions)||void 0===n?void 0:n.analytics_label);return r}(t,await e.firebaseDependencies.installations.getId());!function(e,t){const n={};n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),e.logEvents.push(n)}(e,n)}function dR(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(e.charAt(r)),r<t.length&&n.push(t.charAt(r));return n.join("")}async function pR(e,t){var n=function({data:e}){if(!e)return null;try{return e.json()}catch(e){return null}}(e);if(n){t.deliveryMetricsExportedToBigQueryEnabled&&await hR(t,n);var r,i,s,a,o=await gR();if(o.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")))return function(e,t){t.isFirebaseMessaging=!0,t.messageType=QA.PUSH_RECEIVED;for(const n of e)n.postMessage(t)}(o,n);n.notification&&await function(e){var t=e["actions"],n=Notification["maxActions"];t&&n&&t.length>n&&console.warn(`This browser only supports ${n} actions. The remaining actions will not be displayed.`);return self.registration.showNotification(null!==(n=e.title)&&void 0!==n?n:"",e)}(function(e){const t=Object.assign({},e.notification);return t.data={[BN]:e},t}(n)),t&&t.onBackgroundMessageHandler&&(a={from:(r=n).from,collapseKey:r.collapse_key,messageId:r.fcmMessageId},o=a,(e=r).notification&&(o.notification={},(n=e.notification.title)&&(o.notification.title=n),(n=e.notification.body)&&(o.notification.body=n),(n=e.notification.image)&&(o.notification.image=n)),e=a,(o=r).data&&(e.data=o.data),o=a,((r=r).fcmOptions||null!==(i=r.notification)&&void 0!==i&&i.click_action)&&(o.fcmOptions={},(s=null!==(i=null===(i=r.fcmOptions)||void 0===i?void 0:i.link)&&void 0!==i?i:null===(s=r.notification)||void 0===s?void 0:s.click_action)&&(o.fcmOptions.link=s),(s=null===(s=r.fcmOptions)||void 0===s?void 0:s.analytics_label)&&(o.fcmOptions.analyticsLabel=s)),a=a,"function"==typeof t.onBackgroundMessageHandler?await t.onBackgroundMessageHandler(a):t.onBackgroundMessageHandler.next(a))}}async function fR(e){const t=null===(s=null===(i=e.notification)||void 0===i?void 0:i.data)||void 0===s?void 0:s[BN];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();var n=function(e){var t;var n=null!==(t=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==t?t:null===(n=e.notification)||void 0===n?void 0:n.click_action;if(n)return n;return function(e){return"object"==typeof e&&e&&jN in e}(e.data)?self.location.origin:null}(t);if(n){var r,i=new URL(n,self.location.href),s=new URL(self.location.origin);if(i.host===s.host){let e=await async function(e){var t=await gR();for(const r of t){var n=new URL(r.url,self.location.href);if(e.host===n.host)return r}return null}(i);if(e?e=await e.focus():(e=await self.clients.openWindow(n),r=3e3,await new Promise(e=>{setTimeout(e,r)})),e)return t.messageType=QA.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}}function gR(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function mR(e){return rR.create("missing-app-config-values",{valueName:e})}dR("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),dR("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class vR{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw mR("App Configuration Object");if(!e.name)throw mR("App Name");var t=e["options"];for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw mR(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}const yR=e=>{const t=new vR(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(pR(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(async function(e,t){var n;(n=e["newSubscription"])?(n=await eR(t.firebaseDependencies),await lR(t),t.vapidKey=null!==(n=null===(n=null==n?void 0:n.subscriptionOptions)||void 0===n?void 0:n.vapidKey)&&void 0!==n?n:qN,await cR(t)):await lR(t)}(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(fR(e))}),t};function _R(e,t){return function(e,t){if(void 0!==self.document)throw rR.create("only-available-in-sw");return e.onBackgroundMessageHandler=t,()=>{e.onBackgroundMessageHandler=null}}(e=X(e),t)}Ve(new Z("messaging-sw",yR,"PUBLIC"));var wR,bR,IR;class TR{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return async function(e,t){return xN(e=X(e),t)}(this._delegate,e)}async deleteToken(){return FN(this._delegate)}onMessage(e){return UN(this._delegate,e)}onBackgroundMessage(e){return _R(this._delegate,e)}}const ER=e=>self&&"ServiceWorkerGlobalScope"in self?new TR(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new TR(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),kR={isSupported:function(){return self&&"ServiceWorkerGlobalScope"in self?_()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"undefined"!=typeof window&&_()&&b()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}};ft.INTERNAL.registerComponent(new Z("messaging-compat",ER,"PUBLIC").setServiceProps(kR)),ft.registerVersion("@firebase/messaging-compat","0.1.16");const CR="firebasestorage.googleapis.com",SR="storageBucket";class AR extends I{constructor(e,t){super(NR(e),`Firebase Storage: ${t} (${NR(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,AR.prototype)}_codeEquals(e){return NR(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function NR(e){return"storage/"+e}function RR(){return new AR("unknown","An unknown error occurred, please check the error payload for server response.")}function xR(){return new AR("canceled","User canceled the upload/download.")}function DR(){return new AR("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function PR(e){return new AR("invalid-argument",e)}function OR(){return new AR("app-deleted","The Firebase app was deleted.")}function MR(e){return new AR("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function LR(e,t){return new AR("invalid-format","String does not match format '"+e+"': "+t)}function FR(e){throw new AR("internal-error","Internal error: "+e)}class UR{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=UR.makeFromUrl(t,e)}catch(e){return new UR(t,"")}if(""===n.path)return n;throw t=t,new AR("invalid-default-bucket","Invalid default bucket '"+t+"'.")}static makeFromUrl(e,t){let n=null;var r="([A-Za-z0-9.\\-_]+)";var i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var a=t.replace(/[.]/g,"\\."),o=new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),a=t===CR?"(?:storage.googleapis.com|storage.cloud.google.com)":t,c=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${a}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let h=0;h<c.length;h++){const d=c[h];var l=d.regex.exec(e);if(l){var u=l[d.indices.bucket];let e=l[d.indices.path];e=e||"",n=new UR(u,e),d.postModify(n);break}}if(null==n)throw t=e,new AR("invalid-url","Invalid URL '"+t+"'.");return n}}class qR{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function VR(e){return"string"==typeof e||e instanceof String}function BR(e){return jR()&&e instanceof Blob}function jR(){return"undefined"!=typeof Blob}function KR(e,t,n,r){if(r<t)throw PR(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n<r)throw PR(`Invalid value for '${e}'. Expected ${n} or less.`)}function $R(e,t,n){let r=null==n?`https://${t}`:t;return`${n}://${r}/v0${e}`}function WR(e){const t=encodeURIComponent;let n="?";for(const i in e){var r;e.hasOwnProperty(i)&&(r=t(i)+"="+t(e[i]),n=n+r+"&")}return n=n.slice(0,-1),n}(mt=wR=wR||{})[mt.NO_ERROR=0]="NO_ERROR",mt[mt.NETWORK_ERROR=1]="NETWORK_ERROR",mt[mt.ABORT=2]="ABORT";class zR{constructor(e,t,n,r,i,s,a,o,c,l,u){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){var e=(r,e)=>{if(e)r(!1,new GR(!1,null,!0));else{const i=this.connectionFactory_();this.pendingConnection_=i;const s=e=>{var t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&i.addUploadProgressListener(s),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&i.removeUploadProgressListener(s),this.pendingConnection_=null;var e,t=i.getErrorCode()===wR.NO_ERROR,n=i.getStatus();t&&!this.isRetryStatusCode_(n)?(e=-1!==this.successCodes_.indexOf(n),r(!0,new GR(e,i))):(e=i.getErrorCode()===wR.ABORT,r(!1,new GR(!1,null,e)))})}},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=this.callback_(i,i.getResponse());void 0!==s?n(s):n()}catch(e){r(e)}else if(null!==i){const o=RR();o.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,o)):r(o)}else{var a;t.canceled?(a=(this.appDelete_?OR:xR)(),r(a)):(a=new AR("retry-limit-exceeded","Max retry time for operation exceeded, please try again."),r(a))}};this.canceled_?t(0,new GR(!1,null,!0)):this.backoffId_=function(t,n,e){let r=1,i=null,s=null,a=!1,o=0;function c(){return 2===o}let l=!1;function u(...e){l||(l=!0,n.apply(null,e))}function h(e){i=setTimeout(()=>{i=null,t(p,c())},e)}function d(){s&&clearTimeout(s)}function p(t,...n){if(l)d();else{if(t)return d(),void u.call(null,t,...n);if(c()||a)return d(),void u.call(null,t,...n);r<64&&(r*=2);let e;e=1===o?(o=2,0):1e3*(r+Math.random()),h(e)}}let f=!1;function g(e){f||(f=!0,d(),l||(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),s=setTimeout(()=>{g(a=!0)},e),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(e){var t=500<=e&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||r}}class GR{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function HR(...t){const n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){const r=new n;for(let e=0;e<t.length;e++)r.append(t[e]);return r.getBlob()}if(jR())return new Blob(t);throw new AR("unsupported-environment","This browser doesn't seem to support creating Blobs")}const QR={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class YR{constructor(e,t){this.data=e,this.contentType=t||null}}function JR(e,t){switch(e){case QR.RAW:return new YR(XR(t));case QR.BASE64:case QR.BASE64URL:return new YR(ZR(e,t));case QR.DATA_URL:return new YR((n=t,(r=new ex(n)).base64?ZR(QR.BASE64,r.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw LR(QR.DATA_URL,"Malformed data URL.")}return XR(t)}(r.rest)),(n=t,new ex(n).contentType))}var n,r;throw RR()}function XR(t){const n=[];for(let s=0;s<t.length;s++){let e=t.charCodeAt(s);var r,i;e<=127?n.push(e):e<=2047?n.push(192|e>>6,128|63&e):55296==(64512&e)?s<t.length-1&&56320==(64512&t.charCodeAt(s+1))?(r=e,i=t.charCodeAt(++s),e=65536|(1023&r)<<10|1023&i,n.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):n.push(239,191,189):56320==(64512&e)?n.push(239,191,189):n.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(n)}function ZR(t,e){switch(t){case QR.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw LR(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case QR.BASE64URL:r=-1!==e.indexOf("+"),n=-1!==e.indexOf("/");if(r||n)throw LR(t,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=atob(e)}catch(e){throw LR(t,"Invalid character found")}const s=new Uint8Array(i.length);for(let a=0;a<i.length;a++)s[a]=i.charCodeAt(a);return s}class ex{constructor(e){this.base64=!1,this.contentType=null;var t,n,r=e.match(/^data:([^,]+)?,/);if(null===r)throw LR(QR.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const i=r[1]||null;null!=i&&(this.base64=(t=i,n=";base64",t.length>=n.length&&t.substring(t.length-n.length)===n),this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=e.substring(e.indexOf(",")+1)}}class tx{constructor(e,t){let n=0,r="";BR(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(BR(this.data_)){var n=this.data_,n=(i=e,s=t,(r=n).webkitSlice?r.webkitSlice(i,s):r.mozSlice?r.mozSlice(i,s):r.slice?r.slice(i,s):null);return null===n?null:new tx(n)}var r,i,s,n=new Uint8Array(this.data_.buffer,e,t-e);return new tx(n,!0)}static getBlob(...e){if(jR()){var t=e.map(e=>e instanceof tx?e.data_:e);return new tx(HR.apply(null,t))}{const r=e.map(e=>VR(e)?JR(QR.RAW,e).data:e.data_);let t=0;r.forEach(e=>{t+=e.byteLength});const i=new Uint8Array(t);let n=0;return r.forEach(e=>{for(let t=0;t<e.length;t++)i[n++]=e[t]}),new tx(i,!0)}}uploadData(){return this.data_}}function nx(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function rx(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function ix(e,t){return t}class sx{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||ix}}let ax=null;function ox(){if(ax)return ax;const e=[];e.push(new sx("bucket")),e.push(new sx("generation")),e.push(new sx("metageneration")),e.push(new sx("name","fullPath",!0));const t=new sx("name");t.xform=function(e,t){return!VR(t=t)||t.length<2?t:rx(t)},e.push(t);const n=new sx("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new sx("timeCreated")),e.push(new sx("updated")),e.push(new sx("md5Hash",null,!0)),e.push(new sx("cacheControl",null,!0)),e.push(new sx("contentDisposition",null,!0)),e.push(new sx("contentEncoding",null,!0)),e.push(new sx("contentLanguage",null,!0)),e.push(new sx("contentType",null,!0)),e.push(new sx("metadata","customMetadata",!0)),ax=e,ax}function cx(n,r){Object.defineProperty(n,"ref",{get:function(){var e=n.bucket,t=n.fullPath,t=new UR(e,t);return r._makeStorageReference(t)}})}function lx(e,t,n){var r=nx(t);return null===r?null:function(e,t,n){const r={type:"file"};var i=n.length;for(let s=0;s<i;s++){const a=n[s];r[a.local]=a.xform(r,t[a.server])}return cx(r,e),r}(e,r,n)}function ux(e,t){const n={};var r=t.length;for(let s=0;s<r;s++){var i=t[s];i.writable&&(n[i.server]=e[i.local])}return JSON.stringify(n)}const hx="prefixes";function dx(e,t,n){var r=nx(n);return null===r?null:function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[hx])for(const a of n[hx]){var i=a.replace(/\/$/,""),i=e._makeStorageReference(new UR(t,i));r.prefixes.push(i)}if(n.items)for(const o of n.items){var s=e._makeStorageReference(new UR(t,o.name));r.items.push(s)}return r}(e,t,r)}class px{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function fx(e){if(!e)throw RR()}function gx(r,i){return function(e,t){var n=lx(r,t,i);return fx(null!==n),n}}function mx(r,i){return function(e,t){var n=dx(r,i,t);return fx(null!==n),n}}function vx(r,i){return function(e,t){var n=lx(r,t,i);return fx(null!==n),function(r,e,i,s){var t=nx(e);if(null===t)return null;if(!VR(t.downloadTokens))return null;const n=t.downloadTokens;if(0===n.length)return null;const a=encodeURIComponent,o=n.split(",");return o.map(e=>{var t=r.bucket,n=r.fullPath;return $R("/b/"+a(t)+"/o/"+a(n),i,s)+WR({alt:"media",token:e})})[0]}(n,t,r.host,r._protocol)}}function yx(i){return function(e,t){let n;var r;return n=401===e.getStatus()?e.getErrorText().includes("Firebase App Check token is invalid")?new AR("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new AR("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=i.bucket,new AR("quota-exceeded","Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(e=i.path,new AR("unauthorized","User does not have permission to access '"+e+"'.")):t,n.serverResponse=t.serverResponse,n}}function _x(r){const i=yx(r);return function(e,t){let n=i(e,t);return 404===e.getStatus()&&(n=(e=r.path,new AR("object-not-found","Object '"+e+"' does not exist."))),n.serverResponse=t.serverResponse,n}}function wx(e,t,n){var r=$R(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new px(r,"GET",gx(e,n),i);return s.errorHandler=_x(t),s}function bx(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=(e=t,(t=null)&&t.contentType||e&&e.type()||"application/octet-stream")),r}function Ix(e,t,n,r,i){var s=t.bucketOnlyServerUrl();const a={"X-Goog-Upload-Protocol":"multipart"};var o=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+o;var c=bx(t,r,i),l="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+ux(c,n)+"\r\n--"+o+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",o="\r\n--"+o+"--";const u=tx.getBlob(l,r,o);if(null===u)throw DR();o={name:c.fullPath},c=$R(s,e.host,e._protocol),s=e.maxUploadRetryTime;const h=new px(c,"POST",gx(e,n),s);return h.urlParams=o,h.headers=a,h.body=u.uploadData(),h.errorHandler=yx(t),h}class Tx{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function Ex(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){fx(!1)}const r=t||["active"];return fx(!!n&&-1!==r.indexOf(n)),n}function kx(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),a=bx(t,r,i),o={name:a.fullPath},c=$R(s,e.host,e._protocol),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},s=ux(a,n),a=e.maxUploadRetryTime;const u=new px(c,"POST",function(e){Ex(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){fx(!1)}return fx(VR(t)),t},a);return u.urlParams=o,u.headers=l,u.body=s,u.errorHandler=yx(t),u}function Cx(e,t,n,i){var r=e.maxUploadRetryTime;const s=new px(n,"POST",function(e){var t=Ex(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){fx(!1)}n||fx(!1);var r=Number(n);return fx(!isNaN(r)),new Tx(r,i.size(),"final"===t)},r);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=yx(t),s}function Sx(e,a,t,o,n,c,r,i){const l=new Tx(0,0);if(r?(l.current=r.current,l.total=r.total):(l.current=0,l.total=o.size()),o.size()!==l.total)throw new AR("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var s=l.total-l.current;let u=s;0<n&&(u=Math.min(u,n));var h=l.current,d=h+u,s={"X-Goog-Upload-Command":u===s?"upload, finalize":"upload","X-Goog-Upload-Offset":`${l.current}`};const p=o.slice(h,d);if(null===p)throw DR();d=a.maxUploadRetryTime;const f=new px(t,"POST",function(e,t){var n=Ex(e,["active","final"]),r=l.current+u,i=o.size();let s;return s="final"===n?gx(a,c)(e,t):null,new Tx(r,i,"final"===n,s)},d);return f.headers=s,f.body=p.uploadData(),f.progressCallback=i||null,f.errorHandler=yx(e),f}const Ax={STATE_CHANGED:"state_changed"},Nx={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Rx(e){switch(e){case"running":case"pausing":case"canceling":return Nx.RUNNING;case"paused":return Nx.PAUSED;case"success":return Nx.SUCCESS;case"canceled":return Nx.CANCELED;default:return Nx.ERROR}}class xx{constructor(e,t,n){var r;"function"==typeof e||null!=t||null!=n?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0):(this.next=(r=e).next,this.error=r.error,this.complete=r.complete)}}function Dx(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class Px extends class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=wR.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=wR.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=wR.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw FR("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw FR("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw FR("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw FR("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw FR("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}{initXhr(){this.xhr_.responseType="text"}}function Ox(){return new Px}class Mx{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=ox(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=e,this._transition("error"))},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(n){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":n(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var n=kx(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,Ox,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const i=this._uploadUrl;this._resolveToken((e,t)=>{var n=Cx(this._ref.storage,this._ref._location,i,this._blob);const r=this._ref.storage._makeRequest(n,Ox,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const i=262144*this._chunkMultiplier,s=new Tx(this._transferred,this._blob.size()),a=this._uploadUrl;this._resolveToken((e,t)=>{let n;try{n=Sx(this._ref._location,this._ref.storage,a,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const r=this._ref.storage._makeRequest(n,Ox,e,t);this._request=r,r.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var n=wx(this._ref.storage,this._ref._location,this._mappings);const r=this._ref.storage._makeRequest(n,Ox,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var n=Ix(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,Ox,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request&&this._request.cancel();break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=xR(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=Rx(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new xx(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){var t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise();const e=this._observers.slice();e.forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(Rx(this._state)){case Nx.SUCCESS:Dx(this._resolve.bind(null,this.snapshot))();break;case Nx.CANCELED:case Nx.ERROR:const t=this._reject;Dx(t.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Rx(this._state)){case Nx.RUNNING:case Nx.PAUSED:e.next&&Dx(e.next.bind(e,this.snapshot))();break;case Nx.SUCCESS:e.complete&&Dx(e.complete.bind(e))();break;case Nx.CANCELED:case Nx.ERROR:default:e.error&&Dx(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class Lx{constructor(e,t){this._service=e,t instanceof UR?this._location=t:this._location=UR.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Lx(e,t)}get root(){var e=new UR(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return rx(this._location.path)}get storage(){return this._service}get parent(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;e=new UR(this._location.bucket,e);return new Lx(this._service,e)}_throwIfRoot(e){if(""===this._location.path)throw MR(e)}}function Fx(e){const t={prefixes:[],items:[]};return async function e(t,n,r){const i={pageToken:r};const s=await Ux(t,i);n.prefixes.push(...s.prefixes);n.items.push(...s.items);null!=s.nextPageToken&&await e(t,n,s.nextPageToken)}(e,t).then(()=>t)}function Ux(e,t){null!=t&&"number"==typeof t.maxResults&&KR("options.maxResults",1,1e3,t.maxResults);var n=t||{},n=function(e,t,n,r,i){const s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&0<n.length&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i);var a=$R(t.bucketOnlyServerUrl(),e.host,e._protocol),o=e.maxOperationRetryTime;const c=new px(a,"GET",mx(e,t.bucket),o);return c.urlParams=s,c.errorHandler=yx(t),c}(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(n,Ox)}function qx(e,t){e._throwIfRoot("updateMetadata");var n=function(e,t,n,r){var i=$R(t.fullServerUrl(),e.host,e._protocol),s=ux(n,r),a=e.maxOperationRetryTime;const o=new px(i,"PATCH",gx(e,r),a);return o.headers={"Content-Type":"application/json; charset=utf-8"},o.body=s,o.errorHandler=_x(t),o}(e.storage,e._location,t,ox());return e.storage.makeRequestWithTokens(n,Ox)}function Vx(e){e._throwIfRoot("getDownloadURL");var t=function(e,t,n){var r=$R(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new px(r,"GET",vx(e,n),i);return s.errorHandler=_x(t),s}(e.storage,e._location,ox());return e.storage.makeRequestWithTokens(t,Ox).then(e=>{if(null===e)throw new AR("no-download-url","The given file does not have any download URLs.");return e})}function Bx(e){e._throwIfRoot("deleteObject");var t=function(e,t){var n=$R(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime;const i=new px(n,"DELETE",function(e,t){},r);return i.successCodes=[200,204],i.errorHandler=_x(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,Ox)}function jx(e,t){var n,r=(n=e._location.path,r=t.split("/").filter(e=>0<e.length).join("/"),0===n.length?r:n+"/"+r),r=new UR(e._location.bucket,r);return new Lx(e.storage,r)}function Kx(e,t){if(e instanceof zx){var n=e;if(null==n._bucket)throw new AR("no-default-bucket","No default bucket found. Did you set the '"+SR+"' property when initializing the app?");n=new Lx(n,n._bucket);return null!=t?Kx(n,t):n}return void 0!==t?jx(e,t):e}function $x(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof zx)return n=e,r=t,new Lx(n,r);throw PR("To use ref(service, url), the first argument must be a Storage instance.")}return Kx(e,t);var n,r}function Wx(e,t){var n=null==t?void 0:t[SR];return null==n?null:UR.makeFromBucketSpec(n,e)}class zx{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=CR,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?UR.makeFromBucketSpec(r,this._host):Wx(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=UR.makeFromBucketSpec(this._url,e):this._bucket=Wx(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){KR("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){KR("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){var t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Lx(this,e)}_makeRequest(e,t,n,r){if(this._deleted)return new qR(OR());{const l=(i=e,s=this._appId,a=n,e=r,n=t,r=this._firebaseVersion,o=WR(i.urlParams),c=i.url+o,o=Object.assign({},i.headers),t=o,(s=s)&&(t["X-Firebase-GMPID"]=s),s=o,null!==(a=a)&&0<a.length&&(s.Authorization="Firebase "+a),r=r,o["X-Firebase-Storage-Version"]="webjs/"+(null!=r?r:"AppManager"),r=o,null!==(e=e)&&(r["X-Firebase-AppCheck"]=e),new zR(c,i.method,o,i.body,i.successCodes,i.additionalRetryCodes,i.handler,i.errorHandler,i.timeout,i.progressCallback,n));return this._requests.add(l),l.getPromise().then(()=>this._requests.delete(l),()=>this._requests.delete(l)),l}var i,s,a,o,c}async makeRequestWithTokens(e,t){var[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const Gx="@firebase/storage";function Hx(e,t,n){return e=X(e),t=t,n=n,(e=e)._throwIfRoot("uploadBytesResumable"),new Mx(e,new tx(t),n)}function Qx(e){return function(e){e._throwIfRoot("getMetadata");var t=wx(e.storage,e._location,ox());return e.storage.makeRequestWithTokens(t,Ox)}(e=X(e))}function Yx(e,t){return $x(e=X(e),t)}function Jx(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";var i=r["mockUserToken"];i&&(e._overrideAuthToken="string"==typeof i?i:o(i,e.app.options.projectId))}(e,t,n,r)}function Xx(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new zx(n,r,i,t,$e)}Ve(new Z("storage",Xx,"PUBLIC").setMultipleInstances(!0)),He(Gx,"0.9.9",""),He(Gx,"0.9.9","esm2017");class Zx{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class eD{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new Zx(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new Zx(e,this,this._ref))},e)}on(e,t,n,r){let i=void 0;return t&&(i="function"==typeof t?e=>t(new Zx(e,this,this._ref)):{next:t.next?e=>t.next(new Zx(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class tD{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new nD(e,this._service))}get items(){return this._delegate.items.map(e=>new nD(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class nD{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){var t=jx(this._delegate,e);return new nD(t,this.storage)}get root(){return new nD(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new nD(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new eD(Hx(this._delegate,e,t),this)}putString(e,t=QR.RAW,n){this._throwIfRoot("putString");var r=JR(t,e);const i=Object.assign({},n);return null==i.contentType&&null!=r.contentType&&(i.contentType=r.contentType),new eD(new Mx(this._delegate,new tx(r.data,!0),i),this)}listAll(){return Fx(X(this._delegate)).then(e=>new tD(e,this.storage))}list(e){return t=this._delegate,e=e||void 0,Ux(t=X(t),e).then(e=>new tD(e,this.storage));var t}getMetadata(){return Qx(this._delegate)}updateMetadata(e){return qx(X(this._delegate),e)}getDownloadURL(){return Vx(X(this._delegate))}delete(){return this._throwIfRoot("delete"),Bx(X(this._delegate))}_throwIfRoot(e){if(""===this._delegate._location.path)throw MR(e)}}class rD{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(iD(e))throw PR("ref() expected a child path but got a URL, use refFromURL instead.");return new nD(Yx(this._delegate,e),this)}refFromURL(e){if(!iD(e))throw PR("refFromURL() expected a full URL but got a child path, use ref() instead.");try{UR.makeFromUrl(e,this._delegate.host)}catch(e){throw PR("refFromUrl() expected a valid full URL but got an invalid one.")}return new nD(Yx(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){Jx(this._delegate,e,t,n)}}function iD(e){return/^[A-Za-z]+:\/\//.test(e)}function sD(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("storage").getImmediate({identifier:t});return new rD(n,r)}bR=ft,IR={TaskState:Nx,TaskEvent:Ax,StringFormat:QR,Storage:rD,Reference:nD},bR.INTERNAL.registerComponent(new Z("storage-compat",sD,"PUBLIC").setServiceProps(IR).setMultipleInstances(!0)),bR.registerVersion("@firebase/storage-compat","0.1.17");const aD="@firebase/performance",oD="0.5.12",cD=oD,lD="FB-PERF-TRACE-MEASURE",uD="@firebase/performance/config",hD="@firebase/performance/configexpire";var dD,pD,fD,gD="Performance";const mD=new T("performance",gD,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),vD=new ue(gD);vD.logLevel=ie.INFO;let yD,_D;class wD{constructor(e){if(!(this.window=e))throw mD.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&b()?!!_()||(vD.info("IndexedDB is not supported by current browswer"),!1):(vD.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,n){if(this.PerformanceObserver){const t=new this.PerformanceObserver(e=>{for(const t of e.getEntries())n(t)});t.observe({entryTypes:[e]})}}static getInstance(){return void 0===yD&&(yD=new wD(_D)),yD}}let bD;function ID(e,t){var n=e.length-t.length;if(n<0||1<n)throw mD.create("invalid String merger input");const r=[];for(let i=0;i<e.length;i++)r.push(e.charAt(i)),t.length>i&&r.push(t.charAt(i));return r.join("")}let TD;class ED{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=ID("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=ID("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===TD&&(TD=new ED),TD}}(mt=dD=dD||{})[mt.UNKNOWN=0]="UNKNOWN",mt[mt.VISIBLE=1]="VISIBLE",mt[mt.HIDDEN=2]="HIDDEN";const kD=["firebase_","google_","ga_"],CD=new RegExp("^[a-zA-Z]\\w*$");function SD(){switch(wD.getInstance().document.visibilityState){case"visible":return dD.VISIBLE;case"hidden":return dD.HIDDEN;default:return dD.UNKNOWN}}function AD(e){var t=null===(t=e.options)||void 0===t?void 0:t.appId;if(!t)throw mD.create("no app id");return t}const ND="0.0.1",RD={loggingEnabled:!0},xD="FIREBASE_INSTALLATIONS_AUTH";function DD(e,t){var r,i,n=function(){const e=wD.getInstance().localStorage;if(e){var t=e.getItem(hD);if(t&&function(e){return Number(e)>Date.now()}(t)){t=e.getItem(uD);if(t)try{return JSON.parse(t)}catch(e){return}}}}();return n?(OD(n),Promise.resolve()):(i=t,function(e){const t=e.getToken();return t.then(e=>{}),t}((r=e).installations).then(e=>{var t=function(e){var t=null===(t=e.options)||void 0===t?void 0:t.projectId;if(!t)throw mD.create("no project id");return t}(r.app),n=function(e){var t=null===(t=e.options)||void 0===t?void 0:t.apiKey;if(!t)throw mD.create("no api key");return t}(r.app),n=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=${n}`,{method:"POST",headers:{Authorization:`${xD} ${e}`},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:AD(r.app),app_version:cD,sdk_version:ND})});return fetch(n).then(e=>{if(e.ok)return e.json();throw mD.create("RC response not ok")})}).catch(()=>{vD.info(PD)}).then(OD).then(e=>function(e){const t=wD.getInstance().localStorage;e&&t&&(t.setItem(uD,JSON.stringify(e)),t.setItem(hD,String(Date.now()+60*ED.getInstance().configTimeToLive*60*1e3)))}(e),()=>{}))}const PD="Could not fetch config, will use default configs";function OD(e){if(!e)return e;const t=ED.getInstance();var n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=RD.loggingEnabled,n.fpr_log_source?t.logSource=Number(n.fpr_log_source):RD.logSource&&(t.logSource=RD.logSource),n.fpr_log_endpoint_url?t.logEndPointUrl=n.fpr_log_endpoint_url:RD.logEndPointUrl&&(t.logEndPointUrl=RD.logEndPointUrl),n.fpr_log_transport_key?t.transportKey=n.fpr_log_transport_key:RD.transportKey&&(t.transportKey=RD.transportKey),void 0!==n.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate):void 0!==RD.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=RD.networkRequestsSamplingRate),void 0!==n.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate):void 0!==RD.tracesSamplingRate&&(t.tracesSamplingRate=RD.tracesSamplingRate),t.logTraceAfterSampling=MD(t.tracesSamplingRate),t.logNetworkAfterSampling=MD(t.networkRequestsSamplingRate),e}function MD(e){return Math.random()<=e}let LD=1,FD;function UD(e){var t;return LD=2,FD=FD||(t=e,function(){const n=wD.getInstance().document;return new Promise(e=>{if(n&&"complete"!==n.readyState){const t=()=>{"complete"===n.readyState&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}().then(()=>function(e){const t=e.getId();return t.then(e=>{bD=e}),t}(t.installations)).then(e=>DD(t,e)).then(()=>qD(),()=>qD())),FD}function qD(){LD=3}const VD=1e4,BD=3,jD=1e3;let KD=BD,$D=[],WD=!1;function zD(e){setTimeout(()=>{if(0!==KD)return $D.length?void function(){const e=$D.splice(0,jD),t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:ED.getInstance().logSource,log_event:t};!function(e,r){return function(e){var t=ED.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}(e).then(e=>(e.ok||vD.info("Call to Firebase backend failed."),e.json())).then(e=>{var t=Number(e.nextRequestWaitMillis);let n=VD;isNaN(t)||(n=Math.max(t,n));t=e.logResponseDetails;Array.isArray(t)&&0<t.length&&"RETRY_REQUEST_LATER"===t[0].responseAction&&($D=[...r,...$D],vD.info("Retry transport request later.")),KD=BD,zD(n)})}(n,e).catch(()=>{$D=[...e,...$D],KD--,vD.info(`Tries left: ${KD}.`),zD(VD)})}():zD(VD)},e)}function GD(t){return(...e)=>{!function(e){if(!e.eventTime||!e.message)throw mD.create("invalid cc log");$D=[...$D,e]}({message:t(...e),eventTime:Date.now()})}}let HD;function QD(e,t){HD=HD||GD(XD),HD(e,t)}function YD(e){var t=ED.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&wD.getInstance().requiredApisAvailable()&&(e.isAuto&&SD()!==dD.VISIBLE||(3===LD?JD(e):UD(e.performanceController).then(()=>JD(e),()=>JD(e))))}function JD(e){var t;!bD||(t=ED.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>QD(e,1),0)}function XD(e,t){return 0===t?(n={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},n={application_info:ZD(e.performanceController.app),network_request_metric:n},JSON.stringify(n)):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);var n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);n={application_info:ZD(e.performanceController.app),trace_metric:t};return JSON.stringify(n)}(e);var n}function ZD(e){return{google_app_id:AD(e),app_instance_id:bD,web_app_info:{sdk_version:cD,page_url:wD.getInstance().getUrl(),service_worker_status:"serviceWorker"in(t=wD.getInstance().navigator)?t.serviceWorker.controller?2:3:1,visibility_state:SD(),effective_connection_type:function(){var e=wD.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0};var t}const eP=["_fp","_fcp","_fid"];class tP{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=wD.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=r||`${lD}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw mD.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw mD.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),YD(this)}record(e,t,n){if(e<=0)throw mD.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw mD.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const r of Object.keys(n.metrics))isNaN(Number(n.metrics[r]))||(this.counters[r]=Math.floor(Number(n.metrics[r])));YD(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(r=e,i=this.name,0===r.length||100<r.length||!(i&&i.startsWith("_wt_")&&-1<eP.indexOf(r))&&r.startsWith("_"))throw mD.create("invalid custom metric name",{customMetricName:e});var n,r,i;this.counters[e]=(t=null!=t?t:0,(n=Math.floor(t))<t&&vD.info(`Metric value should be an Integer, setting the value as : ${n}.`),n)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var n,r,i=!(0===(n=e).length||40<n.length)&&(!kD.some(e=>n.startsWith(e))&&!!n.match(CD)),s=0!==(r=t).length&&r.length<=100;if(i&&s)this.customAttributes[e]=t;else{if(!i)throw mD.create("invalid attribute name",{attributeName:e});if(!s)throw mD.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure),e=e&&e[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){var i=wD.getInstance().getUrl();if(i){const s=new tP(e,"_wt_"+i,!0);i=Math.floor(1e3*wD.getInstance().getTimeOrigin());s.setStartTime(i),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));n&&((i=n.find(e=>"first-paint"===e.name))&&i.startTime&&s.putMetric("_fp",Math.floor(1e3*i.startTime)),(i=n.find(e=>"first-contentful-paint"===e.name))&&i.startTime&&s.putMetric("_fcp",Math.floor(1e3*i.startTime)),r&&s.putMetric("_fid",Math.floor(1e3*r))),YD(s)}}static createUserTimingTrace(e,t){YD(new tP(e,t,!1,t))}}function nP(e,t){const n=t;var r,i,s;n&&void 0!==n.responseStart&&(s=wD.getInstance().getTimeOrigin(),r=Math.floor(1e3*(n.startTime+s)),i=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,s=Math.floor(1e3*(n.responseEnd-n.startTime)),function(e){const t=ED.getInstance();var n,r,i;t.instrumentationEnabled&&(n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0],n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout(()=>QD(e,0),0))}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:s}))}const rP=5e3;function iP(e){bD&&(setTimeout(()=>function(n){const e=wD.getInstance(),r=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let t=setTimeout(()=>{tP.createOobTrace(n,r,i),t=void 0},rP);e.onFirstInputDelay(e=>{t&&(clearTimeout(t),tP.createOobTrace(n,r,i,e))})}else tP.createOobTrace(n,r,i)}(e),0),setTimeout(()=>function(t){const e=wD.getInstance(),n=e.getEntriesByType("resource");for(const r of n)nP(t,r);e.setupObserver("resource",e=>nP(t,e))}(e),0),setTimeout(()=>function(t){const e=wD.getInstance(),n=e.getEntriesByType("measure");for(const r of n)sP(t,r);e.setupObserver("measure",e=>sP(t,e))}(e),0))}function sP(e,t){const n=t.name;n.substring(0,lD.length)!==lD&&tP.createUserTimingTrace(e,n)}class aP{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),wD.getInstance().requiredApisAvailable()?w().then(e=>{e&&(WD||(zD(5500),WD=!0),UD(this).then(()=>iP(this),()=>iP(this)),this.initialized=!0)}).catch(e=>{vD.info(`Environment doesn't support IndexedDB: ${e}`)}):vD.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){ED.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return ED.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){ED.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return ED.getInstance().dataCollectionEnabled}}const oP="[DEFAULT]";const cP=(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if(n.name!==oP)throw mD.create("FB not default");if("undefined"==typeof window)throw mD.create("no window");e=window,_D=e;const i=new aP(n,r);return i._init(t),i};Ve(new Z("performance",cP,"PUBLIC")),He(aD,oD),He(aD,oD,"esm2017");class lP{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=this._delegate,e=e,t=X(t),new tP(t,e);var t}}function uP(e){var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("performance").getImmediate();return new lP(t,n)}(pD=ft).INTERNAL.registerComponent(new Z("performance-compat",uP,"PUBLIC")),pD.registerVersion("@firebase/performance-compat","0.1.12");const hP="@firebase/remote-config";class dP{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const pP=new T("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"});const fP=["1","true","t","yes","y","on"];class gP{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=fP.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return isNaN(e)&&(e=0),e}getSource(){return this._source}}async function mP(e){const t=X(e);var[n,r]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(n&&n.config&&n.eTag&&n.eTag!==r)&&(await Promise.all([t._storageCache.setActiveConfig(n.config),t._storage.setActiveConfigEtag(n.eTag)]),!0)}function vP(e){const t=X(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function yP(t){const n=X(t),e=new dP;setTimeout(async()=>{e.abort()},n.settings.fetchTimeoutMillis);try{await n._client.fetch({cacheMaxAgeMillis:n.settings.minimumFetchIntervalMillis,signal:e}),await n._storageCache.setLastFetchStatus("success")}catch(e){var r=(i="fetch-throttle",(t=e)instanceof I&&-1!==t.code.indexOf(i)?"throttle":"failure");throw await n._storageCache.setLastFetchStatus(r),e}var i}function _P(n){const e=X(n);return[t={},r={}]=[e._storageCache.getActiveConfig(),e.defaultConfig],Object.keys(Object.assign(Object.assign({},t),r)).reduce((e,t)=>(e[t]=wP(n,t),e),{});var t,r}function wP(e,t){const n=X(e);n._isInitializationComplete||n._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value.");var r=n._storageCache.getActiveConfig();return r&&void 0!==r[t]?new gP("remote",r[t]):n.defaultConfig&&void 0!==n.defaultConfig[t]?new gP("default",String(n.defaultConfig[t])):(n._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new gP("static"))}class bP{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-t,r=n<=e;return this.logger.debug("Config fetch cache check."+` Cache age millis: ${n}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${r}.`),r}async fetch(e){var[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag;n=await this.client.fetch(e);const r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===n.status&&r.push(this.storage.setLastSuccessfulFetchResponse(n)),await Promise.all(r),n}}class IP{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(n){var e,[t,r]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,s={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":n.eTag||"*"},r={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:r,app_id:this.appId,language_code:(e=navigator).languages&&e.languages[0]||e.language},r={method:"POST",headers:s,body:JSON.stringify(r)},i=fetch(i,r),r=new Promise((e,t)=>{n.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let a;try{await Promise.race([i,r]),a=await i}catch(e){let t="fetch-client-network";throw"AbortError"===(null===e||void 0===e?void 0:e.name)&&(t="fetch-timeout"),pP.create(t,{originalErrorMessage:null===e||void 0===e?void 0:e.message})}let o=a.status;i=a.headers.get("ETag")||void 0;let c,l;if(200===a.status){let e;try{e=await a.json()}catch(e){throw pP.create("fetch-client-parse",{originalErrorMessage:null===e||void 0===e?void 0:e.message})}c=e.entries,l=e.state}if("INSTANCE_STATE_UNSPECIFIED"===l?o=500:"NO_CHANGE"===l?o=304:"NO_TEMPLATE"!==l&&"EMPTY_CONFIG"!==l||(c={}),304!==o&&200!==o)throw pP.create("fetch-status",{httpStatus:o});return{status:o,eTag:i,config:c}}}class TP{constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(t,{throttleEndTimeMillis:e,backoffCount:n}){var i,s;i=t.signal,s=e,await new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(pP.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var r=await this.client.fetch(t);return await this.storage.deleteThrottleMetadata(),r}catch(e){if(!function(e){if(e instanceof I&&e.customData){var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}}(e))throw e;r={throttleEndTimeMillis:Date.now()+J(n),backoffCount:n+1};return await this.storage.setThrottleMetadata(r),this.attemptFetch(t,r)}}}class EP{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function kP(e,t){var n=e.target.error||void 0;return pP.create(t,{originalErrorMessage:n&&(null===n||void 0===n?void 0:n.message)})}const CP="app_namespace_store";class SP{constructor(e,t,n,r=function(){return new Promise((t,n)=>{try{const e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{n(kP(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(CP,{keyPath:"compositeKey"})}}catch(e){n(pP.create("storage-open",{originalErrorMessage:null===e||void 0===e?void 0:e.message}))}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(a){const o=await this.openDbPromise;return new Promise((n,t)=>{const e=o.transaction([CP],"readonly"),r=e.objectStore(CP);var i=this.createCompositeKey(a);try{const s=r.get(i);s.onerror=e=>{t(kP(e,"storage-get"))},s.onsuccess=e=>{var t=e.target.result;n(t?t.value:void 0)}}catch(e){t(pP.create("storage-get",{originalErrorMessage:null===e||void 0===e?void 0:e.message}))}})}async set(a,o){const c=await this.openDbPromise;return new Promise((e,t)=>{const n=c.transaction([CP],"readwrite"),r=n.objectStore(CP);var i=this.createCompositeKey(a);try{const s=r.put({compositeKey:i,value:o});s.onerror=e=>{t(kP(e,"storage-set"))},s.onsuccess=()=>{e()}}catch(e){t(pP.create("storage-set",{originalErrorMessage:null===e||void 0===e?void 0:e.message}))}})}async delete(a){const o=await this.openDbPromise;return new Promise((e,t)=>{const n=o.transaction([CP],"readwrite"),r=n.objectStore(CP);var i=this.createCompositeKey(a);try{const s=r.delete(i);s.onerror=e=>{t(kP(e,"storage-delete"))},s.onsuccess=()=>{e()}}catch(e){t(pP.create("storage-delete",{originalErrorMessage:null===e||void 0===e?void 0:e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class AP{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),e=await e;e&&(this.lastFetchStatus=e);t=await t;t&&(this.lastSuccessfulFetchTimestampMillis=t);n=await n;n&&(this.activeConfig=n)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}async function NP(){if(!_())return!1;try{return await w()}catch(e){return!1}}Ve(new Z("remote-config",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw pP.create("registration-window");if(!_())throw pP.create("indexed-db-unavailable");var{projectId:i,apiKey:s,appId:a}=n.options;if(!i)throw pP.create("registration-project-id");if(!s)throw pP.create("registration-api-key");if(!a)throw pP.create("registration-app-id");t=t||"firebase";const o=new SP(a,n.name,t),c=new AP(o),l=new ue(hP);l.logLevel=ie.ERROR;a=new IP(r,$e,t,i,s,a),a=new TP(a,o),a=new bP(a,o,c,l),a=new EP(n,a,c,o,l);return vP(a),a},"PUBLIC").setMultipleInstances(!0)),He(hP,"0.3.11"),He(hP,"0.3.11","esm2017");class RP{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return mP(this._delegate)}ensureInitialized(){return vP(this._delegate)}fetch(){return yP(this._delegate)}fetchAndActivate(){return async function(e){return await yP(e=X(e)),mP(e)}(this._delegate)}getAll(){return _P(this._delegate)}getBoolean(e){return wP(X(this._delegate),e).asBoolean()}getNumber(e){return wP(X(this._delegate),e).asNumber()}getString(e){return wP(X(this._delegate),e).asString()}getValue(e){return wP(this._delegate,e)}setLogLevel(e){!function(e,t){const n=X(e);switch(t){case"debug":n._logger.logLevel=ie.DEBUG;break;case"silent":n._logger.logLevel=ie.SILENT;break;default:n._logger.logLevel=ie.ERROR}}(this._delegate,e)}}function xP(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("remote-config").getImmediate({identifier:t});return new RP(n,r)}return(fD=ft).INTERNAL.registerComponent(new Z("remoteConfig-compat",xP,"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:NP})),fD.registerVersion("@firebase/remote-config-compat","0.1.12"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),ft.registerVersion("firebase","9.10.0","compat-cdn"),ft});
//# sourceMappingURL=firebase-compat.js.map
